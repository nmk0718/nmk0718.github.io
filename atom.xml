<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title></title>
  
  
  <link href="http://nmk0718.github.io/atom.xml" rel="self"/>
  
  <link href="http://nmk0718.github.io/"/>
  <updated>2025-01-17T03:28:24.882Z</updated>
  <id>http://nmk0718.github.io/</id>
  
  <author>
    <name>kk</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>OpenTelemetry</title>
    <link href="http://nmk0718.github.io/2025/01/14/OpenTelemetry/"/>
    <id>http://nmk0718.github.io/2025/01/14/OpenTelemetry/</id>
    <published>2025-01-14T03:09:00.000Z</published>
    <updated>2025-01-17T03:28:24.882Z</updated>
    
    <content type="html"><![CDATA[<p>OpenTelemetryï¼ˆç®€ç§°OTelï¼‰æ˜¯ä¸€ä¸ªå¼€æºå¯è§‚æµ‹æ€§æ¡†æ¶ï¼Œç”¨äºä»ªè¡¨åŒ–ã€ç”Ÿæˆã€æ”¶é›†å’Œå¯¼å‡ºè¯¸å¦‚è·Ÿè¸ªã€åº¦é‡ã€æ—¥å¿—ç­‰é¥æµ‹æ•°æ®<br><image src="https://opentelemetry.io/docs/collector/img/otel-collector.svg" alt="Collector"></image></p><p>éƒ¨ç½²å‚è€ƒæ–‡æ¡£ï¼š<br><a href="https://opentelemetry.io/zh/docs" target="_blank" rel="noopener">https://opentelemetry.io/zh/docs</a><br><a href="https://www.zhihu.com/question/545762884/answer/3323681028" target="_blank" rel="noopener">https://www.zhihu.com/question/545762884/answer/3323681028</a></p><h3 id="Instrumentation"><a href="#Instrumentation" class="headerlink" title="Instrumentation"></a>Instrumentation</h3><p>Instrumentation æ˜¯ OpenTelemetry ä¸­ç”¨äºå¯¹åº”ç”¨ç¨‹åºè¿›è¡Œç›‘æ§å’Œæ•°æ®æ”¶é›†ã€‚å®ƒåŒ…æ‹¬æ‰‹åŠ¨ä»ªè¡¨åŒ–ï¼ˆManual Instrumentationï¼‰å’Œè‡ªåŠ¨ä»ªè¡¨åŒ–ï¼ˆAutomatic Instrumentationï¼‰ä¸¤ç§æ–¹å¼ã€‚é€šè¿‡ Instrumentationï¼Œå¼€å‘äººå‘˜å¯ä»¥å°†åº”ç”¨ç¨‹åºçš„è¿è¡Œæ•°æ®ï¼ˆå¦‚è¿½è¸ªã€æŒ‡æ ‡ã€æ—¥å¿—ï¼‰æ”¶é›†å¹¶å‘é€åˆ°åç«¯ç³»ç»Ÿè¿›è¡Œåˆ†æå’Œå¯è§†åŒ–ã€‚</p><ol><li>æ‰‹åŠ¨ä»ªè¡¨åŒ–ï¼š<ul><li>å¼€å‘è€…é€šè¿‡åœ¨ä»£ç ä¸­æ˜¾å¼åœ°æ·»åŠ  OpenTelemetry API è°ƒç”¨ï¼Œæ¥åˆ›å»ºå’Œç®¡ç†è¿½è¸ªã€æŒ‡æ ‡ç­‰é¥æµ‹æ•°æ®ã€‚</li><li>å¯ä»¥å¯¹åº”ç”¨ç¨‹åºçš„ç‰¹å®šéƒ¨åˆ†è¿›è¡Œè¯¦ç»†çš„ç›‘æ§å’Œåˆ†æï¼Œè·å–æ›´æ·±å…¥çš„æ€§èƒ½å’Œè¡Œä¸ºä¿¡æ¯ã€‚</li><li>åœ¨å…³é”®çš„ä¸šåŠ¡é€»è¾‘å¤„æ‰‹åŠ¨åˆ›å»º span æ¥è®°å½•æ“ä½œçš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œä»è€Œç²¾ç¡®åœ°ç›‘æ§ç‰¹å®šä»£ç æ®µçš„æ‰§è¡Œæƒ…å†µã€‚</li></ul></li><li>è‡ªåŠ¨ä»ªè¡¨åŒ–ï¼š<ul><li>æ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºæºä»£ç ï¼Œé€šè¿‡ç‰¹å®šçš„æœºåˆ¶ï¼ˆå¦‚å­—èŠ‚ç æ³¨å…¥ã€ä»£ç†ç­‰ï¼‰è‡ªåŠ¨å¯¹åº”ç”¨ç¨‹åºä¸­çš„å„ç§åº“ã€æ¡†æ¶ç­‰è¿›è¡Œç›‘æ§ï¼Œæ”¶é›†é¥æµ‹æ•°æ®ã€‚</li><li>å‡å°‘æ‰‹åŠ¨æ·»åŠ ç›‘æ§ä»£ç çš„å·¥ä½œé‡ï¼Œå¿«é€Ÿä¸ºåº”ç”¨ç¨‹åºæ·»åŠ åŸºæœ¬çš„ç›‘æ§èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼ŒOpenTelemetry çš„ Java è‡ªåŠ¨ä»ªè¡¨åŒ–å¯ä»¥é€šè¿‡ä¸€ä¸ª agent è‡ªåŠ¨æ”¶é›†æ—¥å¿—ã€æŒ‡æ ‡ã€trace å¹¶ä¸ŠæŠ¥ã€‚</li></ul></li></ol><h3 id="Collector"><a href="#Collector" class="headerlink" title="Collector"></a>Collector</h3><p>Collector æ˜¯ä¸€ä¸ªå¼€æºçš„ã€å¯æ‰©å±•çš„ä»£ç†ï¼Œç”¨äºæ¥æ”¶ã€å¤„ç†å’Œå¯¼å‡ºé¥æµ‹æ•°æ®ï¼ˆå¦‚ tracesã€metrics å’Œ logsï¼‰ã€‚å®ƒæä¾›äº†ä¸€ç§å‚å•†ä¸­ç«‹çš„æ–¹å¼æ¥æ”¶é›†ã€å¤„ç†å’Œå¯¼å‡ºé¥æµ‹æ•°æ®ï¼Œæ¶ˆé™¤äº†è¿è¡Œã€æ“ä½œå’Œç»´æŠ¤å¤šä¸ªä»£ç†/æ”¶é›†å™¨çš„éœ€è¦ã€‚</p><h4 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h4><p>åœ¨ä¸ä¿®æ”¹åº”ç”¨ç¨‹åºä»£ç çš„æƒ…å†µä¸‹ï¼Œæ”¶é›†å’Œå¤„ç†é¥æµ‹æ•°æ®ã€‚</p><ol><li>Agentï¼š<ul><li>éƒ¨ç½²æ–¹å¼ï¼šæ¯ä¸ªå®¢æˆ·ç«¯SDKæˆ–ä¸‹æ¸¸é‡‡é›†å™¨éƒ½é…ç½®ä¸€ä¸ªcollectorã€‚æ”¶é›†å™¨å®ä¾‹ä¸åº”ç”¨ç¨‹åºåœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œï¼Œä¾‹å¦‚sidecaræˆ–è€…daemonsetæ–¹å¼ã€‚</li><li>å·¥ä½œæ–¹å¼ï¼šåº”ç”¨ç¨‹åºä¸­çš„SDKä»¥OTLPåè®®å‘é€é¥æµ‹æ•°æ®ç»™collectorã€‚ç„¶åcollectorå¤„ç†é¥æµ‹æ•°æ®å¹¶å¯¹æ¥åˆ°å¯è§‚æµ‹æ€§åç«¯ã€‚<image src="https://opentelemetry.io/zh/docs/collector/img/otel-agent-sdk.svg" alt="Agentå½¢æ€"></image></li></ul></li><li>Gatewayï¼š<ul><li>éƒ¨ç½²æ–¹å¼ï¼šä½¿ç”¨å¼€ç®±å³ç”¨çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆæ¯”å¦‚nginxï¼‰åœ¨otel-collectorä¹‹é—´åˆ†é…è´Ÿè½½ã€‚</li><li>å·¥ä½œæ–¹å¼ï¼šåº”ç”¨ç¨‹åºä¸­çš„SDKä»¥OTLPåè®®å‘é€é¥æµ‹æ•°æ®ç»™è´Ÿè½½å‡è¡¡å™¨ï¼Œè´Ÿè½½å‡è¡¡å™¨æ ¹æ®ç®—æ³•é€‰æ‹©å…¶ä¸­ä¸€ä¸ªcollectorå®ä¾‹è¿›è¡Œå¤„ç†å¹¶å¯¹æ¥åˆ°å¯è§‚æµ‹æ€§åç«¯<image src="https://opentelemetry.io/zh/docs/collector/img/otel-gateway-sdk.svg" alt="Gatewayå½¢æ€"></image></li></ul></li></ol><h4 id="Pipeline-components"><a href="#Pipeline-components" class="headerlink" title="Pipeline components"></a>Pipeline components</h4><ul><li><p>receiverï¼šè´Ÿè´£æŒ‰ç…§å¯¹åº”çš„åè®®æ ¼å¼ç›‘å¬æ¥æ”¶é¥æµ‹æ•°æ®ï¼Œå¹¶æŠŠæ•°æ®è½¬ç»™ä¸€ä¸ªæˆ–è€…å¤šä¸ªprocessorã€‚</p></li><li><p>processorï¼šè´Ÿè´£åšé¥æµ‹æ•°æ®åŠ å·¥å¤„ç†ï¼Œå¦‚ä¸¢å¼ƒæ•°æ®ï¼Œå¢åŠ ä¿¡æ¯ï¼Œè½¬æ‰¹å¤„ç†ç­‰ï¼Œå¹¶æŠŠæ•°æ®ä¼ é€’ç»™ä¸‹ä¸€ä¸ªprocessoræˆ–è€…ä¼ é€’ç»™ä¸€ä¸ªæˆ–å¤šä¸ªexporterã€‚</p></li><li><p>exporterï¼šè´Ÿè´£æŠŠæ•°æ®å¾€ä¸‹ä¸€ä¸ªæ¥æ”¶ç«¯å‘é€ï¼ˆä¸€èˆ¬æ˜¯é¥æµ‹åç«¯ï¼‰ï¼Œexporterå¯ä»¥å®šä¹‰åŒæ—¶ä»å¤šä¸ªä¸åŒçš„processorä¸­è·å–é¥æµ‹æ•°æ®ã€‚</p></li></ul><p>Collector é™¤äº†æä¾›è®©é¥æµ‹æ•°æ®æ”¶é›†ä¸ä¸šåŠ¡é€»è¾‘å¤„ç†æ­£äº¤çš„èƒ½åŠ›ï¼Œè¿˜å……å½“äº†é¥æµ‹æ•°æ®å¯¹æ¥é¥æµ‹åç«¯çš„é€‚é…å™¨ã€‚Collectorå¯ä»¥æ¥æ”¶ Otlpã€Zipkinã€Jaegerç­‰ä»»æ„æ ¼å¼çš„æ•°æ®ï¼Œç„¶åä»¥ Otlpã€Zipkinã€Jaegerç­‰ä»»æ„æ ¼å¼çš„æ•°æ®è½¬å‘å‡ºå»ã€‚è¿™ä¸€åˆ‡åªå–å†³äºä½ éœ€è¦è¾“å…¥æˆ–è¾“å‡ºçš„æ ¼å¼æ˜¯å¦æœ‰å¯¹åº”çš„ receiver å’Œ exporter å®ç°</p><h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h3><h4 id="Jaeger"><a href="#Jaeger" class="headerlink" title="Jaeger"></a>Jaeger</h4><p>ä¸ºäº†ä¾¿äºæ¼”ç¤ºè¿™é‡Œä½¿ç”¨  jaegertracing/all-in-one é•œåƒæ¥éƒ¨ç½² Jaegerï¼Œè¿™ä¸ªé•œåƒåŒ…å«äº† Jaeger æ”¶é›†å™¨ã€å†…å­˜å­˜å‚¨ã€æŸ¥è¯¢æœåŠ¡å’Œ UI ç­‰ç»„ä»¶ï¼Œéå¸¸é€‚åˆå¼€å‘å’Œæµ‹è¯•ä½¿ç”¨ã€‚é€šè¿‡ç¯å¢ƒå˜é‡ <code>COLLECTOR_OTLP_ENABLED</code> å¯åŠ¨å¯¹ OTLPï¼ˆOpenTelemetry Protocolï¼‰ çš„æ”¯æŒã€‚</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="bullet">-</span> <span class="string">&lt;&lt;EOF</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jaeger</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">jaeger</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">jaeger</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jaeger</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">jaegertracing/all-in-one:latest</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">COLLECTOR_OTLP_ENABLED</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"true"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">16686</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">14268</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jaeger</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">jaeger</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ui</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">16686</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">16686</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">collector</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">14268</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">14268</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">4318</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">4318</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grpc</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">4317</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">4317</span>      </span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h4 id="â€‹â€‹OpenTelemetry-Operator"><a href="#â€‹â€‹OpenTelemetry-Operator" class="headerlink" title="â€‹â€‹OpenTelemetry Operator"></a>â€‹â€‹OpenTelemetry Operator</h4><p>OpenTelemetry Operatorç”¨äºç®¡ç†OpenTelemetry æ”¶é›†å™¨(OpenTelemetry Collectors)å’Œå·¥ä½œè´Ÿè½½çš„è‡ªåŠ¨æ£€æµ‹(auto-instrumentation)<br>å®‰è£…OpenTelemetry Operator</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts</span><br><span class="line"></span><br><span class="line">helm install opentelemetry-operator open-telemetry/opentelemetry-operator \</span><br><span class="line">  --<span class="built_in">set</span> <span class="string">"manager.collectorImage.repository=otel/opentelemetry-collector-k8s"</span> \</span><br><span class="line">  --<span class="built_in">set</span> admissionWebhooks.certManager.enabled=<span class="literal">false</span> \</span><br><span class="line">  --<span class="built_in">set</span> admissionWebhooks.autoGenerateCert.enabled=<span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li><code>otel/opentelemetry-collector-k8s</code>ä¸“é—¨ä¸ºKubernetesç¯å¢ƒä¼˜åŒ–çš„ï¼ŒåŒ…å«äº†åœ¨Kubernetesä¸­è¿è¡Œæ‰€éœ€çš„åŸºæœ¬åŠŸèƒ½å’Œæ’ä»¶ã€‚</li><li><code>opentelemetry-collector-contrib</code>åŒ…å«äº†å¤§é‡çš„æ‰©å±•åŠŸèƒ½å’Œå®éªŒæ€§ç»„ä»¶ã€‚è¿™äº›ç»„ä»¶åŒ…æ‹¬å„ç§æ¥æ”¶å™¨ã€å¤„ç†å™¨ã€å¯¼å‡ºå™¨ä»¥åŠæ‰©å±•åŠŸèƒ½ï¼Œæ—¨åœ¨æä¾›æ›´å¹¿æ³›çš„é¥æµ‹æ•°æ®å¤„ç†èƒ½åŠ›<br>å¯ä»¥çœ‹åˆ°å¯¹åº”çš„ Pod å·²ç»æ­£å¸¸è¿è¡Œï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ kubectl --namespace default get pods -l <span class="string">"app.kubernetes.io/name=opentelemetry-operator"</span></span><br><span class="line">NAME                                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">opentelemetry-operator-f78f45ffc-sgns7   2/2     Running   0          2m44s</span><br></pre></td></tr></table></figure></li></ul><p>è¿˜ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æ·»åŠ OpenTelemetry ç›¸å…³çš„ CRDï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ kubectl get crd |grep opentelemetry</span><br><span class="line">instrumentations.opentelemetry.io                    2025-01-14T07:32:04Z</span><br><span class="line">opampbridges.opentelemetry.io                        2025-01-14T07:32:04Z</span><br><span class="line">opentelemetrycollectors.opentelemetry.io             2025-01-14T07:32:04Z</span><br></pre></td></tr></table></figure><h4 id="OpenTelemetry-Collector"><a href="#OpenTelemetry-Collector" class="headerlink" title="OpenTelemetry Collector"></a>OpenTelemetry Collector</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="bullet">-</span> <span class="string">&lt;&lt;EOF</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">opentelemetry.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">OpenTelemetryCollector</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">|</span></span><br><span class="line">    <span class="attr">receivers:</span></span><br><span class="line">      <span class="attr">otlp:</span></span><br><span class="line">        <span class="attr">protocols:</span></span><br><span class="line">          <span class="attr">grpc:</span></span><br><span class="line">          <span class="attr">http:</span></span><br><span class="line">    <span class="attr">processors:</span></span><br><span class="line">      <span class="attr">memory_limiter:</span></span><br><span class="line">        <span class="attr">check_interval:</span> <span class="string">1s</span></span><br><span class="line">        <span class="attr">limit_percentage:</span> <span class="number">75</span></span><br><span class="line">        <span class="attr">spike_limit_percentage:</span> <span class="number">15</span></span><br><span class="line">      <span class="attr">batch:</span></span><br><span class="line">        <span class="attr">send_batch_size:</span> <span class="number">10000</span></span><br><span class="line">        <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">exporters:</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">otlp/jaeger:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">"jaeger.default:4317"</span></span><br><span class="line">        <span class="attr">tls:</span></span><br><span class="line">          <span class="attr">insecure:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">pipelines:</span></span><br><span class="line">        <span class="attr">traces:</span></span><br><span class="line">          <span class="attr">receivers:</span> <span class="string">[otlp]</span></span><br><span class="line">          <span class="attr">processors:</span> <span class="string">[]</span></span><br><span class="line">          <span class="attr">exporters:</span> <span class="string">[debug,otlp/jaeger]</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>åˆ›å»º CR OpenTelemetryCollector åï¼ŒOtel Operator ä¼šåˆ›å»ºä¸€ä¸ª deployment å’Œ å¤šä¸ª serviceã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~</span><br><span class="line">kubectl get deployment,service -l app.kubernetes.io/component=opentelemetry-collector</span><br><span class="line"></span><br><span class="line">NAME                             READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/otel-collector   1/1     1            1           3m37s</span><br><span class="line"></span><br><span class="line">NAME                                TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE</span><br><span class="line">service/otel-collector              ClusterIP   10.111.0.124     &lt;none&gt;        4317/TCP,4318/TCP   3m36s</span><br><span class="line">service/otel-collector-headless     ClusterIP   None             &lt;none&gt;        4317/TCP,4318/TCP   3m36s</span><br><span class="line">service/otel-collector-monitoring   ClusterIP   10.111.151.111   &lt;none&gt;        8888/TCP            3m36s</span><br></pre></td></tr></table></figure><h4 id="Auto-instrumentation"><a href="#Auto-instrumentation" class="headerlink" title="Auto-instrumentation"></a>Auto-instrumentation</h4><p>åˆ›å»ºä¸€ä¸ªJava æœåŠ¡çš„åŸºæœ¬æ£€æµ‹èµ„æº</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="bullet">-</span> <span class="string">&lt;&lt;EOF</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">opentelemetry.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Instrumentation</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">instrumentation-sample</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">propagators:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tracecontext</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">baggage</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">b3</span></span><br><span class="line">  <span class="attr">sampler:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">parentbased_traceidratio</span></span><br><span class="line">    <span class="attr">argument:</span> <span class="string">"1"</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_EXPORTER_OTLP_ENDPOINT</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">otel-collector.default:4318</span></span><br><span class="line">  <span class="attr">java:</span>    </span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_EXPORTER_OTLP_ENDPOINT</span></span><br><span class="line">        <span class="attr">value:</span> <span class="string">http://otel-collector.default:4317</span>   </span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>â€‹Instrumentationâ€‹â€‹ ç”±ä»¥ä¸‹å±æ€§ç»„æˆï¼š<br><code>â€‹â€‹exporter.endpointâ€‹</code>â€‹ -ï¼ˆå¯é€‰ï¼‰å°†é¥æµ‹æ•°æ®å‘é€åˆ° OTLP æ ¼å¼çš„åœ°å€ã€‚<br><code>â€‹â€‹propagators</code>â€‹â€‹ - ä½¿æ‰€æœ‰æ•°æ®æºèƒ½å¤Ÿå…±äº«åº•å±‚ä¸Šä¸‹æ–‡æœºåˆ¶ï¼Œç”¨äºåœ¨äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å­˜å‚¨çŠ¶æ€å’Œè®¿é—®æ•°æ®ã€‚<br>â€‹<code>â€‹sampler</code>â€‹â€‹â€‹ - é€šè¿‡å‡å°‘æ”¶é›†å’Œå‘é€åˆ°åç«¯çš„è·Ÿè¸ªæ ·æœ¬æ•°é‡æ¥å¼•å…¥çš„å™ªéŸ³å’Œå¼€é”€çš„æœºåˆ¶ã€‚ OpenTelemetry æä¾›ä¸¤ç§ç±»å‹ï¼šâ€‹â€‹StaticSamplerâ€‹â€‹â€‹ å’Œ â€‹TraceIDRatioBasedâ€‹â€‹ã€‚<br>è¯­è¨€å±æ€§ï¼Œå³â€‹â€‹javaâ€‹â€‹â€‹ã€â€‹â€‹nodejsâ€‹â€‹â€‹ã€â€‹â€‹pythonâ€‹â€‹â€‹ å’Œâ€‹â€‹dotnetâ€‹â€‹ - æ ¹æ® pod æ³¨è§£ä¸­è®¾ç½®çš„è¯­è¨€ï¼Œä½¿ç”¨è‡ªåŠ¨æ’æ¡©çš„è‡ªå®šä¹‰é•œåƒ</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨æ£€æµ‹ Java æœåŠ¡çš„ Instrumentation èµ„æºä¸åè®®otlpä¸€èµ·ä½¿ç”¨http/protobufã€‚è¿™æ„å‘³ç€é…ç½®çš„ç«¯ç‚¹å¿…é¡»èƒ½å¤Ÿé€šè¿‡httpæœ‰æ•ˆprotobufè´Ÿè½½æ¥æ”¶ OTLPã€‚å› æ­¤ï¼Œç¤ºä¾‹ä½¿ç”¨otel-collector.default:4318ï¼Œå®ƒè¿æ¥åˆ° httpä¸Šä¸€æ­¥ä¸­åˆ›å»ºçš„ Collector çš„ otlpreceiver çš„ç«¯å£ã€‚</p><p>åˆ›å»ºjavaç¤ºä¾‹åº”ç”¨</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="bullet">-</span> <span class="string">&lt;&lt;EOF</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">java-sample</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">java-sample</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">java-sample</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="comment">#spec.template.metadata.annotationsç‰¹å®šäºè¯­è¨€çš„æ³¨è§£æ¥å®Œæˆè‡ªåŠ¨æ£€æµ‹</span></span><br><span class="line">        <span class="attr">instrumentation.opentelemetry.io/inject-java:</span> <span class="string">"true"</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">java-sample</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">pinakispecial/spring-boot-rest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>å¯ç”¨æ³¨è§£ï¼š<br>â€‹<code>â€‹true</code>â€‹â€‹ - ä»å‘½åç©ºé—´æ³¨å…¥å’ŒåŸ‹ç‚¹èµ„æºã€‚<br>â€‹<code>â€‹my-instrumentationâ€‹â€‹</code>â€‹ - å½“å‰å‘½åç©ºé—´ä¸­æ³¨å…¥â€‹â€‹Instrumentationâ€‹â€‹ CR å®ä¾‹çš„åç§°ã€‚<br>â€‹<code>â€‹my-other-namespace/my-instrumentation</code>â€‹â€‹â€‹ - å¦ä¸€ä¸ªå‘½åç©ºé—´ä¸­â€‹â€‹Instrumentationâ€‹â€‹ CR å®ä¾‹çš„åç§°å’Œå‘½åç©ºé—´ã€‚<br><code>â€‹â€‹false</code>â€‹â€‹ -ä¸æ³¨å…¥ã€‚</p><p>å¯ä»¥çœ‹åˆ° Otel Operator å‘ Pod ä¸­æ³¨å…¥äº†ä¸€ä¸ª otel çš„åˆå§‹åŒ–å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ kubectl get pod java-sample-6f688ffb4f-gq95j -o jsonpath=<span class="string">'&#123;.spec.initContainers[*].image&#125; &#123;.spec.containers[*].image&#125;'</span></span><br><span class="line">ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-java:1.33.6 pinakispecial/spring-boot-rest%</span><br></pre></td></tr></table></figure><p>ä»¥åŠåœ¨ java å®¹å™¨ä¸­æ³¨å…¥äº†ä¸€ç³»åˆ—çš„ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_NODE_IP</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">fieldRef:</span></span><br><span class="line">          <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">          <span class="attr">fieldPath:</span> <span class="string">status.hostIP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_POD_IP</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">fieldRef:</span></span><br><span class="line">          <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">          <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_EXPORTER_OTLP_ENDPOINT</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">http://otel-collector.default:4317</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JAVA_TOOL_OPTIONS</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">' -javaagent:/otel-auto-instrumentation-java/javaagent.jar'</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_SERVICE_NAME</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">java-sample</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_RESOURCE_ATTRIBUTES_POD_NAME</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">fieldRef:</span></span><br><span class="line">          <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">          <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_RESOURCE_ATTRIBUTES_NODE_NAME</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">fieldRef:</span></span><br><span class="line">          <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">          <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_PROPAGATORS</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">tracecontext,baggage,b3</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_TRACES_SAMPLER</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">parentbased_traceidratio</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_TRACES_SAMPLER_ARG</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">"1"</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OTEL_RESOURCE_ATTRIBUTES</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">k8s.container.name=java-sample,k8s.deployment.name=java-sample,k8s.namespace.name=default,k8s.node.name=$(OTEL_RESOURCE_ATTRIBUTES_NODE_NAME),k8s.pod.name=$(OTEL_RESOURCE_ATTRIBUTES_POD_NAME),k8s.replicaset.name=java-sample-6f688ffb4f,service.instance.id=default.$(OTEL_RESOURCE_ATTRIBUTES_POD_NAME).java-sample</span></span><br></pre></td></tr></table></figure><p>è¯·æ±‚æœåŠ¡æ¥å£</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¼€æ”¾JavaæœåŠ¡çš„ç«¯å£è®¿é—®</span></span><br><span class="line">âœ  ~ kubectl port-forward java-sample-6f688ffb4f-gq95j 8080:8080</span><br><span class="line">Forwarding from 127.0.0.1:8080 -&gt; 8080</span><br><span class="line">Forwarding from [::1]:8080 -&gt; 8080</span><br><span class="line"><span class="comment">#è¯·æ±‚æ¥å£</span></span><br><span class="line">âœ  ~ curl localhost:8080</span><br><span class="line">OK%</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¼€æ”¾Jaeger UIçš„ç«¯å£è®¿é—®</span></span><br><span class="line">âœ  ~ kubectl port-forward svc/jaeger 16686:16686</span><br><span class="line">Forwarding from 127.0.0.1:16686 -&gt; 16686</span><br><span class="line">Forwarding from [::1]:16686 -&gt; 16686</span><br></pre></td></tr></table></figure><p>è®¿é—® Jaeger UI æŸ¥çœ‹è®¿é—®çš„é“¾è·¯ä¿¡æ¯<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/JaegerUI.png"></p><h4 id="æ¥å…¥prometheus"><a href="#æ¥å…¥prometheus" class="headerlink" title="æ¥å…¥prometheus"></a>æ¥å…¥prometheus</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">helm repo add prometheus-community https://prometheus-community.github.io/helm-charts</span><br><span class="line"></span><br><span class="line">helm show values  prometheus-community/prometheus &gt; values.yaml</span><br><span class="line"></span><br><span class="line">helm install prometheus prometheus-community/prometheus -f values.yaml</span><br><span class="line"></span><br><span class="line">kubectl port-forward svc/prometheus-server 9090:80</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">opentelemetry.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">OpenTelemetryCollector</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-prometheus</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">|</span></span><br><span class="line">    <span class="attr">receivers:</span></span><br><span class="line">      <span class="attr">otlp:</span></span><br><span class="line">        <span class="attr">protocols:</span></span><br><span class="line">          <span class="attr">grpc:</span></span><br><span class="line">          <span class="attr">http:</span></span><br><span class="line">    <span class="attr">processors:</span></span><br><span class="line">      <span class="attr">memory_limiter:</span></span><br><span class="line">        <span class="attr">check_interval:</span> <span class="string">1s</span></span><br><span class="line">        <span class="attr">limit_percentage:</span> <span class="number">75</span></span><br><span class="line">        <span class="attr">spike_limit_percentage:</span> <span class="number">15</span></span><br><span class="line">      <span class="attr">batch:</span></span><br><span class="line">        <span class="attr">send_batch_size:</span> <span class="number">10000</span></span><br><span class="line">        <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">exporters:</span></span><br><span class="line">      <span class="attr">prometheus:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">"localhost:9090"</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">pipelines:</span></span><br><span class="line">        <span class="attr">metrics:</span></span><br><span class="line">          <span class="attr">receivers:</span> <span class="string">[otlp]</span></span><br><span class="line">          <span class="attr">processors:</span> <span class="string">[memory_limiter,</span> <span class="string">batch]</span></span><br><span class="line">          <span class="attr">exporters:</span> <span class="string">[prometheus]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;OpenTelemetryï¼ˆç®€ç§°OTelï¼‰æ˜¯ä¸€ä¸ªå¼€æºå¯è§‚æµ‹æ€§æ¡†æ¶ï¼Œç”¨äºä»ªè¡¨åŒ–ã€ç”Ÿæˆã€æ”¶é›†å’Œå¯¼å‡ºè¯¸å¦‚è·Ÿè¸ªã€åº¦é‡ã€æ—¥å¿—ç­‰é¥æµ‹æ•°æ®&lt;br&gt;&lt;image src=&quot;https://opentelemetry.io/docs/collector/img/otel-collector.</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://nmk0718.github.io/tag/k8s/"/>
    
    <category term="OpenTelemetry" scheme="http://nmk0718.github.io/tag/OpenTelemetry/"/>
    
  </entry>
  
  <entry>
    <title>Tampermonkeyå±è”½è…¾è®¯äº‘å¹¿å‘Š</title>
    <link href="http://nmk0718.github.io/2025/01/04/Tampermonkey%E5%B1%8F%E8%94%BD%E8%85%BE%E8%AE%AF%E4%BA%91%E5%B9%BF%E5%91%8A/"/>
    <id>http://nmk0718.github.io/2025/01/04/Tampermonkey%E5%B1%8F%E8%94%BD%E8%85%BE%E8%AE%AF%E4%BA%91%E5%B9%BF%E5%91%8A/</id>
    <published>2025-01-04T03:00:00.000Z</published>
    <updated>2025-01-15T07:32:01.704Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨è…¾è®¯äº‘æ§åˆ¶å°è¿‡ç¨‹ä¸­é‡åˆ°å¾ˆå¤šå¹¿å‘Šï¼Œæ¯æ¬¡ç‚¹xåè¿˜ä¼šå¼¹ğŸ¤®ï¼Œå½±å“é¡µé¢å±•ç¤ºã€‚é€šè¿‡æ²¹çŒ´è„šæœ¬è¿›è¡Œè¿‡æ»¤å¹¿å‘Š<br>è…¾è®¯äº‘åŸé¡µé¢<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/tencent_ads_cvm.png"><br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/tencent_ads_cdn.png"><br>é€šè¿‡kimiè¿›è¡Œç¼–å†™è„šæœ¬ï¼Œä¸€å¼€å§‹æƒ³å¯¹æ¥å£ç›´æ¥æ‹¦æˆªï¼Œä½†æ˜¯é…ç½®åä¸ç”Ÿæ•ˆï¼Œåç»­é€šè¿‡é¡µé¢éšè—å…ƒç´ å®ç°<br>é€šè¿‡F12æ£€æŸ¥å…ƒç´ æŸ¥çœ‹å¹¿å‘Šå¯¹åº”çš„å…ƒç´ <br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/check_web_element.png"><br>è®©kimié€šè¿‡å…ƒç´ è¿›è¡Œéšè—ï¼Œç¼–å†™æ²¹çŒ´è„šæœ¬ï¼Œæœ€ç»ˆè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         å±è”½ç‰¹å®šé¡µé¢çš„å¹¿å‘Šå’Œæç¤º</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  å±è”½ç‰¹å®šé¡µé¢çš„å¹¿å‘Šå’Œæç¤º</span></span><br><span class="line"><span class="comment">// @author       Kimi</span></span><br><span class="line"><span class="comment">// @match        https://console.cloud.tencent.com/*</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// @run-at       document-body</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥éšè—å…ƒç´ </span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hideElements</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> currentUrl = <span class="built_in">window</span>.location.href;</span><br><span class="line">        <span class="comment">// éšè—å…·æœ‰ data-sid="opc-ads" å±æ€§çš„ ins å…ƒç´ </span></span><br><span class="line">        <span class="keyword">const</span> ads = <span class="built_in">document</span>.querySelectorAll(<span class="string">'ins[data-sid="opc-ads"]'</span>);</span><br><span class="line">        ads.forEach(<span class="function"><span class="params">ad</span> =&gt;</span> &#123;</span><br><span class="line">            ad.style.display = <span class="string">'none'</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// éšè—æ‰€æœ‰ä»¥ app- å¼€å¤´å¹¶åŒ…å« alert çš„ div å…ƒç´ </span></span><br><span class="line">        <span class="keyword">const</span> alerts = <span class="built_in">document</span>.querySelectorAll(<span class="string">'div[class^="app-"][class*="alert"]'</span>);</span><br><span class="line">        alerts.forEach(<span class="function"><span class="params">alert</span> =&gt;</span> &#123;</span><br><span class="line">            alert.style.display = <span class="string">'none'</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentUrl.includes(<span class="string">'/cvm/instance/index?rid=1'</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// éšè—å…·æœ‰ class="app-cvm-alert" çš„ div å…ƒç´ </span></span><br><span class="line">            <span class="keyword">const</span> alerts = <span class="built_in">document</span>.querySelectorAll(<span class="string">'div.app-cvm-alert'</span>);</span><br><span class="line">            alerts.forEach(<span class="function"><span class="params">alert</span> =&gt;</span> &#123;</span><br><span class="line">                alert.style.display = <span class="string">'none'</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentUrl.includes(<span class="string">'/cdn'</span>)) &#123;</span><br><span class="line">            <span class="comment">// éšè—å…·æœ‰ class="streams-to-eo-ads-bar" çš„ div å…ƒç´ </span></span><br><span class="line">            <span class="keyword">const</span> adsBar = <span class="built_in">document</span>.querySelector(<span class="string">'div.streams-to-eo-ads-bar'</span>);</span><br><span class="line">            <span class="keyword">if</span> (adsBar) &#123;</span><br><span class="line">                adsBar.style.display = <span class="string">'none'</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// éšè—å…·æœ‰ class="streams-to-eo-ads-content" çš„ div å…ƒç´ </span></span><br><span class="line">            <span class="keyword">const</span> adsContent = <span class="built_in">document</span>.querySelector(<span class="string">'div.streams-to-eo-ads-content'</span>);</span><br><span class="line">            <span class="keyword">if</span> (adsContent) &#123;</span><br><span class="line">                adsContent.style.display = <span class="string">'none'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹æ£€æŸ¥</span></span><br><span class="line">    hideElements();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ MutationObserver ç›‘æ§ DOM å˜åŒ–</span></span><br><span class="line">    <span class="keyword">const</span> observer = <span class="keyword">new</span> MutationObserver(<span class="function">(<span class="params">mutations</span>) =&gt;</span> &#123;</span><br><span class="line">        mutations.forEach(<span class="function">(<span class="params">mutation</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mutation.addedNodes) &#123;</span><br><span class="line">                mutation.addedNodes.forEach(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (node.nodeType === <span class="number">1</span>) &#123;</span><br><span class="line">                        hideElements();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®è§‚å¯Ÿå™¨é€‰é¡¹</span></span><br><span class="line">    <span class="keyword">const</span> config = &#123;</span><br><span class="line">        childList: <span class="literal">true</span>,</span><br><span class="line">        subtree: <span class="literal">true</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹è§‚å¯Ÿæ•´ä¸ªæ–‡æ¡£</span></span><br><span class="line">    observer.observe(<span class="built_in">document</span>.body, config);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>å¼€å¯æ²¹çŒ´æ’ä»¶åï¼Œé‡æ–°è®¿é—®è…¾è®¯äº‘æ§åˆ¶å°ï¼Œå¯çœ‹åˆ°å±è”½åæ•ˆæœå›¾<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/tencent_cvm.png"><br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/tencent_cdn.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨ä½¿ç”¨è…¾è®¯äº‘æ§åˆ¶å°è¿‡ç¨‹ä¸­é‡åˆ°å¾ˆå¤šå¹¿å‘Šï¼Œæ¯æ¬¡ç‚¹xåè¿˜ä¼šå¼¹ğŸ¤®ï¼Œå½±å“é¡µé¢å±•ç¤ºã€‚é€šè¿‡æ²¹çŒ´è„šæœ¬è¿›è¡Œè¿‡æ»¤å¹¿å‘Š&lt;br&gt;è…¾è®¯äº‘åŸé¡µé¢&lt;br&gt;&lt;img src=&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcm</summary>
      
    
    
    
    
    <category term="windows" scheme="http://nmk0718.github.io/tag/windows/"/>
    
  </entry>
  
  <entry>
    <title>iterm2</title>
    <link href="http://nmk0718.github.io/2025/01/03/iterm2/"/>
    <id>http://nmk0718.github.io/2025/01/03/iterm2/</id>
    <published>2025-01-03T03:37:00.000Z</published>
    <updated>2025-01-03T05:47:03.891Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><ol><li><p>iterm2â€”&gt;Preferencesâ€”&gt;Profilesï¼Œé…ç½®ä¸€ä¸ªæ–°çš„profile</p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/jumpserver_profile.png"></li><li><p>iterm2â€”&gt;Windowâ€”&gt;Password Managerï¼ŒAccountNameåªæ˜¯æç¤ºï¼ŒPasswordé…ç½®æ­£ç¡®å³å¯</p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/jumpserver_password.png"></li><li><p>å¯¹åº”Profilesé‡Œé¢çš„Advancedé€‰é¡¹ï¼Œæ‰¾åˆ°Triggersï¼Œç‚¹å‡»Edit</p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/jumpserver_triggers.png">é…ç½®è§¦å‘æ‰“å¼€Password Manager<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/jumpserver_open_password.png"></li><li><p>é…ç½®SSHä¼šè¯å¤åˆ¶ã€ä¼šè¯ä¿æŒ<br>åœ¨~/.ssh/configæ–‡ä»¶é‡Œæ·»åŠ å‡ è¡Œé…ç½®å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¼šè¯å¤åˆ¶ç›¸å…³é…ç½®</span></span><br><span class="line">Host *</span><br><span class="line">ControlMaster auto</span><br><span class="line">ControlPath ~/.ssh/%r@%h:%p.socket</span><br><span class="line"></span><br><span class="line">ControlPersist yes</span><br><span class="line">ServerAliveInterval 10 <span class="comment"># æ¯éš”10så‘ä¸€æ¬¡å¿ƒè·³</span></span><br><span class="line">ServerAliveCountMax 3  <span class="comment"># ä¸‰æ¬¡å¿ƒè·³æ²¡å“åº”åˆ™å…³é—­è¿æ¥</span></span><br></pre></td></tr></table></figure></li><li><p><code>command + o</code>é€‰æ‹©æœåŠ¡å™¨è¿æ¥ï¼Œé…ç½®è‡ªåŠ¨å…³é—­çª—å£</p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/closewindow.png"></li></ol><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/weixin_52777294/article/details/112410350" target="_blank" rel="noopener">https://blog.csdn.net/weixin_52777294/article/details/112410350</a></p><h3 id="rzsz"><a href="#rzsz" class="headerlink" title="rzsz"></a>rzsz</h3><ol><li><p>åœ¨macä¸Šå®‰è£…lrzsz</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew install lrzsz</span><br></pre></td></tr></table></figure></li><li><p>å°†iterm2-send-zmodem.shå’Œiterm2-recv-zmodem.shè„šæœ¬ä¿å­˜åœ¨/usr/local/bin/<br>iterm2-recv-zmodem.sh</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Author: Matt Mastracci (matthew@mastracci.com)</span></span><br><span class="line"><span class="comment"># AppleScript from http://stackoverflow.com/questions/4309087/cancel-button-on-osascript-in-a-bash-script</span></span><br><span class="line"><span class="comment"># licensed under cc-wiki with attribution required </span></span><br><span class="line"><span class="comment"># Remainder of script public domain</span></span><br><span class="line"></span><br><span class="line">osascript -e <span class="string">'tell application "iTerm2" to version'</span> &gt; /dev/null 2&gt;&amp;1 &amp;&amp; NAME=iTerm2 || NAME=iTerm</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$NAME</span> = <span class="string">"iTerm"</span> ]]; <span class="keyword">then</span></span><br><span class="line">FILE=$(osascript -e <span class="string">'tell application "iTerm" to activate'</span> -e <span class="string">'tell application "iTerm" to set thefile to choose folder with prompt "Choose a folder to place received files in"'</span> -e <span class="string">"do shell script (\"echo \"&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\"\")"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">FILE=$(osascript -e <span class="string">'tell application "iTerm2" to activate'</span> -e <span class="string">'tell application "iTerm2" to set thefile to choose folder with prompt "Choose a folder to place received files in"'</span> -e <span class="string">"do shell script (\"echo \"&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\"\")"</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$FILE</span> = <span class="string">""</span> ]]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> Cancelled.</span><br><span class="line"><span class="comment"># Send ZModem cancel</span></span><br><span class="line"><span class="built_in">echo</span> -e \\x18\\x18\\x18\\x18\\x18</span><br><span class="line">sleep 1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \<span class="comment"># Cancelled transfer</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$FILE</span>"</span></span><br><span class="line">/usr/<span class="built_in">local</span>/bin/rz --rename --escape --binary --bufsize 4096 </span><br><span class="line">sleep 1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \<span class="comment"># Sent \-\&gt; $FILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p> iterm2-send-zmodem.sh</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Author: Matt Mastracci (matthew@mastracci.com)</span></span><br><span class="line"><span class="comment"># AppleScript from http://stackoverflow.com/questions/4309087/cancel-button-on-osascript-in-a-bash-script</span></span><br><span class="line"><span class="comment"># licensed under cc-wiki with attribution required </span></span><br><span class="line"><span class="comment"># Remainder of script public domain</span></span><br><span class="line"></span><br><span class="line">osascript -e <span class="string">'tell application "iTerm2" to version'</span> &gt; /dev/null 2&gt;&amp;1 &amp;&amp; NAME=iTerm2 || NAME=iTerm</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$NAME</span> = <span class="string">"iTerm"</span> ]]; <span class="keyword">then</span></span><br><span class="line">FILE=$(osascript -e <span class="string">'tell application "iTerm" to activate'</span> -e <span class="string">'tell application "iTerm" to set thefile to choose file with prompt "Choose a file to send"'</span> -e <span class="string">"do shell script (\"echo \"&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\"\")"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">FILE=$(osascript -e <span class="string">'tell application "iTerm2" to activate'</span> -e <span class="string">'tell application "iTerm2" to set thefile to choose file with prompt "Choose a file to send"'</span> -e <span class="string">"do shell script (\"echo \"&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\"\")"</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$FILE</span> = <span class="string">""</span> ]]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> Cancelled.</span><br><span class="line"><span class="comment"># Send ZModem cancel</span></span><br><span class="line"><span class="built_in">echo</span> -e \\x18\\x18\\x18\\x18\\x18</span><br><span class="line">sleep 1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \<span class="comment"># Cancelled transfer</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">/usr/<span class="built_in">local</span>/bin/sz <span class="string">"<span class="variable">$FILE</span>"</span> --escape --binary --bufsize 4096</span><br><span class="line">sleep 1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \<span class="comment"># Received "$FILE"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨ iTerm 2 ä¸­è®¾ç½®è§¦å‘å™¨<br>Setting &gt;&gt; Profiles &gt;&gt; è‡ªå®šä¹‰çš„Profile &gt;&gt; Advanced &gt;&gt; Tiggers &gt;&gt; Edit</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Regular expression: rz waiting to receive.\*\*B0100</span><br><span class="line">Action: Run Silent Coprocess</span><br><span class="line">Parameters: /usr/local/bin/iterm2-send-zmodem.sh</span><br><span class="line">Instant: checked</span><br><span class="line">Enabled: checked</span><br><span class="line"></span><br><span class="line">Regular expression: \*\*B00000000000000</span><br><span class="line">Action: Run Silent Coprocess</span><br><span class="line">Parameters: /usr/local/bin/iterm2-recv-zmodem.sh</span><br><span class="line">Instant: checked</span><br><span class="line">Enabled: checked</span><br></pre></td></tr></table></figure></li></ol><p>åœ¨æ§åˆ¶å°è¾“å…¥rzï¼Œé€‰æ‹©æœ¬åœ°æœºå™¨ä¸Šè¦å‘é€çš„æ–‡ä»¶ï¼Œå³å¯ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨,sz filenameï¼Œåœ¨æœ¬åœ°æœºå™¨ä¸Šé€‰æ‹©è¦æ¥æ”¶çš„æ–‡ä»¶å¤¹ï¼Œå³å¯ä¸‹è½½åˆ°æœ¬åœ°<br>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://github.com/robberphex/iTerm2-zmodem" target="_blank" rel="noopener">https://github.com/robberphex/iTerm2-zmodem</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;ssh&quot;&gt;&lt;a href=&quot;#ssh&quot; class=&quot;headerlink&quot; title=&quot;ssh&quot;&gt;&lt;/a&gt;ssh&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;iterm2â€”&amp;gt;Preferencesâ€”&amp;gt;Profilesï¼Œé…ç½®ä¸€ä¸ªæ–°çš„profile&lt;/p&gt;
&lt;im</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Windowsçƒ­ç‚¹å…±äº«5Ghz</title>
    <link href="http://nmk0718.github.io/2024/12/24/Windows%E7%83%AD%E7%82%B9%E5%85%B1%E4%BA%AB5Ghz/"/>
    <id>http://nmk0718.github.io/2024/12/24/Windows%E7%83%AD%E7%82%B9%E5%85%B1%E4%BA%AB5Ghz/</id>
    <published>2024-12-24T05:34:00.000Z</published>
    <updated>2025-02-10T02:35:49.454Z</updated>
    
    <content type="html"><![CDATA[<p>èƒŒæ™¯ï¼š</p><ul><li>åŠå…¬ç”µè„‘è¿æ¥officeç½‘ç»œå…±äº«çƒ­ç‚¹ï¼Œè‡ªå¸¦MacBook Proè¿æ¥çƒ­ç‚¹å†…ç½‘åŠå…¬ï¼Œå®ç°ç›´æ¥è®¿é—®å†…ç½‘ä¹Ÿä¸è¢«ç›‘æ§ã€‚é‡åˆ°çš„é—®é¢˜ä¸ºè¿æ¥å…±äº«çƒ­ç‚¹åchromeè®¿é—®é¡µé¢å¾ˆæ…¢.</li></ul><p>è§£å†³æ–¹æ¡ˆ:</p><ul><li>MacBook ProæŒ‰ä½optioné”®,ç‚¹å‡»å³ä¸Šè§’wifiæŒ‰é’®,å¯çœ‹åˆ°ä¸º2.4Ghzé¢‘ç‡</li><li>Windowsæ‰“å¼€è®¾å¤‡ç®¡ç†å™¨,æ‰¾åˆ°wifiçš„è®¾å¤‡ï¼Œå³é”®å±æ€§,æ›´æ”¹ä¸º5Ghz<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/change5g.jpg"></li><li>çƒ­ç‚¹å…±äº«,ç¼–è¾‘é¢‘ç‡,æ”¹ä¸º5Ghz,æ‰“å¼€çƒ­ç‚¹<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/frequency.jpg"></li><li>MacBook Proè¿æ¥å,æ‰“å¼€é¡µé¢å¾ˆå¿«,æŸ¥çœ‹é¢‘ç‡<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/wifi5Ghz.png"></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;èƒŒæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠå…¬ç”µè„‘è¿æ¥officeç½‘ç»œå…±äº«çƒ­ç‚¹ï¼Œè‡ªå¸¦MacBook Proè¿æ¥çƒ­ç‚¹å†…ç½‘åŠå…¬ï¼Œå®ç°ç›´æ¥è®¿é—®å†…ç½‘ä¹Ÿä¸è¢«ç›‘æ§ã€‚é‡åˆ°çš„é—®é¢˜ä¸ºè¿æ¥å…±äº«çƒ­ç‚¹åchromeè®¿é—®é¡µé¢å¾ˆæ…¢.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MacBo</summary>
      
    
    
    
    
    <category term="windows" scheme="http://nmk0718.github.io/tag/windows/"/>
    
  </entry>
  
  <entry>
    <title>dockerå®¹å™¨ç›‘æ§</title>
    <link href="http://nmk0718.github.io/2024/11/26/docker%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7/"/>
    <id>http://nmk0718.github.io/2024/11/26/docker%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7/</id>
    <published>2024-11-26T07:45:00.000Z</published>
    <updated>2024-12-27T06:07:20.063Z</updated>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯ä¿¡æ¯ï¼š"><a href="#èƒŒæ™¯ä¿¡æ¯ï¼š" class="headerlink" title="èƒŒæ™¯ä¿¡æ¯ï¼š"></a>èƒŒæ™¯ä¿¡æ¯ï¼š</h3><blockquote><p>åœ¨ç°ä»£ä¼ä¸šè¿è¥ä¸­ï¼ŒPrometheus å·²è¢«å¹¿æ³›éƒ¨ç½²ç”¨äºç›‘æ§ Kubernetes é›†ç¾¤ã€ä¸­é—´ä»¶ä»¥åŠæœåŠ¡å™¨ï¼Œä»¥å®ç°å¿«é€Ÿçš„é—®é¢˜å®šä½å’Œé¢„è­¦ã€‚å°½ç®¡ Prometheus ä¸ cAdvisor ç»“åˆä½¿ç”¨å¯ä»¥æ”¶é›†ä¸€å°æœºå™¨ä¸Šæ‰€æœ‰è¿è¡Œçš„å®¹å™¨ä¿¡æ¯ï¼Œå¯¹èŠ‚ç‚¹æœºå™¨ä¸Šçš„ CPU ä½¿ç”¨æƒ…å†µã€å†…å­˜ä½¿ç”¨æƒ…å†µã€ç½‘ç»œååé‡åŠæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨æƒ…å†µè¿›è¡Œå®æ—¶ç›‘æ§å’Œæ€§èƒ½æ•°æ®é‡‡é›†ï¼Œä½†è¿™ç§ç›‘æ§æ–¹å¼å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ã€‚åœ¨ç›‘æ§å•ä¸ªä¸»æœºå†…è¿è¡Œå®¹å™¨çš„æœåŠ¡å¥åº·çŠ¶æ€æ–¹é¢å­˜åœ¨ä¸è¶³ã€‚è¿™ç§å±€é™æ€§å¯èƒ½å¯¼è‡´åœ¨æœåŠ¡å‡ºç°æ•…éšœæ—¶æ— æ³•åŠæ—¶æ„ŸçŸ¥ï¼Œå½±å“æœåŠ¡çš„è¿ç»­æ€§å’Œç¨³å®šæ€§</p></blockquote><h3 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„:"></a>ç›®çš„:</h3><blockquote><p>æœ‰æ•ˆåœ°ç›‘æ§ä¸»æœºå†…è¿è¡Œçš„ Docker å®¹å™¨è¿è¡ŒçŠ¶æ€ï¼Œå»ºç«‹ä¸€ä¸ªå…¨é¢çš„ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿï¼Œé¢„é˜²æœåŠ¡ä¸­æ–­ï¼Œç¡®ä¿æœåŠ¡çš„é«˜å¯ç”¨æ€§å’Œä¸šåŠ¡è¿ç»­æ€§</p></blockquote><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ:"></a>è§£å†³æ–¹æ¡ˆ:</h3><p>ç¼–å†™GOè„šæœ¬ä½¿ç”¨Docker Engine APIçš„/statsç«¯ç‚¹æ¥è·å–è·å–CPU,å†…å­˜,å®¹å™¨è¿è¡ŒçŠ¶æ€,è¿›ç¨‹æ•°ã€‚ç»“åˆ nvidia_gpu_exporter æ”¶é›† GPU æŒ‡æ ‡ï¼Œå¹¶é€šè¿‡ VictoriaMetrics å’Œ Grafana å®ç°ç›‘æ§ä¸å‘Šè­¦ï¼ˆå› æœ‰çš„å®¹å™¨å†…éœ€è¦æ‰‹åŠ¨æ¿€æ´»ç¯å¢ƒåï¼Œå¯åŠ¨æœåŠ¡ï¼Œæ‰€ä»¥åªç›‘æ§å®¹å™¨çŠ¶æ€ä¸èƒ½ç¡®ä¿å®¹å™¨å­˜æ´»ï¼Œå¯åŠ¨æœåŠ¡ä¸æ˜¯ä¸»è¿›ç¨‹å®¹å™¨ä¸ä¼šæŒ‚æ‰ï¼Œé‡‡ç”¨è¿›ç¨‹çš„æ–¹å¼æ›´åˆç†ï¼‰<br>åºŸå¼ƒæ–¹æ¡ˆ:é€šè¿‡cAdvisorçš„container_processesæŒ‡æ ‡è·å–è¿›ç¨‹æ•°é‡è¿›è¡Œç›‘æ§ï¼Œä½†æ˜¯å‘ç°æ‰‹åŠ¨å®‰è£…çš„æ²¡æœ‰è¯¥æŒ‡æ ‡ï¼Œk8sçš„kubeletæ˜¯æœ‰è¯¥æŒ‡æ ‡çš„ã€‚</p><h4 id="éƒ¨ç½²Docker-process-exporter"><a href="#éƒ¨ç½²Docker-process-exporter" class="headerlink" title="éƒ¨ç½²Docker_process_exporter"></a>éƒ¨ç½²Docker_process_exporter</h4><p>æœºå™¨ipå’Œdockerç‰ˆæœ¬ï¼š<br>10.1.16.250 Version: 24.0.7</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŠŠè„šæœ¬ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</span></span><br><span class="line">root@VM-ubuntu:~<span class="comment"># rz</span></span><br><span class="line">root@VM-ubuntu:~<span class="comment"># chmod +x Docker_process_exporter_v24.0.7</span></span><br><span class="line">root@VM-ubuntu:~<span class="comment"># nohup ./Docker_process_exporter_v24.0.7  &amp;</span></span><br></pre></td></tr></table></figure><h4 id="é‡‡é›†çš„æŒ‡æ ‡æ ¼å¼"><a href="#é‡‡é›†çš„æŒ‡æ ‡æ ¼å¼" class="headerlink" title="é‡‡é›†çš„æŒ‡æ ‡æ ¼å¼"></a>é‡‡é›†çš„æŒ‡æ ‡æ ¼å¼</h4><p>ä½¿ç”¨curl <a href="http://localhost:9190/metrics" target="_blank" rel="noopener">http://localhost:9190/metrics</a> å¯ä»¥çœ‹åˆ°å½“å‰é‡‡é›†çš„æŒ‡æ ‡</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#cpuä½¿ç”¨ç‡</span></span><br><span class="line">docker_container_cpu_usage&#123;</span><br><span class="line">    containerId=<span class="string">"142b0b391a1862f101623ba4739afa7e2dd45254fef4344fdf1d37cc2adde3e0"</span>, </span><br><span class="line">    containerName=<span class="string">"ailabel"</span>, </span><br><span class="line">    image=<span class="string">"ailabel:v1.9.5"</span>, </span><br><span class="line">    instance=<span class="string">"10.1.16.250:9190"</span>, </span><br><span class="line">    job=<span class="string">"go-process-exporter"</span>, </span><br><span class="line">    status=<span class="string">"running"</span>, </span><br><span class="line">    vmagent_ha=<span class="string">"victoria-metrics/vmagent-ha"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å†…å­˜ä½¿ç”¨ç‡</span></span><br><span class="line">docker_container_mem_usage&#123;</span><br><span class="line">    containerId=<span class="string">"142b0b391a1862f101623ba4739afa7e2dd45254fef4344fdf1d37cc2adde3e0"</span>, </span><br><span class="line">    containerName=<span class="string">"ailabel"</span>, </span><br><span class="line">    image=<span class="string">"ailabel:v1.9.5"</span>, </span><br><span class="line">    instance=<span class="string">"10.1.16.250:9190"</span>, </span><br><span class="line">    job=<span class="string">"go-process-exporter"</span>, </span><br><span class="line">    status=<span class="string">"running"</span>, </span><br><span class="line">    vmagent_ha=<span class="string">"victoria-metrics/vmagent-ha"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç£ç›˜ä½¿ç”¨ç‡</span></span><br><span class="line">docker_instance_disk_usage&#123;</span><br><span class="line">    device=<span class="string">"/dev/vda1"</span>, </span><br><span class="line">    instance=<span class="string">"10.1.16.250:9190"</span>, </span><br><span class="line">    job=<span class="string">"go-process-exporter"</span>, </span><br><span class="line">    mountPath=<span class="string">"/"</span>, </span><br><span class="line">    vmagent_ha=<span class="string">"victoria-metrics/vmagent-ha"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®¹å™¨è¿è¡ŒçŠ¶æ€</span></span><br><span class="line">docker_container_info&#123;</span><br><span class="line">    containerId=<span class="string">"142b0b391a1862f101623ba4739afa7e2dd45254fef4344fdf1d37cc2adde3e0"</span>, </span><br><span class="line">    containerName=<span class="string">"ailabel"</span>, </span><br><span class="line">    image=<span class="string">"ailabel:v1.9.5"</span>, </span><br><span class="line">    instance=<span class="string">"10.1.16.250:9190"</span>, </span><br><span class="line">    job=<span class="string">"go-process-exporter"</span>,</span><br><span class="line">    status=<span class="string">"running"</span>, </span><br><span class="line">    vmagent_ha=<span class="string">"victoria-metrics/vmagent-ha"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®¹å™¨è¿›ç¨‹ä¿¡æ¯</span></span><br><span class="line">docker_container_process_info&#123;</span><br><span class="line">    <span class="built_in">command</span>=<span class="string">"python OpenPCDet/tools/predict_openpcdet_produce.py"</span> </span><br><span class="line">    containerId=<span class="string">"142b0b391a1862f101623ba4739afa7e2dd45254fef4344fdf1d37cc2adde3e0"</span>, </span><br><span class="line">    containerName=<span class="string">"ailabel"</span>, </span><br><span class="line">    image=<span class="string">"ailabel:v1.9.5"</span>, </span><br><span class="line">    instance=<span class="string">"10.1.16.250:9190"</span>, </span><br><span class="line">    job=<span class="string">"go-process-exporter"</span>, </span><br><span class="line">    pid=<span class="string">"14781"</span>, </span><br><span class="line">    vmagent_ha=<span class="string">"victoria-metrics/vmagent-ha"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®é‡‡é›†"><a href="#é…ç½®é‡‡é›†" class="headerlink" title="é…ç½®é‡‡é›†"></a>é…ç½®é‡‡é›†</h4><p>æ–°å»ºjob,æŠŠéœ€è¦ç›‘æ§çš„ä¸»æœºå’Œé‡‡é›†é—´éš”å¡«å†™è¿›å»</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">root@VM-victoria-metrics:~#</span> <span class="string">vi</span> <span class="string">/data/victoria-metrics/vmagent-victoriametrics.yaml</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">go-process-exporter</span></span><br><span class="line">      <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line">      <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['10.1.7.151:9190','10.1.7.67:9190','10.1.16.154:9190','10.1.16.250:9190']</span></span><br></pre></td></tr></table></figure><p>åŠ è½½é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@VM-victoria-metrics:~<span class="comment"># kubectl apply -f vmagent-victoriametrics.yaml -n victoria-metrics</span></span><br><span class="line">vmagent.operator.victoriametrics.com/vmagent-ha unchanged</span><br></pre></td></tr></table></figure><p>éªŒè¯æ˜¯å¦é‡‡é›†</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨victoriametricsçš„vmuié¡µé¢è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">http://&lt;vmselect&gt;:8481/select/&lt;accountID&gt;/vmui/</span><br><span class="line"></span><br><span class="line">æˆ–è€…ä½¿ç”¨grafanaçš„Exploreè¿›è¡ŒæŸ¥è¯¢</span><br></pre></td></tr></table></figure><h4 id="é…ç½®å›¾è¡¨"><a href="#é…ç½®å›¾è¡¨" class="headerlink" title="é…ç½®å›¾è¡¨"></a>é…ç½®å›¾è¡¨</h4><ul><li><p>é…ç½®å˜é‡<br>é€šè¿‡CVMå˜é‡æ¥è¿‡æ»¤ç›‘æ§çš„æœºå™¨,ContainerNameå˜é‡æ¥è¿‡æ»¤æœºå™¨å†…è¿è¡Œçš„å®¹å™¨<br><br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image\grafana-cvm.png"><br></p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image\grafana-containername.png"></li><li><p>é…ç½®é¢æ¿<br>CPUä½¿ç”¨ç‡</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker_container_cpu_usage&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9190"</span>,status=<span class="string">"running"</span>,containerName=<span class="string">"<span class="variable">$ContainerName</span>"</span>&#125;</span><br></pre></td></tr></table></figure><p>  å†…å­˜ä½¿ç”¨ç‡</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker_container_mem_usage&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9190"</span>,status=<span class="string">"running"</span>,containerName=<span class="string">"<span class="variable">$ContainerName</span>"</span>&#125;</span><br></pre></td></tr></table></figure><p>  ç£ç›˜ä½¿ç”¨ç‡</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sum(docker_instance_disk_usage&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9190"</span>&#125;) by (device,mountPath)</span><br></pre></td></tr></table></figure><p>  GPU</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#GPUæ¸©åº¦</span></span><br><span class="line">nvidia_smi_temperature_gpu&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9835"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#GPUæ˜¾å­˜ä½¿ç”¨é‡</span></span><br><span class="line">nvidia_smi_memory_used_bytes&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9835"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#GPUæ˜¾å­˜æ€»é‡</span></span><br><span class="line">nvidia_smi_memory_total_bytes&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9835"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#GPUä½¿ç”¨ç‡</span></span><br><span class="line">(nvidia_smi_memory_used_bytes&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9835"</span>&#125; / nvidia_smi_memory_total_bytes&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9835"</span>&#125;)* 100</span><br></pre></td></tr></table></figure><p>  å®¹å™¨å¼‚å¸¸è¿è¡ŒçŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#é€€å‡ºçŠ¶æ€çš„å®¹å™¨æ¡æ•°</span></span><br><span class="line">count(docker_container_info&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9190"</span>,status=<span class="string">"exited"</span>&#125;) by (status)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œä¸­çŠ¶æ€çš„å®¹å™¨æ¡æ•°</span></span><br><span class="line">count(docker_container_info&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9190"</span>,status=<span class="string">"running"</span>&#125;) by (status)</span><br></pre></td></tr></table></figure><p>  å®¹å™¨è¿è¡Œè¿›ç¨‹æ•°</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®¹å™¨å†…å¯åŠ¨çš„å‘½ä»¤+pid+å®¹å™¨åç§°</span></span><br><span class="line">count(docker_container_process_info&#123;instance=<span class="string">"<span class="variable">$CVM</span>:9190"</span>,containerName=<span class="string">"<span class="variable">$ContainerName</span>"</span>&#125;) by (<span class="built_in">command</span>,pid,containerName)</span><br></pre></td></tr></table></figure></li></ul><h3 id="æœ€ç»ˆæ•ˆæœå›¾ï¼š"><a href="#æœ€ç»ˆæ•ˆæœå›¾ï¼š" class="headerlink" title="æœ€ç»ˆæ•ˆæœå›¾ï¼š"></a>æœ€ç»ˆæ•ˆæœå›¾ï¼š</h3><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image\grafana.png">]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;èƒŒæ™¯ä¿¡æ¯ï¼š&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯ä¿¡æ¯ï¼š&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯ä¿¡æ¯ï¼š&quot;&gt;&lt;/a&gt;èƒŒæ™¯ä¿¡æ¯ï¼š&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;åœ¨ç°ä»£ä¼ä¸šè¿è¥ä¸­ï¼ŒPrometheus å·²è¢«å¹¿æ³›éƒ¨ç½²ç”¨äºç›‘æ§ Kubernetes é›†ç¾¤ã€</summary>
      
    
    
    
    
    <category term="docker" scheme="http://nmk0718.github.io/tag/docker/"/>
    
  </entry>
  
  <entry>
    <title>VictoriaMetrics</title>
    <link href="http://nmk0718.github.io/2024/11/25/VictoriaMetrics/"/>
    <id>http://nmk0718.github.io/2024/11/25/VictoriaMetrics/</id>
    <published>2024-11-25T08:30:00.000Z</published>
    <updated>2025-01-03T08:49:11.655Z</updated>
    
    <content type="html"><![CDATA[<p>VictoriaMetrics æ˜¯ä¸€æ¬¾å¿«é€Ÿã€ç»æµé«˜æ•ˆä¸”å¯æ‰©å±•çš„æ—¶é—´åºåˆ—æ•°æ®åº“ã€‚å¯ç”¨ä½œ Prometheus çš„é•¿æœŸè¿œç¨‹å­˜å‚¨ã€‚å¦‚æœæå–ç‡ä½äºæ¯ç§’â€‹â€‹ä¸€ç™¾ä¸‡ä¸ªæ•°æ®ç‚¹ï¼Œå»ºè®®ä½¿ç”¨å•èŠ‚ç‚¹ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯é›†ç¾¤ç‰ˆæœ¬ã€‚</p><p>VictoriaMetricsé›†ç¾¤ç”±ä»¥ä¸‹æœåŠ¡ç»„æˆï¼š</p><ul><li><code>vmstorage</code> å­˜å‚¨åŸå§‹æ•°æ®å¹¶è¿”å›ç»™å®šæ ‡ç­¾è¿‡æ»¤å™¨åœ¨ç»™å®šæ—¶é—´èŒƒå›´å†…çš„æŸ¥è¯¢æ•°æ®</li><li><code>vminsert</code> æ¥å—é‡‡é›†çš„æ•°æ®ï¼Œå¹¶æ ¹æ®æŒ‡æ ‡åç§°åŠå…¶æ‰€æœ‰æ ‡ç­¾çš„ä¸€è‡´æ€§å“ˆå¸Œï¼Œå°†å…¶ä¼ æ’­åˆ° vmstorage èŠ‚ç‚¹ä¹‹é—´</li><li><code>vmselect</code> é€šè¿‡ä»æ‰€æœ‰é…ç½®çš„ vmstorage èŠ‚ç‚¹è·å–æ‰€éœ€æ•°æ®æ¥æ‰§è¡Œä¼ å…¥æŸ¥è¯¢</li><li><code>vmalert</code> è´Ÿè´£å‘Šè­¦ï¼Œå’Œ Prometheus ä¸€æ ·æ”¯æŒçºªå½•ã€å‘Šè­¦ä¸¤ç§è§„åˆ™é…ç½®ä¸å‘é€å‘Šè­¦é€šçŸ¥ï¼Œå…è®¸åœ¨æ³¨è§£ä¸­ä½¿ç”¨ Go æ¨¡æ¿æ¥æ ¼å¼åŒ–æ•°æ®ã€è¿­ä»£æˆ–æ‰§è¡Œè¡¨è¾¾å¼ï¼Œæ”¯æŒè·¨ç§Ÿæˆ·å‘é€è­¦æŠ¥å’Œè®°å½•è§„åˆ™</li><li><code>vmagent</code> è´Ÿè´£æ•°æ®é‡‡é›†ï¼Œé‡æ–°æ ‡è®°å’Œè¿‡æ»¤æ”¶é›†åˆ°çš„æŒ‡æ ‡ï¼Œå¹¶é€šè¿‡ Prometheus åè®®æˆ–é€šè¿‡ VictoriaMetrics åè®®å°†å®ƒä»¬å­˜å‚¨åœ¨ VictoriaMetrics æˆ–ä»»ä½•å…¶ä»–å­˜å‚¨ç³»ç»Ÿä¸­ã€‚<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://docs.victoriametrics.com/Cluster-VictoriaMetrics_cluster-scheme.webp"></li></ul><p>éƒ¨ç½²å‚è€ƒæ–‡æ¡£ï¼š<br><a href="https://docs.victoriametrics.com/helm/victoriametrics-operator/" target="_blank" rel="noopener">https://docs.victoriametrics.com/helm/victoriametrics-operator/</a><br><a href="https://docs.victoriametrics.com/cluster-victoriametrics/" target="_blank" rel="noopener">https://docs.victoriametrics.com/cluster-victoriametrics/</a><br><a href="https://zhuanlan.zhihu.com/p/715516533" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/715516533</a></p><p>âš ï¸æœ¬æ–‡æ¡£ä¸­çš„æ“ä½œå‡åœ¨æœ¬åœ°è¿›è¡Œï¼Œå¦‚éœ€ç”Ÿäº§éƒ¨ç½²ï¼Œè¯·æŠŠport-forwardè½¬æ¢ä¸ºingressè½¬å‘ï¼Œvmclusterè°ƒæ•´åˆé€‚çš„é…ç½®.</p><h2 id="VictoriaMetrics-Helm-å­˜å‚¨åº“"><a href="#VictoriaMetrics-Helm-å­˜å‚¨åº“" class="headerlink" title="VictoriaMetrics Helm å­˜å‚¨åº“"></a>VictoriaMetrics Helm å­˜å‚¨åº“</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#helmæ·»åŠ repo</span></span><br><span class="line">âœ  ~ helm repo add vm https://victoriametrics.github.io/helm-charts/</span><br><span class="line"><span class="string">"vm"</span> has been added to your repositories</span><br><span class="line"></span><br><span class="line"><span class="comment">#helmæ›´æ–°repo</span></span><br><span class="line">âœ  ~ helm repo update</span><br><span class="line">Hang tight <span class="keyword">while</span> we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the <span class="string">"aliyun"</span> chart repository</span><br><span class="line">...Successfully got an update from the <span class="string">"vm"</span> chart repository</span><br><span class="line">Update Complete. âˆHappy Helming!âˆ</span><br><span class="line"></span><br><span class="line"><span class="comment">#helmæŸ¥çœ‹ç›¸å…³æœåŠ¡å’Œç‰ˆæœ¬</span></span><br><span class="line">âœ  ~ helm search repo vm/</span><br><span class="line">NAME                           CHART VERSIONAPP VERSIONDESCRIPTION</span><br><span class="line">vm/victoria-logs-single        0.8.2        v1.0.0     Victoria Logs Single version - high-performance...</span><br><span class="line">vm/victoria-metrics-agent      0.14.9       v1.106.1   Victoria Metrics Agent - collects metrics from ...</span><br><span class="line">vm/victoria-metrics-alert      0.12.6       v1.106.1   Victoria Metrics Alert - executes a list of giv...</span><br><span class="line">vm/victoria-metrics-anomaly    1.6.7        v1.18.4    Victoria Metrics Anomaly Detection - a service ...</span><br><span class="line">vm/victoria-metrics-auth       0.7.7        v1.106.1   Victoria Metrics Auth - is a simple auth proxy ...</span><br><span class="line">vm/victoria-metrics-cluster    0.14.12      v1.106.1   Victoria Metrics Cluster version - high-perform...</span><br><span class="line">vm/victoria-metrics-common     0.0.31                  Victoria Metrics Common - contains shared templ...</span><br><span class="line">vm/victoria-metrics-distributed0.5.0        v1.106.1   A Helm chart <span class="keyword">for</span> Running VMCluster on Multiple ...</span><br><span class="line">vm/victoria-metrics-gateway    0.5.7        v1.106.1   Victoria Metrics Gateway - Auth &amp; Rate-Limittin...</span><br><span class="line">vm/victoria-metrics-k8s-stack  0.28.4       v1.106.1   Kubernetes monitoring on VictoriaMetrics stack....</span><br><span class="line">vm/victoria-metrics-operator   0.38.0       v0.49.1    Victoria Metrics Operator</span><br><span class="line">vm/victoria-metrics-single     0.12.7       v1.106.1   Victoria Metrics Single version - high-performa...</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-VictoriaMetrics-Operator"><a href="#å®‰è£…-VictoriaMetrics-Operator" class="headerlink" title="å®‰è£… VictoriaMetrics-Operator"></a>å®‰è£… VictoriaMetrics-Operator</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨å‘½ä»¤å®‰è£…</span></span><br><span class="line">âœ  ~ helm install vmo vm/victoria-metrics-operator</span><br><span class="line">NAME: vmo</span><br><span class="line">LAST DEPLOYED: Tue Dec 24 14:38:21 2024</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">victoria-metrics-operator has been installed. Check its status by running:</span><br><span class="line">  kubectl --namespace default get pods -l <span class="string">"app.kubernetes.io/instance=vmo"</span></span><br><span class="line"></span><br><span class="line">Get more information on https://github.com/VictoriaMetrics/helm-charts/tree/master/charts/victoria-metrics-operator.</span><br><span class="line">See <span class="string">"Getting started guide for VM Operator"</span> on https://docs.victoriametrics.com/guides/getting-started-with-vm-operator</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹podçŠ¶æ€</span></span><br><span class="line">âœ  ~ kubectl get pods -A | grep <span class="string">'vmo'</span></span><br><span class="line">default       vmo-victoria-metrics-operator-54bf97548f-fj8j7   1/1     Running   0             1m</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…VictoriaMetrics-Cluster"><a href="#å®‰è£…VictoriaMetrics-Cluster" class="headerlink" title="å®‰è£…VictoriaMetrics Cluster"></a>å®‰è£…VictoriaMetrics Cluster</h2><p>Operator ä¼šæ ¹æ®æˆ‘ä»¬çš„å®šä¹‰å»éƒ¨ç½²é›†ç¾¤,å¯ä»¥é€šè¿‡ kubectl explain VMCluster.spec æ¥æŸ¥çœ‹å¯¹è±¡å¯é…ç½®çš„å±æ€§</p><h4 id="vmcluster-yaml"><a href="#vmcluster-yaml" class="headerlink" title="vmcluster.yaml"></a>vmcluster.yaml</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">operator.victoriametrics.com/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VMCluster</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">vmcluster</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">victoria-metrics</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment">#æ•°æ®ä¿ç•™çš„æ—¶é•¿,é»˜è®¤ä¿ç•™æœŸä¸º 1 ä¸ªæœˆï¼Œ é»˜è®¤å•ä½ä¸º m(æœˆ)ï¼Œæ”¯æŒçš„å•ä½æœ‰ h (hour), d (day), w (week), y (year)</span></span><br><span class="line">  <span class="attr">retentionPeriod:</span> <span class="string">"1w"</span></span><br><span class="line">  <span class="comment">#å¼€å¯å‰¯æœ¬ï¼Œå¹¶æ§åˆ¶å‰¯æœ¬æ•°é‡ï¼Œä¼šå¾€å¤šä¸ªvmstorageæ’å…¥åŒä¸€ä»½æ ·æœ¬æ•°æ®</span></span><br><span class="line">  <span class="comment">#replicationFactor: 2</span></span><br><span class="line">  <span class="attr">vmstorage:</span></span><br><span class="line">    <span class="comment">#å‰¯æœ¬æ•°</span></span><br><span class="line">    <span class="attr">replicaCount:</span> <span class="number">2</span></span><br><span class="line">    <span class="comment">#æ•°æ®æŒä¹…åŒ–</span></span><br><span class="line">    <span class="attr">storageDataPath:</span> <span class="string">/vm-data</span></span><br><span class="line">    <span class="attr">storage:</span></span><br><span class="line">      <span class="attr">volumeClaimTemplate:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">storageClassName:</span> <span class="string">cbs</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">storage:</span> <span class="string">10Gi</span></span><br><span class="line">    <span class="comment">#èµ„æºå¤§å°</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">"0.5"</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">500Mi</span></span><br><span class="line">  <span class="attr">vmselect:</span></span><br><span class="line">    <span class="attr">replicaCount:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">cacheMountPath:</span> <span class="string">"/select-cache"</span></span><br><span class="line">    <span class="attr">storage:</span></span><br><span class="line">      <span class="attr">volumeClaimTemplate:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">storageClassName:</span> <span class="string">cbs</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">storage:</span> <span class="string">"2Gi"</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">"0.3"</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">"300Mi"</span></span><br><span class="line">  <span class="attr">vminsert:</span></span><br><span class="line">    <span class="attr">replicaCount:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p><code>æ³¨æ„</code>ï¼š</p><ul><li>å¼€å¯replicationFactorï¼Œvmagentä¼šäº§ç”ŸreplicationFactorä»½å†—ä½™æ•°æ®ï¼Œéœ€è¦dedup.minScrapeIntervalå‚æ•°ï¼Œæ¥å»é™¤é‡å¤æ•°æ®ã€‚</li><li>å¼€å¯æˆ–ä¿®æ”¹replicationFactor,å¯èƒ½é€ æˆæ•°æ®éƒ¨åˆ†ä¸¢å¤±ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ ¹æ®è‡ªå®šä¹‰çš„é…ç½®è¿›è¡Œå®‰è£…</span></span><br><span class="line">âœ  ~ kubectl apply -f vmcluster.yaml</span><br><span class="line">vmcluster.operator.victoriametrics.com/vmcluster created</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ˜¯å¦æ­£å¸¸å¯åŠ¨</span></span><br><span class="line">âœ  ~ kubectl get pods</span><br><span class="line">NAME                                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">vminsert-vmcluster-8587774678-2xxt6              1/1     Running   0          12s</span><br><span class="line">vminsert-vmcluster-8587774678-mplrr              1/1     Running   0          12s</span><br><span class="line">vmo-victoria-metrics-operator-5d4ff4d8f4-gk4gj   1/1     Running   0          3m58s</span><br><span class="line">vmselect-vmcluster-0                             1/1     Running   0          17s</span><br><span class="line">vmselect-vmcluster-1                             1/1     Running   0          17s</span><br><span class="line">vmstorage-vmcluster-0                            1/1     Running   0          23s</span><br><span class="line">vmstorage-vmcluster-1                            1/1     Running   0          23s</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">âœ  ~ kubectl get vmclusters</span><br><span class="line">NAME        INSERT COUNT   STORAGE COUNT   SELECT COUNT   AGE   STATUS</span><br><span class="line">vmcluster   2              2               2              63s   operational</span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å–vminsertæœåŠ¡å</span></span><br><span class="line">âœ  ~ kubectl get svc | grep vminsert</span><br><span class="line">vminsert-vmcluster              ClusterIP   10.105.160.47    &lt;none&gt;        8480/TCP                     6m49s</span><br></pre></td></tr></table></figure><h3 id="vmagent-yaml"><a href="#vmagent-yaml" class="headerlink" title="vmagent.yaml"></a>vmagent.yaml</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">operator.victoriametrics.com/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VMAgent</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">vmagent</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceScrapeNamespaceSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">podScrapeNamespaceSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">podScrapeSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">serviceScrapeSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">nodeScrapeSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">nodeScrapeNamespaceSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">staticScrapeSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">staticScrapeNamespaceSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">replicaCount:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">remoteWrite:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">"http://vminsert-vmcluster.default.svc.cluster.local:8480/insert/0/prometheus/api/v1/write"</span></span><br></pre></td></tr></table></figure><blockquote><p>VMAgentçš„<code>remoteWrite.url</code> ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>â€œservice_name.VMCluster_namespace.svc.kubernetes_cluster_domainâ€<br>åœ¨ä¾‹å­ä¸­ï¼Œå®ƒæ˜¯vminsert-vmcluster.default.svc.cluster.local</li></ul></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ ¹æ®è‡ªå®šä¹‰çš„é…ç½®è¿›è¡Œå®‰è£…</span></span><br><span class="line">âœ  ~ kubectl apply -f vmagent.yaml</span><br><span class="line">vmagent.operator.victoriametrics.com/vmagent created</span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®æœ¬åœ°ç«¯å£è½¬å‘è®¿é—®(ç”Ÿäº§ç¯å¢ƒå¯ä½¿ç”¨ingressæˆ–nodeportè½¬å‘è®¿é—®)</span></span><br><span class="line">âœ  ~ kubectl port-forward svc/vmagent-vmagent 8429:8429</span><br><span class="line">Forwarding from 127.0.0.1:8429 -&gt; 8429</span><br><span class="line">Forwarding from [::1]:8429 -&gt; 8429</span><br><span class="line">Handling connection <span class="keyword">for</span> 8429</span><br><span class="line">Handling connection <span class="keyword">for</span> 8429</span><br></pre></td></tr></table></figure><p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<a href="http://127.0.0.1:8429/targets" target="_blank" rel="noopener">http://127.0.0.1:8429/targets</a> æŸ¥çœ‹VMAgentæ˜¯å¦ä» K8s é›†ç¾¤æ”¶é›†æŒ‡æ ‡</p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://docs.victoriametrics.com/guides/getting-started-with-vm-operator/vmcluster.webp"><h2 id="éªŒè¯-VictoriaMetrics-Cluster"><a href="#éªŒè¯-VictoriaMetrics-Cluster" class="headerlink" title="éªŒè¯ VictoriaMetrics Cluster"></a>éªŒè¯ VictoriaMetrics Cluster</h2><p>è·å–vmselectæœåŠ¡å</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ kubectl get svc | grep vmselect</span><br><span class="line">vmselect-vmcluster              ClusterIP   None             &lt;none&gt;        8481/TCP                     31m</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…Grafana"><a href="#å®‰è£…Grafana" class="headerlink" title="å®‰è£…Grafana"></a>å®‰è£…Grafana</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF</span> <span class="string">|</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">grafana</span> <span class="string">grafana/grafana</span> <span class="string">-f</span> <span class="bullet">-</span></span><br><span class="line">  <span class="attr">datasources:</span></span><br><span class="line">    <span class="attr">datasources.yaml:</span></span><br><span class="line">      <span class="attr">apiVersion:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">datasources:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">victoriametrics</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">prometheus</span></span><br><span class="line">          <span class="attr">orgId:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">http://vmselect-vmcluster.default.svc.cluster.local:8481/select/0/prometheus/</span></span><br><span class="line">          <span class="attr">access:</span> <span class="string">proxy</span></span><br><span class="line">          <span class="attr">isDefault:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">updateIntervalSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">editable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">dashboardProviders:</span></span><br><span class="line">   <span class="attr">dashboardproviders.yaml:</span></span><br><span class="line">     <span class="attr">apiVersion:</span> <span class="number">1</span></span><br><span class="line">     <span class="attr">providers:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">'default'</span></span><br><span class="line">       <span class="attr">orgId:</span> <span class="number">1</span></span><br><span class="line">       <span class="attr">folder:</span> <span class="string">''</span></span><br><span class="line">       <span class="attr">type:</span> <span class="string">file</span></span><br><span class="line">       <span class="attr">disableDeletion:</span> <span class="literal">true</span></span><br><span class="line">       <span class="attr">editable:</span> <span class="literal">true</span></span><br><span class="line">       <span class="attr">options:</span></span><br><span class="line">         <span class="attr">path:</span> <span class="string">/var/lib/grafana/dashboards/default</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">dashboards:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">victoriametrics:</span></span><br><span class="line">        <span class="attr">gnetId:</span> <span class="number">11176</span></span><br><span class="line">        <span class="attr">revision:</span> <span class="number">18</span></span><br><span class="line">        <span class="attr">datasource:</span> <span class="string">victoriametrics</span></span><br><span class="line">      <span class="attr">vmagent:</span></span><br><span class="line">        <span class="attr">gnetId:</span> <span class="number">12683</span></span><br><span class="line">        <span class="attr">revision:</span> <span class="number">7</span></span><br><span class="line">        <span class="attr">datasource:</span> <span class="string">victoriametrics</span></span><br><span class="line">      <span class="attr">kubernetes:</span></span><br><span class="line">        <span class="attr">gnetId:</span> <span class="number">14205</span></span><br><span class="line">        <span class="attr">revision:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">datasource:</span> <span class="string">victoriametrics</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="æµè§ˆå™¨éªŒè¯"><a href="#æµè§ˆå™¨éªŒè¯" class="headerlink" title="æµè§ˆå™¨éªŒè¯"></a>æµè§ˆå™¨éªŒè¯</h2><h3 id="grafana"><a href="#grafana" class="headerlink" title="grafana"></a>grafana</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹adminå¯†ç </span></span><br><span class="line">âœ  ~ kubectl get secret --namespace default grafana -o jsonpath=<span class="string">"&#123;.data.admin-password&#125;"</span> | base64 --decode ; <span class="built_in">echo</span></span><br><span class="line">wVj5Rdl1BuPClRy5qgxrztsaoE8v0e4m05DU1cUW</span><br><span class="line"><span class="comment">#è½¬å‘é…ç½®æœ¬åœ°ç«¯å£è½¬å‘è®¿é—®</span></span><br><span class="line">âœ  ~ <span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">"app.kubernetes.io/name=grafana,app.kubernetes.io/instance=grafana"</span> -o jsonpath=<span class="string">"&#123;.items[0].metadata.name&#125;"</span>)</span><br><span class="line">âœ  ~ kubectl --namespace default port-forward <span class="variable">$POD_NAME</span> 3000</span><br><span class="line">Forwarding from 127.0.0.1:3000 -&gt; 3000</span><br><span class="line">Forwarding from [::1]:3000 -&gt; 3000</span><br></pre></td></tr></table></figure><p>è®¿é—®:<code>http://localhost:3000</code><br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://docs.victoriametrics.com/guides/getting-started-with-vm-operator/vmcluster-grafana1.webp"><br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://docs.victoriametrics.com/guides/getting-started-with-vm-operator/vmcluster-grafana2.webp"></p><h3 id="vmui"><a href="#vmui" class="headerlink" title="vmui"></a>vmui</h3><p>VictoriaMetrics Clusteræä¾›äº†ç”¨äºæŸ¥è¯¢æ•…éšœæ’é™¤å’Œæ¢ç´¢çš„ UI</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ kubectl port-forward svc/vmselect-vmcluster 8481:8481</span><br><span class="line">Forwarding from 127.0.0.1:8481 -&gt; 8481</span><br><span class="line">Forwarding from [::1]:8481 -&gt; 8481</span><br></pre></td></tr></table></figure><p>è®¿é—®:<code>http://localhost:8481/select/0/vmui/</code><br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/vmui.png"></p><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="ç›‘æ§jvm"><a href="#ç›‘æ§jvm" class="headerlink" title="ç›‘æ§jvm"></a>ç›‘æ§jvm</h3><h4 id="åœ¨dceé›†ç¾¤åˆ›å»ºå‘½åç©ºé—´"><a href="#åœ¨dceé›†ç¾¤åˆ›å»ºå‘½åç©ºé—´" class="headerlink" title="åœ¨dceé›†ç¾¤åˆ›å»ºå‘½åç©ºé—´"></a>åœ¨dceé›†ç¾¤åˆ›å»ºå‘½åç©ºé—´</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºmonitorçš„å‘½åç©ºé—´</span></span><br><span class="line">âœ  ~ kubectl create ns monitor</span><br><span class="line">namespace/monitor created</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹k8sç‰ˆæœ¬</span></span><br><span class="line">âœ  ~ kubectl version --short</span><br><span class="line">Flag --short has been deprecated, and will be removed <span class="keyword">in</span> the future. The --short output will become the default.</span><br><span class="line">Client Version: v1.24.0</span><br><span class="line">Kustomize Version: v4.5.4</span><br><span class="line">Server Version: v1.18.20</span><br><span class="line">WARNING: version difference between client (1.24) and server (1.18) exceeds the supported minor version skew of +/-1</span><br></pre></td></tr></table></figure><h4 id="åœ¨monitorå‘½åç©ºé—´ä¸­åˆ›å»ºserviceaccountï¼š"><a href="#åœ¨monitorå‘½åç©ºé—´ä¸­åˆ›å»ºserviceaccountï¼š" class="headerlink" title="åœ¨monitorå‘½åç©ºé—´ä¸­åˆ›å»ºserviceaccountï¼š"></a>åœ¨monitorå‘½åç©ºé—´ä¸­åˆ›å»ºserviceaccountï¼š</h4><p>ServiceAccount.yaml</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">k8s</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">kube-prometheus</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.18</span><span class="number">.20</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus-k8s</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºsecret-ä¼šè‡ªåŠ¨åˆ›å»ºtoken"><a href="#åˆ›å»ºsecret-ä¼šè‡ªåŠ¨åˆ›å»ºtoken" class="headerlink" title="åˆ›å»ºsecret,ä¼šè‡ªåŠ¨åˆ›å»ºtoken"></a>åˆ›å»ºsecret,ä¼šè‡ªåŠ¨åˆ›å»ºtoken</h4><p>ï¼ˆk8såœ¨1.24ç‰ˆæœ¬ååˆ›å»ºserviceaccountä¸ä¼šè‡ªåŠ¨åˆ›å»ºç»‘å®šsecretï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºsecretæ¥ç»‘å®šåˆ°serviceaccountï¼‰<br>Secret.yaml</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/service-account.name:</span> <span class="string">prometheus-k8s</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus-k8s-secret</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/service-account-token</span></span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºcluster-role"><a href="#åˆ›å»ºcluster-role" class="headerlink" title="åˆ›å»ºcluster role"></a>åˆ›å»ºcluster role</h4><p>ClusterRole.yaml</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">k8s</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">kube-prometheus</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.18</span><span class="number">.20</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus-k8s</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes/metrics</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">  <span class="comment">#- endpointslices  å¯¹äºéœ€è¦å¤„ç†æ•°åƒç”šè‡³æ•°ä¸‡ä¸ªç«¯ç‚¹çš„å¤§å‹æœåŠ¡ï¼Œä½¿ç”¨EndpointSliceå¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br></pre></td></tr></table></figure><h4 id="æˆæƒç»™serviceaccount"><a href="#æˆæƒç»™serviceaccount" class="headerlink" title="æˆæƒç»™serviceaccount"></a>æˆæƒç»™serviceaccount</h4><p>ClusterRoleBinding.yaml</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">k8s</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">kube-prometheus</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.18</span><span class="number">.20</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus-k8s</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus-k8s</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus-k8s</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br></pre></td></tr></table></figure><h4 id="åœ¨vmé›†ç¾¤ä¸­åˆ›å»ºå¥½dceé›†ç¾¤çš„comfigmapå¹¶éƒ¨ç½²"><a href="#åœ¨vmé›†ç¾¤ä¸­åˆ›å»ºå¥½dceé›†ç¾¤çš„comfigmapå¹¶éƒ¨ç½²" class="headerlink" title="åœ¨vmé›†ç¾¤ä¸­åˆ›å»ºå¥½dceé›†ç¾¤çš„comfigmapå¹¶éƒ¨ç½²"></a>åœ¨vmé›†ç¾¤ä¸­åˆ›å»ºå¥½dceé›†ç¾¤çš„comfigmapå¹¶éƒ¨ç½²</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹prometheus-k8s-secretä¸­çš„token</span></span><br><span class="line">âœ  ~ kubectl get secret prometheus-k8s-secret -n monitor -o yaml | grep token</span><br><span class="line">  token: ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkltUnVibTFSYUVkbVdtTlBUR2hzZHpVd1dEZE9UVWhhZFdKdlJVZHpaMDV2Y1hOcmFqTnNTM1ZVYUhNaWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUp0YjI1cGRHOXlJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5elpXTnlaWFF1Ym1GdFpTSTZJbkJ5YjIxbGRHaGxkWE10YXpoekxYTmxZM0psZENJc0ltdDFZbVZ5Ym1WMFpYTXVhVzh2YzJWeWRtbGpaV0ZqWTI5MWJuUXZjMlZ5ZG1salpTMWhZMk52ZFc1MExtNWhiV1VpT2lKd2NtOXRaWFJvWlhWekxXczRjeUlzSW10MVltVnlibVYwWlhNdWFXOHZjMlZ5ZG1salpXRmpZMjkxYm5RdmMyVnlkbWxqWlMxaFkyTnZkVzUwTG5WcFpDSTZJak5rTWpJd01qQm1MVEZsTXpjdE5EaGxaQzFpTVRkbExUazVOMlEwWVRSbVpUUTVOU0lzSW5OMVlpSTZJbk41YzNSbGJUcHpaWEoyYVdObFlXTmpiM1Z1ZERwdGIyNXBkRzl5T25CeWIyMWxkR2hsZFhNdGF6aHpJbjAuaVFGRjI3N3U5MGEtODR4aGR0dXVPeUdvWWdZRGpTNWJOQkhEVm1lSUZ3blVqMy1zY3U1RkJfTjhjYVc3d1JhUXNjaDN6Tk0tbWwwSVZUbXRSNjVFREZxVTNiRV85SGlKS1R1UlFfb2NUTVRjQUJKT3I5YnotY19IMFNsSlJlSUN6dlVlM0M1SUxhV2JERkJSRGxfVlRKTXBhVjMxZTlacXN6YTVMRGE5MkJDYldoaldzd2tOR1pSOUppeFVwTW1Mb2dKZFN2Nm0wcjFxelQwU2NjeEw2STRSa2JEUkhDZ1p5ZlhKc1Y3T1d5cmdoT0dwX2FJYTdJUHItbC00dEV0cGhoTFd4MjJMTWFFOW5odkJCZ2dHUVR4a2VDcEY1MWRjSzAtQ3phTjNWV1htckNHajJyT1BzTXdzaVdsOHJ3bk1BdmhYdmVaSGRCVFYwT2dQYkVkWXF3</span><br><span class="line">      &#123;<span class="string">"apiVersion"</span>:<span class="string">"v1"</span>,<span class="string">"kind"</span>:<span class="string">"Secret"</span>,<span class="string">"metadata"</span>:&#123;<span class="string">"annotations"</span>:&#123;<span class="string">"kubernetes.io/service-account.name"</span>:<span class="string">"prometheus-k8s"</span>&#125;,<span class="string">"name"</span>:<span class="string">"prometheus-k8s-secret"</span>,<span class="string">"namespace"</span>:<span class="string">"monitor"</span>&#125;,<span class="string">"type"</span>:<span class="string">"kubernetes.io/service-account-token"</span>&#125;</span><br><span class="line"><span class="built_in">type</span>: kubernetes.io/service-account-token</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹tokenè¿›è¡Œbase64è§£å¯†</span></span><br><span class="line">âœ  ~ <span class="built_in">echo</span> <span class="string">"ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkltUnVibTFSYUVkbVdtTlBUR2hzZHpVd1dEZE9UVWhhZFdKdlJVZHpaMDV2Y1hOcmFqTnNTM1ZVYUhNaWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUp0YjI1cGRHOXlJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5elpXTnlaWFF1Ym1GdFpTSTZJbkJ5YjIxbGRHaGxkWE10YXpoekxYTmxZM0psZENJc0ltdDFZbVZ5Ym1WMFpYTXVhVzh2YzJWeWRtbGpaV0ZqWTI5MWJuUXZjMlZ5ZG1salpTMWhZMk52ZFc1MExtNWhiV1VpT2lKd2NtOXRaWFJvWlhWekxXczRjeUlzSW10MVltVnlibVYwWlhNdWFXOHZjMlZ5ZG1salpXRmpZMjkxYm5RdmMyVnlkbWxqWlMxaFkyTnZkVzUwTG5WcFpDSTZJak5rTWpJd01qQm1MVEZsTXpjdE5EaGxaQzFpTVRkbExUazVOMlEwWVRSbVpUUTVOU0lzSW5OMVlpSTZJbk41YzNSbGJUcHpaWEoyYVdObFlXTmpiM1Z1ZERwdGIyNXBkRzl5T25CeWIyMWxkR2hsZFhNdGF6aHpJbjAuaVFGRjI3N3U5MGEtODR4aGR0dXVPeUdvWWdZRGpTNWJOQkhEVm1lSUZ3blVqMy1zY3U1RkJfTjhjYVc3d1JhUXNjaDN6Tk0tbWwwSVZUbXRSNjVFREZxVTNiRV85SGlKS1R1UlFfb2NUTVRjQUJKT3I5YnotY19IMFNsSlJlSUN6dlVlM0M1SUxhV2JERkJSRGxfVlRKTXBhVjMxZTlacXN6YTVMRGE5MkJDYldoaldzd2tOR1pSOUppeFVwTW1Mb2dKZFN2Nm0wcjFxelQwU2NjeEw2STRSa2JEUkhDZ1p5ZlhKc1Y3T1d5cmdoT0dwX2FJYTdJUHItbC00dEV0cGhoTFd4MjJMTWFFOW5odkJCZ2dHUVR4a2VDcEY1MWRjSzAtQ3phTjNWV1htckNHajJyT1BzTXdzaVdsOHJ3bk1BdmhYdmVaSGRCVFYwT2dQYkVkWXF3"</span> |base64 --decode</span><br></pre></td></tr></table></figure><p>æŠŠä¸Šé¢base64 è§£å¯†åæ–‡ä»¶å†™åœ¨å¦‚ä¸‹ tokené‡Œ<br>dce-token-configmap.yaml</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">token:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">eyJhbGciOiJSUzI1NiIsImtpZCI6ImRubm1RaEdmWmNPTGhsdzUwWDdOTUhadWJvRUdzZ05vcXNrajNsS3VUaHMifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJtb25pdG9yIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InByb21ldGhldXMtazhzLXNlY3JldCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJwcm9tZXRoZXVzLWs4cyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjNkMjIwMjBmLTFlMzctNDhlZC1iMTdlLTk5N2Q0YTRmZTQ5NSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDptb25pdG9yOnByb21ldGhldXMtazhzIn0.iQFF277u90a-84xhdtuuOyGoYgYDjS5bNBHDVmeIFwnUj3-scu5FB_N8caW7wRaQsch3zNM-ml0IVTmtR65EDFqU3bE_9HiJKTuRQ_ocTMTcABJOr9bz-c_H0SlJReICzvUe3C5ILaWbDFBRDl_VTJMpaV31e9Zqsza5LDa92BCbWhjWswkNGZR9JixUpMmLogJdSv6m0r1qzT0SccxL6I4RkbDRHCgZyfXJsV7OWyrghOGp_aIa7IPr-l-4tEtphhLWx22LMaE9nhvBBggGQTxkeCpF51dcK0-CzaN3VWXmrCGj2rOPsMwsiWl8rwnMAvhXveZHdBTV0OgPbEdYqw</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dce-token-configmap</span></span><br></pre></td></tr></table></figure><p>éƒ¨ç½²dce-token-configmap </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ kubectl apply -f dce-token-configmap.yaml</span><br><span class="line">configmap/dce-token-configmap created</span><br></pre></td></tr></table></figure><h4 id="åœ¨vmagent-yamlæ–‡ä»¶é…ç½®é‡‡é›†æŒ‡æ ‡ç­–ç•¥"><a href="#åœ¨vmagent-yamlæ–‡ä»¶é…ç½®é‡‡é›†æŒ‡æ ‡ç­–ç•¥" class="headerlink" title="åœ¨vmagent.yamlæ–‡ä»¶é…ç½®é‡‡é›†æŒ‡æ ‡ç­–ç•¥"></a>åœ¨vmagent.yamlæ–‡ä»¶é…ç½®é‡‡é›†æŒ‡æ ‡ç­–ç•¥</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">operator.victoriametrics.com/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VMAgent</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">vmagent</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment">#æŠ“å–æŒ‡æ ‡çš„æ—¶é—´é—´éš”</span></span><br><span class="line">  <span class="attr">scrapeInterval:</span> <span class="string">20s</span></span><br><span class="line">  <span class="comment">#vmagentå‰¯æœ¬æ•°é‡</span></span><br><span class="line">  <span class="attr">replicaCount:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment">#èµ„æºå¤§å°</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="number">4</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">8Gi</span></span><br><span class="line">    <span class="attr">limits:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="number">4</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">8Gi</span></span><br><span class="line">  <span class="comment">#æŒ‚è½½dce-token</span></span><br><span class="line">  <span class="attr">volumeMounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/dce-token/</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dce-token</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">configMap:</span></span><br><span class="line">      <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dce-token-configmap</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">dce-token</span></span><br><span class="line">  <span class="comment">#è¿œç¨‹å†™å…¥</span></span><br><span class="line">  <span class="attr">remoteWrite:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">"http://vminsert-vmcluster.default.svc.cluster.local:8480/insert/0/prometheus/api/v1/write"</span></span><br><span class="line">  <span class="attr">inlineScrapeConfig:</span> <span class="string">|</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">dce-jvm-exporter</span></span><br><span class="line">      <span class="comment">#æ˜¯å¦å°Šé‡æŒ‡æ ‡çš„æ—¶é—´æˆ³</span></span><br><span class="line">      <span class="attr">honor_timestamps:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment">#æŠ“å–æŒ‡æ ‡çš„æ—¶é—´é—´éš”</span></span><br><span class="line">      <span class="attr">scrape_interval:</span> <span class="string">20s</span></span><br><span class="line">      <span class="comment">#æŠ“å–æŒ‡æ ‡çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">      <span class="attr">scrape_timeout:</span> <span class="string">30s</span></span><br><span class="line">      <span class="comment">#æŠ“å–çš„æŒ‡æ ‡è·¯å¾„</span></span><br><span class="line">      <span class="attr">metrics_path:</span> <span class="string">/actuator/prometheus</span></span><br><span class="line">      <span class="comment">#æŠ“å–åè®®</span></span><br><span class="line">      <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">      <span class="comment">#æŒ‡å®šè®¤è¯çš„ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line">      <span class="attr">basic_auth:</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">'actuator'</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">'actuator%2@nmk!@#'</span></span><br><span class="line">      <span class="comment">#è·³è¿‡ TLS è¯ä¹¦éªŒè¯</span></span><br><span class="line">      <span class="attr">tls_config:</span></span><br><span class="line">        <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">      <span class="comment">#Kubernetes API æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">api_server:</span> <span class="string">https://10.30.150.11:16443</span></span><br><span class="line">        <span class="comment">#æŒ‡å®šè¦å‘ç°çš„èµ„æºç±»å‹(endpointsï¼Œserviceï¼Œpodï¼Œnodeï¼Œingress)</span></span><br><span class="line">        <span class="attr">role:</span> <span class="string">pod</span></span><br><span class="line">        <span class="comment">#é…ç½®è®¿é—® Kubernetes API çš„è®¤è¯å’Œ TLS è®¾ç½®</span></span><br><span class="line">        <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/dce-token/token</span></span><br><span class="line">        <span class="attr">tls_config:</span></span><br><span class="line">          <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">relabel_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> <span class="string">[__meta_kubernetes_pod_annotation_prometheus_io_scrape]</span></span><br><span class="line">          <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">"true"</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">keep</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> <span class="string">[__meta_kubernetes_pod_annotation_prometheus_io_path]</span></span><br><span class="line">          <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> <span class="string">[__address__,</span> <span class="string">__meta_kubernetes_pod_annotation_prometheus_io_port]</span></span><br><span class="line">          <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">([^:]+)(?::\d+)?;(\d+)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1:$2</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_pod_label_(.+)</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> <span class="string">[__meta_kubernetes_namespace]</span></span><br><span class="line">          <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.*)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">kubernetes_namespace</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> <span class="string">[__meta_kubernetes_pod_name]</span></span><br><span class="line">          <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.*)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">kubernetes_pod_name</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br></pre></td></tr></table></figure><p>relabel_configs: è¿‡æ»¤å’Œé‡å†™ç›®æ ‡æ ‡ç­¾</p><ol><li>source_labels: æŒ‡å®šç”¨äºåŒ¹é…çš„æºæ ‡ç­¾åˆ—è¡¨</li><li>separator: æŒ‡å®šåˆ†éš”ç¬¦</li><li>regex: ç”¨äºåŒ¹é… source_labels æå–çš„å€¼çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé»˜è®¤ä¸ºåŒ¹é…ä»»æ„å€¼ï¼ˆ.*ï¼‰</li><li>replacement: ç”¨äºæ›¿æ¢æ“ä½œçš„å€¼</li><li>actionï¼šå®šä¹‰äº†å¯¹æ ‡ç­¾çš„å¤„ç†æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š<ul><li>replaceï¼šæ ¹æ® regex åŒ¹é… source_labels çš„å€¼ï¼Œå¹¶å°†å…¶å†™å…¥ target_label</li><li>keepï¼šä»…ä¿ç•™åŒ¹é… regex çš„æ ‡ç­¾ï¼Œå…¶ä½™çš„å°†è¢«ä¸¢å¼ƒ</li><li>dropï¼šä¸¢å¼ƒåŒ¹é… regex çš„æ ‡ç­¾ï¼Œä¿ç•™å…¶ä½™çš„</li><li>labelmapï¼šæ ¹æ® regex åŒ¹é… Target å®ä¾‹æ‰€æœ‰æ ‡ç­¾çš„åç§°ï¼Œå¹¶ä»¥åŒ¹é…åˆ°çš„å†…å®¹ä¸ºæ–°çš„æ ‡ç­¾åç§°ï¼Œå…¶å€¼ä½œä¸ºæ–°æ ‡ç­¾çš„å€¼</li><li>labeldropï¼šç§»é™¤åŒ¹é… regex è§„åˆ™çš„æ ‡ç­¾</li><li>labelkeepï¼šç§»é™¤ä¸åŒ¹é… regex è§„åˆ™çš„æ ‡ç­¾ï¼Œä¿ç•™åŒ¹é…çš„</li></ul></li></ol><p>è¦ç›‘æ§çš„Pod ä¸­éœ€è¦æœ‰ä»¥ä¸‹æ³¨è§£æ‰èƒ½æ­£å¸¸é‡‡é›†</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">annotations:</span><br><span class="line">        prometheus.io/path: /actuator/prometheus</span><br><span class="line">        prometheus.io/port: &quot;20001&quot;</span><br><span class="line">        prometheus.io/scrape: &quot;true&quot;</span><br></pre></td></tr></table></figure><h4 id="åŠ è½½é…ç½®æ–‡ä»¶ï¼š"><a href="#åŠ è½½é…ç½®æ–‡ä»¶ï¼š" class="headerlink" title="åŠ è½½é…ç½®æ–‡ä»¶ï¼š"></a>åŠ è½½é…ç½®æ–‡ä»¶ï¼š</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ kubectl apply -f vmagent.yaml</span><br><span class="line">vmagent.operator.victoriametrics.com/vmagent configured</span><br></pre></td></tr></table></figure><h4 id="vmagentæŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š"><a href="#vmagentæŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š" class="headerlink" title="vmagentæŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š"></a>vmagentæŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š</h4><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/vmagent-jvm.jpg"><h4 id="GrafanaæŸ¥çœ‹é¢æ¿"><a href="#GrafanaæŸ¥çœ‹é¢æ¿" class="headerlink" title="GrafanaæŸ¥çœ‹é¢æ¿"></a>GrafanaæŸ¥çœ‹é¢æ¿</h4><p>æ‰“å¼€Grafana,åœ¨Dashboardsä¸­importé¢æ¿ID:4701<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/vm-jvm.png"></p><h3 id="ç›‘æ§k8sé›†ç¾¤çŠ¶æ€"><a href="#ç›‘æ§k8sé›†ç¾¤çŠ¶æ€" class="headerlink" title="ç›‘æ§k8sé›†ç¾¤çŠ¶æ€"></a>ç›‘æ§k8sé›†ç¾¤çŠ¶æ€</h3><h4 id="kube-state-metrics"><a href="#kube-state-metrics" class="headerlink" title="kube-state-metrics"></a>kube-state-metrics</h4><p>é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ï¼Œè¿›è¡Œå®‰è£…éƒ¨ç½²<br><a href="https://github.com/kubernetes/kube-state-metrics" target="_blank" rel="noopener">https://github.com/kubernetes/kube-state-metrics</a></p><p>é‡‡é›†å¤–éƒ¨é›†ç¾¤éœ€è¦æŠŠkube-state-metricsçš„serviceæ”¹ä¸ºNodePort</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- job_name: dce-kube-state-metrics</span><br><span class="line">  honor_timestamps: true</span><br><span class="line">  scrape_interval: 15s</span><br><span class="line">  metrics_path: &apos;/metrics&apos;</span><br><span class="line">  scheme: http</span><br><span class="line">  static_configs:</span><br><span class="line">  - targets: [&apos;10.30.150.1:33987&apos;]</span><br><span class="line">  #æŒ‡æ ‡è¿‡å¤§æ—¶å¯ä½¿ç”¨</span><br><span class="line">  params:</span><br><span class="line">  max_scrape_size: 33554432</span><br></pre></td></tr></table></figure><h4 id="cAdvisor"><a href="#cAdvisor" class="headerlink" title="cAdvisor"></a>cAdvisor</h4><p>âš ï¸å¿…é¡»è¦ä¸¤ä¸ªbearer_token_fileï¼Œä¸€ä¸ªè®¤è¯apiserverï¼Œä¸€ä¸ªé€šè¿‡apiserverè¿›è¡ŒcAdvisoré‡‡é›†æŒ‡æ ‡</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- job_name: dce-cadvisor</span><br><span class="line">  metrics_path: /metrics</span><br><span class="line">  scheme: https</span><br><span class="line">  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/dce-token/token</span><br><span class="line">  tls_config:</span><br><span class="line">    insecure_skip_verify: true</span><br><span class="line">  kubernetes_sd_configs:</span><br><span class="line">  - api_server: https://10.30.150.11:16443</span><br><span class="line">    role: node</span><br><span class="line">    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/dce-token/token</span><br><span class="line">    tls_config:</span><br><span class="line">      insecure_skip_verify: true</span><br><span class="line">  relabel_configs:</span><br><span class="line">  - action: labelmap</span><br><span class="line">    regex: __meta_kubernetes_node_label_(.*)</span><br><span class="line">  - target_label: __address__</span><br><span class="line">    action: replace</span><br><span class="line">    regex: (.*)</span><br><span class="line">    source_labels: [&quot;__address__&quot;]</span><br><span class="line">    replacement: 10.30.150.11:16443</span><br><span class="line">  - source_labels: [__meta_kubernetes_node_name]</span><br><span class="line">    regex: (.*)</span><br><span class="line">    action: replace</span><br><span class="line">    target_label: __metrics_path__</span><br><span class="line">    replacement: /api/v1/nodes/$&#123;1&#125;/proxy/metrics/cadvisor</span><br><span class="line">  metric_relabel_configs:</span><br><span class="line">  - source_labels: [instance]</span><br><span class="line">    separator: ;</span><br><span class="line">    regex: (.+)</span><br><span class="line">    target_label: node</span><br><span class="line">    replacement: $1</span><br><span class="line">    action: replace</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å¤§ç›˜<br>æ‰“å¼€Grafana,åœ¨Dashboardsä¸­importé¢æ¿ID:13105<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/vm-k8s.png"></p><h4 id="Node-Exporter"><a href="#Node-Exporter" class="headerlink" title="Node-Exporter"></a>Node-Exporter</h4><p>é›†ç¾¤å†…éƒ¨å¯é€šè¿‡VMNodeScrapeèµ„æºå¯¹è±¡è¿›è¡Œé…ç½®,è¯¥èµ„æºå¯¹è±¡ä¸æ”¯æŒapiserverå‚æ•°ï¼Œæ‰€ä»¥æ— æ³•é‡‡é›†å¤–éƒ¨é›†ç¾¤çš„ä¿¡æ¯<br>VMNodeScrape.yaml</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">operator.victoriametrics.com/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VMNodeScrape</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">node-exporter</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/metrics</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">"9111"</span> <span class="comment"># æŒ‡å®š node-exporter çš„ç«¯å£</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line">  <span class="comment"># relabelConfigsï¼š  # relabelé…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span><br><span class="line">  <span class="comment"># selector:  # è¿‡æ»¤èŠ‚ç‚¹ï¼ˆå¦‚æœéœ€è¦ï¼‰'</span></span><br></pre></td></tr></table></figure><p>é›†ç¾¤å¤–éƒ¨é€šè¿‡Vmagentè¿›è¡Œé‡‡é›†<br>âš ï¸é€šè¿‡node-exporterçš„serviceæ”¹ä¸ºnodeportè¿›è¡Œé‡‡é›†åªæœ‰ä¸€å°å®ä¾‹æ•°æ®ï¼Œæ‰€ä»¥æ”¹ä¸ºå¤štargetsé‡‡é›†</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- job_name: dce-node-exporter</span><br><span class="line">      honor_timestamps: true</span><br><span class="line">      scrape_interval: 15s</span><br><span class="line">      metrics_path: &apos;/metrics&apos;</span><br><span class="line">      scheme: http</span><br><span class="line">      static_configs:</span><br><span class="line">      - targets: [&apos;10.30.150.1:12921&apos;,&apos;10.30.150.2:12921&apos;,&apos;10.30.150.3:12921&apos;,&apos;10.30.150.4:12921&apos;,&apos;10.30.150.5:12921&apos;,&apos;10.30.150.6:12921&apos;,&apos;10.30.150.8:12921&apos;,&apos;10.30.150.9:12921&apos;,&apos;10.30.150.10:12921&apos;]</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å¤§ç›˜<br>æ‰“å¼€Grafana,åœ¨Dashboardsä¸­importé¢æ¿ID:16098<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/vm-nodeexporter.png"></p><h3 id="Vmalert"><a href="#Vmalert" class="headerlink" title="Vmalert"></a>Vmalert</h3><p>vmalertåœ¨å†…å­˜ä¸­ä¿å­˜è­¦æŠ¥çŠ¶æ€ã€‚é‡æ–°å¯åŠ¨è¯¥vmalertè¿›ç¨‹å°†é‡ç½®å†…å­˜ä¸­æ‰€æœ‰æ´»åŠ¨è­¦æŠ¥çš„çŠ¶æ€ã€‚ä¸ºé˜²æ­¢vmalertåœ¨é‡æ–°å¯åŠ¨æ—¶ä¸¢å¤±,é€šè¿‡<code>-remote.write.url</code>å’Œ<code>-remote.read.url</code>å°†å…¶é…ç½®ä¸ºå°†çŠ¶æ€æŒä¹…ä¿å­˜åˆ°è¿œç¨‹æ•°æ®åº“</p><h4 id="å®‰è£…vmalertå’Œalert-manager"><a href="#å®‰è£…vmalertå’Œalert-manager" class="headerlink" title="å®‰è£…vmalertå’Œalert manager"></a>å®‰è£…vmalertå’Œalert manager</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&lt;&lt;EOF</span> <span class="string">|</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">vma</span> <span class="string">vm/victoria-metrics-alert</span> <span class="string">-f</span> <span class="bullet">-</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">http://vmselect-vmcluster.default.svc:8481/select/0/prometheus</span></span><br><span class="line">    <span class="attr">remote:</span></span><br><span class="line">      <span class="attr">write:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://vminsert-vmcluster.default.svc:8480/insert/0/prometheus</span></span><br><span class="line">      <span class="attr">read:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://vmselect-vmcluster.default.svc:8481/select/0/prometheus</span></span><br><span class="line">      <span class="attr">notifier:</span></span><br><span class="line">        <span class="attr">alertmanager:</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">http://vma-victoria-metrics-alert-alertmanager.default.svc:9093</span></span><br><span class="line">  <span class="attr">alertmanager:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®alert-manager"><a href="#é…ç½®alert-manager" class="headerlink" title="é…ç½®alert manager"></a>é…ç½®alert manager</h4><p>kubectl edit configmap vma-victoria-metrics-alert-alertmanager-config</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">global:</span><br><span class="line">  smtp_smarthost: &apos;smtp.qq.com:465&apos;</span><br><span class="line">  smtp_from: &apos;2977358239@qq.com&apos;</span><br><span class="line">  smtp_auth_username: &apos;2977358239@qq.com&apos;</span><br><span class="line">  smtp_auth_password: &apos;jgigqzrlhycddhcf&apos; # è¿™é‡Œæ˜¯é‚®ç®±çš„æˆæƒå¯†ç ï¼Œä¸æ˜¯ç™»å½•å¯†ç </span><br><span class="line">  smtp_require_tls: false</span><br><span class="line">templates:</span><br><span class="line">  - &apos;/alertmanager/template/*.tmpl&apos;</span><br><span class="line">route:</span><br><span class="line">  group_by: [&apos;severity&apos;, &apos;source&apos;]</span><br><span class="line">  group_wait: 30s</span><br><span class="line">  group_interval: 5m</span><br><span class="line">  repeat_interval: 10m</span><br><span class="line">  receiver: email</span><br><span class="line">receivers:</span><br><span class="line">- name: &apos;email&apos;</span><br><span class="line">  email_configs:</span><br><span class="line">  - to: &apos;nimingkun@ruqimobility.com&apos;</span><br><span class="line">    send_resolved: true</span><br></pre></td></tr></table></figure><h4 id="é…ç½®vmalert"><a href="#é…ç½®vmalert" class="headerlink" title="é…ç½®vmalert"></a>é…ç½®vmalert</h4><p>kubectl edit configmap vma-victoria-metrics-alert-server-alert-rules-config</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">groups:</span><br><span class="line">- name: record</span><br><span class="line">  rules:</span><br><span class="line">  - record: job:node_memory_MemFree_bytes:percent  # è®°å½•è§„åˆ™åç§°</span><br><span class="line">    expr: 100 - (100 * node_memory_MemFree_bytes / node_memory_MemTotal_bytes)</span><br><span class="line">- name: node</span><br><span class="line">  rules:  # å…·ä½“çš„æŠ¥è­¦è§„åˆ™</span><br><span class="line">  - alert: NodeMemoryUsage  # æŠ¥è­¦è§„åˆ™çš„åç§°</span><br><span class="line">    expr: (node_memory_MemTotal_bytes - (node_memory_MemFree_bytes + node_memory_Buffers_bytes + node_memory_Cached_bytes)) / node_memory_MemTotal_bytes * 100 &gt; 30</span><br><span class="line">    for: 1m</span><br><span class="line">    labels:</span><br><span class="line">      source: node</span><br><span class="line">      severity: critical</span><br><span class="line">    annotations:</span><br><span class="line">      summary: &quot;Node &#123;&#123;$labels.instance&#125;&#125; High Memory usage detected&quot;</span><br><span class="line">      description: &quot;&#123;&#123;$labels.instance&#125;&#125;: Memory usage is above 30% (current value is: &#123;&#123; $value &#125;&#125;)&quot;</span><br></pre></td></tr></table></figure><p>recordè§„åˆ™å•ç‹¬ä½¿ç”¨ï¼Œä¸èƒ½ä¸alertè§„åˆ™æ··åˆï¼Œrecordè§„åˆ™ä¸éœ€è¦alertã€forã€labelså’Œannotationså­—æ®µ<br>record è®°å½•è§„åˆ™çš„ä¸»è¦ä½œç”¨æ˜¯å°†ä¸€ä¸ªç»™å®šçš„è¡¨è¾¾å¼çš„ç»“æœä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„æ—¶é—´åºåˆ—ï¼Œè¿™æ ·å¯ä»¥åœ¨Grafanaç­‰å¯è§†åŒ–å·¥å…·ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›æ•°æ®ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—è¡¨è¾¾å¼ã€‚</p><h4 id="alerté¡µé¢æŸ¥çœ‹æ˜¯å¦æ­£å¸¸"><a href="#alerté¡µé¢æŸ¥çœ‹æ˜¯å¦æ­£å¸¸" class="headerlink" title="alerté¡µé¢æŸ¥çœ‹æ˜¯å¦æ­£å¸¸"></a>alerté¡µé¢æŸ¥çœ‹æ˜¯å¦æ­£å¸¸</h4><p>kubectl port-forward svc/vma-victoria-metrics-alert-server 8880:8880</p><p>æŸ¥çœ‹æ‰€æœ‰çš„ Groups<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/vmalert_group.png"><br>æŸ¥çœ‹æŠ¥è­¦è§„åˆ™åˆ—è¡¨çš„çŠ¶æ€<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/vmalert_state.png"><br>æŸ¥çœ‹æŠ¥è­¦è§„åˆ™çš„è¯¦ç»†ä¿¡æ¯<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/vmalert_details.png"><br>æŸ¥çœ‹é‚®ç®±(âš ï¸éœ€ç¡®ä¿å‘ä»¶é‚®ç®±çš„éªŒè¯ç æ­£ç¡®)<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/alertmanager_mail.png"></p><p>æˆ‘ä»¬æ·»åŠ çš„è®°å½•è§„åˆ™ä¼šé€šè¿‡ remote write ä¼ é€’ç»™ vminsert ä¿ç•™ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ vmselect æŸ¥è¯¢åˆ°<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/vmui_select_record.png"></p><h4 id="æ’æŸ¥è¿‡æ»¤æŸäº›æŠ“å–æŒ‡æ ‡è¿‡é•¿å¯¼è‡´å¡ä¸»é—®é¢˜"><a href="#æ’æŸ¥è¿‡æ»¤æŸäº›æŠ“å–æŒ‡æ ‡è¿‡é•¿å¯¼è‡´å¡ä¸»é—®é¢˜" class="headerlink" title="æ’æŸ¥è¿‡æ»¤æŸäº›æŠ“å–æŒ‡æ ‡è¿‡é•¿å¯¼è‡´å¡ä¸»é—®é¢˜"></a>æ’æŸ¥è¿‡æ»¤æŸäº›æŠ“å–æŒ‡æ ‡è¿‡é•¿å¯¼è‡´å¡ä¸»é—®é¢˜</h4><p>å…ˆå»æŸ¥çœ‹vmstorage-vmcluster  vmstorageç»„ä»¶çš„æ—¥å¿—ï¼Œæ‰¾åˆ°é‚£æ¡æŒ‡æ ‡å½±å“äº†<br>è¿‡æ»¤customeræœåŠ¡çš„æŒ‡æ ‡æ”¶é›†ï¼Œåœ¨ç›¸åº”çš„jobé‡‡é›†ä»»åŠ¡ä¸‹æ·»åŠ å¦‚ä¸‹é…ç½®å³å¯</p><ul><li>source_labels: [__meta_kubernetes_pod_label_ruqi_app]<br>action: drop<br>regex: travel-platform-customerservice</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;VictoriaMetrics æ˜¯ä¸€æ¬¾å¿«é€Ÿã€ç»æµé«˜æ•ˆä¸”å¯æ‰©å±•çš„æ—¶é—´åºåˆ—æ•°æ®åº“ã€‚å¯ç”¨ä½œ Prometheus çš„é•¿æœŸè¿œç¨‹å­˜å‚¨ã€‚å¦‚æœæå–ç‡ä½äºæ¯ç§’â€‹â€‹ä¸€ç™¾ä¸‡ä¸ªæ•°æ®ç‚¹ï¼Œå»ºè®®ä½¿ç”¨å•èŠ‚ç‚¹ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯é›†ç¾¤ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;VictoriaMetricsé›†ç¾¤ç”±ä»¥ä¸‹æœåŠ¡ç»„æˆï¼š&lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://nmk0718.github.io/tag/k8s/"/>
    
    <category term="VictoriaMetrics" scheme="http://nmk0718.github.io/tag/VictoriaMetrics/"/>
    
  </entry>
  
  <entry>
    <title>nginx-ingressé…ç½®</title>
    <link href="http://nmk0718.github.io/2024/11/18/nginx-ingress%E9%85%8D%E7%BD%AE%E8%B7%A8%E5%9F%9F/"/>
    <id>http://nmk0718.github.io/2024/11/18/nginx-ingress%E9%85%8D%E7%BD%AE%E8%B7%A8%E5%9F%9F/</id>
    <published>2024-11-18T03:46:00.000Z</published>
    <updated>2024-11-18T07:42:57.730Z</updated>
    
    <content type="html"><![CDATA[<h4 id="é…ç½®å¾®ä¿¡å°ç¨‹åºæˆ–å…¬ä¼—å·è®¤è¯"><a href="#é…ç½®å¾®ä¿¡å°ç¨‹åºæˆ–å…¬ä¼—å·è®¤è¯" class="headerlink" title="é…ç½®å¾®ä¿¡å°ç¨‹åºæˆ–å…¬ä¼—å·è®¤è¯"></a>é…ç½®å¾®ä¿¡å°ç¨‹åºæˆ–å…¬ä¼—å·è®¤è¯</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/configuration-snippet:</span> <span class="string">|</span></span><br><span class="line">      <span class="string">location</span> <span class="string">/MP_verify_CwtbVLWfGpMDmrcy.txt</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">add_header</span> <span class="string">Content-Type</span> <span class="string">text/plain;</span></span><br><span class="line">        <span class="string">return</span> <span class="number">200</span> <span class="string">"CwtbVLWfGpMDmrcy"</span><span class="string">;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="è·¨åŸŸé…ç½®"><a href="#è·¨åŸŸé…ç½®" class="headerlink" title="è·¨åŸŸé…ç½®"></a>è·¨åŸŸé…ç½®</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-credentials:</span> <span class="string">'true'</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-headers:</span> <span class="string">&gt;-</span></span><br><span class="line">      <span class="string">DNT,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Forwarded-For,X-CustomHeader,X-Token</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-methods:</span> <span class="string">GET,</span> <span class="string">PUT,</span> <span class="string">POST,</span> <span class="string">DELETE,</span> <span class="string">PATCH,</span> <span class="string">OPTIONS</span></span><br><span class="line">    <span class="comment">#å¦‚æœcors-allow-originä¸èƒ½ä¸º*ï¼Œå¯å†™æ­»ä¸ºå¯¹åº”çš„åŸŸåï¼Œä¹Ÿå¯ä½¿ç”¨ä¸‹é¢çš„æ–¹æ¡ˆ</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-origin:</span> <span class="string">'*'</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-expose-headers:</span> <span class="string">Version,</span> <span class="string">X-CustomResponseHeader</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/enable-cors:</span> <span class="string">'true'</span></span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/server-snippet:</span> <span class="string">&gt;</span></span><br><span class="line">      <span class="string">if</span> <span class="string">($http_origin</span> <span class="string">=</span> <span class="string">''</span><span class="string">)&#123;</span></span><br><span class="line">            <span class="string">set</span> <span class="string">$http_origin</span> <span class="string">"*"</span><span class="string">;</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">add_header</span> <span class="string">Access-Control-Allow-Origin</span> <span class="string">$http_origin;</span></span><br><span class="line"></span><br><span class="line">      <span class="string">add_header</span> <span class="string">'Access-Control-Allow-Credentials'</span> <span class="string">'true'</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">      <span class="string">add_header</span> <span class="string">'Access-Control-Allow-Headers'</span></span><br><span class="line">      <span class="string">DNT,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Forwarded-For,X-CustomHeader,X-Token;</span></span><br><span class="line"></span><br><span class="line">      <span class="string">add_header</span> <span class="string">'Access-Control-Allow-Methods'</span> <span class="string">'GET, PUT, POST, DELETE,PATCH,OPTIONS'</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">      <span class="string">add_header</span> <span class="string">'Access-Control-Expose-Headers'</span> <span class="string">'Version,X-CustomResponseHeader'</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">      <span class="string">proxy_hide_header</span> <span class="string">'Access-Control-Allow-Origin'</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">      <span class="string">proxy_hide_header</span> <span class="string">'Access-Control-Allow-Credentials'</span><span class="string">;</span></span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">annotations:</span>    </span><br><span class="line">    <span class="comment">#httpè¯·æ±‚ä¸ä¼šé‡å®šå‘åˆ°https</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-body-size:</span> <span class="string">10m</span></span><br><span class="line">    <span class="comment">#è¯·æ±‚å…è®¸çš„æœ€å¤§è¯·æ±‚ä½“å¤§å°</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">'false'</span></span><br><span class="line">    <span class="comment">#ä½¿ç”¨é»˜è®¤çš„åç«¯è¿”å›å¤´</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/configuration-snippet:</span> <span class="string">proxy_hide_header</span> <span class="string">none;</span></span><br><span class="line">    <span class="comment">#é…ç½®è¶…æ—¶ç­‰ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/server-snippet:</span> <span class="string">|</span> </span><br><span class="line">      <span class="string">client_body_timeout</span> <span class="string">120s;</span></span><br><span class="line">      <span class="string">client_max_body_size</span> <span class="string">1024M;</span></span><br><span class="line">      <span class="string">client_header_buffer_size</span> <span class="string">10k;</span></span><br><span class="line">      <span class="string">proxy_request_buffering</span> <span class="string">off;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;é…ç½®å¾®ä¿¡å°ç¨‹åºæˆ–å…¬ä¼—å·è®¤è¯&quot;&gt;&lt;a href=&quot;#é…ç½®å¾®ä¿¡å°ç¨‹åºæˆ–å…¬ä¼—å·è®¤è¯&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®å¾®ä¿¡å°ç¨‹åºæˆ–å…¬ä¼—å·è®¤è¯&quot;&gt;&lt;/a&gt;é…ç½®å¾®ä¿¡å°ç¨‹åºæˆ–å…¬ä¼—å·è®¤è¯&lt;/h4&gt;&lt;figure class=&quot;highlight yaml</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>é™åˆ¶ç›´è¿podè®¿é—®</title>
    <link href="http://nmk0718.github.io/2024/10/24/%E9%99%90%E5%88%B6%E7%9B%B4%E8%BF%9Epod%E8%AE%BF%E9%97%AE/"/>
    <id>http://nmk0718.github.io/2024/10/24/%E9%99%90%E5%88%B6%E7%9B%B4%E8%BF%9Epod%E8%AE%BF%E9%97%AE/</id>
    <published>2024-10-24T03:30:00.000Z</published>
    <updated>2024-10-24T05:42:28.544Z</updated>
    
    <content type="html"><![CDATA[<p>é—®é¢˜ï¼šå› å…¬å¸é€šè¿‡ä¸“çº¿ä¸è…¾è®¯äº‘æ‰“é€šï¼Œå¯¼è‡´æœ¬åœ°åŠå…¬ç½‘ç»œèƒ½ç›´è¿é›†ç¾¤å†…çš„pod ipå’Œportè¿›è¡Œè®¿é—®</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><h4 id="ä½¿ç”¨NetworkPolicyé™åˆ¶"><a href="#ä½¿ç”¨NetworkPolicyé™åˆ¶" class="headerlink" title="ä½¿ç”¨NetworkPolicyé™åˆ¶"></a>ä½¿ç”¨NetworkPolicyé™åˆ¶</h4><p>è¿›å…¥tke&gt;ç»„ä»¶ç®¡ç†&gt;æ–°å»º&gt;å‹¾é€‰NetworkPolicyç»„ä»¶ï¼Œè¿›è¡Œä¿å­˜ï¼Œä½¿ç”¨yamlæ–‡ä»¶åˆ›å»ºé™åˆ¶ç­–ç•¥</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">metadata:</span><br><span class="line">  name: test-network-policy</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels: </span><br><span class="line">      app: test-app #æœåŠ¡çš„æ ‡ç­¾</span><br><span class="line">  policyTypes:</span><br><span class="line">  - Ingress</span><br><span class="line">  ingress:</span><br><span class="line">  - from:</span><br><span class="line">    - ipBlock:</span><br><span class="line">        cidr: 10.3.0.0/16 #å…è®¸ç½‘æ®µè®¿é—®</span><br><span class="line">        except:</span><br><span class="line">        - 10.80.0.0/16 #ä¸å…è®¸ç½‘æ®µè®¿é—®</span><br><span class="line">    ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">      port: 4000</span><br></pre></td></tr></table></figure><p>âš ï¸å¦‚æœæ²¡æœ‰é…ç½®ç»„ä»¶ï¼Œåˆ›å»ºyamlæ˜¯ä¸ç”Ÿæ•ˆçš„<br>å…·ä½“å‚è€ƒ<br><a href="https://cloud.tencent.com/document/product/457/19793" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/457/19793</a></p><h4 id="ç»™VPC-CNIç»‘å®šå®‰å…¨ç»„"><a href="#ç»™VPC-CNIç»‘å®šå®‰å…¨ç»„" class="headerlink" title="ç»™VPC-CNIç»‘å®šå®‰å…¨ç»„"></a>ç»™VPC-CNIç»‘å®šå®‰å…¨ç»„</h4><p>è¿›å…¥tke&gt;ç»„ä»¶ç®¡ç†&gt;eniipamdçš„å³ä¾§æ›´æ–°é…ç½®&gt;å‹¾é€‰å®‰å…¨ç»„ï¼Œé…ç½®å®‰å…¨ç»„å³å¯<br><a href="https://cloud.tencent.com/document/product/457/50360" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/457/50360</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;é—®é¢˜ï¼šå› å…¬å¸é€šè¿‡ä¸“çº¿ä¸è…¾è®¯äº‘æ‰“é€šï¼Œå¯¼è‡´æœ¬åœ°åŠå…¬ç½‘ç»œèƒ½ç›´è¿é›†ç¾¤å†…çš„pod ipå’Œportè¿›è¡Œè®¿é—®&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;h4 id=&quot;ä½¿ç”¨NetworkPolicyé™åˆ¶&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨NetworkPolicyé™åˆ¶&quot; class=&quot;headerlin</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://nmk0718.github.io/tag/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Adhell3 é˜»æ­¢å¹¿å‘Šï¼ˆä¸‰æ˜Ÿï¼‰</title>
    <link href="http://nmk0718.github.io/2024/09/29/Adhell3/"/>
    <id>http://nmk0718.github.io/2024/09/29/Adhell3/</id>
    <published>2024-09-29T05:35:00.000Z</published>
    <updated>2024-09-29T06:53:17.011Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><ol><li>éœ€è¦å…ˆå¯¹ä¸‰æ˜Ÿæ‰‹æœºè¿›è¡Œadbæˆæƒå¯åŠ¨é»‘åŸŸ</li><li>NotifyRDS-Add-on-Samsung.apk,Adhell3.apk,ä¸‰æ˜Ÿæ‰‹æœº</li></ol><p>âš ï¸æœ¬æ–‡å°è¯•å‚è€ƒé“¾æ¥ä¸­çš„ç‚¼å¦–å£¶æ–¹æ¡ˆæ— æ³•æ¿€æ´»Adhell3,ä»…åˆ—å‡ºå®‰å…¨æ–‡ä»¶å¤¹çš„æ¿€æ´»æ­¥éª¤</p><h4 id="æ¿€æ´»"><a href="#æ¿€æ´»" class="headerlink" title="æ¿€æ´»"></a>æ¿€æ´»</h4><ol><li><p>å¯ç”¨ klms agent</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#é»‘åŸŸå†…è¿è¡Œå‘½ä»¤</span><br><span class="line">pm enable com.samsung.klmsagent</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…NotifyRDS-Add-on-Samsung</p></li><li><p>æ‰‹æœºè®¾ç½®ä¸­å¼€å¯å®‰å…¨æ–‡ä»¶å¤¹ï¼ŒæŠŠNotifyRDS-Add-on-Samsungå®‰è£…åˆ°å®‰å…¨æ–‡ä»¶å¤¹ä¸­<br>å®‰å…¨æ–‡ä»¶å¤¹ï¼šå³ä¸Šè§’åŠ å·â€”â€”æ·»åŠ NotifyRDS-Add-on-Samsung</p></li><li><p>å¸è½½æ‰‹æœºè‡ªèº«å®‰è£…çš„NotifyRDS-Add-on-Samsung<br>æ‰‹æœºè®¾ç½®å†…æœç´¢ <code>è®¾å¤‡ç®¡ç†åº”ç”¨ç¨‹åº</code> å¯¹ç¬¬ä¸€ä¸ªNotifyRDS-Add-on-Samsungè¿›è¡Œå–æ¶ˆæ¿€æ´»å’Œå¸è½½</p></li><li><p>ç¦ç”¨ klms agent</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#é»‘åŸŸå†…è¿è¡Œå‘½ä»¤</span><br><span class="line">pm disable-user com.samsung.klmsagent</span><br></pre></td></tr></table></figure></li><li><p>å¸è½½å®‰å…¨æ–‡ä»¶å¤¹ä¸­çš„NotifyRDS-Add-on-Samsung<br>å®‰å…¨æ–‡ä»¶å¤¹ï¼šå³ä¸Šè§’ä¸‰ä¸ªç‚¹â€”â€”è®¾ç½®â€”â€”æ›´å¤šè®¾ç½®â€”â€”å¸è½½ï¼Œã€å–æ¶ˆã€‘å°†åª’ä½“æ–‡ä»¶ç§»å‡ºå®‰å…¨æ–‡ä»¶</p></li><li><p>å®‰è£… Adhell<br>å…ˆå®‰è£…Adhell3åˆ°æ‰‹æœºå†…<br>é»‘åŸŸå†…è¿è¡Œå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pm enable com.samsung.klmsagent</span><br></pre></td></tr></table></figure></li></ol><p>æ‰‹æœºè®¾ç½®å†…æœç´¢ <code>è®¾å¤‡ç®¡ç†åº”ç”¨ç¨‹åº</code> å¯¹Adhell3è¿›è¡Œæ¿€æ´»<br>å¯åŠ¨Adhell3å³å¯</p><h4 id="é…ç½®ä½œç”¨åŸŸ"><a href="#é…ç½®ä½œç”¨åŸŸ" class="headerlink" title="é…ç½®ä½œç”¨åŸŸ"></a>é…ç½®ä½œç”¨åŸŸ</h4><p>åœ¨ä½œç”¨åŸŸçš„è®¢é˜…æºä¸­é…ç½®</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://raw.githubusercontent.com/VeleSila/yhosts/master/hosts</span><br><span class="line">https://raw.githubusercontent.com/AdAway/adaway.github.io/master/hosts.txt</span><br><span class="line">https://hblock.molinero.dev/hosts</span><br></pre></td></tr></table></figure><p>åœ¨ä½œç”¨åŸŸçš„ç™½åå•ä¸­é…ç½®</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">errnewlog.umeng.com</span><br><span class="line">errlog.umeng.com</span><br><span class="line">beacon.qq.com</span><br><span class="line">ssl.google-analytics.com</span><br><span class="line">loggw.alipay.com.cn</span><br><span class="line">dataflow.biliapi.com</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»é¡µå¯ç”¨ä½œç”¨åŸŸå³å¯</p><p>å‚è€ƒæ–‡æ¡£:<br><a href="https://zhuanlan.zhihu.com/p/670139739" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/670139739</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;å‡†å¤‡å·¥ä½œ&quot;&gt;&lt;a href=&quot;#å‡†å¤‡å·¥ä½œ&quot; class=&quot;headerlink&quot; title=&quot;å‡†å¤‡å·¥ä½œ&quot;&gt;&lt;/a&gt;å‡†å¤‡å·¥ä½œ&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;éœ€è¦å…ˆå¯¹ä¸‰æ˜Ÿæ‰‹æœºè¿›è¡Œadbæˆæƒå¯åŠ¨é»‘åŸŸ&lt;/li&gt;
&lt;li&gt;NotifyRDS-Add-on-Samsung.ap</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>è…¾è®¯äº‘åªæˆæƒç”¨æˆ·tkeç™»é™†å®¹å™¨æƒé™</title>
    <link href="http://nmk0718.github.io/2024/09/23/%E8%85%BE%E8%AE%AF%E4%BA%91%E5%8F%AA%E6%8E%88%E6%9D%83%E7%94%A8%E6%88%B7tke%E7%99%BB%E9%99%86%E5%AE%B9%E5%99%A8%E6%9D%83%E9%99%90/"/>
    <id>http://nmk0718.github.io/2024/09/23/%E8%85%BE%E8%AE%AF%E4%BA%91%E5%8F%AA%E6%8E%88%E6%9D%83%E7%94%A8%E6%88%B7tke%E7%99%BB%E9%99%86%E5%AE%B9%E5%99%A8%E6%9D%83%E9%99%90/</id>
    <published>2024-09-23T08:00:00.000Z</published>
    <updated>2025-02-10T02:38:37.772Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æˆæƒåªè¯»æƒé™"><a href="#æˆæƒåªè¯»æƒé™" class="headerlink" title="æˆæƒåªè¯»æƒé™"></a>æˆæƒåªè¯»æƒé™</h3><h4 id="é€‰æ‹©ç­–ç•¥ç”Ÿæˆå™¨"><a href="#é€‰æ‹©ç­–ç•¥ç”Ÿæˆå™¨" class="headerlink" title="é€‰æ‹©ç­–ç•¥ç”Ÿæˆå™¨"></a>é€‰æ‹©ç­–ç•¥ç”Ÿæˆå™¨</h4><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image\RBAC-create.png"><h4 id="é€‰æ‹©è¦æˆæƒçš„è´¦å·"><a href="#é€‰æ‹©è¦æˆæƒçš„è´¦å·" class="headerlink" title="é€‰æ‹©è¦æˆæƒçš„è´¦å·"></a>é€‰æ‹©è¦æˆæƒçš„è´¦å·</h4><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image\RBAC-auth-user.png"><h4 id="æˆæƒåªè¯»æƒé™-1"><a href="#æˆæƒåªè¯»æƒé™-1" class="headerlink" title="æˆæƒåªè¯»æƒé™"></a>æˆæƒåªè¯»æƒé™</h4><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image\RBAC-auth.png"><h3 id="æˆæƒå®¹å™¨ç™»å½•æƒé™"><a href="#æˆæƒå®¹å™¨ç™»å½•æƒé™" class="headerlink" title="æˆæƒå®¹å™¨ç™»å½•æƒé™"></a>æˆæƒå®¹å™¨ç™»å½•æƒé™</h3><h4 id="åˆ›å»ºClusterRole"><a href="#åˆ›å»ºClusterRole" class="headerlink" title="åˆ›å»ºClusterRole"></a>åˆ›å»ºClusterRole</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">cloud.tencent.com/tke-rbac-generated:</span> <span class="string">"true"</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tke:pod-exec</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods/attach</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods/exec</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">create</span></span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºRoleBingingæˆæƒç»™ç”¨æˆ·"><a href="#åˆ›å»ºRoleBingingæˆæƒç»™ç”¨æˆ·" class="headerlink" title="åˆ›å»ºRoleBingingæˆæƒç»™ç”¨æˆ·"></a>åˆ›å»ºRoleBingingæˆæƒç»™ç”¨æˆ·</h4><p>å¤åˆ¶åªè¯»æƒé™ä¸­çš„ç›¸å…³ä¿¡æ¯<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image\ClusterRoleBinding-yaml.png"></p><p>å¯¹è´¦å·è¿›è¡Œæˆæƒå®¹å™¨ç™»å½•æƒé™</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">cloud.tencent.com/tke-account-nickname:</span> <span class="string">nmk</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">cloud.tencent.com/tke-account:</span> <span class="string">"100023199976"</span></span><br><span class="line">  <span class="attr">name:</span> <span class="number">100023199976</span><span class="string">-Role-pod-exec</span>    </span><br><span class="line">  <span class="comment">#namespace: no-critical-service #å¡«å†™namespaceä¸ºé’ˆå¯¹æŸä¸ªå‘½ä»¤ç©ºé—´</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tke:pod-exec</span>    <span class="comment">#æŒ‡å®šåˆšåˆ›å»ºçš„ClusterRole</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="number">100023199976</span><span class="number">-1682220970</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;æˆæƒåªè¯»æƒé™&quot;&gt;&lt;a href=&quot;#æˆæƒåªè¯»æƒé™&quot; class=&quot;headerlink&quot; title=&quot;æˆæƒåªè¯»æƒé™&quot;&gt;&lt;/a&gt;æˆæƒåªè¯»æƒé™&lt;/h3&gt;&lt;h4 id=&quot;é€‰æ‹©ç­–ç•¥ç”Ÿæˆå™¨&quot;&gt;&lt;a href=&quot;#é€‰æ‹©ç­–ç•¥ç”Ÿæˆå™¨&quot; class=&quot;headerlink&quot; ti</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://nmk0718.github.io/tag/k8s/"/>
    
  </entry>
  
  <entry>
    <title>arthas</title>
    <link href="http://nmk0718.github.io/2024/09/05/arthas/"/>
    <id>http://nmk0718.github.io/2024/09/05/arthas/</id>
    <published>2024-09-05T03:30:00.000Z</published>
    <updated>2024-09-23T08:42:39.656Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸‹è½½</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@platform-green-5d77977ffc-nw8dm:/<span class="comment"># curl -O https://arthas.aliyun.com/arthas-boot.jar</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  138k  100  138k    0     0   367k      0 --:--:-- --:--:-- --:--:--  367k</span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><p>å¯åŠ¨åæŒ‰1ï¼Œ1ä¸ºè¿›ç¨‹ID</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@platform-green-5d77977ffc-nw8dm:/<span class="comment"># java -jar arthas-boot.jar</span></span><br><span class="line">[INFO] JAVA_HOME: /usr/<span class="built_in">local</span>/openjdk-11</span><br><span class="line">[INFO] arthas-boot version: 3.7.2</span><br><span class="line">[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.</span><br><span class="line">* [1]: 1 platform-0.5.6-SNAPSHOT.jar</span><br><span class="line">1</span><br><span class="line">[INFO] Start download arthas from remote server: https://arthas.aliyun.com/download/3.7.2?mirror=aliyun</span><br><span class="line">[INFO] Download arthas success.</span><br><span class="line">[INFO] arthas home: /root/.arthas/lib/3.7.2/arthas</span><br><span class="line">[INFO] Try to attach process 1</span><br><span class="line">Picked up JAVA_TOOL_OPTIONS: </span><br><span class="line">[INFO] Attach process 1 success.</span><br><span class="line">[INFO] arthas-client connect 127.0.0.1 3658</span><br><span class="line">  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.                           </span><br><span class="line"> /  O  \ |  .--. <span class="string">''</span>--.  .--<span class="string">'|  '</span>--<span class="string">'  | /  O  \ '</span>   .-<span class="string">'                          </span></span><br><span class="line"><span class="string">|  .-.  ||  '</span>--<span class="string">'.'</span>   |  |   |  .--.  ||  .-.  |`.  `-.                          </span><br><span class="line">|  | |  ||  |\  \    |  |   |  |  |  ||  | |  |.-<span class="string">'    |                         </span></span><br><span class="line"><span class="string">`--'</span> `--<span class="string">'`--'</span> <span class="string">'--'</span>   `--<span class="string">'   `--'</span>  `--<span class="string">'`--'</span> `--<span class="string">'`-----'</span>                          </span><br><span class="line"></span><br><span class="line">wiki       https://arthas.aliyun.com/doc                                        </span><br><span class="line">tutorials  https://arthas.aliyun.com/doc/arthas-tutorials.html                  </span><br><span class="line">version    3.7.2                                                                </span><br><span class="line">main_class                                                                      </span><br><span class="line">pid        1                                                                    </span><br><span class="line">time       2024-09-05 11:31:56</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å†…å­˜ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[arthas@1]$ memory</span><br><span class="line">Memory                                                                    used                    total                    max                     usage                    </span><br><span class="line">heap                                                                      2819M                   10240M                   10240M                  27.54%                   </span><br><span class="line">g1_eden_space                                                             816M                    6220M                    -1                      13.12%                   </span><br><span class="line">g1_old_gen                                                                1771M                   3788M                    10240M                  17.30%                   </span><br><span class="line">g1_survivor_space                                                         232M                    232M                     -1                      100.00%                  </span><br><span class="line">nonheap                                                                   349M                    367M                     1256M                   27.85%                   </span><br><span class="line">codeheap_<span class="string">'non-nmethods'</span>                                                   1M                      2M                       5M                      31.82%                   </span><br><span class="line">metaspace                                                                 204M                    215M                     512M                    39.98%                   </span><br><span class="line">codeheap_<span class="string">'profiled_nmethods'</span>                                              65M                     67M                      117M                    56.26%                   </span><br><span class="line">compressed_class_space                                                    23M                     27M                      504M                    4.62%                    </span><br><span class="line">codeheap_<span class="string">'non-profiled_nmethods'</span>                                          54M                     54M                      117M                    46.12%                   </span><br><span class="line">mapped                                                                    0K                      0K                       -                       0.00%                    </span><br><span class="line">direct                                                                    69M                     69M                      -                       100.00%</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¸‹è½½&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root@platform-green-5d77977ffc-nw8dm:/&lt;span cla</summary>
      
    
    
    
    
    <category term="arthas" scheme="http://nmk0718.github.io/tag/arthas/"/>
    
  </entry>
  
  <entry>
    <title>hexoæ›´æ¢å­—ä½“</title>
    <link href="http://nmk0718.github.io/2024/08/27/hexo%E6%9B%B4%E6%8D%A2%E5%AD%97%E4%BD%93/"/>
    <id>http://nmk0718.github.io/2024/08/27/hexo%E6%9B%B4%E6%8D%A2%E5%AD%97%E4%BD%93/</id>
    <published>2024-08-27T03:30:00.000Z</published>
    <updated>2024-09-20T03:00:25.793Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸‹è½½å­—ä½“"><a href="#ä¸‹è½½å­—ä½“" class="headerlink" title="ä¸‹è½½å­—ä½“"></a>ä¸‹è½½å­—ä½“</h3><p>å¼€æºå­—ä½“</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://github.com/fontworks-fonts/Klee/tree/master/fonts/ttf</span><br></pre></td></tr></table></figure><p>ä¸‹è½½åæ ¼å¼è½¬æ¢ </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://www.fontsquirrel.com/tools/webfont-generator</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ–‡æ¡£ï¼š<br><a href="https://blog.csdn.net/qq_30997503/article/details/109551074" target="_blank" rel="noopener">https://blog.csdn.net/qq_30997503/article/details/109551074</a></p><p>ä¸‹è½½åå¤åˆ¶åˆ° hexoé¡¹ç›®çš„themes/nmk_hexo/source/fontsä¸‹</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ ~ tree  Klee_One</span><br><span class="line">Klee_One</span><br><span class="line">â”œâ”€â”€ kleeone-regular-webfont.eot</span><br><span class="line">â”œâ”€â”€ kleeone-regular-webfont.svg</span><br><span class="line">â”œâ”€â”€ kleeone-regular-webfont.ttf</span><br><span class="line">â”œâ”€â”€ kleeone-regular-webfont.woff</span><br><span class="line">â””â”€â”€ kleeone-regular-webfont.woff2</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹themes/nmk_hexo/source/css/font.stylçš„é…ç½®ä¸º</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@font-face &#123;</span><br><span class="line">    font-family: &apos;klee_oneregular&apos;;</span><br><span class="line">    src: url(&apos;../fonts/Klee_One/kleeone-regular-webfont.eot&apos;);</span><br><span class="line">    src: url(&apos;../fonts/Klee_One/kleeone-regular-webfont.eot?#iefix&apos;) format(&apos;embedded-opentype&apos;),</span><br><span class="line">         url(&apos;../fonts/Klee_One/kleeone-regular-webfont.woff2&apos;) format(&apos;woff2&apos;),</span><br><span class="line">         url(&apos;../fonts/Klee_One/kleeone-regular-webfont.woff&apos;) format(&apos;woff&apos;),</span><br><span class="line">         url(&apos;../fonts/Klee_One/kleeone-regular-webfont.ttf&apos;) format(&apos;truetype&apos;),</span><br><span class="line">         url(&apos;../fonts/Klee_One/kleeone-regular-webfont.svg#klee_oneregular&apos;) format(&apos;svg&apos;);</span><br><span class="line">    font-weight 300;</span><br><span class="line">    font-style: normal;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$font-family = klee_oneregular</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥ä½¿ç”¨ç³»ç»Ÿçš„</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$font-family = Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;ä¸‹è½½å­—ä½“&quot;&gt;&lt;a href=&quot;#ä¸‹è½½å­—ä½“&quot; class=&quot;headerlink&quot; title=&quot;ä¸‹è½½å­—ä½“&quot;&gt;&lt;/a&gt;ä¸‹è½½å­—ä½“&lt;/h3&gt;&lt;p&gt;å¼€æºå­—ä½“&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=</summary>
      
    
    
    
    
    <category term="hexo" scheme="http://nmk0718.github.io/tag/hexo/"/>
    
  </entry>
  
  <entry>
    <title>helm</title>
    <link href="http://nmk0718.github.io/2024/08/23/helm/"/>
    <id>http://nmk0718.github.io/2024/08/23/helm/</id>
    <published>2024-08-23T08:29:00.000Z</published>
    <updated>2024-11-29T06:44:26.887Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å®‰è£…helm"><a href="#å®‰è£…helm" class="headerlink" title="å®‰è£…helm"></a>å®‰è£…helm</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># macä¸‹è½½</span></span><br><span class="line">wget https://get.helm.sh/helm-v3.14.3-darwin-amd64.tar.gz</span><br><span class="line"><span class="comment"># linuxä¸‹è½½</span></span><br><span class="line">wget https://get.helm.sh/helm-v3.14.3-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf helm-v3.14.3-darwin-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">sudo mv darwin-amd64/helm /usr/<span class="built_in">local</span>/bin/helm</span><br><span class="line"></span><br><span class="line">helm version</span><br><span class="line">version.BuildInfo&#123;Version:<span class="string">"v3.14.3"</span>, GitCommit:<span class="string">"f03cc04caaa8f6d7c3e67cf918929150cf6f3f12"</span>, GitTreeState:<span class="string">"clean"</span>,GoVersion:<span class="string">"go1.21.7"</span>&#125;</span><br></pre></td></tr></table></figure><p>macéœ€è¦å» <code>ç³»ç»Ÿè®¾ç½®&gt;éšç§ä¸å®‰å…¨æ€§&gt;å®‰å…¨æ€§</code> å…è®¸helmè¿è¡Œ</p><h3 id="helmå‘½ä»¤"><a href="#helmå‘½ä»¤" class="headerlink" title="helmå‘½ä»¤"></a>helmå‘½ä»¤</h3><h4 id="helm-create"><a href="#helm-create" class="headerlink" title="helm create"></a>helm create</h4><p>è¯¥å‘½ä»¤ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Helm Chartã€‚Helm Chart æ˜¯ Kubernetes åº”ç”¨çš„åŒ…ï¼ŒåŒ…å«äº†è¿è¡Œåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰èµ„æºå®šä¹‰ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">helm create nmk-app</span><br><span class="line">âœ ~ tree nmk-app</span><br><span class="line">nmk-app</span><br><span class="line">â”œâ”€â”€ Chart.yaml</span><br><span class="line">â”œâ”€â”€ charts</span><br><span class="line">â”œâ”€â”€ templates</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ NOTES.txt</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ _helpers.tpl</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ deployment.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ hpa.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ingress.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ service.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ serviceaccount.yaml</span><br><span class="line">â”‚Â Â  â””â”€â”€ tests</span><br><span class="line">â”‚Â Â      â””â”€â”€ <span class="built_in">test</span>-connection.yaml</span><br><span class="line">â””â”€â”€ values.yaml</span><br></pre></td></tr></table></figure><h4 id="helm-install"><a href="#helm-install" class="headerlink" title="helm install"></a>helm install</h4><p>ç”¨äºå°† Helm Chart å®‰è£…åˆ° Kubernetes é›†ç¾¤ä¸­ã€‚å®ƒä¼šåˆ›å»ºæ‰€æœ‰å®šä¹‰åœ¨ Chart ä¸­çš„èµ„æºã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ ~ helm install nmk-app nmk-app</span><br><span class="line">NAME: nmk-app</span><br><span class="line">LAST DEPLOYED: Mon Aug 23 16:06:14 2024</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br></pre></td></tr></table></figure><h4 id="helm-upgrade"><a href="#helm-upgrade" class="headerlink" title="helm upgrade"></a>helm upgrade</h4><p>ç”¨äºå‡çº§å·²å®‰è£…çš„ Helm Chart åˆ°æ–°ç‰ˆæœ¬ã€‚å¯ä»¥ä¿®æ”¹ Chart çš„é…ç½®å’Œèµ„æºã€‚</p><p>å°†å·²æœ‰çš„ release å‡çº§åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„ chart</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ ~ helm upgrade nmk-app nmk-app</span><br><span class="line">Release <span class="string">"nmk-app"</span> has been upgraded. Happy Helming!</span><br><span class="line">NAME: nmk-app</span><br><span class="line">LAST DEPLOYED: Mon Aug 26 16:07:57 2024</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 2</span><br><span class="line">TEST SUITE: None</span><br></pre></td></tr></table></figure><h4 id="helm-rollback"><a href="#helm-rollback" class="headerlink" title="helm rollback"></a>helm rollback</h4><p>å½“ Helm Chart å‡çº§åå‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ ~ helm rollback nmk-app 1</span><br><span class="line">Rollback was a success! Happy Helming!</span><br><span class="line">âœ ~ kubectl get pod  -n tke-docker-test -l app=nmk-app</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE</span><br><span class="line">nmk-app   1/1     Running   0          8m49s</span><br></pre></td></tr></table></figure><h4 id="helm-lint"><a href="#helm-lint" class="headerlink" title="helm lint"></a>helm lint</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ ~ helm lint nmk-app</span><br><span class="line">==&gt; Linting nmk-app</span><br><span class="line">[INFO] Chart.yaml: icon is recommended</span><br><span class="line"></span><br><span class="line">1 chart(s) linted, 0 chart(s) failed</span><br><span class="line"><span class="comment">#å¯¹1ä¸ªchartè¿›è¡Œäº†lintingï¼ˆä»£ç å®¡æŸ¥ï¼‰ï¼Œå¹¶ä¸”åœ¨å®¡æŸ¥è¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç°ä»»ä½•å¤±è´¥çš„é—®é¢˜</span></span><br></pre></td></tr></table></figure><h4 id="helm-show"><a href="#helm-show" class="headerlink" title="helm show"></a>helm show</h4><p>ç”¨äºæŸ¥çœ‹ Helm Chart çš„å†…å®¹ï¼ŒåŒ…æ‹¬æ¨¡æ¿ã€é…ç½®æ–‡ä»¶å’Œå…¶ä»–èµ„æºçš„å®šä¹‰ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">æ˜¾ç¤ºChartçš„ä¿¡æ¯å’Œå…ƒæ•°æ®</span><br><span class="line"></span><br><span class="line">âœ ~ helm show chart nmk-app</span><br><span class="line">apiVersion: v2</span><br><span class="line">appVersion: 1.16.0</span><br><span class="line">description: A Helm chart <span class="keyword">for</span> Kubernetes</span><br><span class="line">name: nmk-app</span><br><span class="line"><span class="built_in">type</span>: application</span><br><span class="line">version: 0.1.0</span><br></pre></td></tr></table></figure><h4 id="helm-uninstall"><a href="#helm-uninstall" class="headerlink" title="helm uninstall"></a>helm uninstall</h4><p>ç§»é™¤å·²å®‰è£…çš„ Helm Chartã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ ~ helm uninstall nmk-app</span><br><span class="line">release <span class="string">"nmk-app"</span> uninstalled</span><br></pre></td></tr></table></figure><h4 id="helm-pull"><a href="#helm-pull" class="headerlink" title="helm pull"></a>helm pull</h4><p>ä»è¿œç¨‹ä»“åº“ä¸‹è½½æˆ–æ‹‰å–ä¸€ä¸ª Helm Chart åˆ°æœ¬åœ°ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ ~ helm repo add stable https://charts.helm.sh/stable</span><br><span class="line">âœ ~ helm pull stable/mysql --version 1.6.9</span><br><span class="line">å¸¸ç”¨å‚æ•°ï¼š</span><br><span class="line"></span><br><span class="line">--versionï¼šå…è®¸æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬çº¦æŸï¼Œç”¨äºä¸‹è½½ç‰¹å®šç‰ˆæœ¬çš„ Helm å›¾è¡¨ã€‚é»˜è®¤ä½¿ç”¨latestç‰ˆæœ¬ï¼›</span><br><span class="line">--untarï¼šä¸‹è½½Chartåæ˜¯å¦è‡ªåŠ¨è§£å‹ç¼©ã€‚å¦‚æœè®¾ç½®ä¸º<span class="literal">true</span>ï¼Œåˆ™Helmä¼šåœ¨ä¸‹è½½åè‡ªåŠ¨è§£å‹ç¼©</span><br><span class="line">--untardirï¼šæŒ‡å®šå›¾è¡¨æå–åˆ°çš„ç›®å½•ï¼›</span><br><span class="line">--repoï¼šæŒ‡å®šä»ä¸­ä¸‹è½½å›¾è¡¨çš„å­˜å‚¨åº“çš„ URLï¼›</span><br><span class="line">--usernameå’Œ--passwordï¼šæä¾›è®¿é—®ç§äººå­˜å‚¨åº“çš„å‡­è¯ï¼›</span><br><span class="line">--verifyï¼šå¯ä»¥åœ¨ä½¿ç”¨å›¾è¡¨ä¹‹å‰å¯¹å…¶è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿å›¾è¡¨çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚</span><br></pre></td></tr></table></figure><h3 id="åˆ¶ä½œhelm-chart"><a href="#åˆ¶ä½œhelm-chart" class="headerlink" title="åˆ¶ä½œhelm chart"></a>åˆ¶ä½œhelm chart</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">helm create nmk-app</span><br><span class="line">âœ  Downloads tree nmk-app</span><br><span class="line">nmk-test</span><br><span class="line">â”œâ”€â”€ Chart.yaml</span><br><span class="line">â”œâ”€â”€ charts</span><br><span class="line">â”œâ”€â”€ templates</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ NOTES.txt</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ _helpers.tpl</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ deployment.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ hpa.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ingress.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ service.yaml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ serviceaccount.yaml</span><br><span class="line">â”‚Â Â  â””â”€â”€ tests</span><br><span class="line">â”‚Â Â      â””â”€â”€ <span class="built_in">test</span>-connection.yaml</span><br><span class="line">â””â”€â”€ values.yaml</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ²¡ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œåªä¿ç•™ä»¥ä¸‹æ–‡ä»¶</p><h4 id="deployment-yaml"><a href="#deployment-yaml" class="headerlink" title="deployment.yaml"></a>deployment.yaml</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.appname</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.namespace</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.appname</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.appname</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.appname</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">imagePullSecrets:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.imagepullsecrets</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.appname</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JAVA_OPTS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.env.javaoptions</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">"<span class="template-variable">&#123;&#123; .Values.image.repository &#125;&#125;</span><span class="template-variable">&#123;&#123; .Values.appname &#125;&#125;</span>:<span class="template-variable">&#123;&#123; .Values.image.tag &#125;&#125;</span>"</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.image.pullPolicy</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">lifecycle:</span></span><br><span class="line">            <span class="attr">preStop:</span></span><br><span class="line">              <span class="attr">exec:</span></span><br><span class="line">                <span class="attr">command:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">sleep</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">20s</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/actuator/</span></span><br><span class="line">              <span class="attr">port:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.service.port</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">15</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">startupProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/actuator/</span></span><br><span class="line">              <span class="attr">port:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.service.port</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.resource.limitCpu</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.resource.limitMemory</span> <span class="string">&#125;&#125;</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.resource.requestCpu</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.resource.requestMemory</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="service-yaml"><a href="#service-yaml" class="headerlink" title="service.yaml"></a>service.yaml</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.appname</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.namespace</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.service.type</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.service.port</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.service.port</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.appname</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.appname</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">sessionAffinity:</span> <span class="string">None</span></span><br></pre></td></tr></table></figure><h4 id="ingress-yaml"><a href="#ingress-yaml" class="headerlink" title="ingress.yaml"></a>ingress.yaml</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">if</span> <span class="string">.Values.ingress.enabled</span> <span class="string">-&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">$fullName</span> <span class="string">:=</span> <span class="string">.Values.appName</span> <span class="string">-&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">$svcPort</span> <span class="string">:=</span> <span class="string">.Values.service.port</span> <span class="string">-&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">if</span> <span class="string">and</span> <span class="string">.Values.ingress.className</span> <span class="string">(not</span> <span class="string">(semverCompare</span> <span class="string">"&gt;=1.18-0"</span> <span class="string">.Capabilities.KubeVersion.GitVersion))</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="string">&#123;&#123;-</span> <span class="string">if</span> <span class="string">not</span> <span class="string">(hasKey</span> <span class="string">.Values.ingress.annotations</span> <span class="string">"kubernetes.io/ingress.class"</span><span class="string">)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="string">&#123;&#123;-</span> <span class="string">$_</span> <span class="string">:=</span> <span class="string">set</span> <span class="string">.Values.ingress.annotations</span> <span class="string">"kubernetes.io/ingress.class"</span> <span class="string">.Values.ingress.className&#125;&#125;</span></span><br><span class="line">  <span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">if</span> <span class="string">semverCompare</span> <span class="string">"&gt;=1.19-0"</span> <span class="string">.Capabilities.KubeVersion.GitVersion</span> <span class="string">-&#125;&#125;</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">else</span> <span class="string">if</span> <span class="string">semverCompare</span> <span class="string">"&gt;=1.14-0"</span> <span class="string">.Capabilities.KubeVersion.GitVersion</span> <span class="string">-&#125;&#125;</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">else</span> <span class="string">-&#125;&#125;</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&#123;&#123;</span> <span class="string">$fullName</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.namespace</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="string">&#123;&#123;-</span> <span class="string">if</span> <span class="string">and</span> <span class="string">.Values.ingress.className</span> <span class="string">(semverCompare</span> <span class="string">"&gt;=1.18-0"</span> <span class="string">.Capabilities.KubeVersion.GitVersion)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">&#123;&#123;</span> <span class="string">.Values.ingress.className</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="string">&#123;&#123;-</span> <span class="string">if</span> <span class="string">.Values.ingress.tls</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">    <span class="string">&#123;&#123;-</span> <span class="string">range</span> <span class="string">.Values.ingress.tls</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">        <span class="string">&#123;&#123;-</span> <span class="string">range</span> <span class="string">.hosts</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#123;&#123;</span> <span class="string">.</span> <span class="string">|</span> <span class="string">quote</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">&#123;&#123;</span> <span class="string">.secretName</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="string">&#123;&#123;-</span> <span class="string">range</span> <span class="string">.Values.ingress.hosts</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">&#123;&#123;</span> <span class="string">.host</span> <span class="string">|</span> <span class="string">quote</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="string">&#123;&#123;-</span> <span class="string">range</span> <span class="string">.paths</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">&#123;&#123;</span> <span class="string">.path</span> <span class="string">&#125;&#125;</span></span><br><span class="line">            <span class="string">&#123;&#123;-</span> <span class="string">if</span> <span class="string">and</span> <span class="string">.pathType</span> <span class="string">(semverCompare</span> <span class="string">"&gt;=1.18-0"</span> <span class="string">$.Capabilities.KubeVersion.GitVersion)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">&#123;&#123;</span> <span class="string">.pathType</span> <span class="string">&#125;&#125;</span></span><br><span class="line">            <span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="string">&#123;&#123;-</span> <span class="string">if</span> <span class="string">semverCompare</span> <span class="string">"&gt;=1.19-0"</span> <span class="string">$.Capabilities.KubeVersion.GitVersion</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="attr">service:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">&#123;&#123;</span> <span class="string">$fullName</span> <span class="string">&#125;&#125;</span></span><br><span class="line">                <span class="attr">port:</span></span><br><span class="line">                  <span class="attr">number:</span> <span class="string">&#123;&#123;</span> <span class="string">$svcPort</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="string">&#123;&#123;-</span> <span class="string">else</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="attr">serviceName:</span> <span class="string">&#123;&#123;</span> <span class="string">$fullName</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="attr">servicePort:</span> <span class="string">&#123;&#123;</span> <span class="string">$svcPort</span> <span class="string">&#125;&#125;</span></span><br><span class="line">              <span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="values-yaml"><a href="#values-yaml" class="headerlink" title="values.yaml"></a>values.yaml</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">appname:</span> <span class="string">nmk-app</span></span><br><span class="line"></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">tke-docker-test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">replicaCount:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">image:</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">helm-hub.com/nmk/</span></span><br><span class="line">  <span class="attr">pullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">tag:</span> <span class="string">app-20240806110148</span></span><br><span class="line"></span><br><span class="line"><span class="attr">imagepullsecrets:</span> <span class="string">qcloudregistrykey</span></span><br><span class="line"></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">javaoptions:</span> <span class="string">-Xms2g</span> <span class="string">-Xmx2g</span> <span class="string">-XX:MetaspaceSize=512M</span> <span class="string">-XX:MaxMetaspaceSize=512M</span> <span class="string">-Dspring.profiles.active=test</span> <span class="string">-Dspring.cloud.consul.enabled=false</span> <span class="string">-Dtsf.discovery.ribbon.enabled=false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">resource:</span></span><br><span class="line">  <span class="attr">limitCpu:</span> <span class="string">'2'</span></span><br><span class="line">  <span class="attr">limitMemory:</span> <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">requestCpu:</span> <span class="string">'1'</span></span><br><span class="line">  <span class="attr">requestMemory:</span> <span class="string">1Gi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">ingress:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">className:</span> <span class="string">"nginx"</span></span><br><span class="line">  <span class="attr">annotations:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="comment">#kubernetes.io/ingress.class: nginx</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">nmk.com</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">          <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">  <span class="attr">tls:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">secretName:</span> <span class="string">ssl-2024</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">nmk.com</span></span><br></pre></td></tr></table></figure><h4 id="Chart-yaml"><a href="#Chart-yaml" class="headerlink" title="Chart.yaml"></a>Chart.yaml</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v2</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">nmk-app</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">A</span> <span class="string">Helm</span> <span class="string">chart</span> <span class="string">for</span> <span class="string">Kubernetes</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">application</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">0.1</span><span class="number">.0</span></span><br><span class="line"><span class="attr">appVersion:</span> <span class="string">"1.16.0"</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…åæŸ¥çœ‹"><a href="#å®‰è£…åæŸ¥çœ‹" class="headerlink" title="å®‰è£…åæŸ¥çœ‹"></a>å®‰è£…åæŸ¥çœ‹</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ ~ Downloads helm list</span><br><span class="line">nmk-app        default  1       2024-08-26 16:06:14.735267 +0800 CST   deployednmk-app-0.1.0 1.16.0</span><br><span class="line"></span><br><span class="line">âœ ~ Downloads kubectl get pods -n tke-docker-test</span><br><span class="line">nmk-app-6fdc57bd55-gx6mn                                    1/1     Running            0          117s</span><br><span class="line"></span><br><span class="line">âœ ~ Downloads kubectl get service -n tke-docker-test</span><br><span class="line">nmk-app                                    ClusterIP      172.31.159.244   &lt;none&gt;         8080/TCP                        4m14s</span><br><span class="line"></span><br><span class="line">âœ ~ Downloads kubectl get ingress -n tke-docker-test</span><br><span class="line">nmk-app                                 nginx    nmk.com                          10.30.150.3   80, 443   4m24s</span><br></pre></td></tr></table></figure><p>å¯ä½¿ç”¨ä»¥ä¸‹å‚æ•°æŒ‡å®šå˜é‡è¿›è¡Œå¤šåº”ç”¨éƒ¨ç½²ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">--<span class="built_in">set</span> appName=demo --<span class="built_in">set</span> version=v1.1</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ–‡çŒ®ï¼š<br><a href="https://blog.csdn.net/dhf880913/article/details/138125561" target="_blank" rel="noopener">https://blog.csdn.net/dhf880913/article/details/138125561</a><br><a href="https://blog.csdn.net/zhuganlai168/article/details/131483308" target="_blank" rel="noopener">https://blog.csdn.net/zhuganlai168/article/details/131483308</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;å®‰è£…helm&quot;&gt;&lt;a href=&quot;#å®‰è£…helm&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…helm&quot;&gt;&lt;/a&gt;å®‰è£…helm&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code</summary>
      
    
    
    
    
    <category term="helm" scheme="http://nmk0718.github.io/tag/helm/"/>
    
  </entry>
  
  <entry>
    <title>å®¹å™¨å†…å®‰è£…åŸºç¡€å·¥å…·</title>
    <link href="http://nmk0718.github.io/2024/07/22/%E5%AE%B9%E5%99%A8%E5%86%85%E5%AE%89%E8%A3%85%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/"/>
    <id>http://nmk0718.github.io/2024/07/22/%E5%AE%B9%E5%99%A8%E5%86%85%E5%AE%89%E8%A3%85%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/</id>
    <published>2024-07-22T06:25:00.000Z</published>
    <updated>2024-11-29T06:42:37.451Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨openjdk:8å’Œopenjdk:11ä½œä¸ºåŸºç¡€é•œåƒæ„å»ºä¸šåŠ¡é•œåƒï¼Œä½†æ˜¯ä½¿ç”¨ä¸­å‘ç°é•œåƒé‡Œé¢æ²¡æœ‰pingã€telnetç­‰åŸºç¡€å‘½ä»¤</p><h3 id="åœ¨å®¹å™¨ä¸­ä½¿ç”¨"><a href="#åœ¨å®¹å™¨ä¸­ä½¿ç”¨" class="headerlink" title="åœ¨å®¹å™¨ä¸­ä½¿ç”¨:"></a>åœ¨å®¹å™¨ä¸­ä½¿ç”¨:</h3><h4 id="å°†æºæ›´æ¢ä¸ºæ¸…åæº"><a href="#å°†æºæ›´æ¢ä¸ºæ¸…åæº" class="headerlink" title="å°†æºæ›´æ¢ä¸ºæ¸…åæº"></a>å°†æºæ›´æ¢ä¸ºæ¸…åæº</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat &gt; /etc/apt/sources.list &lt;&lt; EOF</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…è½¯ä»¶"><a href="#å®‰è£…è½¯ä»¶" class="headerlink" title="å®‰è£…è½¯ä»¶"></a>å®‰è£…è½¯ä»¶</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get clean</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y curl telnet vim iputils-ping net-tools</span><br></pre></td></tr></table></figure><h4 id="Dockerfileä¸­ä½¿ç”¨"><a href="#Dockerfileä¸­ä½¿ç”¨" class="headerlink" title="Dockerfileä¸­ä½¿ç”¨:"></a>Dockerfileä¸­ä½¿ç”¨:</h4><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free"</span> &gt;/etc/apt/sources.list </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free"</span> &gt;&gt;/etc/apt/sources.list </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free"</span> &gt;&gt;/etc/apt/sources.list </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free"</span> &gt;&gt;/etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  apt-get clean</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  apt-get install -y curl telnet vim iputils-ping net-tools</span></span><br></pre></td></tr></table></figure><h3 id="alpineå®‰è£…telnetã€curlç­‰å‘½ä»¤"><a href="#alpineå®‰è£…telnetã€curlç­‰å‘½ä»¤" class="headerlink" title="alpineå®‰è£…telnetã€curlç­‰å‘½ä»¤"></a>alpineå®‰è£…telnetã€curlç­‰å‘½ä»¤</h3><p>å¾ˆå¤šé•œåƒæ˜¯ä½¿ç”¨alpineä½œä¸ºåŸºç¡€é•œåƒï¼Œä½“ç§¯å°ï¼Œä½†aplineç²¾ç®€äº†å¾ˆå¤šåŸºç¡€ç»„ä»¶å› æ­¤è°ƒè¯•èµ·æ¥å¾ˆéº»çƒ¦ï¼Œä¸‹æ–¹æ€»ç»“äº†å¸¸ç”¨çš„alpineç»„ä»¶å®‰è£…æ–¹æ³•ï¼š</p><table><thead><tr><th align="center">åŠŸèƒ½</th><th align="center">å‘½ä»¤</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">é•œåƒåŠ é€Ÿ</td><td align="center">sed -i â€˜s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/gâ€™ /etc/apk/repositories</td><td align="center">å°†åŸè£…çš„alpineåº“æ›¿æ¢æˆå›½å†…çš„ustcåº“</td></tr><tr><td align="center">apkåº“æ›´æ–°</td><td align="center">apk update</td><td align="center"></td></tr><tr><td align="center">å®‰è£…curl</td><td align="center">apk add curl</td><td align="center"></td></tr><tr><td align="center">å®‰è£…telnet</td><td align="center">apk add busybox-extras</td><td align="center"></td></tr><tr><td align="center">å·æ‡’Nåˆ1</td><td align="center">sed -i â€˜s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/gâ€™ /etc/apk/repositories &amp;&amp; apk update &amp;&amp; apk add curl &amp;&amp; apk add busybox-extras</td><td align="center"></td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä½¿ç”¨openjdk:8å’Œopenjdk:11ä½œä¸ºåŸºç¡€é•œåƒæ„å»ºä¸šåŠ¡é•œåƒï¼Œä½†æ˜¯ä½¿ç”¨ä¸­å‘ç°é•œåƒé‡Œé¢æ²¡æœ‰pingã€telnetç­‰åŸºç¡€å‘½ä»¤&lt;/p&gt;
&lt;h3 id=&quot;åœ¨å®¹å™¨ä¸­ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#åœ¨å®¹å™¨ä¸­ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;åœ¨å®¹å™¨ä¸­ä½¿ç”¨:&quot;</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://nmk0718.github.io/tag/k8s/"/>
    
    <category term="docker" scheme="http://nmk0718.github.io/tag/docker/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntuå®‰è£…Dockerå’ŒGPUé©±åŠ¨</title>
    <link href="http://nmk0718.github.io/2023/12/05/Ubuntu%E5%AE%89%E8%A3%85Docker%E5%92%8CGPU%E9%A9%B1%E5%8A%A8/"/>
    <id>http://nmk0718.github.io/2023/12/05/Ubuntu%E5%AE%89%E8%A3%85Docker%E5%92%8CGPU%E9%A9%B1%E5%8A%A8/</id>
    <published>2023-12-05T07:30:00.000Z</published>
    <updated>2024-11-29T06:41:49.378Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install     ca-certificates     curl     gnupg     lsb-release -y</span><br><span class="line">sudo mkdir -p /etc/apt/keyrings</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ å®˜æ–¹GPGå¯†é’¥ï¼š"><a href="#æ·»åŠ å®˜æ–¹GPGå¯†é’¥ï¼š" class="headerlink" title="æ·»åŠ å®˜æ–¹GPGå¯†é’¥ï¼š"></a>æ·»åŠ å®˜æ–¹GPGå¯†é’¥ï¼š</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ Dockerçš„ç¨³å®šç‰ˆæœ¬ä»“åº“ï¼š"><a href="#æ·»åŠ Dockerçš„ç¨³å®šç‰ˆæœ¬ä»“åº“ï¼š" class="headerlink" title="æ·»åŠ Dockerçš„ç¨³å®šç‰ˆæœ¬ä»“åº“ï¼š"></a>æ·»åŠ Dockerçš„ç¨³å®šç‰ˆæœ¬ä»“åº“ï¼š</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo useradd docker</span><br><span class="line">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h4><p>è…¾è®¯äº‘ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker.io -y</span><br></pre></td></tr></table></figure><h4 id="æŒ‚è½½ç£ç›˜"><a href="#æŒ‚è½½ç£ç›˜" class="headerlink" title="æŒ‚è½½ç£ç›˜"></a>æŒ‚è½½ç£ç›˜</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/var/lib# fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/vda: 50 GiB, 53687091200 bytes, 104857600 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel type: gpt</span><br><span class="line">Disk identifier: 884D39AE-2030-4231-B486-520515A9ADD7</span><br><span class="line"></span><br><span class="line">Device     Start       End   Sectors Size Type</span><br><span class="line">/dev/vda1   2048      4095      2048   1M BIOS boot</span><br><span class="line">/dev/vda2   4096 104857566 104853471  50G Linux filesystem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 200 GiB, 214748364800 bytes, 419430400 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">root@ubuntu:/var/lib# fdisk /dev/vdb</span><br><span class="line"></span><br><span class="line">Welcome to fdisk (util-linux 2.34).</span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table.</span><br><span class="line">Created a new DOS disklabel with disk identifier 0x1c765732.</span><br><span class="line"></span><br><span class="line">Command (m for help): `p`</span><br><span class="line">Disk /dev/vdb: 200 GiB, 214748364800 bytes, 419430400 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel type: dos</span><br><span class="line">Disk identifier: 0x1c765732</span><br><span class="line"></span><br><span class="line">Command (m for help): `n`</span><br><span class="line">Partition type</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended (container for logical partitions)</span><br><span class="line">Select (default p): `p`</span><br><span class="line">Partition number (1-4, default 1):</span><br><span class="line">First sector (2048-419430399, default 2048):</span><br><span class="line">Last sector, +/-sectors or +/-size&#123;K,M,G,T,P&#125; (2048-419430399, default 419430399):</span><br><span class="line"></span><br><span class="line">Created a new partition 1 of type &apos;Linux&apos; and of size 200 GiB.</span><br><span class="line"></span><br><span class="line">Command (m for help): `w`</span><br><span class="line">The partition table has been altered.</span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line"></span><br><span class="line">root@ubuntu:/var/lib# mkfs.ext4 /dev/vdb1</span><br><span class="line">mke2fs 1.45.5 (07-Jan-2020)</span><br><span class="line">Creating filesystem with 52428544 4k blocks and 13107200 inodes</span><br><span class="line">Filesystem UUID: a75b2a51-daa1-4d05-a6ee-0871fb0cf059</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</span><br><span class="line">4096000, 7962624, 11239424, 20480000, 23887872</span><br><span class="line"></span><br><span class="line">Allocating group tables: done</span><br><span class="line">Writing inode tables: done</span><br><span class="line">Creating journal (262144 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br><span class="line"></span><br><span class="line">root@ubuntu:/var/lib# mkdir /data</span><br><span class="line">root@ubuntu:/# mount /dev/vdb1 /data</span><br><span class="line">root@ubuntu:/# df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">udev             16G     0   16G   0% /dev</span><br><span class="line">tmpfs           3.1G  808K  3.1G   1% /run</span><br><span class="line">/dev/vda2        50G   19G   29G  39% /</span><br><span class="line">tmpfs            16G   24K   16G   1% /dev/shm</span><br><span class="line">tmpfs           5.0M     0  5.0M   0% /run/lock</span><br><span class="line">tmpfs            16G     0   16G   0% /sys/fs/cgroup</span><br><span class="line">tmpfs           3.1G     0  3.1G   0% /run/user/1000</span><br><span class="line">/dev/vdb1       196G   28K  186G   1% /data</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹å­˜å‚¨è·¯å¾„"><a href="#ä¿®æ”¹å­˜å‚¨è·¯å¾„" class="headerlink" title="ä¿®æ”¹å­˜å‚¨è·¯å¾„"></a>ä¿®æ”¹å­˜å‚¨è·¯å¾„</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#Dockerçš„é•œåƒéœ€åœ¨å¤§é‡çš„å­˜å‚¨ç©ºé—´ï¼Œé»˜è®¤çš„å­˜å‚¨è·¯å¾„åœ¨ /var/lib/docker, å¯ä»¥æŒ‰å®é™…éœ€æ±‚ä¿®æ”¹å­˜å‚¨è·¯å¾„ã€‚</span><br><span class="line">#åœæ­¢docker</span><br><span class="line">systemctl stop docker</span><br><span class="line">#ç§»åŠ¨ç›®å½•åˆ°æ–°è·¯å¾„</span><br><span class="line">sudo mv /var/lib/docker /data/docker</span><br><span class="line">#åšä¸ªè½¯é“¾æ¥</span><br><span class="line">ln -s /data/docker /var/lib/docker </span><br><span class="line">#å¯åŠ¨docker</span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…GPUé©±åŠ¨"><a href="#å®‰è£…GPUé©±åŠ¨" class="headerlink" title="å®‰è£…GPUé©±åŠ¨"></a>å®‰è£…GPUé©±åŠ¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">distribution=$(. /etc/os-release;echo $ID$VERSION_ID)</span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -</span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install -y nvidia-container-toolkit</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h4 id="éªŒè¯é©±åŠ¨"><a href="#éªŒè¯é©±åŠ¨" class="headerlink" title="éªŒè¯é©±åŠ¨"></a>éªŒè¯é©±åŠ¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo nvidia-smi</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;å®‰è£…ä¾èµ–&quot;&gt;&lt;a href=&quot;#å®‰è£…ä¾èµ–&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…ä¾èµ–&quot;&gt;&lt;/a&gt;å®‰è£…ä¾èµ–&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;</summary>
      
    
    
    
    
    <category term="ubuntu" scheme="http://nmk0718.github.io/tag/ubuntu/"/>
    
    <category term="docker" scheme="http://nmk0718.github.io/tag/docker/"/>
    
  </entry>
  
  <entry>
    <title>corednsåŸŸåè§£æ</title>
    <link href="http://nmk0718.github.io/2023/10/12/coredns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/"/>
    <id>http://nmk0718.github.io/2023/10/12/coredns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/</id>
    <published>2023-10-12T10:20:00.000Z</published>
    <updated>2024-11-29T06:42:53.041Z</updated>
    
    <content type="html"><![CDATA[<p>ç¼–è¾‘corednsçš„é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl edit configmap coredns -n kube-system</span><br></pre></td></tr></table></figure><p>å¢åŠ è§£æ</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">hosts</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">nacos.com</span></span><br><span class="line">        <span class="string">fallthrough</span></span><br><span class="line">        <span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ä¸ºç¤ºä¾‹</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">coredns</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">selfLink:</span> <span class="string">/api/v1/namespaces/kube-system/configmaps/coredns</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">afe82210-48ab-4e74-a190-7d401a8af49a</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">'240420099'</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">'2022-09-29T03:44:33Z'</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">forward_config:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">Corefile:</span> <span class="string">|-</span></span><br><span class="line">    <span class="string">.:53</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">errors</span></span><br><span class="line">        <span class="string">health</span></span><br><span class="line">        <span class="string">ready</span></span><br><span class="line">        <span class="string">hosts</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">nacos.com</span></span><br><span class="line">        <span class="string">fallthrough</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">        <span class="string">kubernetes</span> <span class="string">cluster.local</span> <span class="string">in-addr.arpa</span> <span class="string">ip6.arpa</span> <span class="string">&#123;</span></span><br><span class="line">           <span class="string">pods</span> <span class="string">insecure</span></span><br><span class="line">           <span class="string">upstream</span></span><br><span class="line">           <span class="string">fallthrough</span> <span class="string">in-addr.arpa</span> <span class="string">ip6.arpa</span></span><br><span class="line">           <span class="string">ttl</span> <span class="number">30</span></span><br><span class="line">        <span class="string">&#125;</span>      </span><br><span class="line">       <span class="string">prometheus</span> <span class="string">:9153</span></span><br><span class="line">        <span class="string">log</span> <span class="string">.</span> <span class="string">&#123;</span></span><br><span class="line">            <span class="string">class</span> <span class="string">all</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">        <span class="string">cache</span> <span class="number">30</span></span><br><span class="line">        <span class="string">loop</span></span><br><span class="line">        <span class="string">reload</span></span><br><span class="line">        <span class="string">loadbalance</span></span><br><span class="line">        <span class="string">forward</span> <span class="string">.</span> <span class="string">/etc/resolv.conf</span></span><br><span class="line">    <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ç¼–è¾‘corednsçš„é…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;kubectl edit configmap coredns -n k</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://nmk0718.github.io/tag/k8s/"/>
    
  </entry>
  
  <entry>
    <title>istio</title>
    <link href="http://nmk0718.github.io/2022/08/11/istio/"/>
    <id>http://nmk0718.github.io/2022/08/11/istio/</id>
    <published>2022-08-11T06:43:00.000Z</published>
    <updated>2024-11-29T06:44:33.324Z</updated>
    
    <content type="html"><![CDATA[<p>å®‰è£… Istio</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master-01 ~]# istioctl install --set profile=demo -y</span><br><span class="line">âœ” Istio core installed</span><br><span class="line">âœ” Istiod installed</span><br><span class="line">âœ” Egress gateways installed</span><br><span class="line">âœ” Ingress gateways installed</span><br><span class="line">âœ” Installation complete</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå‘½åç©ºé—´</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master-01 ~]# kubectl create ns tnmk</span><br><span class="line">namespace/tnmk created</span><br></pre></td></tr></table></figure><p>Istio é»˜è®¤<a href="https://istio.io/latest/zh/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection" target="_blank" rel="noopener">è‡ªåŠ¨æ³¨å…¥ Sidecar</a>. ä¸º tnmk å‘½åç©ºé—´æ‰“ä¸Šæ ‡ç­¾ <code>istio-injection=enabled</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master-01 ~]# kubectl label namespace tnmk istio-injection=enabled</span><br><span class="line">namespace/tnmk labeled</span><br></pre></td></tr></table></figure><p><a href="https://raw.githubusercontent.com/istio/istio/release-1.14/samples/bookinfo/platform/kube/bookinfo.yaml" target="_blank" rel="noopener">bookinfo.yaml</a></p><p>ä½¿ç”¨ <code>kubectl</code> éƒ¨ç½²åº”ç”¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master-01 ~]# kubectl apply -f bookinfo.yaml -n tnmk</span><br><span class="line">service/details created</span><br><span class="line">serviceaccount/bookinfo-details created</span><br><span class="line">deployment.apps/details-v1 created</span><br><span class="line">service/ratings created</span><br><span class="line">serviceaccount/bookinfo-ratings created</span><br><span class="line">deployment.apps/ratings-v1 created</span><br><span class="line">service/reviews created</span><br><span class="line">serviceaccount/bookinfo-reviews created</span><br><span class="line">deployment.apps/reviews-v1 created</span><br><span class="line">deployment.apps/reviews-v2 created</span><br><span class="line">deployment.apps/reviews-v3 created</span><br><span class="line">service/productpage created</span><br><span class="line">serviceaccount/bookinfo-productpage created</span><br><span class="line">deployment.apps/productpage-v1 created</span><br></pre></td></tr></table></figure><p>ç¡®è®¤æ‰€æœ‰çš„æœåŠ¡å’Œ Pod éƒ½å·²ç»å¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master-01 ~]# kubectl get services -n tnmk</span><br><span class="line">NAME          TYPE        CLUSTER-IP        EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">details       ClusterIP   172.101.98.173    &lt;none&gt;        9080/TCP   112s</span><br><span class="line">productpage   ClusterIP   172.101.139.235   &lt;none&gt;        9080/TCP   112s</span><br><span class="line">ratings       ClusterIP   172.101.24.172    &lt;none&gt;        9080/TCP   112s</span><br><span class="line">reviews       ClusterIP   172.101.40.212    &lt;none&gt;        9080/TCP   112s</span><br><span class="line">[root@master-01 ~]# kubectl get pods -n tnmk</span><br><span class="line">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class="line">details-v1-7d88846999-hggx9       2/2     Running   0          3m23s</span><br><span class="line">productpage-v1-7795568889-tqjrv   2/2     Running   0          3m23s</span><br><span class="line">ratings-v1-754f9c4975-tqrqj       2/2     Running   0          3m23s</span><br><span class="line">reviews-v1-55b668fc65-nns2c       2/2     Running   0          3m23s</span><br><span class="line">reviews-v2-858f99c99-l8vv5        2/2     Running   0          3m23s</span><br><span class="line">reviews-v3-7886dd86b9-wpkkl       2/2     Running   0          3m23s</span><br></pre></td></tr></table></figure><p>è¦ç¡®è®¤ Bookinfo åº”ç”¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œè¯·åœ¨æŸä¸ª Pod ä¸­ç”¨ <code>curl</code> å‘½ä»¤å¯¹åº”ç”¨å‘é€è¯·æ±‚ï¼Œä¾‹å¦‚ <code>ratings</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master-01 ~]# kubectl exec -it -n tnmk $(kubectl get pod -l app=ratings -n tnmk -o jsonpath=&apos;&#123;.items[0].metadata.name&#125;&apos;) -c ratings -- curl productpage:9080/productpage | grep -o &quot;&lt;title&gt;.*&lt;/title&gt;&quot;</span><br><span class="line">&lt;title&gt;Simple Bookstore App&lt;/title&gt;</span><br></pre></td></tr></table></figure><p>ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰ Ingress ç½‘å…³</p><p><a href="https://raw.githubusercontent.com/istio/istio/release-1.14/samples/bookinfo/networking/bookinfo-gateway.yaml" target="_blank" rel="noopener">bookinfo-gateway.yaml</a></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master-01 ~]# kubectl apply -f bookinfo-gateway.yaml -n tnmk</span><br><span class="line">gateway.networking.istio.io/bookinfo-gateway created</span><br><span class="line">virtualservice.networking.istio.io/bookinfo created</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è§„åˆ™</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl get VirtualService -A</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å®‰è£… Istio&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@master-01 ~]# istioctl install --s</summary>
      
    
    
    
    
    <category term="istio" scheme="http://nmk0718.github.io/tag/istio/"/>
    
  </entry>
  
  <entry>
    <title>verdaccio</title>
    <link href="http://nmk0718.github.io/2022/06/20/verdaccio/"/>
    <id>http://nmk0718.github.io/2022/06/20/verdaccio/</id>
    <published>2022-06-20T11:20:00.000Z</published>
    <updated>2024-11-29T06:41:44.874Z</updated>
    
    <content type="html"><![CDATA[<p>yumæŒ‡å®šnodeç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl --silent --location https://rpm.nodesource.com/setup_12.x | sudo bash -</span><br></pre></td></tr></table></figure><p>å®‰è£…node</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install nodejs</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹nodeç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure><p>å…¨å±€å®‰è£…verdaccio</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install verdaccio -g</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç‰ˆæœ¬å·</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">verdaccio  -v</span><br></pre></td></tr></table></figure><p>å¤åˆ¶ä¸¤ä¸ªé…ç½®æ–‡ä»¶åˆ°/root/.config/ä¸‹</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">config.yaml  htpasswd</span><br></pre></td></tr></table></figure><p>æ‹·è´ç§æœåº“çš„åŒ…åˆ°æœåŠ¡å™¨çš„/dataä¸‹ è§£å‹</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tar zxvf /data/npm-storage.tar</span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">verdaccio</span><br><span class="line"></span><br><span class="line"> info --- Creating default config file in /root/.config/verdaccio/config.yaml</span><br><span class="line"> warn --- config file  - /root/.config/verdaccio/config.yaml</span><br><span class="line">(node:1835) Warning: Verdaccio doesn't need superuser privileges. don't run it under root</span><br><span class="line">(node:1835) Warning: Verdaccio doesn't need superuser privileges. don't run it under root</span><br><span class="line"> warn --- "crypt" algorithm is deprecated consider switch to "bcrypt". Read more: https://github.com/verdaccio/monorepo/pull/580</span><br><span class="line"> info --- plugin successfully loaded: verdaccio-htpasswd</span><br><span class="line"> info --- plugin successfully loaded: verdaccio-audit</span><br><span class="line"> warn --- http address - http://localhost:4873/ - verdaccio/5.13.0</span><br></pre></td></tr></table></figure><p>è®¿é—®é¡µé¢</p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image/image-20220620192826502.png"><p>æ³¨å†ŒæˆæœåŠ¡</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> vi /etc/systemd/system/verdaccio.service</span><br><span class="line"> </span><br><span class="line">[Unit]</span><br><span class="line">Description=Verdaccio lightweight npm proxy registry</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">Restart=on-failure</span><br><span class="line">#User=root</span><br><span class="line">ExecStart=/usr/bin/verdaccio --config /root/.config/verdaccio/config.yaml</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>é‡æ–°åŠ è½½,é…ç½®å¼€æœºå¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable verdaccio.service</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æœåŠ¡å¯åŠ¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl start verdaccio.service</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;yumæŒ‡å®šnodeç‰ˆæœ¬&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl --silent --location https://rpm.</summary>
      
    
    
    
    
    <category term="verdaccio" scheme="http://nmk0718.github.io/tag/verdaccio/"/>
    
  </entry>
  
  <entry>
    <title>KubernetesæŸ¥çœ‹podå…³è”çš„pvc</title>
    <link href="http://nmk0718.github.io/2022/06/13/Kubernetes%E6%9F%A5%E7%9C%8Bpod%E5%85%B3%E8%81%94%E7%9A%84pvc/"/>
    <id>http://nmk0718.github.io/2022/06/13/Kubernetes%E6%9F%A5%E7%9C%8Bpod%E5%85%B3%E8%81%94%E7%9A%84pvc/</id>
    <published>2022-06-13T09:20:00.000Z</published>
    <updated>2025-01-05T15:55:13.020Z</updated>
    
    <content type="html"><![CDATA[<h3 id="kubernetes-æŸ¥çœ‹å“ªäº›-pod-æ­£åœ¨ä½¿ç”¨-pvc"><a href="#kubernetes-æŸ¥çœ‹å“ªäº›-pod-æ­£åœ¨ä½¿ç”¨-pvc" class="headerlink" title="kubernetes æŸ¥çœ‹å“ªäº› pod æ­£åœ¨ä½¿ç”¨ pvc"></a>kubernetes æŸ¥çœ‹å“ªäº› pod æ­£åœ¨ä½¿ç”¨ pvc</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@k8s ~]<span class="comment"># cat pvc-pod.sh</span></span><br><span class="line">kubectl get pods --all-namespaces -o=json | jq -c <span class="string">'.items[] | &#123;name: .metadata.name, namespace: .metadata.namespace, claimName:.spec.volumes[] | select( has ("persistentVolumeClaim") ).persistentVolumeClaim.claimName &#125;'</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@k8s ~]# sh pvc-pod.sh</span><br><span class="line">&#123;&quot;name&quot;:&quot;archery-mysql-master-0&quot;,&quot;namespace&quot;:&quot;archery&quot;,&quot;claimName&quot;:&quot;data-archery-mysql-master-0&quot;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;clash-d59b74867-rlj7j&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;claimName&quot;:&quot;ruleset-cache&quot;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;sonarqube-postgresql-postgresql-0&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;claimName&quot;:&quot;data-sonarqube-postgresql-postgresql-0&quot;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;sonarqube-sonarqube-7b548fdb4f-45ww8&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;claimName&quot;:&quot;sonarqube-sonarqube&quot;&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹k8sé›†ç¾¤æœ‰å“ªäº›åœ¨ä½¿ç”¨çš„ç«¯å£å¯¹åº”çš„æœåŠ¡"><a href="#æŸ¥çœ‹k8sé›†ç¾¤æœ‰å“ªäº›åœ¨ä½¿ç”¨çš„ç«¯å£å¯¹åº”çš„æœåŠ¡" class="headerlink" title="æŸ¥çœ‹k8sé›†ç¾¤æœ‰å“ªäº›åœ¨ä½¿ç”¨çš„ç«¯å£å¯¹åº”çš„æœåŠ¡"></a>æŸ¥çœ‹k8sé›†ç¾¤æœ‰å“ªäº›åœ¨ä½¿ç”¨çš„ç«¯å£å¯¹åº”çš„æœåŠ¡</h3><p>å¯¼å‡ºæ‰€æœ‰svcåˆ°æ–‡æœ¬</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl get svc --all-namespaces &gt;svc.txt</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤nodeportæ˜¾ç¤º</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep NodePort svc.txt</span><br></pre></td></tr></table></figure><p>é€šè¿‡NodePortå¯çŸ¥é“æ˜ å°„çš„æœåŠ¡</p><h4 id="ç¼©å‡æ‰€æœ‰ç©ºé—´çš„podå‰¯æœ¬æ•°ä¸º0"><a href="#ç¼©å‡æ‰€æœ‰ç©ºé—´çš„podå‰¯æœ¬æ•°ä¸º0" class="headerlink" title="ç¼©å‡æ‰€æœ‰ç©ºé—´çš„podå‰¯æœ¬æ•°ä¸º0"></a>ç¼©å‡æ‰€æœ‰ç©ºé—´çš„podå‰¯æœ¬æ•°ä¸º0</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl get ns -o name | awk &apos;&#123;print $1&#125;&apos; |awk -F &apos;/&apos; &apos;&#123;print $2&#125;&apos; &gt;ns.txt</span><br></pre></td></tr></table></figure><h4 id="ç¼©å‡æ‰€æœ‰ç©ºé—´çš„deploymentå‰¯æœ¬æ•°ä¸º0"><a href="#ç¼©å‡æ‰€æœ‰ç©ºé—´çš„deploymentå‰¯æœ¬æ•°ä¸º0" class="headerlink" title="ç¼©å‡æ‰€æœ‰ç©ºé—´çš„deploymentå‰¯æœ¬æ•°ä¸º0"></a>ç¼©å‡æ‰€æœ‰ç©ºé—´çš„deploymentå‰¯æœ¬æ•°ä¸º0</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat start.sh</span><br><span class="line"></span><br><span class="line">while read line</span><br><span class="line"></span><br><span class="line">do</span><br><span class="line"></span><br><span class="line">echo $line</span><br><span class="line">kubectl scale --replicas=0 $(kubectl get deploy -o name -n $line) -n $line</span><br><span class="line"></span><br><span class="line">done &lt; ns.txt</span><br></pre></td></tr></table></figure><p>./start.sh</p><h3 id="ç¼©å‡æ‰€æœ‰ç©ºé—´çš„statefulsetså‰¯æœ¬æ•°ä¸º0"><a href="#ç¼©å‡æ‰€æœ‰ç©ºé—´çš„statefulsetså‰¯æœ¬æ•°ä¸º0" class="headerlink" title="ç¼©å‡æ‰€æœ‰ç©ºé—´çš„statefulsetså‰¯æœ¬æ•°ä¸º0"></a>ç¼©å‡æ‰€æœ‰ç©ºé—´çš„statefulsetså‰¯æœ¬æ•°ä¸º0</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat start.sh</span><br><span class="line"></span><br><span class="line">while read line</span><br><span class="line"></span><br><span class="line">do</span><br><span class="line"></span><br><span class="line">echo $line</span><br><span class="line">kubectl scale --replicas=0 $(kubectl get statefulsets -o name -n $line) -n $line</span><br><span class="line"></span><br><span class="line">done &lt; ns.txt</span><br></pre></td></tr></table></figure><p>./start.sh</p><p><a href="https://www.e-learn.cn/topic/3816776" target="_blank" rel="noopener">https://www.e-learn.cn/topic/3816776</a></p><p>ä½¿ç”¨<code>kubectl delete jobs --all</code>å¯ä»¥åˆ é™¤å½“å‰namespacesä¸‹æ‰€æœ‰çš„job</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;kubernetes-æŸ¥çœ‹å“ªäº›-pod-æ­£åœ¨ä½¿ç”¨-pvc&quot;&gt;&lt;a href=&quot;#kubernetes-æŸ¥çœ‹å“ªäº›-pod-æ­£åœ¨ä½¿ç”¨-pvc&quot; class=&quot;headerlink&quot; title=&quot;kubernetes æŸ¥çœ‹å“ªäº› pod æ­£åœ¨ä½¿ç”¨ pvc&quot;&gt;&lt;/a&gt;ku</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://nmk0718.github.io/tag/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Flutterä¸­ä½¿ç”¨SetStateæ— æ•ˆ</title>
    <link href="http://nmk0718.github.io/2022/03/08/flutter%E6%9B%B4%E6%96%B0%E7%8A%B6%E6%80%81%E6%97%A0%E6%95%88/"/>
    <id>http://nmk0718.github.io/2022/03/08/flutter%E6%9B%B4%E6%96%B0%E7%8A%B6%E6%80%81%E6%97%A0%E6%95%88/</id>
    <published>2022-03-08T06:21:48.575Z</published>
    <updated>2022-03-08T06:21:48.575Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åœ¨Flutterä¸­ä½¿ç”¨SetStateæ— æ•ˆï¼Ÿå¯èƒ½æ˜¯å¿½ç•¥äº†è¿™ä¸ªï¼"><a href="#åœ¨Flutterä¸­ä½¿ç”¨SetStateæ— æ•ˆï¼Ÿå¯èƒ½æ˜¯å¿½ç•¥äº†è¿™ä¸ªï¼" class="headerlink" title="åœ¨Flutterä¸­ä½¿ç”¨SetStateæ— æ•ˆï¼Ÿå¯èƒ½æ˜¯å¿½ç•¥äº†è¿™ä¸ªï¼"></a>åœ¨Flutterä¸­ä½¿ç”¨SetStateæ— æ•ˆï¼Ÿå¯èƒ½æ˜¯å¿½ç•¥äº†è¿™ä¸ªï¼</h3><p>é—®é¢˜ï¼šåœ¨æŸä¸ªç»„ä»¶ä¸­è°ƒç”¨setState()æ–¹æ³•æ›´æ–°è¯¥ç»„ä»¶çŠ¶æ€ï¼Œç»“æœæ˜¯æ— æ³•åšåˆ°æ›´æ–°æ•ˆæœï¼Œç»„ä»¶ä»ç„¶ç»´æŒåŸçŠ¶ã€‚<br>ä¸‹é¢æˆ‘ä»¬ç”¨ä»£ç ç¤ºä¾‹è¿˜åŸé—®é¢˜åœºæ™¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class _MyHomePageState extends State&lt;MyHomePage&gt; &#123;</span><br><span class="line">  bool isChecked = false;</span><br><span class="line"></span><br><span class="line">  showTestDialog() &#123;</span><br><span class="line">    showDialog(</span><br><span class="line">      context: context,</span><br><span class="line">      builder: (BuildContext context) &#123;</span><br><span class="line">        return SimpleDialog(title: Text(&quot;æµ‹è¯•å¯¹è¯æ¡†æ ‡é¢˜&quot;), children: &lt;Widget&gt;[</span><br><span class="line">          Row(children: &lt;Widget&gt;[</span><br><span class="line">            Checkbox(</span><br><span class="line">                value: this.isChecked,</span><br><span class="line">                onChanged: (bool val) &#123;</span><br><span class="line">                  setState(() &#123;</span><br><span class="line">                    this.isChecked = !this.isChecked;</span><br><span class="line">                  &#125;);</span><br><span class="line">                  debugPrint(this.isChecked.toString());</span><br><span class="line">                &#125;),</span><br><span class="line">            Text(&quot;æµ‹è¯•å¤é€‰æ¡†&quot;)</span><br><span class="line">          ])</span><br><span class="line">        ]);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(widget.title),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">          child: RaisedButton(</span><br><span class="line">        child: Text(&quot;ç‚¹å‡»å‡ºç°å¼¹çª—&quot;),</span><br><span class="line">        onPressed: () &#123;</span><br><span class="line">          showTestDialog();</span><br><span class="line">        &#125;,</span><br><span class="line">      )),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†çªå‡ºé—®é¢˜ç‚¹ï¼Œå‡å°‘ä¸å¿…è¦çš„å¹²æ‰°ï¼Œæˆ‘ç®€åŒ–äº†åŸæœ‰ä»£ç å†…å®¹ã€‚é€šè¿‡é˜…è¯»ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¾—çŸ¥æ•´ä¸ªDemoçš„ç•Œé¢æœ‰ä¸€ä¸ªæŒ‰é’®æ„æˆï¼Œå½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼ŒshowTestDialog()æ–¹æ³•è¢«æ‰§è¡Œã€‚ç•Œé¢å°†æ˜¾ç¤ºä¸€ä¸ªå°çª—å£ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå¤é€‰æ¡†ã€‚<br>æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœå½“ç„¶æ˜¯ç”¨æˆ·ç‚¹å‡»å¤é€‰æ¡†çš„æ—¶å€™ï¼Œæ”¹å˜å¤é€‰æ¡†çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œåœ¨å¤é€‰æ¡†çš„onChanged()æ–¹æ³•ä¸­æ”¹å˜äº†å†³å®šå¤é€‰æ¡†çŠ¶æ€çš„å¸ƒå°”å€¼ï¼Œå¹¶setState()ã€‚<br>ç„¶è€ŒçœŸå®çš„è¿è¡Œç»“æœå¹¶éåƒé¢„æœŸé‚£æ ·äº§ç”Ÿæ•ˆæœã€‚<br>ç©¶å…¶åŸå› ï¼Œæˆ‘ä»¬è¿˜éœ€ä»setState()è¯´èµ·ã€‚<br>é¡¾åæ€ä¹‰ï¼ŒsetState()è¦æ±‚å…¶ä½œç”¨å¯¹è±¡å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶ã€‚å¦‚æœä½œç”¨å¯¹è±¡æœ¬èº«æ— çŠ¶æ€ï¼Œé‚£ä¹ˆsetState()å°†æ— æ³•èµ·ä½œç”¨ã€‚<br>å› æ­¤ï¼Œæˆ‘ä»¬æ‰¾åˆ°åŸå› ï¼šSimpleDialog()ä¸­çš„å­ç»„ä»¶é»˜è®¤æ˜¯æ— çŠ¶æ€çš„ã€‚<br>æ¥ä¸‹æ¥çš„è§£å†³åŠæ³•å°±ç®€å•äº†ï¼Œåªéœ€è¦åœ¨SimpleDialogç»„ä»¶å¤–éƒ¨â€œå¥—â€ä¸€ä¸ªStatefulBuilderç»„ä»¶å³å¯ã€‚å‚è€ƒä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class _MyHomePageState extends State&lt;MyHomePage&gt; &#123;</span><br><span class="line">  bool isChecked = false;</span><br><span class="line"></span><br><span class="line">  showTestDialog() &#123;</span><br><span class="line">    showDialog(</span><br><span class="line">      context: context,</span><br><span class="line">      builder: (BuildContext context) &#123;</span><br><span class="line">        return StatefulBuilder(</span><br><span class="line">          builder:</span><br><span class="line">              (BuildContext context, void Function(void Function()) setState) &#123;</span><br><span class="line">            return SimpleDialog(title: Text(&quot;æµ‹è¯•å¯¹è¯æ¡†æ ‡é¢˜&quot;), children: &lt;Widget&gt;[</span><br><span class="line">              Row(children: &lt;Widget&gt;[</span><br><span class="line">                Checkbox(</span><br><span class="line">                    value: this.isChecked,</span><br><span class="line">                    onChanged: (bool val) &#123;</span><br><span class="line">                      setState(() &#123;</span><br><span class="line">                        this.isChecked = !this.isChecked;</span><br><span class="line">                      &#125;);</span><br><span class="line">                      debugPrint(this.isChecked.toString());</span><br><span class="line">                    &#125;),</span><br><span class="line">                Text(&quot;æµ‹è¯•å¤é€‰æ¡†&quot;)</span><br><span class="line">              ])</span><br><span class="line">            ]);</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(widget.title),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">          child: RaisedButton(</span><br><span class="line">        child: Text(&quot;ç‚¹å‡»å‡ºç°å¼¹çª—&quot;),</span><br><span class="line">        onPressed: () &#123;</span><br><span class="line">          showTestDialog();</span><br><span class="line">        &#125;,</span><br><span class="line">      )),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œï¼Œå¯¹è¯æ¡†ä¸­çš„å¤é€‰æ¡†å¯ä»¥æ­£å¸¸å“åº”ã€‚è‡³æ­¤ï¼Œé—®é¢˜è§£å†³ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://juejin.cn/post/6844904195531735048" target="_blank" rel="noopener">https://juejin.cn/post/6844904195531735048</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;åœ¨Flutterä¸­ä½¿ç”¨SetStateæ— æ•ˆï¼Ÿå¯èƒ½æ˜¯å¿½ç•¥äº†è¿™ä¸ªï¼&quot;&gt;&lt;a href=&quot;#åœ¨Flutterä¸­ä½¿ç”¨SetStateæ— æ•ˆï¼Ÿå¯èƒ½æ˜¯å¿½ç•¥äº†è¿™ä¸ªï¼&quot; class=&quot;headerlink&quot; title=&quot;åœ¨Flutterä¸­ä½¿ç”¨SetStateæ— æ•ˆï¼Ÿå¯èƒ½æ˜¯å¿½ç•¥äº†è¿™ä¸ª</summary>
      
    
    
    
    
    <category term="flutter" scheme="http://nmk0718.github.io/tag/flutter/"/>
    
  </entry>
  
</feed>

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Moments</title>

    <link rel="icon" href="/favicon.png">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/js/script.js"></script>
    <script src="/js/tocbot.min.js"></script>

    <link rel="alternate" href="/atom.xml" title="kk's Blog" type="application/atom+xml">

    <style>

        /* 图片网格样式 */
        .tweet-grid-images {
            position: relative;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            margin: 10px 0;
        }

        .grid-image-item {
            aspect-ratio: 1;
            overflow: hidden;
            cursor: pointer;
        }

        .grid-image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 图片查看器样式 */
        .image-viewer {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            z-index: 100;
        }

        .image-viewer-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .main-image-container {
            position: relative;
            width: 100%;
            height: calc(100% - 100px);
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #fff;
        }

        .main-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .thumbnail-container {
            width: 100%;
            height: 100px;
            background-color: #f5f5f5;
            overflow-x: auto;
            white-space: nowrap;
            border-top: 1px solid #eee;
        }

        .thumbnails {
            display: inline-flex;
            gap: 10px;
            padding: 10px;
            height: 100%;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s;
            background-color: #fff;
        }

        .thumbnail.active {
            border-color: #1a73e8;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 101;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 18px;
            z-index: 101;
            border-radius: 4px;
        }

        .prev-btn {
            left: 10px;
        }

        .next-btn {
            right: 10px;
        }

        /* 音乐播放器样式 */
        .music-player {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .music-cover-box {
            position: relative;
            width: 60px;
            height: 60px;
            margin-right: 15px;
        }

        .music-cover {
            width: 100%;
            height: 100%;
            border-radius: 4px;
        }

        .music-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-info-box {
            flex: 1;
        }

        .music-meta {
            margin-bottom: 10px;
        }

        .music-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .music-progress-box {
            display: flex;
            align-items: center;
        }

        .music-current-time, .music-duration {
            font-size: 12px;
            width: 40px;
        }

        .music-progress-bar-bg {
            flex: 1;
            height: 4px;
            background-color: #eee;
            margin: 0 10px;
            position: relative;
        }

        .music-progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: #1a73e8;
            width: 0%;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <header>
            <nav class="navbar">
                <div class="navbar-header header-logo"><a href="/"></a></div>
                <div class="menu navbar-right">
                    <a class="menu-item" href="/archives">Posts</a>
                    <a class="menu-item" href="/app">App</a>
                    <a class="menu-item" href="/moments">Moments</a>
                    <a class="menu-item" href="/map">Map</a>
                    <a class="menu-item" href="/game">Game</a>
                    <a class="menu-item" href="/media">Media</a>
                    <a class="menu-item" href="/tag">Tags</a>
                    <a class="menu-item" href="/about">About</a>
                    <input id="switch_default" type="checkbox" class="switch_default">
                    <label for="switch_default" class="toggleBtn"></label>
                </div>
            </nav>

            <nav class="navbar-mobile" id="nav-mobile">
                <div class="container">
                    <div class="navbar-header">
                        <div>
                            <a href="/">kk&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                        </div>
                        <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
                    </div>
                    <div class="menu" id="mobile-menu">
                        <a class="menu-item" href="/archives">Posts</a>
                        <a class="menu-item" href="/app">App</a>
                        <a class="menu-item" href="/moments">Moments</a>
                        <a class="menu-item" href="/map">Map</a>
                        <a class="menu-item" href="/game">Game</a>
                        <a class="menu-item" href="/media">Media</a>
                        <a class="menu-item" href="/tag">Tags</a>
                        <a class="menu-item" href="/about">About</a>
                    </div>
                </div>
            </nav>
        </header>
    </div>

    <div class="main">
        <div class="container">
            <main class="main-content">
                <div class="tweets-wrapper" id="tweets-container"></div>
            </main>
        </div>
    </div>

    <footer id="footer" class="footer">
        <div class="copyright">
            <span>© nmk | Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span>
        </div>
    </footer>

    <script>
        // 示例数据
        const tweetsData = [
            {
                avatar: '../image/avatars.jpg',
                nickname: 'kk',
                content: '正在听：',
                music: {
                    cover: 'https://y.gtimg.cn/music/photo_new/T002R300x300M000003l02MY0vw8vs.jpg',
                    title: '习惯失恋 - 容祖儿',
                    audioSrc: 'https://lw-sycdn.kuwo.cn/4e7ff719a1d78e60133dde0b5beaa711/68243885/resource/30106/trackmedia/M500001pqziT2xshtK.mp3'
                },
                time: '2025年5月13日'
            },
            {
                avatar: '../image/avatars.jpg',
                nickname: 'kk',
                content: '驻马店第二站：骑士庄园，西凤山庄',
                images: [
                    '../image/pengpengche.jpg',
                    '../image/huanngjiayizhan.jpg',
                    '../image/guaguale.jpg',
                    '../image/taoquan.jpg',
                    '../image/zhumadian-food1.jpg',
                    '../image/xian-food3.jpg'
                ],
                time: '2025年5月4日'
            },
            {
                avatar: '../image/avatars.jpg',
                nickname: 'kk',
                content: '到驻马店，第一站：皇家驿站',
                images: [
                    '../image/pengpengche.jpg',
                    '../image/huanngjiayizhan.jpg',
                    '../image/guaguale.jpg',
                    '../image/taoquan.jpg',
                    '../image/zhumadian-food1.jpg',
                    '../image/xian-food3.jpg'
                ],
                time: '2025年5月3日'
            },
            {
                avatar: '../image/avatars.jpg',
                nickname: 'kk',
                content: '来西安了，吃了窑鸡和泡馍',
                images: [
                    '../image/aircraft-xian.jpg',
                    '../image/aircraft-eat.jpg',
                    '../image/xian-cat.jpg',
                    '../image/xian-food1.jpg',
                    '../image/xian-food2.jpg',
                    '../image/xian-food3.jpg'
                ],
                time: '2025年5月2日'
            },
            {
                avatar: '../image/avatars.jpg',
                nickname: 'kk',
                content: '开心，今天下班回家收到了老婆准备的周年礼物🎁',
                image: '../image/xiaomi-razor.png',
                time: '2025年4月28日'
            },
            {
                avatar: '../image/avatars.jpg',
                nickname: 'kk',
                content: '正在听：',
                music: {
                    cover: 'https://p1.music.126.net/_rHCQX84pzW6Po2gnKKZtA==/109951163718466968.jpg',
                    title: '幸福之歌 - Supper Moment',
                    audioSrc: 'https://sh-sycdn.kuwo.cn/ebf14ce45014328039e1b85d9759e8ec/6824516b/resource/n2/88/82/2436259403.mp3'
                },
                time: '2025年4月28日'
            },
            {
                avatar: '../image/avatars.jpg',
                nickname: 'kk',
                content: '公司开放职级晋升窗口，技术答辩通过，今天拿到了晋升后的薪资，涨薪10%,继续努力💪。',
                time: '2025年4月25日'
            },
            {
                avatar: '../image/avatars.jpg',
                nickname: 'kk',
                content: '开通个人朋友圈，分享生活🥳🥳🥳🎉🎉🎉',
                time: '2025年4月22日'
            }
        ];

        // 动态生成推文
        const tweetsContainer = document.getElementById('tweets-container');
        tweetsData.forEach(tweet => {
            let tweetHTML = `
                <div class="tweet-item">
                    <div class="tweet-header">
                        <img class="tweet-avatar" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="${tweet.avatar}" alt="头像">
                        <div class="tweet-nickname">${tweet.nickname}</div>
                    </div>
                    <div class="tweet-content">${tweet.content}</div>
            `;

            if (tweet.music) {
                tweetHTML += `
                    <div class="music-player">
                        <div class="music-cover-box">
                            <img class="music-cover" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="${tweet.music.cover}" alt="音乐封面">
                            <button class="music-play-btn" data-audio-src="${tweet.music.audioSrc}" title="播放/暂停">
                                <svg id="playIcon" viewBox="0 0 40 40" width="24" height="24" fill="none">
                                    <circle cx="20" cy="20" r="20" fill="rgba(0,0,0,0.18)" />
                                    <polygon points="16,13 28,20 16,27" fill="#fff" />
                                </svg>
                                <svg id="pauseIcon" viewBox="0 0 40 40" width="24" height="24" fill="none" style="display:none;">
                                    <circle cx="20" cy="20" r="20" fill="rgba(0,0,0,0.18)" />
                                    <rect x="15" y="13" width="3.5" height="14" rx="1.5" fill="#fff" />
                                    <rect x="21.5" y="13" width="3.5" height="14" rx="1.5" fill="#fff" />
                                </svg>
                            </button>
                        </div>
                        <div class="music-info-box">
                            <div class="music-meta">
                                <div class="music-title">${tweet.music.title}</div>
                            </div>
                            <div class="music-progress-box">
                                <span class="music-current-time">0:00</span>
                                <div class="music-progress-bar-bg">
                                    <div class="music-progress-bar"></div>
                                </div>
                                <span class="music-duration">0:00</span>
                            </div>
                            <audio src="${tweet.music.audioSrc}"></audio>
                        </div>
                    </div>
                `;
            }

            if (tweet.images) {
                tweetHTML += `
                    <div class="tweet-grid-images">
                        ${tweet.images.map((imgSrc, index) => `
                            <div class="grid-image-item" onclick="imageViewer.openViewer(event, this)">
                                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="${imgSrc}">
                            </div>
                        `).join('')}
                        <div class="image-viewer">
                            <div class="image-viewer-content">
                                <div class="main-image-container">
                                    data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="<img class="main-image viewer-main-image" src="" alt="主图">
                                    <button class="close-btn" onclick="imageViewer.closeViewer(event)">&times;</button>
                                    <button class="nav-btn prev-btn" onclick="imageViewer.prevImage(event)">&lt;</button>
                                    <button class="nav-btn next-btn" onclick="imageViewer.nextImage(event)">&gt;</button>
                                </div>
                                <div class="thumbnail-container">
                                    <div class="thumbnails"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (tweet.image) {
                tweetHTML += `
                    <img class="tweet-img" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="${tweet.image}" alt="配图">
                `;
            }

            tweetHTML += `
                <div class="tweet-time">${tweet.time}</div>
            </div>
            `;

            tweetsContainer.innerHTML += tweetHTML;
        });
    </script>

    <script>
        // 图片查看器类
        const imageViewer = {
            imageCache: new Map(), // 图片缓存

            preloadImage(src) {
                if (!this.imageCache.has(src)) {
                    const img = new Image();
                    img.src = src;
                    this.imageCache.set(src, img);
                }
                return this.imageCache.get(src);
            },

            preloadAllImages() {
                const allImages = document.querySelectorAll('.tweet-grid-images img');
                allImages.forEach(img => {
                    this.preloadImage(img.src);
                });
            },

            openViewer(event, element) {
                event.stopPropagation();
                const tweetGrid = element.closest('.tweet-grid-images');
                const viewer = tweetGrid.querySelector('.image-viewer');
                const mainImage = viewer.querySelector('.main-image');
                const clickedImage = element.querySelector('img');
                const clickedSrc = clickedImage.src;

                const cachedImage = this.preloadImage(clickedSrc);
                mainImage.src = cachedImage.src;

                const thumbnails = viewer.querySelector('.thumbnails');
                thumbnails.innerHTML = '';
                const imageItems = tweetGrid.querySelectorAll('.grid-image-item img');
                const images = Array.from(imageItems).map(img => img.src);
                const currentIndex = Array.from(imageItems).indexOf(clickedImage);

                images.forEach((src, index) => {
                    const thumbnail = document.createElement('div');
                    thumbnail.className = `thumbnail ${index === currentIndex ? 'active' : ''}`;
                    const thumbnailImg = document.createElement('img');
                    const cachedThumbnail = this.preloadImage(src);
                    thumbnailImg.src = cachedThumbnail.src;
                    thumbnail.appendChild(thumbnailImg);
                    thumbnails.appendChild(thumbnail);
                    thumbnail.addEventListener('click', (e) => {
                        this.switchImage(e.currentTarget.querySelector('img'), index);
                    });
                });

                viewer.dataset.currentIndex = currentIndex;
                viewer.style.display = 'block';
            },

            closeViewer(event) {
                const viewer = event.target.closest('.image-viewer');
                if (viewer) {
                    viewer.style.display = 'none';
                }
            },

            switchImage(thumbnailImg, index) {
                const viewer = thumbnailImg.closest('.thumbnails').closest('.image-viewer');
                if (!viewer) return;

                const mainImage = viewer.querySelector('.main-image');
                const thumbnails = viewer.querySelectorAll('.thumbnail');
                const tweetGrid = viewer.closest('.tweet-grid-images');
                if (!tweetGrid) return;

                const imageItems = tweetGrid.querySelectorAll('.grid-image-item img');
                const newSrc = imageItems[index].src;

                const cachedImage = this.preloadImage(newSrc);
                mainImage.src = cachedImage.src;

                thumbnails.forEach((thumb, i) => {
                    thumb.classList.toggle('active', i === index);
                });

                viewer.dataset.currentIndex = index;
            },

            prevImage(event) {
                const button = event.target.closest('.prev-btn');
                if (!button) return;

                const viewer = button.closest('.image-viewer');
                if (!viewer) return;

                const thumbnails = viewer.querySelectorAll('.thumbnail');
                const currentIndex = parseInt(viewer.dataset.currentIndex);
                const newIndex = (currentIndex - 1 + thumbnails.length) % thumbnails.length;

                const newThumbnail = thumbnails[newIndex].querySelector('img');
                if (newThumbnail) {
                    this.switchImage(newThumbnail, newIndex);
                }
            },

            nextImage(event) {
                const button = event.target.closest('.next-btn');
                if (!button) return;

                const viewer = button.closest('.image-viewer');
                if (!viewer) return;

                const thumbnails = viewer.querySelectorAll('.thumbnail');
                const currentIndex = parseInt(viewer.dataset.currentIndex);
                const newIndex = (currentIndex + 1) % thumbnails.length;

                const newThumbnail = thumbnails[newIndex].querySelector('img');
                if (newThumbnail) {
                    this.switchImage(newThumbnail, newIndex);
                }
            }
        };

        // 页面加载完成后初始化图片查看器
        document.addEventListener('DOMContentLoaded', function() {
            imageViewer.preloadAllImages();

            // 为音乐播放器添加事件监听器
            const playButtons = document.querySelectorAll('.music-play-btn');
            playButtons.forEach(button => {
                const audio = button.nextElementSibling.querySelector('audio');
                const playIcon = button.querySelector('#playIcon');
                const pauseIcon = button.querySelector('#pauseIcon');
                const currentTimeEl = button.nextElementSibling.querySelector('.music-current-time');
                const durationEl = button.nextElementSibling.querySelector('.music-duration');
                const progressBar = button.nextElementSibling.querySelector('.music-progress-bar');

                audio.addEventListener('loadedmetadata', function() {
                    durationEl.textContent = formatTime(audio.duration);
                });

                audio.addEventListener('timeupdate', function() {
                    currentTimeEl.textContent = formatTime(audio.currentTime);
                    if (audio.duration) {
                        progressBar.style.width = (audio.currentTime / audio.duration * 100) + '%';
                    }
                });

                button.addEventListener('click', function() {
                    if (audio.paused) {
                        audio.play();
                        playIcon.style.display = 'none';
                        pauseIcon.style.display = '';
                    } else {
                        audio.pause();
                        playIcon.style.display = '';
                        pauseIcon.style.display = 'none';
                    }
                });

                audio.addEventListener('play', function() {
                    playIcon.style.display = 'none';
                    pauseIcon.style.display = '';
                });

                audio.addEventListener('pause', function() {
                    playIcon.style.display = '';
                    pauseIcon.style.display = 'none';
                });

                audio.addEventListener('ended', function() {
                    playIcon.style.display = '';
                    pauseIcon.style.display = 'none';
                });
            });

            function formatTime(sec) {
                sec = Math.floor(sec);
                return `${Math.floor(sec / 60)}:${('0' + (sec % 60)).slice(-2)}`;
            }
        });
    </script>

        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body>

</html>
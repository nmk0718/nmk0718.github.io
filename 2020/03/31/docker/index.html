<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>Docker | K&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">nimingkun&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">nimingkun&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Docker</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">nmk</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">2020-3-31&nbsp;&nbsp;17:00:00</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/deployment/">deployment</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker</span><br></pre></td></tr></table></figure>

<h3 id="查看docker容器版本"><a href="#查看docker容器版本" class="headerlink" title="查看docker容器版本"></a>查看docker容器版本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<h3 id="查看docker容器信息"><a href="#查看docker容器信息" class="headerlink" title="查看docker容器信息"></a>查看docker容器信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure>

<h3 id="修改存储路径"><a href="#修改存储路径" class="headerlink" title="修改存储路径"></a>修改存储路径</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#Docker的镜像需在大量的存储空间，默认的存储路径在 &#x2F;var&#x2F;lib&#x2F;docker, 可以按实际需求修改存储路径。</span><br><span class="line">#停止docker</span><br><span class="line">service docker stop</span><br><span class="line">#创建目录</span><br><span class="line">mkdir -p &#x2F;data&#x2F;docker</span><br><span class="line">#移动目录到新路径</span><br><span class="line">mv &#x2F;var&#x2F;lib&#x2F;docker &#x2F;data&#x2F;docker</span><br><span class="line">#做个软链接</span><br><span class="line">ln -s &#x2F;data&#x2F;docker &#x2F;var&#x2F;lib&#x2F;docker </span><br><span class="line">#启动docker</span><br><span class="line">service docker start</span><br></pre></td></tr></table></figure>

<h3 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat</span><br><span class="line">#相当于 docker pull centos:latest 最新版本,可以手动指定版本</span><br></pre></td></tr></table></figure>

<h3 id="查看容器的所有镜像"><a href="#查看容器的所有镜像" class="headerlink" title="查看容器的所有镜像"></a>查看容器的所有镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h3 id="查看容器运行的镜像"><a href="#查看容器运行的镜像" class="headerlink" title="查看容器运行的镜像"></a>查看容器运行的镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">#可以使用grep过滤镜像</span><br><span class="line">docker ps |grep tomcat</span><br></pre></td></tr></table></figure>

<h3 id="查看容器历史运行过的镜像"><a href="#查看容器历史运行过的镜像" class="headerlink" title="查看容器历史运行过的镜像"></a>查看容器历史运行过的镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<h3 id="显示运行容器总文件大小"><a href="#显示运行容器总文件大小" class="headerlink" title="显示运行容器总文件大小"></a>显示运行容器总文件大小</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -s</span><br></pre></td></tr></table></figure>

<h3 id="镜像启动"><a href="#镜像启动" class="headerlink" title="镜像启动"></a>镜像启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:8080 -v &#x2F;data:&#x2F;data --name&#x3D;mytomcat tomcat </span><br><span class="line">#-d: 后台运行容器，并返回容器ID；</span><br><span class="line">#-i: 以交互模式运行容器，通常与 -t 同时使用；</span><br><span class="line">#-t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；</span><br><span class="line">#-p：前者是外围访问端口：后者是容器内部端口</span><br><span class="line">#--volume,-v: 宿主机的目录&#x2F;data映射到容器的&#x2F;data</span><br><span class="line">#--name&#x3D;&quot;nginx-lb&quot;: 为容器指定一个名称；</span><br></pre></td></tr></table></figure>

<h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it [CONTAINER ID] &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker rmi [CONTAINER ID]</span><br><span class="line"></span><br><span class="line">如果出现应用出错：Error response from daemon: conflict: unable to delete CONTAINER ID(cannot be forced) - image has dependent child images</span><br><span class="line">docker rmi REPOSITORY:TAG</span><br></pre></td></tr></table></figure>

<h3 id="删除运行失败的镜像"><a href="#删除运行失败的镜像" class="headerlink" title="删除运行失败的镜像"></a>删除运行失败的镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm [CONTAINER ID]</span><br><span class="line">#删除运行中的镜像需要先停止该容器,然后使用上述命令。使用-f可强制删除</span><br></pre></td></tr></table></figure>

<h3 id="删除所有none镜像"><a href="#删除所有none镜像" class="headerlink" title="删除所有none镜像"></a>删除所有none镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi &#96;docker images | grep  &quot;&lt;none&gt;&quot; | awk &#39;&#123;print $3&#125;&#39;&#96;</span><br></pre></td></tr></table></figure>

<h3 id="删除不是latest的镜像"><a href="#删除不是latest的镜像" class="headerlink" title="删除不是latest的镜像"></a>删除不是latest的镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi &#96;docker images|grep -v latest |awk &#39;&#123;print $3&#125;&#39;&#96;</span><br></pre></td></tr></table></figure>

<h3 id="删除Exited状态的容器"><a href="#删除Exited状态的容器" class="headerlink" title="删除Exited状态的容器"></a>删除Exited状态的容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm &#96;docker ps -a|grep Exited|awk &#39;&#123;print $1&#125;&#39;&#96;</span><br></pre></td></tr></table></figure>

<h3 id="创建dockerfile"><a href="#创建dockerfile" class="headerlink" title="创建dockerfile"></a>创建dockerfile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from tomcat #tomcat的镜像</span><br><span class="line">MAINTAINER nmk #作者</span><br><span class="line">RUN rm -rf &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;*  #运行的命令</span><br><span class="line">COPY nmk.war &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps #复制war包到tomcat的webapps目录下</span><br><span class="line">EXPOSE 8080  #开放端口</span><br></pre></td></tr></table></figure>

<h3 id="镜像构建"><a href="#镜像构建" class="headerlink" title="镜像构建"></a>镜像构建</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -f &#x2F;data&#x2F;docker&#x2F;dockerfile -t mytomcat:1.1</span><br><span class="line">#-f :指定要使用的Dockerfile路径；</span><br><span class="line">#--tag, -t: 镜像的名字及标签，通常 name:tag 或者 name 格式；</span><br></pre></td></tr></table></figure>

<h3 id="推送到阿里云镜像仓库"><a href="#推送到阿里云镜像仓库" class="headerlink" title="推送到阿里云镜像仓库"></a>推送到阿里云镜像仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#登录阿里云Docker Registry</span><br><span class="line">docker login --username&#x3D;aliyunaccount registry.cn-beijing.aliyuncs.com</span><br><span class="line">#镜像打tag</span><br><span class="line">docker tag [ImageId] registry.cn-beijing.aliyuncs.com&#x2F;nmk&#x2F;tomcat:[镜像版本号]</span><br><span class="line">#推送到阿里云</span><br><span class="line">docker push registry.cn-beijing.aliyuncs.com&#x2F;nmk&#x2F;tomcat:[镜像版本号]</span><br><span class="line">#拉取阿里云镜像</span><br><span class="line">docker pull registry.cn-beijing.aliyuncs.com&#x2F;lepeng&#x2F;tomcat:[镜像版本号]</span><br></pre></td></tr></table></figure>

<h3 id="从宿主机拷贝到容器"><a href="#从宿主机拷贝到容器" class="headerlink" title="从宿主机拷贝到容器"></a>从宿主机拷贝到容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp files.txt [CONTAINER ID或NAMES]:&#x2F;home</span><br></pre></td></tr></table></figure>

<h3 id="从容器拷贝到宿主机"><a href="#从容器拷贝到宿主机" class="headerlink" title="从容器拷贝到宿主机"></a>从容器拷贝到宿主机</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp [CONTAINER ID或NAMES]:&#x2F;home&#x2F;files.txt  &#x2F;home&#x2F;</span><br></pre></td></tr></table></figure>

<h3 id="镜像导入导出有两种方法"><a href="#镜像导入导出有两种方法" class="headerlink" title="镜像导入导出有两种方法"></a>镜像导入导出有两种方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#指定镜像保存成tar归档文件</span><br><span class="line">docker save -o files.tar tomcat:7.5</span><br><span class="line">#载入打包的镜像</span><br><span class="line">docker load -i files.tar</span><br><span class="line">#指定镜像保存成tar归档文件</span><br><span class="line">docker export -o tomcat.tar [CONTAINER ID]</span><br><span class="line">#载入打包的镜像</span><br><span class="line">docker import tomcat.tar tomcat:latest</span><br><span class="line"></span><br><span class="line">#总结一下docker save和docker export的区别：</span><br><span class="line">	1.docker save保存的是镜像（image），docker export保存的是容器（container）；</span><br><span class="line">	2.docker load用来载入镜像包，docker import用来载入容器包，但两者都会恢复为镜像；</span><br><span class="line">	3.docker load不能对载入的镜像重命名，而docker import可以为镜像指定新名称。</span><br><span class="line">#注:docker save保存的镜像docker load不能载入,docker export保存的镜像,docker import不能载入</span><br><span class="line">#详解请看:https:&#x2F;&#x2F;blog.csdn.net&#x2F;liukuan73&#x2F;article&#x2F;details&#x2F;78089138</span><br></pre></td></tr></table></figure>

















        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>nmk</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://nmk0718.github.io/2020/03/31/docker/">http://nmk0718.github.io/2020/03/31/docker/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2020 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/docker/"># docker</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/04/02/easyimage/">easyimage</a>
            
            
            <a class="next" rel="next" href="/2020/03/08/photoshop/">photoshop</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© nmk | Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span>
	</div>
</footer>

    </div>
</body>
</html>

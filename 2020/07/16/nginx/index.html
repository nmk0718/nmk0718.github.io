<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>nginx | K&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">nimingkun&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">nimingkun&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">nginx</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">nmk</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">2020-7-16&nbsp;&nbsp;16:47:00</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/deployment/">deployment</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>Nginx功能丰富,可作为HTTP服务器,也可作为反向代理服务器,邮件服务器。支持FastCGI、SSL、Virtual Host、URL Rewrite、Gzip等功能。并且支持很多第三方的模块扩展。</p>
<h4 id="Nginx常用功能"><a href="#Nginx常用功能" class="headerlink" title="Nginx常用功能"></a>Nginx常用功能</h4><p>Nginx在做反向代理时,提供性能稳定,并且能够提供配置灵活的转发功能。Nginx可以根据不同的正则匹配,采取不同的转发策略,比如图片文件结尾的走文件服务器,动态页面走web服务器。并且Nginx对返回结果进行错误页跳转,异常判断等。如果被分发的服务器存在异常,他可以将请求重新转发给另外一台服务器,然后自动去除异常服务器。</p>
<h4 id="正向代理和反向代理"><a href="#正向代理和反向代理" class="headerlink" title="正向代理和反向代理"></a>正向代理和反向代理</h4><p>反向代理（Reverse Proxy）对应的是正向代理（Forward Proxy）,他们的区别：<br>正向代理： 一般的访问流程是客户端直接向目标服务器发送请求并获取内容,使用正向代理后,客户端改为向代理服务器发送请求,并指定目标服务器（原始服务器）,然后由代理服务器和原始服务器通信,转交请求并获得的内容,再返回给客户端。正向代理隐藏了真实的客户端,为客户端收发请求,使真实客户端对服务器不可见；<br>举个具体的例子 🌰,你的浏览器无法直接访问谷哥,这时候可以通过一个代理服务器来帮助你访问谷哥,那么这个服务器就叫正向代理。<br>反向代理： 与一般访问流程相比,使用反向代理后,直接收到请求的服务器是代理服务器,然后将请求转发给内部网络上真正进行处理的服务器,得到的结果返回给客户端。反向代理隐藏了真实的服务器,为服务器收发请求,使真实服务器对客户端不可见。一般在处理跨域请求的时候比较常用。现在基本上所有的大型网站都设置了反向代理。<br>举个具体的例子 🌰,去饭店吃饭,可以点川菜、粤菜、江浙菜,饭店也分别有三个菜系的厨师 👨‍🍳,但是你作为顾客不用管哪个厨师给你做的菜,只用点菜即可,小二将你菜单中的菜分配给不同的厨师来具体处理,那么这个小二就是反向代理服务器。<br>简单的说,一般给客户端做代理的都是正向代理,给服务器做代理的就是反向代理。</p>
<p><img src="http://showdoc.gzlplink.com/server/../Public/Uploads/2020-07-06/5f0297f17c48c.png" alt=""></p>
<h4 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h4><p>请求爆发式增长的情况下,单个机器性能再强劲也无法满足要求了,这个时候集群的概念产生了,单个服务器解决不了的问题,可以使用多个服务器,然后将请求分发到各个服务器上,将负载分发到不同的服务器,这就是负载均衡,核心是「分摊压力」。Nginx 实现负载均衡,一般来说指的是将请求转发给服务器集群。<br>举个具体的例子 🌰,晚高峰乘坐地铁的时候,入站口经常会有地铁工作人员大喇叭“请走 B 口,B 口人少车空….”,这个工作人员的作用就是负载均衡。<br><img src="http://showdoc.gzlplink.com/server/../Public/Uploads/2020-07-06/5f02987e7922a.png" alt=""></p>
<h4 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h4><p>为了加快网站的解析速度,可以把动态页面和静态页面由不同的服务器来解析,加快解析速度,降低原来单个服务器的压力。<br><img src="http://showdoc.gzlplink.com/server/../Public/Uploads/2020-07-06/5f0298e628adb.png" alt=""><br>一般来说,都需要将动态资源和静态资源分开,由于 Nginx 的高并发和静态资源缓存等特性,经常将静态资源部署在 Nginx 上。如果请求的是静态资源,直接到静态资源目录获取资源,如果是动态资源的请求,则利用反向代理的原理,把请求转发给对应后台应用去处理,从而实现动静分离。<br>使用前后端分离后,可以很大程度提升静态资源的访问速度,即使动态服务不可用,静态资源的访问也不会受到影响。</p>
<h4 id="操作命令"><a href="#操作命令" class="headerlink" title="操作命令"></a>操作命令</h4><h5 id="windows下nginx命令"><a href="#windows下nginx命令" class="headerlink" title="windows下nginx命令"></a>windows下nginx命令</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#启动nginx</span><br><span class="line">在nginx安装目录下</span><br><span class="line">start nginx.exe</span><br><span class="line"></span><br><span class="line">#不停服务加载配置</span><br><span class="line">在nginx安装目录下</span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line">#nginx命令参数</span><br><span class="line">-c &lt;&#x2F;path&#x2F;to&#x2F;config&gt; 为 Nginx 指定一个配置文件,来代替缺省的。</span><br><span class="line">-t 如需检查配置文件的语法的正确性</span><br><span class="line">-v 显示 nginx 的版本</span><br><span class="line">-V 显示 nginx 的版本,编译器版本和配置参数(可查看nginx使用的模块)。</span><br><span class="line">-s reload  # 向主进程发送信号,重新加载配置文件</span><br><span class="line">-s reopen	 # 重启 Nginx</span><br><span class="line">-s stop    # 快速关闭</span><br><span class="line">-s quit    # 等待工作进程处理完成后关闭</span><br><span class="line">nginx -h可查看完整命令</span><br><span class="line"></span><br><span class="line">#查看nginx进程</span><br><span class="line">tasklist &#x2F;fi &quot;imagename eq nginx.exe&quot;</span><br><span class="line"></span><br><span class="line">#强制结束所有nginx进程</span><br><span class="line">taskkill &#x2F;F &#x2F;IM nginx.exe</span><br></pre></td></tr></table></figure>
<h5 id="linux下nginx命令"><a href="#linux下nginx命令" class="headerlink" title="linux下nginx命令"></a>linux下nginx命令</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.手动编译nginx</span><br><span class="line">#启动nginx</span><br><span class="line">在nginx安装目录下</span><br><span class="line">.&#x2F;sbin&#x2F;nginx</span><br><span class="line">#不停服务加载配置</span><br><span class="line">在nginx安装目录下</span><br><span class="line">.&#x2F;sbin&#x2F;nginx -s reload</span><br><span class="line">命令参数均一致,只需把windows的nginx改为.&#x2F;sbin&#x2F;nginx即可</span><br><span class="line">#查看nginx进程</span><br><span class="line">ps -ef|grep nginx</span><br><span class="line">#强制结束所有nginx进程</span><br><span class="line">killalll nginx</span><br><span class="line"></span><br><span class="line">2.yum安装nginx</span><br><span class="line">#yum安装nginx,默认安装目录为&#x2F;etc&#x2F;nginx.可全局使用nginx命令,无需进入nginx安装目录</span><br></pre></td></tr></table></figure>
<h4 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h4><p>nginx配置文件在安装目录的nginx.conf中<br>nginx 配置文件主要分成四部分：main（全局设置）、server（主机设置）、upstream（上游服务器设置,主要为反向代理、负载均衡相关配置）和 location（URL匹配特定位置后的设置）。main 部分设置的指令影响其他所有部分的设置；server 部分的指令主要用于制定虚拟主机域名、IP 和端口号；upstream 的指令用于设置一系列的后端服务器,设置反向代理及后端服务器的负载均衡；location 部分用于匹配网页位置（比如,根目录“/”,“/images”,等等）。他们之间的关系：server 继承 main,location 继承 server；upstream 既不会继承指令也不会被继承。</p>
<p>配置文件的语法规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.配置文件由指令与指令块构成；</span><br><span class="line">2.每条指令以 ; 分号结尾,指令与参数间以空格符号分隔；</span><br><span class="line">3.指令块以 &#123;&#125; 大括号将多条指令组织在一起；</span><br><span class="line">4.include 语句允许组合多个配置文件以提升可维护性；</span><br><span class="line">5.使用 # 符号添加注释,提高可读性；</span><br><span class="line">6.使用 $ 符号使用变量；</span><br><span class="line">7.部分指令的参数支持正则表达式；</span><br></pre></td></tr></table></figure>
<p>Nginx 的典型配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">#定义Nginx运行的用户和用户组</span><br><span class="line">user  nginx; </span><br><span class="line"></span><br><span class="line">#nginx进程数,通常设置成和cpu的数量相等</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#全局错误日志定义类型,[debug | info | notice | warn | error | crit]</span><br><span class="line">error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;  </span><br><span class="line">#error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log  notice;</span><br><span class="line">#error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log  info;</span><br><span class="line"></span><br><span class="line">#进程pid文件</span><br><span class="line">pid        &#x2F;run&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line">#指定进程可以打开的最大描述符：数目</span><br><span class="line">#工作模式与连接数上限</span><br><span class="line">##这个指令是指当一个nginx进程打开的最多文件描述符数目,理论值应该是最多打开文件数（ulimit -n）与nginx进程数相除,但是nginx分配请求并不是那么均匀,所以最好与ulimit -n 的值保持一致。</span><br><span class="line">#这是因为nginx调度时分配请求到进程并不是那么的均衡,所以假如填写10240,总并发量达到3-4万时就有进程可能超过10240了,这时会返回502错误。</span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line">include &#x2F;etc&#x2F;nginx&#x2F;conf.modules.d&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">#单个进程最大连接数（最大连接数&#x3D;连接数+进程数）</span><br><span class="line">#根据硬件调整,和前面工作进程配合起来用,尽量大,但是别把cup跑到100%就行。</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#设定http服务器</span><br><span class="line">http &#123;</span><br><span class="line"> 	# 文件扩展名与类型映射表</span><br><span class="line">    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class="line">	# 默认文件类型</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line">	# Nginx访问日志存放位置</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;</span><br><span class="line">	#开启高效文件传输模式,sendfile指令指定nginx是否调用sendfile函数来输出文件,对于普通应用设为 on,如果用来进行下载等应用磁盘IO重负载应用,可设置为off,以平衡磁盘与网络I&#x2F;O处理速	度,降低系统的负载。注意：如果图片显示不正常把这个改 成off。</span><br><span class="line">    sendfile        on;</span><br><span class="line">	#防止网络阻塞</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line">	</span><br><span class="line">    #长连接超时时间,单位是秒</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">	</span><br><span class="line">	#开启gzip压缩</span><br><span class="line">    #gzip  on;</span><br><span class="line">	</span><br><span class="line">	# 加载子配置项</span><br><span class="line">    include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">    index   index.html index.htm;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">    	listen       80;       # 配置监听的端口</span><br><span class="line">    	server_name  localhost;    # 配置的域名</span><br><span class="line">    	</span><br><span class="line">    	location &#x2F; &#123;</span><br><span class="line">    		root   &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;  # 网站根目录</span><br><span class="line">    		index  index.html index.htm;   # 默认首页文件</span><br><span class="line">    		deny 172.168.22.11;   # 禁止访问的ip地址,可以为all</span><br><span class="line">    		allow 172.168.33.44； # 允许访问的ip地址,可以为all</span><br><span class="line">    	&#125;</span><br><span class="line">    	</span><br><span class="line">    	error_page 500 502 503 504 &#x2F;50x.html;  # 默认50x对应的访问页面</span><br><span class="line">    	error_page 400 404 error.html;   # 同上</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>server 块可以包含多个 location 块,location 指令用于匹配 uri,语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location [ &#x3D; | ~ | ~* | ^~] uri &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>指令后面：</p>
<p>1.<code>=</code>精确匹配路径,用于不含正则表达式的 uri 前,如果匹配成功,不再进行后续的查找；<br>2.<code>^<del></code>用于不含正则表达式的 uri； 前,表示如果该符号后面的字符是最佳匹配,采用该规则,不再进行后续的查找；<br>3.<code></del></code> 表示用该符号后面的正则去匹配路径,区分大小写；<br>4.<code>~*</code>表示用该符号后面的正则去匹配路径,不区分大小写。跟 ~ 优先级都比较低,如有多个location的正则能匹配的话,则使用正则表达式最长的那个；</p>
<p>如果 uri 包含正则表达式,则必须要有 ~ 或 ~* 标志。</p>
<h4 id="常用的全局变量"><a href="#常用的全局变量" class="headerlink" title="常用的全局变量"></a>常用的全局变量</h4><table>
<thead>
<tr>
<th>全局变量名</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>$host</td>
<td>请求信息中的 Host,如果请求中没有 Host 行,则等于设置的服务器名,不包含端口</td>
</tr>
<tr>
<td>$request_method</td>
<td>客户端请求类型,如 GET、POST</td>
</tr>
<tr>
<td>$remote_addr</td>
<td>客户端的 IP 地址</td>
</tr>
<tr>
<td>$args</td>
<td>请求中的参数</td>
</tr>
<tr>
<td>$arg_PARAMETER</td>
<td>GET 请求中变量名 PARAMETER 参数的值,例如：$http_user_agent(Uaer-Agent 值), $http_referer…</td>
</tr>
<tr>
<td>$content_length</td>
<td>请求头中的 Content-length 字段</td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>客户端agent信息</td>
</tr>
<tr>
<td>$http_cookie</td>
<td>客户端cookie信息</td>
</tr>
<tr>
<td>$remote_addr</td>
<td>客户端的IP地址</td>
</tr>
<tr>
<td>$remote_port</td>
<td>客户端的端口</td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>客户端agent信息</td>
</tr>
<tr>
<td>$server_protocol</td>
<td>请求使用的协议,如 HTTP/1.0、HTTP/1.1</td>
</tr>
<tr>
<td>$server_addr</td>
<td>服务器地址</td>
</tr>
<tr>
<td>$server_name</td>
<td>服务器名称</td>
</tr>
<tr>
<td>$server_port</td>
<td>服务器的端口号</td>
</tr>
<tr>
<td>$scheme</td>
<td>HTTP 方法（如http,https）</td>
</tr>
</tbody></table>
<h4 id="配置反向代理"><a href="#配置反向代理" class="headerlink" title="配置反向代理"></a>配置反向代理</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  server &#123;</span><br><span class="line">  linsten 80;</span><br><span class="line">  server_name: www.gzlplink.com;</span><br><span class="line">    </span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">    	proxy_pass http:&#x2F;&#x2F;myserver;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以将请求转发到本机另一个服务器上,也可以根据访问的路径跳转到不同端口的服务中。<br>比如我们监听 9001 端口,然后把访问不同路径的请求进行反向代理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">把访问 http:&#x2F;&#x2F;127.0.0.1:9001&#x2F;edu 的请求转发到 http:&#x2F;&#x2F;127.0.0.1:8080</span><br><span class="line">把访问 http:&#x2F;&#x2F;127.0.0.1:9001&#x2F;vod 的请求转发到 http:&#x2F;&#x2F;127.0.0.1:8081</span><br><span class="line"></span><br><span class="line">在 http 模块下增加一个 server 块：</span><br><span class="line">server &#123;</span><br><span class="line">  listen 9001;</span><br><span class="line">  server_name www.gzlplink.com;</span><br><span class="line"></span><br><span class="line">  location ~ &#x2F;edu&#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:8080;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location ~ &#x2F;vod&#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:8081;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码反向代理还有一些其他的指令,可以了解一下：</p>
<p>1.proxy_set_header：在将客户端请求发送给后端服务器之前,更改来自客户端的请求头信息。<br>2.proxy_connect_timeout：配置Nginx与后端代理服务器尝试建立连接的超时时间。<br>3.proxy_read_timeout：配置Nginx向后端服务器组发出read请求后,等待相应的超时时间。<br>4.proxy_send_timeout：配置Nginx向后端服务器组发出write请求后,等待相应的超时时间。<br>5.proxy_redirect：用于修改后端服务器返回的响应头中的Location和Refresh。</p>
<h4 id="配置负载均衡"><a href="#配置负载均衡" class="headerlink" title="配置负载均衡"></a>配置负载均衡</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  upstream myserver &#123;</span><br><span class="line">  	# ip_hash;  # ip_hash 方式</span><br><span class="line">    # fair;   # fair 方式</span><br><span class="line">    server 127.0.0.1:8081;  # 负载均衡目的服务地址</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line">    server 127.0.0.1:8082 weight&#x3D;10 backup;  # weight 方式,不写默认为 1</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  server &#123;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">    	proxy_pass http:&#x2F;&#x2F;myserver;</span><br><span class="line">      proxy_connect_timeout 10;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Nginx 提供了好几种分配方式,默认为轮询,就是轮流来。有以下几种分配方式：</p>
<p>1.轮询,默认方式,每个请求按时间顺序逐一分配到不同的后端服务器,如果后端服务挂了,能自动剔除；<br>2.weight,权重分配,指定轮询几率,权重越高,在被访问的概率越大,用于后端服务器性能不均的情况；<br>3.ip_hash,对客户端请求的ip进行hash操作,然后根据hash结果将同一个客户端ip的请求分发给同一台服务器进行处理,可以解决session不共享的问题。</p>
<p><img src="/image/iphash.png" alt="iphash"></p>
<p>4.fair（第三方）,按后端服务器的响应时间分配,响应时间短的优先分配,依赖第三方插件 nginx-upstream-fair,需要先安装；<br>5.backup,携带backup代表此server为备用,nginx只有在转发到主server出现问题,才会切换到backup的server</p>
<p><strong>开启gzip</strong></p>
<p>gzip 是一种常用的网页压缩技术,传输的网页经过 gzip 压缩之后大小通常可以变为原来的一半甚至更小（官网原话）,更小的网页体积也就意味着带宽的节约和传输速度的提升,特别是对于访问量巨大大型网站来说,每一个静态资源体积的减小,都会带来可观的流量与带宽的节省。</p>
<p>使用 gzip 不仅需要 Nginx 配置,浏览器端也需要配合,需要在请求消息头中包含 Accept-Encoding: gzip（IE5 之后所有的浏览器都支持了,是现代浏览器的默认设置）。一般在请求 html 和 css 等静态资源的时候,支持的浏览器在 request 请求静态资源的时候,会加上 Accept-Encoding: gzip 这个 header,表示自己支持 gzip 的压缩方式,Nginx 在拿到这个请求的时候,如果有相应配置,就会返回经过 gzip 压缩过的文件给浏览器,并在 response 相应的时候加上 content-encoding: gzip 来告诉浏览器自己采用的压缩方式（因为浏览器在传给服务器的时候一般还告诉服务器自己支持好几种压缩方式）,浏览器拿到压缩的文件后,根据自己的解压方式进行解析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gzip on;</span><br><span class="line">gzip_types text&#x2F;plain text&#x2F;css application&#x2F;json application&#x2F;x-javascript text&#x2F;xml application&#x2F;xml application&#x2F;xml+rss text&#x2F;javascript;</span><br><span class="line">gzip_static on;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_vary on;</span><br><span class="line">gzip_comp_level 2;</span><br><span class="line">gzip_buffers 4 8k;</span><br><span class="line">gzip_min_length 1k;</span><br><span class="line">gzip_http_version 1.1;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>gzip_types：进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到。</p>
</li>
<li><p>gzip_static：默认 off,该模块启用后,Nginx 首先检查是否存在请求静态文件的 gz 结尾的文件,如果有则直接返回该 .gz 文件内容；</p>
</li>
<li><p>gzip_proxied：默认 off,nginx做为反向代理时启用,用于设置启用或禁用从代理服务器上收到相应内容 gzip 压缩；</p>
</li>
<li><p>gzip_vary：用于在响应消息头中添加 Vary：Accept-Encoding,使代理服务器根据请求头中的 Accept-Encoding 识别是否启用 gzip 压缩；</p>
</li>
<li><p>gzip_comp_level：gzip 压缩比,压缩级别是 1-9,1 压缩级别最低,9 最高,数字越大压缩的越好,也越占用CPU时间。一般设置1和2；</p>
</li>
<li><p>gzip_buffers：获取多少内存用于缓存压缩结果,4 8k 表示以 8k*4 为单位获得；</p>
</li>
<li><p>gzip_min_length：启用gzip压缩的最小文件,小于设置值的文件将不会压缩</p>
</li>
<li><p>gzip_http_version：默认 1.1,启用 gzip 所需的 HTTP 最低版本；</p>
<p>这个配置可以插入到 http 模块整个服务器的配置里,也可以插入到需要使用的虚拟主机的 server 或者下面的 location 模块中</p>
</li>
</ol>
<h4 id="配置-HTTPS"><a href="#配置-HTTPS" class="headerlink" title="配置 HTTPS"></a>配置 HTTPS</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 443 ssl http2 default_server;   # SSL 访问端口号为 443</span><br><span class="line">  server_name www.gzlplink.com;         # 填写绑定证书的域名</span><br><span class="line">  add_header backendIP $upstream_addr;   #把后端具体的 upstream 返回给前端 header</span><br><span class="line">  add_header backendCode $upstream_status;</span><br><span class="line"></span><br><span class="line">  ssl_certificate &#x2F;etc&#x2F;nginx&#x2F;https&#x2F;1_sherlocked93.club_bundle.crt;   # 证书文件地址</span><br><span class="line">  ssl_certificate_key &#x2F;etc&#x2F;nginx&#x2F;https&#x2F;2_sherlocked93.club.key;      # 私钥文件地址</span><br><span class="line">  ssl_session_timeout 10m;</span><br><span class="line"></span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;      #请按照以下协议配置</span><br><span class="line">  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; </span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  </span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;</span><br><span class="line">    index        index.html index.htm;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="泛域名转发"><a href="#泛域名转发" class="headerlink" title="泛域名转发"></a>泛域名转发</h4><p>和之前的功能类似,有时候我们希望把二级或者三级域名链接重写到我们希望的路径,让后端就可以根据路由解析不同的规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">test1.gzlplink.com&#x2F;api?name&#x3D;a 自动转发到 127.0.0.1:8080&#x2F;test1&#x2F;api?name&#x3D;a；</span><br><span class="line">test2.gzlplink.com&#x2F;api?name&#x3D;a 自动转发到 127.0.0.1:8080&#x2F;test2&#x2F;api?name&#x3D;a ；</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name ~^([\w-]+)\.gzlplink\.com$;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_set_header        X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header        Host $http_host;</span><br><span class="line">        proxy_set_header        X-NginX-Proxy true;</span><br><span class="line">        proxy_pass              http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;$1$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="泛域名路径分离"><a href="#泛域名路径分离" class="headerlink" title="泛域名路径分离"></a>泛域名路径分离</h4><p>这是一个非常实用的技能,经常有时候我们可能需要配置一些二级或者三级域名,希望通过 Nginx 自动指向对应目录,比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">test1.nmk0718.com 自动指向 &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;test1 服务器地址；</span><br><span class="line">test2.nmk0718.com 自动指向 &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;test2 服务器地址；</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  ~^([\w-]+)\.nmk0718\.com$;</span><br><span class="line"></span><br><span class="line">    root &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;$1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.为了使 Nginx 配置更易于维护,建议为每个服务创建一个单独的配置文件,存储在 /etc/nginx/conf/website 目录,根据需求可以创建任意多个独立的配置文件。<br>2.独立的配置文件,建议遵循以下命名约定 &lt;服务&gt;.conf,比如域名是www. nmk0718.com”,那么你的配置文件的应该是这样的./etc/nginx/conf/website/www. nmk0718.com.conf,如果部署多个服务,也可以在文件名中加上 Nginx 转发的端口号。<br>3.Nginx 日志相关目录,内以 域名.type.log 命名（比如www. nmk0718.com.access.log 和 www. nmk0718.com.error.log ）位于 /var/log/nginx/ 目录中,为每个独立的服务配置不同的访问权限和错误日志文件,这样查找错误时,会更加方便快捷。<br>日志相关目录,内以 域名.type.log 命名（比如 www. nmk0718.com.access.log 和 www. nmk0718.com.error.log ）位于 /var/log/nginx/ 目录中,为每个独立的服务配置不同的访问权限和错误日志文件,这样查找错误时,会更加方便快捷。</p>
<h4 id="nginx重定向"><a href="#nginx重定向" class="headerlink" title="nginx重定向"></a>nginx重定向</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#转发 域名&#x2F;nmk0718&#x2F;index后的任意字符 到error.jpg</span><br><span class="line">	</span><br><span class="line">rewrite ^&#x2F;nmk0718&#x2F;index(.*) http:&#x2F;&#x2F;nmk0718.com&#x2F;error.jpg;</span><br><span class="line">	</span><br><span class="line">#转发 域名&#x2F;nmk0718&#x2F;index后字符跟systemId和&amp;shops匹配的链接 到error.jpg(因nginx不支持and故使用set参数的方式进行转发)</span><br><span class="line">	</span><br><span class="line">location ^~&#x2F;nmk0718&#x2F;index &#123;</span><br><span class="line">	        </span><br><span class="line">	set $foo &quot;&quot;;</span><br><span class="line">	if ($args ~* &quot;systemId&#x3D;202006117621654047&quot;) &#123;</span><br><span class="line">		set $foo &quot;$&#123;foo&#125;1&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	if ($args ~* &quot;&amp;shops&#x3D;102&quot;) &#123;</span><br><span class="line">		set $foo &quot;$&#123;foo&#125;1&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	if ($foo ~* &quot;11&quot;) &#123;</span><br><span class="line">	rewrite  &#x2F;nmk0718&#x2F;index    http:&#x2F;&#x2F;nmk0718.com&#x2F;error.jpg;</span><br><span class="line">	&#125;</span><br><span class="line">	root   html;</span><br><span class="line">	#定义首页索引文件的名称</span><br><span class="line">	index  index.html index.htm index.jsp;</span><br><span class="line">	#定义后端负载服务器组</span><br><span class="line">	proxy_pass http:&#x2F;&#x2F;nmk&#x2F;nmk0718&#x2F;index;</span><br><span class="line">	proxy_set_header   Host    $host;  </span><br><span class="line">	proxy_set_header   X-Real-IP   $remote_addr;  </span><br><span class="line">	proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="nginx转发物理机-容器流量10-1"><a href="#nginx转发物理机-容器流量10-1" class="headerlink" title="nginx转发物理机:容器流量10:1"></a>nginx转发物理机:容器流量10:1</h4><p>转发思路:user&gt;master-nginx&gt;upstream&gt;slave-nginx或ingress</p>
<p>最后效果:用户访问域名,域名进入nginx的upstream 10次有1次进入ingress转发给容器,另外就此转发给slave-nginx,再转给物理机</p>
<p>master-nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#物理机双节点</span><br><span class="line">upstream nmk&#123;</span><br><span class="line">        server 172.17.53.153:19151;</span><br><span class="line">	    server 172.17.53.154:19151;</span><br><span class="line">    &#125;</span><br><span class="line"> 改为</span><br><span class="line">#148为slave-nginx的ip,172为ingress的ip</span><br><span class="line">upstream nmkhttp &#123;</span><br><span class="line">        server 172.17.53.148:80 weight&#x3D;10 fail_timeout&#x3D;10;</span><br><span class="line">        server 172.17.53.172:80 weight&#x3D;1 fail_timeout&#x3D;10;</span><br><span class="line">&#125;</span><br><span class="line">upstream nmkhttps &#123;</span><br><span class="line">        server 172.17.53.148:443 weight&#x3D;10 fail_timeout&#x3D;10;</span><br><span class="line">        server 172.17.53.172:443 weight&#x3D;1 fail_timeout&#x3D;10;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80 default;</span><br><span class="line">		server_name  www.nmk0718.com</span><br><span class="line">	</span><br><span class="line">location &#x2F;nmk &#123;</span><br><span class="line">			root   html;</span><br><span class="line">			#定义首页索引文件的名称</span><br><span class="line">			index  index.html index.htm index.jsp;</span><br><span class="line">			#定义后端负载服务器组</span><br><span class="line">			proxy_pass http:&#x2F;&#x2F;nmkhttp;</span><br><span class="line">			proxy_set_header   Host   $host:$server_port;  </span><br><span class="line">			proxy_set_header   X-Real-IP   $remote_addr;  </span><br><span class="line">			proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; </span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">            listen 443 ssl;</span><br><span class="line">	        listen 8443 ssl;</span><br><span class="line">            server_name www.nmk0718.com</span><br><span class="line"></span><br><span class="line">location &#x2F;nmk &#123;</span><br><span class="line">			root   html;</span><br><span class="line">			#定义首页索引文件的名称</span><br><span class="line">			index  index.html index.htm index.jsp;</span><br><span class="line">			#定义后端负载服务器组</span><br><span class="line">			proxy_pass https:&#x2F;&#x2F;nmkhttps;</span><br><span class="line">			proxy_set_header   Host   $host:$server_port;  </span><br><span class="line">			proxy_set_header   X-Real-IP   $remote_addr;  </span><br><span class="line">			proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>slave-nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">upstream nmk&#123;</span><br><span class="line">        server 172.17.53.153:19151;</span><br><span class="line">	    server 172.17.53.154:19151;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80 default;</span><br><span class="line">		server_name  www.nmk0718.com</span><br><span class="line">	</span><br><span class="line">location &#x2F;nmk &#123;</span><br><span class="line">			root   html;</span><br><span class="line">			#定义首页索引文件的名称</span><br><span class="line">			index  index.html index.htm index.jsp;</span><br><span class="line">			#定义后端负载服务器组</span><br><span class="line">			proxy_pass http:&#x2F;&#x2F;nmk;</span><br><span class="line">			proxy_set_header   Host   $host:$server_port;  </span><br><span class="line">			proxy_set_header   X-Real-IP   $remote_addr;  </span><br><span class="line">			proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; </span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>nmk</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://nmk0718.github.io/2020/07/16/nginx/">http://nmk0718.github.io/2020/07/16/nginx/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2020 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/nginx/"># nginx</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/07/30/elasticsearch/">elasticsearch</a>
            
            
            <a class="next" rel="next" href="/2020/07/01/Rocketchat/">Rocketchat</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© nmk | Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span>
	</div>
</footer>

    </div>
</body>
</html>

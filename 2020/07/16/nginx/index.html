<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>nginx | K&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">nimingkun&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">nimingkun&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">nginx</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">nmk</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">2020-7-16&nbsp;&nbsp;16:47:00</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/deployment/">deployment</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>NginxåŠŸèƒ½ä¸°å¯Œ,å¯ä½œä¸ºHTTPæœåŠ¡å™¨,ä¹Ÿå¯ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨,é‚®ä»¶æœåŠ¡å™¨ã€‚æ”¯æŒFastCGIã€SSLã€Virtual Hostã€URL Rewriteã€Gzipç­‰åŠŸèƒ½ã€‚å¹¶ä¸”æ”¯æŒå¾ˆå¤šç¬¬ä¸‰æ–¹çš„æ¨¡å—æ‰©å±•ã€‚</p>
<h4 id="Nginxå¸¸ç”¨åŠŸèƒ½"><a href="#Nginxå¸¸ç”¨åŠŸèƒ½" class="headerlink" title="Nginxå¸¸ç”¨åŠŸèƒ½"></a>Nginxå¸¸ç”¨åŠŸèƒ½</h4><p>Nginxåœ¨åšåå‘ä»£ç†æ—¶,æä¾›æ€§èƒ½ç¨³å®š,å¹¶ä¸”èƒ½å¤Ÿæä¾›é…ç½®çµæ´»çš„è½¬å‘åŠŸèƒ½ã€‚Nginxå¯ä»¥æ ¹æ®ä¸åŒçš„æ­£åˆ™åŒ¹é…,é‡‡å–ä¸åŒçš„è½¬å‘ç­–ç•¥,æ¯”å¦‚å›¾ç‰‡æ–‡ä»¶ç»“å°¾çš„èµ°æ–‡ä»¶æœåŠ¡å™¨,åŠ¨æ€é¡µé¢èµ°webæœåŠ¡å™¨ã€‚å¹¶ä¸”Nginxå¯¹è¿”å›ç»“æœè¿›è¡Œé”™è¯¯é¡µè·³è½¬,å¼‚å¸¸åˆ¤æ–­ç­‰ã€‚å¦‚æœè¢«åˆ†å‘çš„æœåŠ¡å™¨å­˜åœ¨å¼‚å¸¸,ä»–å¯ä»¥å°†è¯·æ±‚é‡æ–°è½¬å‘ç»™å¦å¤–ä¸€å°æœåŠ¡å™¨,ç„¶åè‡ªåŠ¨å»é™¤å¼‚å¸¸æœåŠ¡å™¨ã€‚</p>
<h4 id="æ­£å‘ä»£ç†å’Œåå‘ä»£ç†"><a href="#æ­£å‘ä»£ç†å’Œåå‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†å’Œåå‘ä»£ç†"></a>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†</h4><p>åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰å¯¹åº”çš„æ˜¯æ­£å‘ä»£ç†ï¼ˆForward Proxyï¼‰,ä»–ä»¬çš„åŒºåˆ«ï¼š<br>æ­£å‘ä»£ç†ï¼š ä¸€èˆ¬çš„è®¿é—®æµç¨‹æ˜¯å®¢æˆ·ç«¯ç›´æ¥å‘ç›®æ ‡æœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶è·å–å†…å®¹,ä½¿ç”¨æ­£å‘ä»£ç†å,å®¢æˆ·ç«¯æ”¹ä¸ºå‘ä»£ç†æœåŠ¡å™¨å‘é€è¯·æ±‚,å¹¶æŒ‡å®šç›®æ ‡æœåŠ¡å™¨ï¼ˆåŸå§‹æœåŠ¡å™¨ï¼‰,ç„¶åç”±ä»£ç†æœåŠ¡å™¨å’ŒåŸå§‹æœåŠ¡å™¨é€šä¿¡,è½¬äº¤è¯·æ±‚å¹¶è·å¾—çš„å†…å®¹,å†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ­£å‘ä»£ç†éšè—äº†çœŸå®çš„å®¢æˆ·ç«¯,ä¸ºå®¢æˆ·ç«¯æ”¶å‘è¯·æ±‚,ä½¿çœŸå®å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨ä¸å¯è§ï¼›<br>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ ğŸŒ°,ä½ çš„æµè§ˆå™¨æ— æ³•ç›´æ¥è®¿é—®è°·å“¥,è¿™æ—¶å€™å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ¥å¸®åŠ©ä½ è®¿é—®è°·å“¥,é‚£ä¹ˆè¿™ä¸ªæœåŠ¡å™¨å°±å«æ­£å‘ä»£ç†ã€‚<br>åå‘ä»£ç†ï¼š ä¸ä¸€èˆ¬è®¿é—®æµç¨‹ç›¸æ¯”,ä½¿ç”¨åå‘ä»£ç†å,ç›´æ¥æ”¶åˆ°è¯·æ±‚çš„æœåŠ¡å™¨æ˜¯ä»£ç†æœåŠ¡å™¨,ç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸ŠçœŸæ­£è¿›è¡Œå¤„ç†çš„æœåŠ¡å™¨,å¾—åˆ°çš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚åå‘ä»£ç†éšè—äº†çœŸå®çš„æœåŠ¡å™¨,ä¸ºæœåŠ¡å™¨æ”¶å‘è¯·æ±‚,ä½¿çœŸå®æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯ä¸å¯è§ã€‚ä¸€èˆ¬åœ¨å¤„ç†è·¨åŸŸè¯·æ±‚çš„æ—¶å€™æ¯”è¾ƒå¸¸ç”¨ã€‚ç°åœ¨åŸºæœ¬ä¸Šæ‰€æœ‰çš„å¤§å‹ç½‘ç«™éƒ½è®¾ç½®äº†åå‘ä»£ç†ã€‚<br>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ ğŸŒ°,å»é¥­åº—åƒé¥­,å¯ä»¥ç‚¹å·èœã€ç²¤èœã€æ±Ÿæµ™èœ,é¥­åº—ä¹Ÿåˆ†åˆ«æœ‰ä¸‰ä¸ªèœç³»çš„å¨å¸ˆ ğŸ‘¨â€ğŸ³,ä½†æ˜¯ä½ ä½œä¸ºé¡¾å®¢ä¸ç”¨ç®¡å“ªä¸ªå¨å¸ˆç»™ä½ åšçš„èœ,åªç”¨ç‚¹èœå³å¯,å°äºŒå°†ä½ èœå•ä¸­çš„èœåˆ†é…ç»™ä¸åŒçš„å¨å¸ˆæ¥å…·ä½“å¤„ç†,é‚£ä¹ˆè¿™ä¸ªå°äºŒå°±æ˜¯åå‘ä»£ç†æœåŠ¡å™¨ã€‚<br>ç®€å•çš„è¯´,ä¸€èˆ¬ç»™å®¢æˆ·ç«¯åšä»£ç†çš„éƒ½æ˜¯æ­£å‘ä»£ç†,ç»™æœåŠ¡å™¨åšä»£ç†çš„å°±æ˜¯åå‘ä»£ç†ã€‚</p>
<p><img src="http://showdoc.gzlplink.com/server/../Public/Uploads/2020-07-06/5f0297f17c48c.png" alt=""></p>
<h4 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h4><p>è¯·æ±‚çˆ†å‘å¼å¢é•¿çš„æƒ…å†µä¸‹,å•ä¸ªæœºå™¨æ€§èƒ½å†å¼ºåŠ²ä¹Ÿæ— æ³•æ»¡è¶³è¦æ±‚äº†,è¿™ä¸ªæ—¶å€™é›†ç¾¤çš„æ¦‚å¿µäº§ç”Ÿäº†,å•ä¸ªæœåŠ¡å™¨è§£å†³ä¸äº†çš„é—®é¢˜,å¯ä»¥ä½¿ç”¨å¤šä¸ªæœåŠ¡å™¨,ç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Š,å°†è´Ÿè½½åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨,è¿™å°±æ˜¯è´Ÿè½½å‡è¡¡,æ ¸å¿ƒæ˜¯ã€Œåˆ†æ‘Šå‹åŠ›ã€ã€‚Nginx å®ç°è´Ÿè½½å‡è¡¡,ä¸€èˆ¬æ¥è¯´æŒ‡çš„æ˜¯å°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨é›†ç¾¤ã€‚<br>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ ğŸŒ°,æ™šé«˜å³°ä¹˜ååœ°é“çš„æ—¶å€™,å…¥ç«™å£ç»å¸¸ä¼šæœ‰åœ°é“å·¥ä½œäººå‘˜å¤§å–‡å­â€œè¯·èµ° B å£,B å£äººå°‘è½¦ç©ºâ€¦.â€,è¿™ä¸ªå·¥ä½œäººå‘˜çš„ä½œç”¨å°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚<br><img src="http://showdoc.gzlplink.com/server/../Public/Uploads/2020-07-06/5f02987e7922a.png" alt=""></p>
<h4 id="åŠ¨é™åˆ†ç¦»"><a href="#åŠ¨é™åˆ†ç¦»" class="headerlink" title="åŠ¨é™åˆ†ç¦»"></a>åŠ¨é™åˆ†ç¦»</h4><p>ä¸ºäº†åŠ å¿«ç½‘ç«™çš„è§£æé€Ÿåº¦,å¯ä»¥æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç”±ä¸åŒçš„æœåŠ¡å™¨æ¥è§£æ,åŠ å¿«è§£æé€Ÿåº¦,é™ä½åŸæ¥å•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ã€‚<br><img src="http://showdoc.gzlplink.com/server/../Public/Uploads/2020-07-06/5f0298e628adb.png" alt=""><br>ä¸€èˆ¬æ¥è¯´,éƒ½éœ€è¦å°†åŠ¨æ€èµ„æºå’Œé™æ€èµ„æºåˆ†å¼€,ç”±äº Nginx çš„é«˜å¹¶å‘å’Œé™æ€èµ„æºç¼“å­˜ç­‰ç‰¹æ€§,ç»å¸¸å°†é™æ€èµ„æºéƒ¨ç½²åœ¨ Nginx ä¸Šã€‚å¦‚æœè¯·æ±‚çš„æ˜¯é™æ€èµ„æº,ç›´æ¥åˆ°é™æ€èµ„æºç›®å½•è·å–èµ„æº,å¦‚æœæ˜¯åŠ¨æ€èµ„æºçš„è¯·æ±‚,åˆ™åˆ©ç”¨åå‘ä»£ç†çš„åŸç†,æŠŠè¯·æ±‚è½¬å‘ç»™å¯¹åº”åå°åº”ç”¨å»å¤„ç†,ä»è€Œå®ç°åŠ¨é™åˆ†ç¦»ã€‚<br>ä½¿ç”¨å‰åç«¯åˆ†ç¦»å,å¯ä»¥å¾ˆå¤§ç¨‹åº¦æå‡é™æ€èµ„æºçš„è®¿é—®é€Ÿåº¦,å³ä½¿åŠ¨æ€æœåŠ¡ä¸å¯ç”¨,é™æ€èµ„æºçš„è®¿é—®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚</p>
<h4 id="æ“ä½œå‘½ä»¤"><a href="#æ“ä½œå‘½ä»¤" class="headerlink" title="æ“ä½œå‘½ä»¤"></a>æ“ä½œå‘½ä»¤</h4><h5 id="windowsä¸‹nginxå‘½ä»¤"><a href="#windowsä¸‹nginxå‘½ä»¤" class="headerlink" title="windowsä¸‹nginxå‘½ä»¤"></a>windowsä¸‹nginxå‘½ä»¤</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#å¯åŠ¨nginx</span><br><span class="line">åœ¨nginxå®‰è£…ç›®å½•ä¸‹</span><br><span class="line">start nginx.exe</span><br><span class="line"></span><br><span class="line">#ä¸åœæœåŠ¡åŠ è½½é…ç½®</span><br><span class="line">åœ¨nginxå®‰è£…ç›®å½•ä¸‹</span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line">#nginxå‘½ä»¤å‚æ•°</span><br><span class="line">-c &lt;&#x2F;path&#x2F;to&#x2F;config&gt; ä¸º Nginx æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶,æ¥ä»£æ›¿ç¼ºçœçš„ã€‚</span><br><span class="line">-t å¦‚éœ€æ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•çš„æ­£ç¡®æ€§</span><br><span class="line">-v æ˜¾ç¤º nginx çš„ç‰ˆæœ¬</span><br><span class="line">-V æ˜¾ç¤º nginx çš„ç‰ˆæœ¬,ç¼–è¯‘å™¨ç‰ˆæœ¬å’Œé…ç½®å‚æ•°(å¯æŸ¥çœ‹nginxä½¿ç”¨çš„æ¨¡å—)ã€‚</span><br><span class="line">-s reload  # å‘ä¸»è¿›ç¨‹å‘é€ä¿¡å·,é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span><br><span class="line">-s reopen	 # é‡å¯ Nginx</span><br><span class="line">-s stop    # å¿«é€Ÿå…³é—­</span><br><span class="line">-s quit    # ç­‰å¾…å·¥ä½œè¿›ç¨‹å¤„ç†å®Œæˆåå…³é—­</span><br><span class="line">nginx -hå¯æŸ¥çœ‹å®Œæ•´å‘½ä»¤</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹nginxè¿›ç¨‹</span><br><span class="line">tasklist &#x2F;fi &quot;imagename eq nginx.exe&quot;</span><br><span class="line"></span><br><span class="line">#å¼ºåˆ¶ç»“æŸæ‰€æœ‰nginxè¿›ç¨‹</span><br><span class="line">taskkill &#x2F;F &#x2F;IM nginx.exe</span><br></pre></td></tr></table></figure>
<h5 id="linuxä¸‹nginxå‘½ä»¤"><a href="#linuxä¸‹nginxå‘½ä»¤" class="headerlink" title="linuxä¸‹nginxå‘½ä»¤"></a>linuxä¸‹nginxå‘½ä»¤</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.æ‰‹åŠ¨ç¼–è¯‘nginx</span><br><span class="line">#å¯åŠ¨nginx</span><br><span class="line">åœ¨nginxå®‰è£…ç›®å½•ä¸‹</span><br><span class="line">.&#x2F;sbin&#x2F;nginx</span><br><span class="line">#ä¸åœæœåŠ¡åŠ è½½é…ç½®</span><br><span class="line">åœ¨nginxå®‰è£…ç›®å½•ä¸‹</span><br><span class="line">.&#x2F;sbin&#x2F;nginx -s reload</span><br><span class="line">å‘½ä»¤å‚æ•°å‡ä¸€è‡´,åªéœ€æŠŠwindowsçš„nginxæ”¹ä¸º.&#x2F;sbin&#x2F;nginxå³å¯</span><br><span class="line">#æŸ¥çœ‹nginxè¿›ç¨‹</span><br><span class="line">ps -ef|grep nginx</span><br><span class="line">#å¼ºåˆ¶ç»“æŸæ‰€æœ‰nginxè¿›ç¨‹</span><br><span class="line">killalll nginx</span><br><span class="line"></span><br><span class="line">2.yumå®‰è£…nginx</span><br><span class="line">#yumå®‰è£…nginx,é»˜è®¤å®‰è£…ç›®å½•ä¸º&#x2F;etc&#x2F;nginx.å¯å…¨å±€ä½¿ç”¨nginxå‘½ä»¤,æ— éœ€è¿›å…¥nginxå®‰è£…ç›®å½•</span><br></pre></td></tr></table></figure>
<h4 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h4><p>nginxé…ç½®æ–‡ä»¶åœ¨å®‰è£…ç›®å½•çš„nginx.confä¸­<br>nginx é…ç½®æ–‡ä»¶ä¸»è¦åˆ†æˆå››éƒ¨åˆ†ï¼šmainï¼ˆå…¨å±€è®¾ç½®ï¼‰ã€serverï¼ˆä¸»æœºè®¾ç½®ï¼‰ã€upstreamï¼ˆä¸Šæ¸¸æœåŠ¡å™¨è®¾ç½®,ä¸»è¦ä¸ºåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ç›¸å…³é…ç½®ï¼‰å’Œ locationï¼ˆURLåŒ¹é…ç‰¹å®šä½ç½®åçš„è®¾ç½®ï¼‰ã€‚main éƒ¨åˆ†è®¾ç½®çš„æŒ‡ä»¤å½±å“å…¶ä»–æ‰€æœ‰éƒ¨åˆ†çš„è®¾ç½®ï¼›server éƒ¨åˆ†çš„æŒ‡ä»¤ä¸»è¦ç”¨äºåˆ¶å®šè™šæ‹Ÿä¸»æœºåŸŸåã€IP å’Œç«¯å£å·ï¼›upstream çš„æŒ‡ä»¤ç”¨äºè®¾ç½®ä¸€ç³»åˆ—çš„åç«¯æœåŠ¡å™¨,è®¾ç½®åå‘ä»£ç†åŠåç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼›location éƒ¨åˆ†ç”¨äºåŒ¹é…ç½‘é¡µä½ç½®ï¼ˆæ¯”å¦‚,æ ¹ç›®å½•â€œ/â€,â€œ/imagesâ€,ç­‰ç­‰ï¼‰ã€‚ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼šserver ç»§æ‰¿ main,location ç»§æ‰¿ serverï¼›upstream æ—¢ä¸ä¼šç»§æ‰¿æŒ‡ä»¤ä¹Ÿä¸ä¼šè¢«ç»§æ‰¿ã€‚</p>
<p>é…ç½®æ–‡ä»¶çš„è¯­æ³•è§„åˆ™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.é…ç½®æ–‡ä»¶ç”±æŒ‡ä»¤ä¸æŒ‡ä»¤å—æ„æˆï¼›</span><br><span class="line">2.æ¯æ¡æŒ‡ä»¤ä»¥ ; åˆ†å·ç»“å°¾,æŒ‡ä»¤ä¸å‚æ•°é—´ä»¥ç©ºæ ¼ç¬¦å·åˆ†éš”ï¼›</span><br><span class="line">3.æŒ‡ä»¤å—ä»¥ &#123;&#125; å¤§æ‹¬å·å°†å¤šæ¡æŒ‡ä»¤ç»„ç»‡åœ¨ä¸€èµ·ï¼›</span><br><span class="line">4.include è¯­å¥å…è®¸ç»„åˆå¤šä¸ªé…ç½®æ–‡ä»¶ä»¥æå‡å¯ç»´æŠ¤æ€§ï¼›</span><br><span class="line">5.ä½¿ç”¨ # ç¬¦å·æ·»åŠ æ³¨é‡Š,æé«˜å¯è¯»æ€§ï¼›</span><br><span class="line">6.ä½¿ç”¨ $ ç¬¦å·ä½¿ç”¨å˜é‡ï¼›</span><br><span class="line">7.éƒ¨åˆ†æŒ‡ä»¤çš„å‚æ•°æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼›</span><br></pre></td></tr></table></figure>
<p>Nginx çš„å…¸å‹é…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">#å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„</span><br><span class="line">user  nginx; </span><br><span class="line"></span><br><span class="line">#nginxè¿›ç¨‹æ•°,é€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹,[debug | info | notice | warn | error | crit]</span><br><span class="line">error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;  </span><br><span class="line">#error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log  notice;</span><br><span class="line">#error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log  info;</span><br><span class="line"></span><br><span class="line">#è¿›ç¨‹pidæ–‡ä»¶</span><br><span class="line">pid        &#x2F;run&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line">#æŒ‡å®šè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æè¿°ç¬¦ï¼šæ•°ç›®</span><br><span class="line">#å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™</span><br><span class="line">##è¿™ä¸ªæŒ‡ä»¤æ˜¯æŒ‡å½“ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®,ç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤,ä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€,æ‰€ä»¥æœ€å¥½ä¸ulimit -n çš„å€¼ä¿æŒä¸€è‡´ã€‚</span><br><span class="line">#è¿™æ˜¯å› ä¸ºnginxè°ƒåº¦æ—¶åˆ†é…è¯·æ±‚åˆ°è¿›ç¨‹å¹¶ä¸æ˜¯é‚£ä¹ˆçš„å‡è¡¡,æ‰€ä»¥å‡å¦‚å¡«å†™10240,æ€»å¹¶å‘é‡è¾¾åˆ°3-4ä¸‡æ—¶å°±æœ‰è¿›ç¨‹å¯èƒ½è¶…è¿‡10240äº†,è¿™æ—¶ä¼šè¿”å›502é”™è¯¯ã€‚</span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line">include &#x2F;etc&#x2F;nginx&#x2F;conf.modules.d&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">#å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°&#x3D;è¿æ¥æ•°+è¿›ç¨‹æ•°ï¼‰</span><br><span class="line">#æ ¹æ®ç¡¬ä»¶è°ƒæ•´,å’Œå‰é¢å·¥ä½œè¿›ç¨‹é…åˆèµ·æ¥ç”¨,å°½é‡å¤§,ä½†æ˜¯åˆ«æŠŠcupè·‘åˆ°100%å°±è¡Œã€‚</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#è®¾å®šhttpæœåŠ¡å™¨</span><br><span class="line">http &#123;</span><br><span class="line"> 	# æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨</span><br><span class="line">    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class="line">	# é»˜è®¤æ–‡ä»¶ç±»å‹</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line">	# Nginxè®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½®</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;</span><br><span class="line">	#å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼,sendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶,å¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º on,å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨,å¯è®¾ç½®ä¸ºoff,ä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI&#x2F;Oå¤„ç†é€Ÿ	åº¦,é™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹ æˆoffã€‚</span><br><span class="line">    sendfile        on;</span><br><span class="line">	#é˜²æ­¢ç½‘ç»œé˜»å¡</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line">	</span><br><span class="line">    #é•¿è¿æ¥è¶…æ—¶æ—¶é—´,å•ä½æ˜¯ç§’</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">	</span><br><span class="line">	#å¼€å¯gzipå‹ç¼©</span><br><span class="line">    #gzip  on;</span><br><span class="line">	</span><br><span class="line">	# åŠ è½½å­é…ç½®é¡¹</span><br><span class="line">    include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">    index   index.html index.htm;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">    	listen       80;       # é…ç½®ç›‘å¬çš„ç«¯å£</span><br><span class="line">    	server_name  localhost;    # é…ç½®çš„åŸŸå</span><br><span class="line">    	</span><br><span class="line">    	location &#x2F; &#123;</span><br><span class="line">    		root   &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;  # ç½‘ç«™æ ¹ç›®å½•</span><br><span class="line">    		index  index.html index.htm;   # é»˜è®¤é¦–é¡µæ–‡ä»¶</span><br><span class="line">    		deny 172.168.22.11;   # ç¦æ­¢è®¿é—®çš„ipåœ°å€,å¯ä»¥ä¸ºall</span><br><span class="line">    		allow 172.168.33.44ï¼› # å…è®¸è®¿é—®çš„ipåœ°å€,å¯ä»¥ä¸ºall</span><br><span class="line">    	&#125;</span><br><span class="line">    	</span><br><span class="line">    	error_page 500 502 503 504 &#x2F;50x.html;  # é»˜è®¤50xå¯¹åº”çš„è®¿é—®é¡µé¢</span><br><span class="line">    	error_page 400 404 error.html;   # åŒä¸Š</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>server å—å¯ä»¥åŒ…å«å¤šä¸ª location å—,location æŒ‡ä»¤ç”¨äºåŒ¹é… uri,è¯­æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location [ &#x3D; | ~ | ~* | ^~] uri &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŒ‡ä»¤åé¢ï¼š</p>
<p>1.<code>=</code>ç²¾ç¡®åŒ¹é…è·¯å¾„,ç”¨äºä¸å«æ­£åˆ™è¡¨è¾¾å¼çš„ uri å‰,å¦‚æœåŒ¹é…æˆåŠŸ,ä¸å†è¿›è¡Œåç»­çš„æŸ¥æ‰¾ï¼›<br>2.<code>^<del></code>ç”¨äºä¸å«æ­£åˆ™è¡¨è¾¾å¼çš„ uriï¼› å‰,è¡¨ç¤ºå¦‚æœè¯¥ç¬¦å·åé¢çš„å­—ç¬¦æ˜¯æœ€ä½³åŒ¹é…,é‡‡ç”¨è¯¥è§„åˆ™,ä¸å†è¿›è¡Œåç»­çš„æŸ¥æ‰¾ï¼›<br>3.<code></del></code> è¡¨ç¤ºç”¨è¯¥ç¬¦å·åé¢çš„æ­£åˆ™å»åŒ¹é…è·¯å¾„,åŒºåˆ†å¤§å°å†™ï¼›<br>4.<code>~*</code>è¡¨ç¤ºç”¨è¯¥ç¬¦å·åé¢çš„æ­£åˆ™å»åŒ¹é…è·¯å¾„,ä¸åŒºåˆ†å¤§å°å†™ã€‚è·Ÿ ~ ä¼˜å…ˆçº§éƒ½æ¯”è¾ƒä½,å¦‚æœ‰å¤šä¸ªlocationçš„æ­£åˆ™èƒ½åŒ¹é…çš„è¯,åˆ™ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœ€é•¿çš„é‚£ä¸ªï¼›</p>
<p>å¦‚æœ uri åŒ…å«æ­£åˆ™è¡¨è¾¾å¼,åˆ™å¿…é¡»è¦æœ‰ ~ æˆ– ~* æ ‡å¿—ã€‚</p>
<h4 id="å¸¸ç”¨çš„å…¨å±€å˜é‡"><a href="#å¸¸ç”¨çš„å…¨å±€å˜é‡" class="headerlink" title="å¸¸ç”¨çš„å…¨å±€å˜é‡"></a>å¸¸ç”¨çš„å…¨å±€å˜é‡</h4><table>
<thead>
<tr>
<th>å…¨å±€å˜é‡å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>$host</td>
<td>è¯·æ±‚ä¿¡æ¯ä¸­çš„ Host,å¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ Host è¡Œ,åˆ™ç­‰äºè®¾ç½®çš„æœåŠ¡å™¨å,ä¸åŒ…å«ç«¯å£</td>
</tr>
<tr>
<td>$request_method</td>
<td>å®¢æˆ·ç«¯è¯·æ±‚ç±»å‹,å¦‚ GETã€POST</td>
</tr>
<tr>
<td>$remote_addr</td>
<td>å®¢æˆ·ç«¯çš„ IP åœ°å€</td>
</tr>
<tr>
<td>$args</td>
<td>è¯·æ±‚ä¸­çš„å‚æ•°</td>
</tr>
<tr>
<td>$arg_PARAMETER</td>
<td>GET è¯·æ±‚ä¸­å˜é‡å PARAMETER å‚æ•°çš„å€¼,ä¾‹å¦‚ï¼š$http_user_agent(Uaer-Agent å€¼), $http_refererâ€¦</td>
</tr>
<tr>
<td>$content_length</td>
<td>è¯·æ±‚å¤´ä¸­çš„ Content-length å­—æ®µ</td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>å®¢æˆ·ç«¯agentä¿¡æ¯</td>
</tr>
<tr>
<td>$http_cookie</td>
<td>å®¢æˆ·ç«¯cookieä¿¡æ¯</td>
</tr>
<tr>
<td>$remote_addr</td>
<td>å®¢æˆ·ç«¯çš„IPåœ°å€</td>
</tr>
<tr>
<td>$remote_port</td>
<td>å®¢æˆ·ç«¯çš„ç«¯å£</td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>å®¢æˆ·ç«¯agentä¿¡æ¯</td>
</tr>
<tr>
<td>$server_protocol</td>
<td>è¯·æ±‚ä½¿ç”¨çš„åè®®,å¦‚ HTTP/1.0ã€HTTP/1.1</td>
</tr>
<tr>
<td>$server_addr</td>
<td>æœåŠ¡å™¨åœ°å€</td>
</tr>
<tr>
<td>$server_name</td>
<td>æœåŠ¡å™¨åç§°</td>
</tr>
<tr>
<td>$server_port</td>
<td>æœåŠ¡å™¨çš„ç«¯å£å·</td>
</tr>
<tr>
<td>$scheme</td>
<td>HTTP æ–¹æ³•ï¼ˆå¦‚http,httpsï¼‰</td>
</tr>
</tbody></table>
<h4 id="é…ç½®åå‘ä»£ç†"><a href="#é…ç½®åå‘ä»£ç†" class="headerlink" title="é…ç½®åå‘ä»£ç†"></a>é…ç½®åå‘ä»£ç†</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  server &#123;</span><br><span class="line">  linsten 80;</span><br><span class="line">  server_name: www.gzlplink.com;</span><br><span class="line">    </span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">    	proxy_pass http:&#x2F;&#x2F;myserver;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å°†è¯·æ±‚è½¬å‘åˆ°æœ¬æœºå¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Š,ä¹Ÿå¯ä»¥æ ¹æ®è®¿é—®çš„è·¯å¾„è·³è½¬åˆ°ä¸åŒç«¯å£çš„æœåŠ¡ä¸­ã€‚<br>æ¯”å¦‚æˆ‘ä»¬ç›‘å¬ 9001 ç«¯å£,ç„¶åæŠŠè®¿é—®ä¸åŒè·¯å¾„çš„è¯·æ±‚è¿›è¡Œåå‘ä»£ç†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">æŠŠè®¿é—® http:&#x2F;&#x2F;127.0.0.1:9001&#x2F;edu çš„è¯·æ±‚è½¬å‘åˆ° http:&#x2F;&#x2F;127.0.0.1:8080</span><br><span class="line">æŠŠè®¿é—® http:&#x2F;&#x2F;127.0.0.1:9001&#x2F;vod çš„è¯·æ±‚è½¬å‘åˆ° http:&#x2F;&#x2F;127.0.0.1:8081</span><br><span class="line"></span><br><span class="line">åœ¨ http æ¨¡å—ä¸‹å¢åŠ ä¸€ä¸ª server å—ï¼š</span><br><span class="line">server &#123;</span><br><span class="line">  listen 9001;</span><br><span class="line">  server_name www.gzlplink.com;</span><br><span class="line"></span><br><span class="line">  location ~ &#x2F;edu&#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:8080;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location ~ &#x2F;vod&#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:8081;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç åå‘ä»£ç†è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æŒ‡ä»¤,å¯ä»¥äº†è§£ä¸€ä¸‹ï¼š</p>
<p>1.proxy_set_headerï¼šåœ¨å°†å®¢æˆ·ç«¯è¯·æ±‚å‘é€ç»™åç«¯æœåŠ¡å™¨ä¹‹å‰,æ›´æ”¹æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¿¡æ¯ã€‚<br>2.proxy_connect_timeoutï¼šé…ç½®Nginxä¸åç«¯ä»£ç†æœåŠ¡å™¨å°è¯•å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚<br>3.proxy_read_timeoutï¼šé…ç½®Nginxå‘åç«¯æœåŠ¡å™¨ç»„å‘å‡ºreadè¯·æ±‚å,ç­‰å¾…ç›¸åº”çš„è¶…æ—¶æ—¶é—´ã€‚<br>4.proxy_send_timeoutï¼šé…ç½®Nginxå‘åç«¯æœåŠ¡å™¨ç»„å‘å‡ºwriteè¯·æ±‚å,ç­‰å¾…ç›¸åº”çš„è¶…æ—¶æ—¶é—´ã€‚<br>5.proxy_redirectï¼šç”¨äºä¿®æ”¹åç«¯æœåŠ¡å™¨è¿”å›çš„å“åº”å¤´ä¸­çš„Locationå’ŒRefreshã€‚</p>
<h4 id="é…ç½®è´Ÿè½½å‡è¡¡"><a href="#é…ç½®è´Ÿè½½å‡è¡¡" class="headerlink" title="é…ç½®è´Ÿè½½å‡è¡¡"></a>é…ç½®è´Ÿè½½å‡è¡¡</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  upstream myserver &#123;</span><br><span class="line">  	# ip_hash;  # ip_hash æ–¹å¼</span><br><span class="line">    # fair;   # fair æ–¹å¼</span><br><span class="line">    server 127.0.0.1:8081;  # è´Ÿè½½å‡è¡¡ç›®çš„æœåŠ¡åœ°å€</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line">    server 127.0.0.1:8082 weight&#x3D;10 backup;  # weight æ–¹å¼,ä¸å†™é»˜è®¤ä¸º 1</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  server &#123;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">    	proxy_pass http:&#x2F;&#x2F;myserver;</span><br><span class="line">      proxy_connect_timeout 10;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Nginx æä¾›äº†å¥½å‡ ç§åˆ†é…æ–¹å¼,é»˜è®¤ä¸ºè½®è¯¢,å°±æ˜¯è½®æµæ¥ã€‚æœ‰ä»¥ä¸‹å‡ ç§åˆ†é…æ–¹å¼ï¼š</p>
<p>1.è½®è¯¢,é»˜è®¤æ–¹å¼,æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨,å¦‚æœåç«¯æœåŠ¡æŒ‚äº†,èƒ½è‡ªåŠ¨å‰”é™¤ï¼›<br>2.weight,æƒé‡åˆ†é…,æŒ‡å®šè½®è¯¢å‡ ç‡,æƒé‡è¶Šé«˜,åœ¨è¢«è®¿é—®çš„æ¦‚ç‡è¶Šå¤§,ç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µï¼›<br>3.ip_hash,å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„ipè¿›è¡Œhashæ“ä½œ,ç„¶åæ ¹æ®hashç»“æœå°†åŒä¸€ä¸ªå®¢æˆ·ç«¯ipçš„è¯·æ±‚åˆ†å‘ç»™åŒä¸€å°æœåŠ¡å™¨è¿›è¡Œå¤„ç†,å¯ä»¥è§£å†³sessionä¸å…±äº«çš„é—®é¢˜ã€‚</p>
<p><img src="/image/iphash.png" alt="iphash"></p>
<p>4.fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰,æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´åˆ†é…,å“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…,ä¾èµ–ç¬¬ä¸‰æ–¹æ’ä»¶ nginx-upstream-fair,éœ€è¦å…ˆå®‰è£…ï¼›<br>5.backup,æºå¸¦backupä»£è¡¨æ­¤serverä¸ºå¤‡ç”¨,nginxåªæœ‰åœ¨è½¬å‘åˆ°ä¸»serverå‡ºç°é—®é¢˜,æ‰ä¼šåˆ‡æ¢åˆ°backupçš„server</p>
<p><strong>å¼€å¯gzip</strong></p>
<p>gzip æ˜¯ä¸€ç§å¸¸ç”¨çš„ç½‘é¡µå‹ç¼©æŠ€æœ¯,ä¼ è¾“çš„ç½‘é¡µç»è¿‡ gzip å‹ç¼©ä¹‹åå¤§å°é€šå¸¸å¯ä»¥å˜ä¸ºåŸæ¥çš„ä¸€åŠç”šè‡³æ›´å°ï¼ˆå®˜ç½‘åŸè¯ï¼‰,æ›´å°çš„ç½‘é¡µä½“ç§¯ä¹Ÿå°±æ„å‘³ç€å¸¦å®½çš„èŠ‚çº¦å’Œä¼ è¾“é€Ÿåº¦çš„æå‡,ç‰¹åˆ«æ˜¯å¯¹äºè®¿é—®é‡å·¨å¤§å¤§å‹ç½‘ç«™æ¥è¯´,æ¯ä¸€ä¸ªé™æ€èµ„æºä½“ç§¯çš„å‡å°,éƒ½ä¼šå¸¦æ¥å¯è§‚çš„æµé‡ä¸å¸¦å®½çš„èŠ‚çœã€‚</p>
<p>ä½¿ç”¨ gzip ä¸ä»…éœ€è¦ Nginx é…ç½®,æµè§ˆå™¨ç«¯ä¹Ÿéœ€è¦é…åˆ,éœ€è¦åœ¨è¯·æ±‚æ¶ˆæ¯å¤´ä¸­åŒ…å« Accept-Encoding: gzipï¼ˆIE5 ä¹‹åæ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ”¯æŒäº†,æ˜¯ç°ä»£æµè§ˆå™¨çš„é»˜è®¤è®¾ç½®ï¼‰ã€‚ä¸€èˆ¬åœ¨è¯·æ±‚ html å’Œ css ç­‰é™æ€èµ„æºçš„æ—¶å€™,æ”¯æŒçš„æµè§ˆå™¨åœ¨ request è¯·æ±‚é™æ€èµ„æºçš„æ—¶å€™,ä¼šåŠ ä¸Š Accept-Encoding: gzip è¿™ä¸ª header,è¡¨ç¤ºè‡ªå·±æ”¯æŒ gzip çš„å‹ç¼©æ–¹å¼,Nginx åœ¨æ‹¿åˆ°è¿™ä¸ªè¯·æ±‚çš„æ—¶å€™,å¦‚æœæœ‰ç›¸åº”é…ç½®,å°±ä¼šè¿”å›ç»è¿‡ gzip å‹ç¼©è¿‡çš„æ–‡ä»¶ç»™æµè§ˆå™¨,å¹¶åœ¨ response ç›¸åº”çš„æ—¶å€™åŠ ä¸Š content-encoding: gzip æ¥å‘Šè¯‰æµè§ˆå™¨è‡ªå·±é‡‡ç”¨çš„å‹ç¼©æ–¹å¼ï¼ˆå› ä¸ºæµè§ˆå™¨åœ¨ä¼ ç»™æœåŠ¡å™¨çš„æ—¶å€™ä¸€èˆ¬è¿˜å‘Šè¯‰æœåŠ¡å™¨è‡ªå·±æ”¯æŒå¥½å‡ ç§å‹ç¼©æ–¹å¼ï¼‰,æµè§ˆå™¨æ‹¿åˆ°å‹ç¼©çš„æ–‡ä»¶å,æ ¹æ®è‡ªå·±çš„è§£å‹æ–¹å¼è¿›è¡Œè§£æã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gzip on;</span><br><span class="line">gzip_types text&#x2F;plain text&#x2F;css application&#x2F;json application&#x2F;x-javascript text&#x2F;xml application&#x2F;xml application&#x2F;xml+rss text&#x2F;javascript;</span><br><span class="line">gzip_static on;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_vary on;</span><br><span class="line">gzip_comp_level 2;</span><br><span class="line">gzip_buffers 4 8k;</span><br><span class="line">gzip_min_length 1k;</span><br><span class="line">gzip_http_version 1.1;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>gzip_typesï¼šè¿›è¡Œå‹ç¼©çš„æ–‡ä»¶ç±»å‹ã€‚javascriptæœ‰å¤šç§å½¢å¼ã€‚å…¶ä¸­çš„å€¼å¯ä»¥åœ¨ mime.types æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚</p>
</li>
<li><p>gzip_staticï¼šé»˜è®¤ off,è¯¥æ¨¡å—å¯ç”¨å,Nginx é¦–å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯·æ±‚é™æ€æ–‡ä»¶çš„ gz ç»“å°¾çš„æ–‡ä»¶,å¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›è¯¥ .gz æ–‡ä»¶å†…å®¹ï¼›</p>
</li>
<li><p>gzip_proxiedï¼šé»˜è®¤ off,nginxåšä¸ºåå‘ä»£ç†æ—¶å¯ç”¨,ç”¨äºè®¾ç½®å¯ç”¨æˆ–ç¦ç”¨ä»ä»£ç†æœåŠ¡å™¨ä¸Šæ”¶åˆ°ç›¸åº”å†…å®¹ gzip å‹ç¼©ï¼›</p>
</li>
<li><p>gzip_varyï¼šç”¨äºåœ¨å“åº”æ¶ˆæ¯å¤´ä¸­æ·»åŠ  Varyï¼šAccept-Encoding,ä½¿ä»£ç†æœåŠ¡å™¨æ ¹æ®è¯·æ±‚å¤´ä¸­çš„ Accept-Encoding è¯†åˆ«æ˜¯å¦å¯ç”¨ gzip å‹ç¼©ï¼›</p>
</li>
<li><p>gzip_comp_levelï¼šgzip å‹ç¼©æ¯”,å‹ç¼©çº§åˆ«æ˜¯ 1-9,1 å‹ç¼©çº§åˆ«æœ€ä½,9 æœ€é«˜,æ•°å­—è¶Šå¤§å‹ç¼©çš„è¶Šå¥½,ä¹Ÿè¶Šå ç”¨CPUæ—¶é—´ã€‚ä¸€èˆ¬è®¾ç½®1å’Œ2ï¼›</p>
</li>
<li><p>gzip_buffersï¼šè·å–å¤šå°‘å†…å­˜ç”¨äºç¼“å­˜å‹ç¼©ç»“æœ,4 8k è¡¨ç¤ºä»¥ 8k*4 ä¸ºå•ä½è·å¾—ï¼›</p>
</li>
<li><p>gzip_min_lengthï¼šå¯ç”¨gzipå‹ç¼©çš„æœ€å°æ–‡ä»¶,å°äºè®¾ç½®å€¼çš„æ–‡ä»¶å°†ä¸ä¼šå‹ç¼©</p>
</li>
<li><p>gzip_http_versionï¼šé»˜è®¤ 1.1,å¯ç”¨ gzip æ‰€éœ€çš„ HTTP æœ€ä½ç‰ˆæœ¬ï¼›</p>
<p>è¿™ä¸ªé…ç½®å¯ä»¥æ’å…¥åˆ° http æ¨¡å—æ•´ä¸ªæœåŠ¡å™¨çš„é…ç½®é‡Œ,ä¹Ÿå¯ä»¥æ’å…¥åˆ°éœ€è¦ä½¿ç”¨çš„è™šæ‹Ÿä¸»æœºçš„ server æˆ–è€…ä¸‹é¢çš„ location æ¨¡å—ä¸­</p>
</li>
</ol>
<h4 id="é…ç½®-HTTPS"><a href="#é…ç½®-HTTPS" class="headerlink" title="é…ç½® HTTPS"></a>é…ç½® HTTPS</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 443 ssl http2 default_server;   # SSL è®¿é—®ç«¯å£å·ä¸º 443</span><br><span class="line">  server_name www.gzlplink.com;         # å¡«å†™ç»‘å®šè¯ä¹¦çš„åŸŸå</span><br><span class="line">  add_header backendIP $upstream_addr;   #æŠŠåç«¯å…·ä½“çš„ upstream è¿”å›ç»™å‰ç«¯ header</span><br><span class="line">  add_header backendCode $upstream_status;</span><br><span class="line"></span><br><span class="line">  ssl_certificate &#x2F;etc&#x2F;nginx&#x2F;https&#x2F;1_sherlocked93.club_bundle.crt;   # è¯ä¹¦æ–‡ä»¶åœ°å€</span><br><span class="line">  ssl_certificate_key &#x2F;etc&#x2F;nginx&#x2F;https&#x2F;2_sherlocked93.club.key;      # ç§é’¥æ–‡ä»¶åœ°å€</span><br><span class="line">  ssl_session_timeout 10m;</span><br><span class="line"></span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;      #è¯·æŒ‰ç…§ä»¥ä¸‹åè®®é…ç½®</span><br><span class="line">  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; </span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  </span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;</span><br><span class="line">    index        index.html index.htm;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ³›åŸŸåè½¬å‘"><a href="#æ³›åŸŸåè½¬å‘" class="headerlink" title="æ³›åŸŸåè½¬å‘"></a>æ³›åŸŸåè½¬å‘</h4><p>å’Œä¹‹å‰çš„åŠŸèƒ½ç±»ä¼¼,æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æŠŠäºŒçº§æˆ–è€…ä¸‰çº§åŸŸåé“¾æ¥é‡å†™åˆ°æˆ‘ä»¬å¸Œæœ›çš„è·¯å¾„,è®©åç«¯å°±å¯ä»¥æ ¹æ®è·¯ç”±è§£æä¸åŒçš„è§„åˆ™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">test1.gzlplink.com&#x2F;api?name&#x3D;a è‡ªåŠ¨è½¬å‘åˆ° 127.0.0.1:8080&#x2F;test1&#x2F;api?name&#x3D;aï¼›</span><br><span class="line">test2.gzlplink.com&#x2F;api?name&#x3D;a è‡ªåŠ¨è½¬å‘åˆ° 127.0.0.1:8080&#x2F;test2&#x2F;api?name&#x3D;a ï¼›</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name ~^([\w-]+)\.gzlplink\.com$;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_set_header        X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header        Host $http_host;</span><br><span class="line">        proxy_set_header        X-NginX-Proxy true;</span><br><span class="line">        proxy_pass              http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;$1$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ³›åŸŸåè·¯å¾„åˆ†ç¦»"><a href="#æ³›åŸŸåè·¯å¾„åˆ†ç¦»" class="headerlink" title="æ³›åŸŸåè·¯å¾„åˆ†ç¦»"></a>æ³›åŸŸåè·¯å¾„åˆ†ç¦»</h4><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„æŠ€èƒ½,ç»å¸¸æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦é…ç½®ä¸€äº›äºŒçº§æˆ–è€…ä¸‰çº§åŸŸå,å¸Œæœ›é€šè¿‡ Nginx è‡ªåŠ¨æŒ‡å‘å¯¹åº”ç›®å½•,æ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">test1.nmk0718.com è‡ªåŠ¨æŒ‡å‘ &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;test1 æœåŠ¡å™¨åœ°å€ï¼›</span><br><span class="line">test2.nmk0718.com è‡ªåŠ¨æŒ‡å‘ &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;test2 æœåŠ¡å™¨åœ°å€ï¼›</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  ~^([\w-]+)\.nmk0718\.com$;</span><br><span class="line"></span><br><span class="line">    root &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;$1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.ä¸ºäº†ä½¿ Nginx é…ç½®æ›´æ˜“äºç»´æŠ¤,å»ºè®®ä¸ºæ¯ä¸ªæœåŠ¡åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é…ç½®æ–‡ä»¶,å­˜å‚¨åœ¨ /etc/nginx/conf/website ç›®å½•,æ ¹æ®éœ€æ±‚å¯ä»¥åˆ›å»ºä»»æ„å¤šä¸ªç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚<br>2.ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶,å»ºè®®éµå¾ªä»¥ä¸‹å‘½åçº¦å®š &lt;æœåŠ¡&gt;.conf,æ¯”å¦‚åŸŸåæ˜¯www. nmk0718.comâ€,é‚£ä¹ˆä½ çš„é…ç½®æ–‡ä»¶çš„åº”è¯¥æ˜¯è¿™æ ·çš„./etc/nginx/conf/website/www. nmk0718.com.conf,å¦‚æœéƒ¨ç½²å¤šä¸ªæœåŠ¡,ä¹Ÿå¯ä»¥åœ¨æ–‡ä»¶åä¸­åŠ ä¸Š Nginx è½¬å‘çš„ç«¯å£å·ã€‚<br>3.Nginx æ—¥å¿—ç›¸å…³ç›®å½•,å†…ä»¥ åŸŸå.type.log å‘½åï¼ˆæ¯”å¦‚www. nmk0718.com.access.log å’Œ www. nmk0718.com.error.log ï¼‰ä½äº /var/log/nginx/ ç›®å½•ä¸­,ä¸ºæ¯ä¸ªç‹¬ç«‹çš„æœåŠ¡é…ç½®ä¸åŒçš„è®¿é—®æƒé™å’Œé”™è¯¯æ—¥å¿—æ–‡ä»¶,è¿™æ ·æŸ¥æ‰¾é”™è¯¯æ—¶,ä¼šæ›´åŠ æ–¹ä¾¿å¿«æ·ã€‚<br>æ—¥å¿—ç›¸å…³ç›®å½•,å†…ä»¥ åŸŸå.type.log å‘½åï¼ˆæ¯”å¦‚ www. nmk0718.com.access.log å’Œ www. nmk0718.com.error.log ï¼‰ä½äº /var/log/nginx/ ç›®å½•ä¸­,ä¸ºæ¯ä¸ªç‹¬ç«‹çš„æœåŠ¡é…ç½®ä¸åŒçš„è®¿é—®æƒé™å’Œé”™è¯¯æ—¥å¿—æ–‡ä»¶,è¿™æ ·æŸ¥æ‰¾é”™è¯¯æ—¶,ä¼šæ›´åŠ æ–¹ä¾¿å¿«æ·ã€‚</p>
<h4 id="nginxé‡å®šå‘"><a href="#nginxé‡å®šå‘" class="headerlink" title="nginxé‡å®šå‘"></a>nginxé‡å®šå‘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#è½¬å‘ åŸŸå&#x2F;nmk0718&#x2F;indexåçš„ä»»æ„å­—ç¬¦ åˆ°error.jpg</span><br><span class="line">	</span><br><span class="line">rewrite ^&#x2F;nmk0718&#x2F;index(.*) http:&#x2F;&#x2F;nmk0718.com&#x2F;error.jpg;</span><br><span class="line">	</span><br><span class="line">#è½¬å‘ åŸŸå&#x2F;nmk0718&#x2F;indexåå­—ç¬¦è·ŸsystemIdå’Œ&amp;shopsåŒ¹é…çš„é“¾æ¥ åˆ°error.jpg(å› nginxä¸æ”¯æŒandæ•…ä½¿ç”¨setå‚æ•°çš„æ–¹å¼è¿›è¡Œè½¬å‘)</span><br><span class="line">	</span><br><span class="line">location ^~&#x2F;nmk0718&#x2F;index &#123;</span><br><span class="line">	        </span><br><span class="line">	set $foo &quot;&quot;;</span><br><span class="line">	if ($args ~* &quot;systemId&#x3D;202006117621654047&quot;) &#123;</span><br><span class="line">		set $foo &quot;$&#123;foo&#125;1&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	if ($args ~* &quot;&amp;shops&#x3D;102&quot;) &#123;</span><br><span class="line">		set $foo &quot;$&#123;foo&#125;1&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	if ($foo ~* &quot;11&quot;) &#123;</span><br><span class="line">	rewrite  &#x2F;nmk0718&#x2F;index    http:&#x2F;&#x2F;nmk0718.com&#x2F;error.jpg;</span><br><span class="line">	&#125;</span><br><span class="line">	root   html;</span><br><span class="line">	#å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line">	index  index.html index.htm index.jsp;</span><br><span class="line">	#å®šä¹‰åç«¯è´Ÿè½½æœåŠ¡å™¨ç»„</span><br><span class="line">	proxy_pass http:&#x2F;&#x2F;nmk&#x2F;nmk0718&#x2F;index;</span><br><span class="line">	proxy_set_header   Host    $host;  </span><br><span class="line">	proxy_set_header   X-Real-IP   $remote_addr;  </span><br><span class="line">	proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="nginxè½¬å‘ç‰©ç†æœº-å®¹å™¨æµé‡10-1"><a href="#nginxè½¬å‘ç‰©ç†æœº-å®¹å™¨æµé‡10-1" class="headerlink" title="nginxè½¬å‘ç‰©ç†æœº:å®¹å™¨æµé‡10:1"></a>nginxè½¬å‘ç‰©ç†æœº:å®¹å™¨æµé‡10:1</h4><p>è½¬å‘æ€è·¯:user&gt;master-nginx&gt;upstream&gt;slave-nginxæˆ–ingress</p>
<p>æœ€åæ•ˆæœ:ç”¨æˆ·è®¿é—®åŸŸå,åŸŸåè¿›å…¥nginxçš„upstream 10æ¬¡æœ‰1æ¬¡è¿›å…¥ingressè½¬å‘ç»™å®¹å™¨,å¦å¤–å°±æ­¤è½¬å‘ç»™slave-nginx,å†è½¬ç»™ç‰©ç†æœº</p>
<p>master-nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#ç‰©ç†æœºåŒèŠ‚ç‚¹</span><br><span class="line">upstream nmk&#123;</span><br><span class="line">        server 172.17.53.153:19151;</span><br><span class="line">	    server 172.17.53.154:19151;</span><br><span class="line">    &#125;</span><br><span class="line"> æ”¹ä¸º</span><br><span class="line">#148ä¸ºslave-nginxçš„ip,172ä¸ºingressçš„ip</span><br><span class="line">upstream nmkhttp &#123;</span><br><span class="line">        server 172.17.53.148:80 weight&#x3D;10 fail_timeout&#x3D;10;</span><br><span class="line">        server 172.17.53.172:80 weight&#x3D;1 fail_timeout&#x3D;10;</span><br><span class="line">&#125;</span><br><span class="line">upstream nmkhttps &#123;</span><br><span class="line">        server 172.17.53.148:443 weight&#x3D;10 fail_timeout&#x3D;10;</span><br><span class="line">        server 172.17.53.172:443 weight&#x3D;1 fail_timeout&#x3D;10;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80 default;</span><br><span class="line">		server_name  www.nmk0718.com</span><br><span class="line">	</span><br><span class="line">location &#x2F;nmk &#123;</span><br><span class="line">			root   html;</span><br><span class="line">			#å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line">			index  index.html index.htm index.jsp;</span><br><span class="line">			#å®šä¹‰åç«¯è´Ÿè½½æœåŠ¡å™¨ç»„</span><br><span class="line">			proxy_pass http:&#x2F;&#x2F;nmkhttp;</span><br><span class="line">			proxy_set_header   Host   $host:$server_port;  </span><br><span class="line">			proxy_set_header   X-Real-IP   $remote_addr;  </span><br><span class="line">			proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; </span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">            listen 443 ssl;</span><br><span class="line">	        listen 8443 ssl;</span><br><span class="line">            server_name www.nmk0718.com</span><br><span class="line"></span><br><span class="line">location &#x2F;nmk &#123;</span><br><span class="line">			root   html;</span><br><span class="line">			#å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line">			index  index.html index.htm index.jsp;</span><br><span class="line">			#å®šä¹‰åç«¯è´Ÿè½½æœåŠ¡å™¨ç»„</span><br><span class="line">			proxy_pass https:&#x2F;&#x2F;nmkhttps;</span><br><span class="line">			proxy_set_header   Host   $host:$server_port;  </span><br><span class="line">			proxy_set_header   X-Real-IP   $remote_addr;  </span><br><span class="line">			proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>slave-nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">upstream nmk&#123;</span><br><span class="line">        server 172.17.53.153:19151;</span><br><span class="line">	    server 172.17.53.154:19151;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80 default;</span><br><span class="line">		server_name  www.nmk0718.com</span><br><span class="line">	</span><br><span class="line">location &#x2F;nmk &#123;</span><br><span class="line">			root   html;</span><br><span class="line">			#å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line">			index  index.html index.htm index.jsp;</span><br><span class="line">			#å®šä¹‰åç«¯è´Ÿè½½æœåŠ¡å™¨ç»„</span><br><span class="line">			proxy_pass http:&#x2F;&#x2F;nmk;</span><br><span class="line">			proxy_set_header   Host   $host:$server_port;  </span><br><span class="line">			proxy_set_header   X-Real-IP   $remote_addr;  </span><br><span class="line">			proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; </span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>nmk</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://nmk0718.github.io/2020/07/16/nginx/">http://nmk0718.github.io/2020/07/16/nginx/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2020 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/nginx/"># nginx</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/07/30/elasticsearch/">elasticsearch</a>
            
            
            <a class="next" rel="next" href="/2020/07/01/Rocketchat/">Rocketchat</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© nmk | Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span>
	</div>
</footer>

    </div>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>mysql | K&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">nimingkun&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">nimingkun&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">mysql</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">nmk</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">2020-4-9&nbsp;&nbsp;0:20:00</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/database/">database</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#此次安装为mysql5.7版本,使用yum install mysql默认安装为mariadb</span><br><span class="line"></span><br><span class="line">wget https:&#x2F;&#x2F;repo.mysql.com&#x2F;mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line">#下载rpm包</span><br><span class="line">rpm -ivh mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line">#安装rpm包</span><br><span class="line">yum repolist all | grep mysql </span><br><span class="line">#查看包版本</span><br><span class="line">yum-config-manager --disable mysql80-community</span><br><span class="line">#取消mysql80-community的默认安装</span><br><span class="line">yum-config-manager --enable mysql57-community</span><br><span class="line">#更改为mysql57-community默认安装版本</span><br><span class="line">#如不能使用使用yum-config-manager请使用yum -y install yum-utils</span><br><span class="line">yum install mysql-community-server</span><br><span class="line">yum -y install mysql-devel</span><br><span class="line">#安装完毕</span><br></pre></td></tr></table></figure>

<h3 id="mysql使用"><a href="#mysql使用" class="headerlink" title="mysql使用"></a>mysql使用</h3><p>mysql服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CentOS 7之前</span><br><span class="line">service mysqld start 			 ——启动mysql服务</span><br><span class="line">service mysqld stop              ——停止mysql服务</span><br><span class="line">service mysqld restart  		 ——重启mysql服务</span><br><span class="line">service mysqld status			 ——查看mysql服务</span><br><span class="line">CentOS 7.x开始，CentOS开始使用systemd服务来代替daemon</span><br><span class="line">systemctl start mysqld.service 	 ——启动mysql服务</span><br><span class="line">systemctl stop mysqld.service 	 ——停止mysql服务</span><br><span class="line">systemctl restart mysqld.service ——重启mysql服务</span><br><span class="line">systemctl status mysqld.service  ——查看mysql状态</span><br><span class="line">mysql -V --查看mysql版本</span><br></pre></td></tr></table></figure>

<p>连接数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">#本地登陆</span><br><span class="line"></span><br><span class="line">mysql -h主机地址 -P端口 -u用户名 －p用户密码</span><br><span class="line">#远程登陆</span><br><span class="line"></span><br><span class="line">grep &quot;temporary password&quot; &#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line">#获取临时密码</span><br></pre></td></tr></table></figure>

<p>修改默认密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER USER USER() IDENTIFIED BY &#39;nmk0718&#39;;</span><br><span class="line">#如需弱密码请使用一下命令</span><br><span class="line">mysql&gt; set global validate_password_policy&#x3D;LOW;</span><br><span class="line">mysql&gt; set global validate_password_length&#x3D;6;</span><br></pre></td></tr></table></figure>

<p>开启远程连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all privileges on *.* to &#39;root&#39;@&#39;%&#39; identified by &#39;nmk0718&#39;;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>

<p>退出mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; exit&#x2F;quit;</span><br></pre></td></tr></table></figure>

<p>忘记密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mysqld.service</span><br><span class="line">#停止服务</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;my.cnf</span><br><span class="line">#编辑配置文件在socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock下一行加入skip-grant-tables</span><br><span class="line">#作用为跳过密码验证</span><br><span class="line"></span><br><span class="line">systemctl start mysqld.service</span><br><span class="line">#启动服务</span><br><span class="line"></span><br><span class="line">mysql -u root</span><br><span class="line">mysql&gt;update mysql.user set authentication_string&#x3D;password(&#39;nmk0718&#39;) where user&#x3D;&#39;root&#39;;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; exit</span><br><span class="line">#进入mysql修改密码</span><br><span class="line"></span><br><span class="line">systemctl stop mysqld.service</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;my.cnf</span><br><span class="line">#删除加入的skip-grant-tables</span><br><span class="line"></span><br><span class="line">systemctl start mysqld.service</span><br></pre></td></tr></table></figure>

<h3 id="mysql常用命令"><a href="#mysql常用命令" class="headerlink" title="mysql常用命令"></a>mysql常用命令</h3><p>创建数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database &lt;数据库名&gt; default character set &lt;编码格式&gt; collate &lt;校验集&gt;;</span><br></pre></td></tr></table></figure>

<p>显示所有数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br></pre></td></tr></table></figure>

<p>删除数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop database &lt;数据库名&gt;;</span><br></pre></td></tr></table></figure>

<p>选择数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use &lt;数据库名&gt;;</span><br></pre></td></tr></table></figure>

<p>创建表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table &lt;表名&gt; (&lt;字段名1&gt; &lt;类型1&gt; [,..&lt;字段名n&gt; &lt;类型n&gt;]);</span><br></pre></td></tr></table></figure>

<p>显示表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br></pre></td></tr></table></figure>

<p>显示表结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc &lt;表名&gt;；或者show columns from 表名;</span><br></pre></td></tr></table></figure>

<p>删除表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop table &lt;表名&gt;；</span><br></pre></td></tr></table></figure>

<p>插入表数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into &lt;表名&gt; [( &lt;字段名1&gt;[,..&lt;字段名n &gt; ])] values ( 值1 )[, ( 值n )]</span><br></pre></td></tr></table></figure>

<p>查询表数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select &lt;目标列表表达式列表&gt; </span><br><span class="line">			 from &lt; 表名或视图名 &gt; </span><br><span class="line">			 where &lt; 条件 &gt; </span><br><span class="line">			 group by &lt;分组表达式&gt;</span><br><span class="line">			 having &lt;条件&gt;</span><br><span class="line">			 order by &lt;排序表达式&gt;[ASC|DESC]</span><br></pre></td></tr></table></figure>

<p>删除表数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from 表名 where 表达式;</span><br></pre></td></tr></table></figure>

<p>修改表数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update 表名 set 字段&#x3D;新值,… where 条件;</span><br></pre></td></tr></table></figure>

<p>修改表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; rename table 原表名 to 新表名;</span><br></pre></td></tr></table></figure>

<p>增加表字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table 表名 add 字段 类型 其他;</span><br></pre></td></tr></table></figure>

<p>修改字段类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table 表名 modify 字段 旧类型 新类型;</span><br></pre></td></tr></table></figure>

<p>删除字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table 表名 drop 字段;</span><br></pre></td></tr></table></figure>

<p>修改字段的注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table &#96;表名&#96; modify column &#96;id&#96; comment &#39;学号&#39;;</span><br></pre></td></tr></table></figure>

<p>加索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table 表名 add index 索引名 (字段名1[，字段名2 …]);</span><br></pre></td></tr></table></figure>

<p>加主关键字的索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table 表名 add primary key (字段名);</span><br></pre></td></tr></table></figure>

<p>加唯一限制条件的索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table 表名 add unique 索引名 (字段名);</span><br></pre></td></tr></table></figure>

<p>删除索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table 表名 drop index 索引名;</span><br></pre></td></tr></table></figure>

<p>备份数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#mysqldump 在windows下进行备份需要cmd的管理员身份</span><br><span class="line">mysqldump -h主机名(ip) -P端口 -u 用户名 -p密码 数据库名1 数据库名2 &gt; 文件名.sql</span><br></pre></td></tr></table></figure>

<p>备份数据库的某张表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h主机名(ip) -u 用户名 -p 数据库名 表1 表2 表3 &gt; 文件名.sql</span><br></pre></td></tr></table></figure>

<p>备份所有数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p --all-databases &gt; 文件名.sql</span><br></pre></td></tr></table></figure>

<p>还原数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p 数据库名 &lt; 文件名.sql</span><br></pre></td></tr></table></figure>

<p>删除数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop database 数据库名</span><br></pre></td></tr></table></figure>

<p>恢复数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#先创建同名数据库</span><br><span class="line">CREATE DATABASE 数据库名;</span><br><span class="line">use 数据库名;</span><br><span class="line">source 备份文件的路径 文件名.sql</span><br></pre></td></tr></table></figure>

<h3 id="mysql开启binlog"><a href="#mysql开启binlog" class="headerlink" title="mysql开启binlog"></a>mysql开启binlog</h3><p>查看binlog日志的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%log_bin%&#39;;</span><br><span class="line">+---------------------------------+-------+</span><br><span class="line">| Variable_name                   | Value |</span><br><span class="line">+---------------------------------+-------+</span><br><span class="line">| log_bin                         | OFF   |</span><br><span class="line">| log_bin_basename                |       |</span><br><span class="line">| log_bin_index                   |       |</span><br><span class="line">| log_bin_trust_function_creators | OFF   |</span><br><span class="line">| log_bin_use_v1_row_events       | OFF   |</span><br><span class="line">| sql_log_bin                     | ON    |</span><br><span class="line">+---------------------------------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line">得知 log_bin为OFF</span><br></pre></td></tr></table></figure>

<p>退出mysql,修改my.cnf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server-id&#x3D;1</span><br><span class="line">log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin</span><br><span class="line"># server-id表示单个结点的id，这里由于只有一个结点，所以可以把id随机指定为一个数，这里将id设置成1。若集群中有个	结点，则id不能相同</span><br><span class="line"># 第二句是指定binlog日志文件的名字为mysql-bin，以及其存储路径</span><br></pre></td></tr></table></figure>

<p>重启myql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<p>进入mysql,查看binlog日志的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  show variables like &#39;%log_bin%&#39;;</span><br><span class="line">+---------------------------------+--------------------------------+</span><br><span class="line">| Variable_name                   | Value                          |</span><br><span class="line">+---------------------------------+--------------------------------+</span><br><span class="line">| log_bin                         | ON                             |</span><br><span class="line">| log_bin_basename                | &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin       |</span><br><span class="line">| log_bin_index                   | &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin.index |</span><br><span class="line">| log_bin_trust_function_creators | OFF                            |</span><br><span class="line">| log_bin_use_v1_row_events       | OFF                            |</span><br><span class="line">| sql_log_bin                     | ON                             |</span><br><span class="line">+---------------------------------+--------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>MySQL数据库 Too many connections</strong><br>从官方文档知道Linux上面编译安装的mysql默认的连接为100个</p>
<p>文档：<a href="http://dev.mysql.com/doc/refman/5.0/en/too-many-connections.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.0/en/too-many-connections.html</a></p>
<p>mysql官方告诉我们需要修改max_connections的值,那么我们怎么去修改呢？有两种方法</p>
<p><strong>1、修改配置文件文件</strong></p>
<p>修改/etc/my.cnf这个文件，在[mysqld] 中新增max_connections=N，如果你没有这个文件请从编译源码中的support-files文件夹中复制你所需要的*.cnf文件为到 /etc/my.cnf。我使用的是my-medium.cnf,中型服务器配置。例如我的[mysqld]的内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]&#96; &#96;port &#x3D; 3306&#96; &#96;socket &#x3D; &#96;&#96;&#x2F;tmp&#x2F;mysql&#96;&#96;.sock&#96; &#96;skip-locking&#96; &#96;key_buffer &#x3D; 160M&#96; &#96;max_allowed_packet &#x3D; 1M&#96; &#96;table_cache &#x3D; 64&#96; &#96;sort_buffer_size &#x3D; 512K&#96; &#96;net_buffer_length &#x3D; 8K&#96; &#96;read_buffer_size &#x3D; 256K&#96; &#96;read_rnd_buffer_size &#x3D; 512K&#96; &#96;myisam_sort_buffer_size &#x3D; 8M&#96; &#96;max_connections&#x3D;1000</span><br></pre></td></tr></table></figure>

<p>由于对mysql还不是很熟悉，所以很多参数没有修改。哈哈。。</p>
<p><strong>2、非使用mysqld脚本自动启动的用户。</strong></p>
<p>修改MYSQLHOME/bin/mysqldsafe文件例如：/usr/local/mysql/bin/mysqldsafe这个文件grep−n‘maxconnection′</p>
<p>MYSQLHOME/bin/mysqldsafe文件例如：/usr/local/mysql/bin/mysqldsafe这个文件grep−n‘maxconnection′MYSQL_HOME/bin/mysqld_safe</p>
<p>修改对应行号的max_connections参数值</p>
<p><strong>3、服务器登录mysql ： mysql -u root -p</strong></p>
<p>百分之九十进不去，进不去的执行重启命令 ：/etc/init.d/mysql restart（centos系统）</p>
<p>此时重启mysql就能连接mysql了，如果还有时间，可以继续下一步，治病要治本</p>
<p>打开配置文件 添加一下配置 vi /etc/my.cnf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wait_timeout &#x3D; 600&#96; &#96;interactive_timeout &#x3D; 600</span><br></pre></td></tr></table></figure>

<p>再次重启mysql即可</p>
<p><strong>原理解答</strong></p>
<p>mysql 默认100 连接数，超过则连不上，实际工作的连接数远远没有100，大部分在sleep</p>
<p>所以要么增大连接数，要么杀掉无用连接，推荐后者。</p>
<p>使用Navicat工具连接&gt;服务器监控&gt;查看进程数,杀掉进程数到100以内即可</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>nmk</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://nmk0718.github.io/2020/04/09/mysql/">http://nmk0718.github.io/2020/04/09/mysql/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2020 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/database/"># database</a>
                    
                        <a href="/tag/mysql/"># mysql</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/04/14/Nexus/">nexus</a>
            
            
            <a class="next" rel="next" href="/2020/04/08/redis/">redis</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© nmk | Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span>
	</div>
</footer>

    </div>
</body>
</html>

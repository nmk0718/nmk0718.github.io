<!DOCTYPE html>
<html lang>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="kk">





<title>Process</title>



    <link rel="icon" href="/favicon.png">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    

<link rel="alternate" href="/atom.xml" title="kk's Blog" type="application/atom+xml">
</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Home</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/app">App</a>
                
                    <a class="menu-item" href="/moments">Moments</a>
                
                    <a class="menu-item" href="/map">Map</a>
                
                    <a class="menu-item" href="/game">Game</a>
                
                    <a class="menu-item" href="/media">Media</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Home</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/app">App</a>
                
                    <a class="menu-item" href="/moments">Moments</a>
                
                    <a class="menu-item" href="/map">Map</a>
                
                    <a class="menu-item" href="/game">Game</a>
                
                    <a class="menu-item" href="/media">Media</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Process</h1>
            
                <div class="post-meta">
                    

                    
                        <span class="post-time">
                        Date: <a href="#">2020-10-16&nbsp;&nbsp;11:35</a>
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><h4 id="windows下杀掉指定应用"><a href="#windows下杀掉指定应用" class="headerlink" title="windows下杀掉指定应用"></a>windows下杀掉指定应用</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">taskkill /im nginx.exe /f</span><br><span class="line">#/im  立即  /f   强制结束进程</span><br><span class="line">#任务管理器&gt;详细信息&gt;内存&gt;查看应用的pid</span><br></pre></td></tr></table></figure>

<h4 id="windows下杀掉指定端口的进程"><a href="#windows下杀掉指定端口的进程" class="headerlink" title="windows下杀掉指定端口的进程"></a>windows下杀掉指定端口的进程</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for /f &quot;tokens=5&quot; %%i in (&apos;netstat -aon ^| findstr &quot;:9091&quot;&apos;) do (set j=%%i)</span><br><span class="line">taskkill /t /f /pid %j% </span><br><span class="line">#netstat -aon | findstr &quot;:port&quot; 查找端口对应的pid</span><br><span class="line">#taskkill /t /f /pid 杀掉pid对应的进程</span><br></pre></td></tr></table></figure>

<h4 id="如有遇到删除文件-提示正在被使用"><a href="#如有遇到删除文件-提示正在被使用" class="headerlink" title="如有遇到删除文件,提示正在被使用"></a>如有遇到删除文件,提示正在被使用</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">任务管理器&gt;性能&gt;打开资源监视器&gt;CPU&gt;关联的句柄</span><br><span class="line">搜索需要删除的文件夹名称或文件名称</span><br></pre></td></tr></table></figure>

<h4 id="如有遇到某进程占用内存过大-并不清楚应用情况下"><a href="#如有遇到某进程占用内存过大-并不清楚应用情况下" class="headerlink" title="如有遇到某进程占用内存过大,并不清楚应用情况下"></a>如有遇到某进程占用内存过大,并不清楚应用情况下</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">任务管理器&gt;详细信息&gt;内存&gt;查看应用的pid</span><br><span class="line">任务管理器&gt;&gt;性能&gt;打开资源监视器&gt;概述&gt;磁盘&gt;按pid排序</span><br><span class="line">即可看到pid对应的启动文件和目录</span><br></pre></td></tr></table></figure>

<h4 id="如有遇到使用windows远程-不可复制粘贴情况"><a href="#如有遇到使用windows远程-不可复制粘贴情况" class="headerlink" title="如有遇到使用windows远程,不可复制粘贴情况"></a>如有遇到使用windows远程,不可复制粘贴情况</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">任务管理器&gt;用户&gt;nmk&gt;RDP剪贴板监视程序</span><br><span class="line">结束掉RDP,使用windows+R运行rdpclip.exe即可</span><br></pre></td></tr></table></figure>

<h4 id="如有遇到windows黑屏或任务栏不见等情况"><a href="#如有遇到windows黑屏或任务栏不见等情况" class="headerlink" title="如有遇到windows黑屏或任务栏不见等情况"></a>如有遇到windows黑屏或任务栏不见等情况</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">任务管理器&gt;用户&gt;nmk&gt;windows资源管理器</span><br><span class="line">结束掉windows资源管理器,使用windows+R运行explorer.exe即可</span><br></pre></td></tr></table></figure>

<h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><h4 id="linux下查看ip"><a href="#linux下查看ip" class="headerlink" title="linux下查看ip"></a>linux下查看ip</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ifconfig|grep 192|awk &apos;&#123;print $2&#125;&apos;</span><br><span class="line">curl ifconfig.me</span><br></pre></td></tr></table></figure>

<h4 id="linux下杀掉指定端口进程"><a href="#linux下杀掉指定端口进程" class="headerlink" title="linux下杀掉指定端口进程"></a>linux下杀掉指定端口进程</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">port=48094</span><br><span class="line">#根据端口号查询对应的pid</span><br><span class="line">pid=$(netstat -nlp | grep :$port | awk &apos;&#123;print $7&#125;&apos; | awk -F&quot;/&quot; &apos;&#123; print $1 &#125;&apos;);</span><br><span class="line"></span><br><span class="line">#杀掉对应的进程，如果pid不存在，则不执行</span><br><span class="line">if [  -n  &quot;$pid&quot;  ];  then</span><br><span class="line">    kill  -9  $pid;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h4 id="linux查看应用进程"><a href="#linux查看应用进程" class="headerlink" title="linux查看应用进程"></a>linux查看应用进程</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -ef|grep java</span><br><span class="line">#grep为过滤 java为启动的应用</span><br><span class="line">#输出结果java后的数字为pid,如需结束,使用kill -9 pid</span><br><span class="line">netstat -lntp</span><br><span class="line">#查看当前应用使用的端口和pid</span><br></pre></td></tr></table></figure>

<h4 id="linux查看文件有多少行"><a href="#linux查看文件有多少行" class="headerlink" title="linux查看文件有多少行"></a>linux查看文件有多少行</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wc -l filename		#输出filename的行数</span><br><span class="line">wc -c filename		#输出filename的字节数</span><br><span class="line">wc -m filename		#输出filename的字符数</span><br><span class="line">wc -w filename		#输出filename的字数</span><br></pre></td></tr></table></figure>

<h4 id="linux查找文件"><a href="#linux查找文件" class="headerlink" title="linux查找文件"></a>linux查找文件</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">在使用linux时，经常需要进行文件查找。其中查找的命令主要有find和grep。两个命令是有区别的。</span><br><span class="line">(1)find命令是根据文件的属性进行查找，如文件名，文件大小，所有者，所属组，是否为空，访问时间，修改时间等。 </span><br><span class="line">(2)grep是根据文件的内容进行查找，会对文件的每一行按照给定的模式(patter)进行匹配查找。</span><br><span class="line"></span><br><span class="line">　　一.find命令</span><br><span class="line"></span><br><span class="line">　　　　基本格式：find  path expression</span><br><span class="line"></span><br><span class="line">　　　　1.按照文件名查找</span><br><span class="line"></span><br><span class="line">　　　　(1)find / -name httpd.conf　　#在根目录下查找文件httpd.conf，表示在整个硬盘查找</span><br><span class="line">　　　　(2)find /etc -name httpd.conf　　#在/etc目录下文件httpd.conf</span><br><span class="line">　　　　(3)find /etc -name &apos;*srm*&apos;　　#使用通配符*(0或者任意多个)。表示在/etc目录下查找文件名中含有字符串‘srm’的文件</span><br><span class="line">　　　　(4)find . -name &apos;srm*&apos; 　　#表示当前目录下查找文件名开头是字符串‘srm’的文件</span><br><span class="line"></span><br><span class="line">　　　　2.按照文件特征查找 　　　　</span><br><span class="line"></span><br><span class="line">　　　　(1)find / -amin -10 　　# 查找在系统中最后10分钟访问的文件(access time)</span><br><span class="line">　　　　(2)find / -atime -2　　 # 查找在系统中最后48小时访问的文件</span><br><span class="line">　　　　(3)find / -empty 　　# 查找在系统中为空的文件或者文件夹</span><br><span class="line">　　　　(4)find / -group cat 　　# 查找在系统中属于 group为cat的文件</span><br><span class="line">　　　　(5)find / -mmin -5 　　# 查找在系统中最后5分钟里修改过的文件(modify time)</span><br><span class="line">　　　　(6)find / -mtime -1 　　#查找在系统中最后24小时里修改过的文件</span><br><span class="line">　　　　(7)find / -user fred 　　#查找在系统中属于fred这个用户的文件</span><br><span class="line">　　　　(8)find / -size +10000c　　#查找出大于10000000字节的文件(c:字节，w:双字，k:KB，M:MB，G:GB)</span><br><span class="line">　　　　(9)find / -size -1000k 　　#查找出小于1000KB的文件</span><br><span class="line"></span><br><span class="line">　　　　3.使用混合查找方式查找文件</span><br><span class="line"></span><br><span class="line">　　　　参数有： ！，-and(-a)，-or(-o)。</span><br><span class="line"></span><br><span class="line">　　　　(1)find /tmp -size +10000c -and -mtime +2 　　#在/tmp目录下查找大于10000字节并在最后2分钟内修改的文件</span><br><span class="line">   　　    (2)find / -user fred -or -user george 　　#在/目录下查找用户是fred或者george的文件文件</span><br><span class="line">   　　    (3)find /tmp ! -user panda　　#在/tmp目录中查找所有不属于panda用户的文件</span><br><span class="line">    　　  </span><br><span class="line"></span><br><span class="line">　　二、grep命令</span><br><span class="line"></span><br><span class="line">　　　  基本格式：find  expression</span><br><span class="line"></span><br><span class="line"> 　　　 1.主要参数</span><br><span class="line"></span><br><span class="line">　　　　[options]主要参数：</span><br><span class="line">　　　　－c：只输出匹配行的计数。</span><br><span class="line">　　　　－i：不区分大小写</span><br><span class="line">　　　　－h：查询多文件时不显示文件名。</span><br><span class="line">　　　　－l：查询多文件时只输出包含匹配字符的文件名。</span><br><span class="line">　　　　－n：显示匹配行及行号。</span><br><span class="line">　　　　－s：不显示不存在或无匹配文本的错误信息。</span><br><span class="line">　　　　－v：显示不包含匹配文本的所有行。</span><br><span class="line"></span><br><span class="line">　　　　pattern正则表达式主要参数：</span><br><span class="line">　　　　\： 忽略正则表达式中特殊字符的原有含义。</span><br><span class="line">　　　　^：匹配正则表达式的开始行。</span><br><span class="line">　　　　$: 匹配正则表达式的结束行。</span><br><span class="line">　　　　\&lt;：从匹配正则表达 式的行开始。</span><br><span class="line">　　　　\&gt;：到匹配正则表达式的行结束。</span><br><span class="line">　　　　[ ]：单个字符，如[A]即A符合要求 。</span><br><span class="line">　　　　[ - ]：范围，如[A-Z]，即A、B、C一直到Z都符合要求 。</span><br><span class="line">　　　　.：所有的单个字符。</span><br><span class="line"></span><br><span class="line">   * ：有字符，长度可以为0。</span><br><span class="line"></span><br><span class="line">　　　　2.实例　 </span><br><span class="line"></span><br><span class="line">　　(1)grep &apos;test&apos; d*　　#显示所有以d开头的文件中包含 test的行</span><br><span class="line">　　(2)grep ‘test’ aa bb cc 　　 #显示在aa，bb，cc文件中包含test的行</span><br><span class="line">　　(3)grep ‘[a-z]\&#123;5\&#125;’ aa 　　#显示所有包含每行字符串至少有5个连续小写字符的字符串的行</span><br><span class="line">　　(4)grep magic /usr/src　　#显示/usr/src目录下的文件(不含子目录)包含magic的行</span><br><span class="line">　　(5)grep -r magic /usr/src　　#显示/usr/src目录下的文件(包含子目录)包含magic的行</span><br><span class="line"></span><br><span class="line">　　(6)grep -w pattern files ：只匹配整个单词，而不是字符串的一部分(如匹配’magic’，而不是’magical’)，</span><br><span class="line"></span><br><span class="line">如果你想在当前目录下 查找&quot;hello,world!&quot;字符串,可以这样:</span><br><span class="line"></span><br><span class="line">grep -rn &quot;hello,world!&quot; *</span><br><span class="line"></span><br><span class="line">* : 表示当前目录所有文件，也可以是某个文件名</span><br><span class="line"></span><br><span class="line">-r 是递归查找（如果不加-r表示只查找当前目录，不会递归的查找子目录）</span><br><span class="line"></span><br><span class="line">-n 是显示行号</span><br><span class="line"></span><br><span class="line">-R 查找所有文件包含子目录</span><br><span class="line"></span><br><span class="line">-i 忽略大小写</span><br><span class="line"></span><br><span class="line">下面是一些有意思的命令行参数：</span><br><span class="line"></span><br><span class="line">grep -i pattern files ：不区分大小写地搜索。默认情况区分大小写， </span><br><span class="line"></span><br><span class="line">grep -l pattern files ：只列出匹配的文件名， </span><br><span class="line"></span><br><span class="line">grep -L pattern files ：列出不匹配的文件名， </span><br><span class="line"></span><br><span class="line">grep -w pattern files ：只匹配整个单词，而不是字符串的一部分（如匹配‘magic’，而不是‘magical’）， </span><br><span class="line"></span><br><span class="line">grep -C number pattern files ：匹配的上下文分别显示[number]行， </span><br><span class="line"></span><br><span class="line">grep pattern1 | pattern2 files ：显示匹配 pattern1 或 pattern2 的行， </span><br><span class="line"></span><br><span class="line">grep pattern1 files | grep pattern2 ：显示既匹配 pattern1 又匹配 pattern2 的行。</span><br></pre></td></tr></table></figure>

<h4 id="查看应用所占内存"><a href="#查看应用所占内存" class="headerlink" title="查看应用所占内存"></a>查看应用所占内存</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# ps -u postgres o pid,rss:8,cmd | awk &apos;NR&gt;1 &#123;A+=$2&#125; &#123;print&#125; END&#123;print &quot;Total RSS: &quot; A&#125;&apos;</span><br><span class="line">  PID      RSS CMD</span><br><span class="line"> 3314    47100 /usr/pgsql-12/bin/postmaster -D /home/pgsql12/data/</span><br><span class="line"> 3318      544 postgres: logger   </span><br><span class="line"> 3320    76952 postgres: checkpointer   </span><br><span class="line"> 3321    57716 postgres: background writer   </span><br><span class="line"> 3322    16980 postgres: walwriter   </span><br><span class="line"> 3323     1664 postgres: autovacuum launcher   </span><br><span class="line"> 3324     1248 postgres: stats collector   </span><br><span class="line"> 3325      920 postgres: logical replication launcher   </span><br><span class="line">34905    23572 postgres: dbuser qiyewechat 192.168.138.1(59622) idle</span><br><span class="line">39446     9936 postgres: dbuser qiyewechat 192.168.138.1(49408) idle</span><br><span class="line">39449    16132 postgres: dbuser qiyewechat 192.168.138.1(49412) idle</span><br><span class="line">42193    32336 postgres: dbuser ymall_test 192.168.138.1(52546) idle</span><br><span class="line">42194    15376 postgres: dbuser ymall_test 192.168.138.1(52547) idle</span><br><span class="line">42996     4492 postgres: dbuser ymall_test 192.168.138.1(54459) idle</span><br><span class="line">43002     8260 postgres: dbuser ymall 192.168.138.1(54498) idle</span><br><span class="line">43489     6604 postgres: dbuser ymall 192.168.138.1(55454) idle</span><br><span class="line">43490     6612 postgres: dbuser ymall 192.168.138.1(55461) idle</span><br><span class="line">43885     4496 postgres: dbuser ymall 192.168.138.1(56158) idle</span><br><span class="line">43886     4496 postgres: dbuser ymall 192.168.138.1(56160) idle</span><br><span class="line">43887    18624 postgres: dbuser ymall 192.168.138.1(56163) idle</span><br><span class="line">43888    25448 postgres: dbuser ymall 192.168.138.1(56165) idle</span><br><span class="line">43889    26704 postgres: dbuser ymall 192.168.138.1(56167) idle</span><br><span class="line">44302    10696 postgres: dbuser qiyewechat 192.168.138.1(57075) idle</span><br><span class="line">44369    14456 postgres: dbuser qiyewechat 192.168.138.1(57083) idle</span><br><span class="line">44370     6028 postgres: dbuser qiyewechat 192.168.138.1(57084) idle</span><br><span class="line">44478     4496 postgres: dbuser ymall_test 192.168.138.1(57323) idle</span><br><span class="line">45814     8460 postgres: dbuser qiyewechat 192.168.138.1(59407) idle</span><br><span class="line">45900    13064 postgres: dbuser qiyewechat 192.168.138.1(59474) idle</span><br><span class="line">45907     5776 postgres: dbuser qiyewechat 192.168.138.1(59514) idle</span><br><span class="line">45992     6344 postgres: dbuser ymall_test 192.168.138.1(59703) idle</span><br><span class="line">46565    17660 postgres: dbuser ymall 192.168.138.1(60717) idle</span><br><span class="line">46573    14536 postgres: dbuser ymall 192.168.138.1(60758) idle</span><br><span class="line">46574     6048 postgres: dbuser ymall 192.168.138.1(60759) idle</span><br><span class="line">47215     4504 postgres: dbuser ymall_test 192.168.138.1(61764) idle</span><br><span class="line">47879     9428 postgres: dbuser ymall_test 192.168.138.1(63113) idle</span><br><span class="line">47880    15380 postgres: dbuser ymall_test 192.168.138.1(63114) idle</span><br><span class="line">48631     4496 postgres: dbuser ymall_test 192.168.138.1(64278) idle</span><br><span class="line">49247     6076 postgres: dbuser postgres 192.168.138.1(65312) idle</span><br><span class="line">49890    18168 postgres: dbuser ymall 192.168.138.1(50169) idle</span><br><span class="line">49893    14576 postgres: dbuser ymall 192.168.138.1(50175) idle</span><br><span class="line">49894     5816 postgres: dbuser ymall 192.168.138.1(50176) idle</span><br><span class="line">50162     4492 postgres: dbuser ymall_test 192.168.138.1(50486) idle</span><br><span class="line">50710    10560 postgres: dbuser ymall 192.168.138.1(51809) idle</span><br><span class="line">50711    14512 postgres: dbuser ymall 192.168.138.1(51810) idle</span><br><span class="line">50717    14816 postgres: dbuser ymall 192.168.138.1(51826) idle</span><br><span class="line">50718     7660 postgres: dbuser ymall 192.168.138.1(51827) idle</span><br><span class="line">50719     5824 postgres: dbuser postgres 192.168.138.1(51828) idle</span><br><span class="line">50723     6064 postgres: dbuser ymall 192.168.138.1(51833) idle</span><br><span class="line">51657     4500 postgres: dbuser ymall_test 192.168.138.1(53646) idle</span><br><span class="line">53083     4504 postgres: dbuser ymall_test 192.168.138.1(56425) idle</span><br><span class="line">53091     8468 postgres: dbuser ymall 192.168.138.1(56449) idle</span><br><span class="line">53092    14500 postgres: dbuser ymall 192.168.138.1(56450) idle</span><br><span class="line">53093     6048 postgres: dbuser ymall 192.168.138.1(56451) idle</span><br><span class="line">62156     4228 postgres: dbuser ymall 192.168.138.1(57632) idle</span><br><span class="line">Total RSS: 698396</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@prod-ghospital ~]#  ps -u mysql o pid,rss:8,cmd | awk &apos;NR&gt;1 &#123;A+=$2&#125; &#123;print&#125; END&#123;print &quot;Total RSS: &quot; A&#125;&apos;</span><br><span class="line">  PID      RSS CMD</span><br><span class="line"> 3057  1496720 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">Total RSS: 1496720</span><br></pre></td></tr></table></figure>

<h4 id="检测页面的状态码查看项目存活"><a href="#检测页面的状态码查看项目存活" class="headerlink" title="检测页面的状态码查看项目存活"></a>检测页面的状态码查看项目存活</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@lepeng ~]# cat url.txt </span><br><span class="line">http://localhost:9980/front/test/aaaa2</span><br><span class="line"></span><br><span class="line">[root@lepeng ~]# cat checkurl.sh </span><br><span class="line">fileurl=&apos;/root/url.txt&apos;</span><br><span class="line">for chkurl in $(cat $&#123;fileurl&#125;)  # $&#123;&#125;忽略空格</span><br><span class="line">do</span><br><span class="line">    # -o 输出内容到/dev/null; -s 静默方式 ；-w 定义显示输出格式；&quot;%&#123;http_code&#125;&quot; 在最后被检索的 HTTP(S) 页中被找到的数字的代码</span><br><span class="line">    HTTP_CODE=`curl -o /dev/null -s --head -w &quot;%&#123;http_code&#125;&quot; &quot;$&#123;chkurl&#125;&quot;`</span><br><span class="line">    if [ $&#123;HTTP_CODE&#125; -ne 200 ]</span><br><span class="line">    then</span><br><span class="line">        port=9980</span><br><span class="line">        echo `date &quot;+%Y-%m-%d %H:%M:%S&quot;` 项目正在重启.....  &gt;&gt;check-result.txt</span><br><span class="line">        #根据端口号查询对应的pid</span><br><span class="line">        pid=$(netstat -nlp | grep :$port | awk &apos;&#123;print $7&#125;&apos; | awk -F&quot;/&quot; &apos;&#123; print $1 &#125;&apos;);</span><br><span class="line"></span><br><span class="line">        #杀掉对应的进程，如果pid不存在，则不执行</span><br><span class="line">        if [  -n  &quot;$pid&quot;  ];  then</span><br><span class="line">                kill  -9  $pid;</span><br><span class="line">        fi</span><br><span class="line">        cd /home/tomcat/lepeng_tomcat/tomcat-8.0.46-9980/bin/</span><br><span class="line">        ./startup.sh</span><br><span class="line">    else</span><br><span class="line">        echo -e  `date &quot;+%Y-%m-%d %H:%M:%S&quot;` 当前状态码为$&#123;HTTP_CODE&#125;: $chkurl  &gt;&gt;check-result.txt</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>加入定时任务</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*/5 * * * * sh /root/checkurl.sh</span><br><span class="line">#每5分钟执行一次检测脚本</span><br><span class="line">#例如项目要3分钟,定时任务要大于3分钟,否则会一直重启</span><br></pre></td></tr></table></figure>

<h4 id="服务一直kill不掉"><a href="#服务一直kill不掉" class="headerlink" title="服务一直kill不掉"></a>服务一直kill不掉</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@prodl bin]# ps -ef|grep runsv</span><br><span class="line">root      7808     1  0 21:11 ?        00:00:00 runsvdir -P /opt/gitlab/service log: vlogd: warning: unable to lock directory: /var/log/gitlab/grafana: temporary failure svlogd: fatal: no functional log directories. svlogd: warning: unable to lock directory: /var/log/gitlab/grafana: temporary failure svlogd: fatal: no functional log directories. svlogd: warning: unable to lock directory: /var/log/gitlab/grafana: temporary failure svlogd: fatal: no functional log directories. </span><br><span class="line">root      7811  7808  0 21:11 ?        00:00:00 runsv gitaly</span><br><span class="line">root      7812  7808  0 21:11 ?        00:00:00 runsv alertmanager</span><br><span class="line">root      7813  7808  0 21:11 ?        00:00:00 runsv sidekiq</span><br><span class="line">root      7814  7808  0 21:11 ?        00:00:00 runsv postgresql</span><br><span class="line">root      7815  7808  0 21:11 ?        00:00:00 runsv unicorn</span><br><span class="line">root      7816  7808  0 21:11 ?        00:00:00 runsv prometheus</span><br><span class="line">root      7818  7808  0 21:11 ?        00:00:00 runsv postgres-exporter</span><br><span class="line">root      7819  7808  0 21:11 ?        00:00:00 runsv logrotate</span><br><span class="line">root      7820  7808  0 21:11 ?        00:00:00 runsv node-exporter</span><br><span class="line">root      7821  7808  0 21:11 ?        00:00:00 runsv gitlab-exporter</span><br><span class="line">root      7822  7808  0 21:11 ?        00:00:00 runsv gitlab-workhorse</span><br><span class="line">root      8329  7808  0 21:23 ?        00:00:00 runsv grafana</span><br></pre></td></tr></table></figure>

<p>runsvdir -P /opt/gitlab/service log为主进程</p>
<p>这是一个runit service，kill -9 无法杀死。【runsvdir 进程杀死后又重新创建（杀不死）】</p>
<p>后来查看了官方文档中的说明后， 使用如下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@prod-ghospital bin]# systemctl stop gitlab-runsvdir</span><br><span class="line">[root@prod-ghospital bin]# ps -ef|grep runsv</span><br><span class="line">root     12453  6424  0 21:36 pts/0    00:00:00 grep --color=auto runsv</span><br><span class="line">[root@prod-ghospital bin]# netstat -lntp</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      4904/sendmail: acce </span><br><span class="line">tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      2081/nginx: master  </span><br><span class="line">tcp        0      0 127.0.0.1:20037         0.0.0.0:*               LISTEN      2534/java           </span><br><span class="line">tcp        0      0 0.0.0.0:6379            0.0.0.0:*               LISTEN      1350/redis-server * </span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      2081/nginx: master  </span><br><span class="line">tcp        0      0 0.0.0.0:8081            0.0.0.0:*               LISTEN      2534/java           </span><br><span class="line">tcp        0      0 0.0.0.0:81              0.0.0.0:*               LISTEN      2081/nginx: master  </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      2978/sshd           </span><br><span class="line">tcp6       0      0 127.0.0.1:9600          :::*                    LISTEN      18615/java          </span><br><span class="line">tcp6       0      0 :::9000                 :::*                    LISTEN      19159/java          </span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      2970/mysqld         </span><br><span class="line">tcp6       0      0 :::6379                 :::*                    LISTEN      1350/redis-server * </span><br><span class="line">tcp6       0      0 :::9200                 :::*                    LISTEN      20071/java          </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      2081/nginx: master  </span><br><span class="line">tcp6       0      0 :::9300                 :::*                    LISTEN      19159/java          </span><br><span class="line">tcp6       0      0 :::9302                 :::*                    LISTEN      20071/java</span><br></pre></td></tr></table></figure>

<p>系统负载大于等于4并且cpu&gt;200% 重启程序</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">#获取5分钟系统负载</span><br><span class="line">sys_load=`/bin/cat /proc/loadavg | awk &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">#获取pot进程pid</span><br><span class="line">pot=$(netstat -nlp | grep 10010 | awk &apos;&#123;print $7&#125;&apos; | awk -F&quot;/&quot; &apos;&#123; print $1 &#125;&apos;);</span><br><span class="line">#获取shop进程pid</span><br><span class="line">shop=$(netstat -nlp | grep 9980 | awk &apos;&#123;print $7&#125;&apos; | awk -F&quot;/&quot; &apos;&#123; print $1 &#125;&apos;);</span><br><span class="line"></span><br><span class="line">#如果系统负载大于等于4并且cpu&gt;200%杀掉该进程</span><br><span class="line">if [ &quot;$sys_load&quot; &gt; &quot;4&quot; ] || [ &quot;$sys_load&quot; = &quot;4&quot; ]; then</span><br><span class="line"></span><br><span class="line">ps axf -o &quot;pid %cpu&quot; | awk &apos;&#123;if($2&gt;=200.0) print $1&#125;&apos; | while read procid</span><br><span class="line">do</span><br><span class="line">kill -9 $procid</span><br><span class="line">echo 系统负载+$sys_load &gt;&gt; /home/output.txt</span><br><span class="line">echo cpu高的进程+ $procid &gt;&gt; /home/output.txt</span><br><span class="line">echo `date`+&quot;杀掉cpu高的进程&quot; &gt;&gt; /home/output.txt</span><br><span class="line"></span><br><span class="line">#如果pot进程不在 重启pot</span><br><span class="line">if [ &quot;$pot&quot; = &quot;&quot;  ];  then</span><br><span class="line">echo pot进程+$pot &gt;&gt; /home/output.txt</span><br><span class="line">cd /home/tomcat/lepeng_tomcat/tomcat-8.0.46-10010/bin/</span><br><span class="line">./startup.sh</span><br><span class="line">echo `date`+&quot;pot重启&quot; &gt;&gt; /home/output.txt</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#如果shop进程不在 重启shop</span><br><span class="line">if [ &quot;$shop&quot; = &quot;&quot;  ];  then</span><br><span class="line">echo shop进程+$shop &gt;&gt; /home/output.txt</span><br><span class="line">cd /home/tomcat/lepeng_tomcat/tomcat-8.0.46-9980/bin/</span><br><span class="line">./startup.sh</span><br><span class="line">echo `date`+&quot;shop重启&quot; &gt;&gt; /home/output.txt</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h4 id="ssh登陆即进行告警通知"><a href="#ssh登陆即进行告警通知" class="headerlink" title="ssh登陆即进行告警通知"></a>ssh登陆即进行告警通知</h4><p>编写相关脚本内容如下:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#msg=&apos;监控服务器登录用户:\n主机名: &apos;`hostname`&apos;\n监控主机IP: &apos;`ifconfig eth0|awk -F &apos;[ :]+&apos; &apos;NR==2 &#123;print $3&#125;&apos;`&apos;\n监控登录用户: &apos;`whoami`&apos;\n监控登录IP: &apos;`who am i |awk -F &apos;[()]&apos; &apos;&#123;print $2&#125;&apos;`&apos;\n监控登录时间: &apos;`date &apos;+%Y-%m-%d-%H:%M:%S&apos;`&apos;&apos;</span><br><span class="line">#获取相关登陆信息</span><br><span class="line">name=`hostname`</span><br><span class="line">ip=`ifconfig eth0|awk -F &apos;[ :]+&apos; &apos;NR==2 &#123;print $3&#125;&apos;`</span><br><span class="line">user=`whoami`</span><br><span class="line">_ip=`who am i |awk -F &apos;[()]&apos; &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">_time=`date &apos;+%Y-%m-%d-%H:%M:%S&apos;`</span><br><span class="line">#查询登陆地址并返回相应信息</span><br><span class="line">addr=`curl -q -s http://freeapi.ipip.net/$_ip | awk -F &apos;&quot;&apos; &apos;&#123;print $2&quot;-&quot;$4&quot;-&quot;$6&#125;&apos;`</span><br><span class="line">#自定义接入钉钉函数</span><br><span class="line">function SendMessageToDingding()&#123;</span><br><span class="line">    #钉钉地址</span><br><span class="line">        url=&quot;https://oapi.dingtalk.com/robot/send?access_token=11030e780f87aee0e5849dc488072940405c03aefa66341cde7e3a3d09916583&quot;</span><br><span class="line">    #推送到钉钉</span><br><span class="line">        res=`curl -XPOST -s -L -H &quot;Content-Type:application/json&quot; -H &quot;charset:utf-8&quot; $url -d &quot;</span><br><span class="line">        &#123;</span><br><span class="line">        \&quot;msgtype\&quot;: \&quot;text\&quot;, </span><br><span class="line">        \&quot;text\&quot;: &#123;</span><br><span class="line">                 \&quot;content\&quot;: \&quot;监控主机名：$1\n主机IP: $2\n 登陆用户：$3\n 登陆IP: $4\nIP归属：$5\n登陆时间：$6\&quot;</span><br><span class="line">                 &#125;</span><br><span class="line">    &#125;&quot;`</span><br><span class="line">        echo $res</span><br><span class="line">&#125;</span><br><span class="line">#subject=`echo -e $msg`</span><br><span class="line">body=&quot;ECS监控ssh登陆&quot;</span><br><span class="line">#SendMessageToDingding $subject $body</span><br><span class="line">#调用函数</span><br><span class="line">SendMessageToDingding $name $ip $user $_ip $addr $_time $body</span><br></pre></td></tr></table></figure>

<p>将脚本文件放置在 /etc/profile.d/ 文件目录下，即可实现登陆时，发送相关告警至钉钉</p>
<p>效果如下：<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="\image\image-20210325100413140.png"></p>

        </div>

        
            <section class="post-copyright">
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/Process/"># Process</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">Back</a>
                <span>· </span>
                <a href="/">Home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/10/17/Kunbernetes自动化部署/">Kunbernetes自动化部署</a>
            
            
            <a class="next" rel="next" href="/2020/10/16/Loki/">Loki</a>
            
        </section>

        <script src="https://giscus.app/client.js" data-repo="nmk0718/nmk0718.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkyMTE0NDU3NDY=" data-category="Announcements" data-category-id="DIC_kwDODJpn8s4Clzt8" data-mapping="title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="noborder_light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async>
</script>
<script src="/js/clipboard.min.js"></script>
<script>
    // 更新 giscus 主题
    function updateGiscusTheme() {
        // 添加短暂延时，确保在主题切换后执行
        setTimeout(() => {
            const isDark = document.body.classList.contains('dark-theme');
            const theme = isDark ? 'noborder_dark' : 'noborder_light';
            const iframe = document.querySelector('.giscus-frame');
            
            if (iframe) {
                iframe.contentWindow.postMessage(
                    { giscus: { setConfig: { theme: theme } } },
                    'https://giscus.app'
                );
            }
        }, 100);  // 100ms 延时
    }

    // 监听主题变化
    const toggleBtn = document.getElementsByClassName('toggleBtn')[0];
    if (toggleBtn) {
        toggleBtn.addEventListener('click', updateGiscusTheme);
    }

    // 移动端主题切换监听
    const mobileToggle = document.getElementById('mobile-toggle-theme');
    if (mobileToggle) {
        mobileToggle.addEventListener('click', updateGiscusTheme);
    }

    // 初始化主题
    document.addEventListener('DOMContentLoaded', updateGiscusTheme);

    document.addEventListener('DOMContentLoaded', function () {
        var codeBlocks = document.querySelectorAll('article .code pre');

        codeBlocks.forEach(function (codeBlock) {
            var copyButton = document.createElement('button');
            copyButton.className = 'copy-button';

            // Check if the code block is in the article content
            if (codeBlock.closest('article')) {
                codeBlock.parentNode.parentNode.style.position = 'relative'; // Update this line to select parent of span (pre)
                codeBlock.parentNode.parentNode.appendChild(copyButton); // Update this line to select parent of span (pre) 

                var isCopying = false;

                copyButton.addEventListener('click', function () {
                    if (!isCopying) {
                        var codeText = codeBlock.innerText;
                        navigator.clipboard.writeText(codeText).then(function () {
                            isCopying = true;
                            setTimeout(function () {
                                isCopying = false;
                            }, 1500);
                        }).catch(function (err) {
                            console.error('Copy failed', err);
                        });
                    }
                });
            }
        });
    });
</script>
    </article>
</div>


        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© kk | Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span>
    </div>
</footer>

    </div>

        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body>
</html>

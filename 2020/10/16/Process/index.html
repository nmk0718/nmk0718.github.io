<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>Process | K&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">kk&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/app">App</a>
                
                    <a class="menu-item" href="/map">Map</a>
                
                    <a class="menu-item" href="/game">Game</a>
                
                    <a class="menu-item" href="/media">Media</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">kk&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/app">App</a>
                
                    <a class="menu-item" href="/map">Map</a>
                
                    <a class="menu-item" href="/game">Game</a>
                
                    <a class="menu-item" href="/media">Media</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Process</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">nmk</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">2020-10-16&nbsp;&nbsp;11:35:00</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><h4 id="windows下杀掉指定应用"><a href="#windows下杀掉指定应用" class="headerlink" title="windows下杀掉指定应用"></a>windows下杀掉指定应用</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">taskkill <span class="string">/im</span> nginx.exe <span class="string">/f</span></span><br><span class="line"><span class="comment">#/im  立即  /f   强制结束进程</span></span><br><span class="line"><span class="comment">#任务管理器&gt;详细信息&gt;内存&gt;查看应用的pid</span></span><br></pre></td></tr></table></figure>

<h4 id="windows下杀掉指定端口的进程"><a href="#windows下杀掉指定端口的进程" class="headerlink" title="windows下杀掉指定端口的进程"></a>windows下杀掉指定端口的进程</h4><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /f "tokens=<span class="number">5</span>" <span class="variable">%%i</span> <span class="keyword">in</span> ('netstat -aon ^| <span class="built_in">findstr</span> ":<span class="number">9091</span>"') <span class="keyword">do</span> (<span class="built_in">set</span> j=<span class="variable">%%i</span>)</span><br><span class="line"><span class="built_in">taskkill</span> /t /f /pid <span class="variable">%j%</span> </span><br><span class="line">#netstat -aon | <span class="built_in">findstr</span> ":port" 查找端口对应的pid</span><br><span class="line">#<span class="built_in">taskkill</span> /t /f /pid 杀掉pid对应的进程</span><br></pre></td></tr></table></figure>

<h4 id="如有遇到删除文件-提示正在被使用"><a href="#如有遇到删除文件-提示正在被使用" class="headerlink" title="如有遇到删除文件,提示正在被使用"></a>如有遇到删除文件,提示正在被使用</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">任务管理器&gt;性能&gt;打开资源监视器&gt;<span class="meta">CPU</span>&gt;关联的句柄</span><br><span class="line">搜索需要删除的文件夹名称或文件名称</span><br></pre></td></tr></table></figure>

<h4 id="如有遇到某进程占用内存过大-并不清楚应用情况下"><a href="#如有遇到某进程占用内存过大-并不清楚应用情况下" class="headerlink" title="如有遇到某进程占用内存过大,并不清楚应用情况下"></a>如有遇到某进程占用内存过大,并不清楚应用情况下</h4><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">任务管理器&gt;详细信息&gt;内存&gt;查看应用的<span class="keyword">pid</span></span><br><span class="line">任务管理器&gt;&gt;性能&gt;打开资源监视器&gt;概述&gt;磁盘&gt;按<span class="keyword">pid</span>排序</span><br><span class="line">即可看到<span class="keyword">pid</span>对应的启动文件和目录</span><br></pre></td></tr></table></figure>

<h4 id="如有遇到使用windows远程-不可复制粘贴情况"><a href="#如有遇到使用windows远程-不可复制粘贴情况" class="headerlink" title="如有遇到使用windows远程,不可复制粘贴情况"></a>如有遇到使用windows远程,不可复制粘贴情况</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">任务管理器&gt;用户&gt;<span class="selector-tag">nmk</span>&gt;<span class="selector-tag">RDP</span>剪贴板监视程序</span><br><span class="line">结束掉<span class="selector-tag">RDP</span>,使用<span class="selector-tag">windows</span>+<span class="selector-tag">R</span>运行<span class="selector-tag">rdpclip</span><span class="selector-class">.exe</span>即可</span><br></pre></td></tr></table></figure>

<h4 id="如有遇到windows黑屏或任务栏不见等情况"><a href="#如有遇到windows黑屏或任务栏不见等情况" class="headerlink" title="如有遇到windows黑屏或任务栏不见等情况"></a>如有遇到windows黑屏或任务栏不见等情况</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">任务管理器&gt;用户&gt;<span class="selector-tag">nmk</span>&gt;<span class="selector-tag">windows</span>资源管理器</span><br><span class="line">结束掉<span class="selector-tag">windows</span>资源管理器,使用<span class="selector-tag">windows</span>+<span class="selector-tag">R</span>运行<span class="selector-tag">explorer</span><span class="selector-class">.exe</span>即可</span><br></pre></td></tr></table></figure>

<h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><h4 id="linux下查看ip"><a href="#linux下查看ip" class="headerlink" title="linux下查看ip"></a>linux下查看ip</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig|<span class="keyword">grep</span> <span class="number">192</span>|awk <span class="string">'&#123;print $2&#125;'</span></span><br><span class="line">curl ifconfig.<span class="keyword">me</span></span><br></pre></td></tr></table></figure>

<h4 id="linux下杀掉指定端口进程"><a href="#linux下杀掉指定端口进程" class="headerlink" title="linux下杀掉指定端口进程"></a>linux下杀掉指定端口进程</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port=48094</span><br><span class="line"><span class="comment">#根据端口号查询对应的pid</span></span><br><span class="line">pid=$(netstat -nlp | grep :<span class="variable">$port</span> | awk <span class="string">'&#123;print $7&#125;'</span> | awk -F<span class="string">"/"</span> <span class="string">'&#123; print $1 &#125;'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#杀掉对应的进程，如果pid不存在，则不执行</span></span><br><span class="line"><span class="keyword">if</span> [  -n  <span class="string">"<span class="variable">$pid</span>"</span>  ];  <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">kill</span>  -9  <span class="variable">$pid</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h4 id="linux查看应用进程"><a href="#linux查看应用进程" class="headerlink" title="linux查看应用进程"></a>linux查看应用进程</h4><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep java</span><br><span class="line"><span class="meta">#grep为过滤 java为启动的应用</span></span><br><span class="line"><span class="meta">#输出结果java后的数字为pid,如需结束,使用kill -9 pid</span></span><br><span class="line">netstat -lntp</span><br><span class="line"><span class="meta">#查看当前应用使用的端口和pid</span></span><br></pre></td></tr></table></figure>

<h4 id="linux查看文件有多少行"><a href="#linux查看文件有多少行" class="headerlink" title="linux查看文件有多少行"></a>linux查看文件有多少行</h4><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wc -l <span class="keyword">filename</span>		#输出<span class="keyword">filename</span>的行数</span><br><span class="line">wc -c <span class="keyword">filename</span>		#输出<span class="keyword">filename</span>的字节数</span><br><span class="line">wc -m <span class="keyword">filename</span>		#输出<span class="keyword">filename</span>的字符数</span><br><span class="line">wc -w <span class="keyword">filename</span>		#输出<span class="keyword">filename</span>的字数</span><br></pre></td></tr></table></figure>

<h4 id="linux查找文件"><a href="#linux查找文件" class="headerlink" title="linux查找文件"></a>linux查找文件</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">在使用linux时，经常需要进行文件查找。其中查找的命令主要有<span class="keyword">find</span>和<span class="keyword">grep</span>。两个命令是有区别的。</span><br><span class="line">(<span class="number">1</span>)<span class="keyword">find</span>命令是根据文件的属性进行查找，如文件名，文件大小，所有者，所属组，是否为空，访问时间，修改时间等。 </span><br><span class="line">(<span class="number">2</span>)<span class="keyword">grep</span>是根据文件的内容进行查找，会对文件的每一行按照给定的模式(patter)进行匹配查找。</span><br><span class="line"></span><br><span class="line">　　一.<span class="keyword">find</span>命令</span><br><span class="line"></span><br><span class="line">　　　　基本格式：<span class="keyword">find</span>  path expression</span><br><span class="line"></span><br><span class="line">　　　　<span class="number">1</span>.按照文件名查找</span><br><span class="line"></span><br><span class="line">　　　　(<span class="number">1</span>)<span class="keyword">find</span> / -name httpd.<span class="keyword">conf</span>　　#在根目录下查找文件httpd.<span class="keyword">conf</span>，表示在整个硬盘查找</span><br><span class="line">　　　　(<span class="number">2</span>)<span class="keyword">find</span> /etc -name httpd.<span class="keyword">conf</span>　　#在/etc目录下文件httpd.<span class="keyword">conf</span></span><br><span class="line">　　　　(<span class="number">3</span>)<span class="keyword">find</span> /etc -name <span class="string">'*srm*'</span>　　#使用通配符*(<span class="number">0</span>或者任意多个)。表示在/etc目录下查找文件名中含有字符串‘srm’的文件</span><br><span class="line">　　　　(<span class="number">4</span>)<span class="keyword">find</span> . -name <span class="string">'srm*'</span> 　　#表示当前目录下查找文件名开头是字符串‘srm’的文件</span><br><span class="line"></span><br><span class="line">　　　　<span class="number">2</span>.按照文件特征查找 　　　　</span><br><span class="line"></span><br><span class="line">　　　　(<span class="number">1</span>)<span class="keyword">find</span> / -amin -<span class="number">10</span> 　　# 查找在系统中最后<span class="number">10</span>分钟访问的文件(access time)</span><br><span class="line">　　　　(<span class="number">2</span>)<span class="keyword">find</span> / -atime -<span class="number">2</span>　　 # 查找在系统中最后<span class="number">48</span>小时访问的文件</span><br><span class="line">　　　　(<span class="number">3</span>)<span class="keyword">find</span> / -<span class="built_in">empty</span> 　　# 查找在系统中为空的文件或者文件夹</span><br><span class="line">　　　　(<span class="number">4</span>)<span class="keyword">find</span> / -group <span class="keyword">cat</span> 　　# 查找在系统中属于 group为<span class="keyword">cat</span>的文件</span><br><span class="line">　　　　(<span class="number">5</span>)<span class="keyword">find</span> / -mmin -<span class="number">5</span> 　　# 查找在系统中最后<span class="number">5</span>分钟里修改过的文件(modify time)</span><br><span class="line">　　　　(<span class="number">6</span>)<span class="keyword">find</span> / -mtime -<span class="number">1</span> 　　#查找在系统中最后<span class="number">24</span>小时里修改过的文件</span><br><span class="line">　　　　(<span class="number">7</span>)<span class="keyword">find</span> / -user fred 　　#查找在系统中属于fred这个用户的文件</span><br><span class="line">　　　　(<span class="number">8</span>)<span class="keyword">find</span> / -size +<span class="number">10000</span><span class="keyword">c</span>　　#查找出大于<span class="number">10000000</span>字节的文件(<span class="keyword">c</span>:字节，<span class="variable">w:</span>双字，<span class="keyword">k</span>:KB，M:MB，G:GB)</span><br><span class="line">　　　　(<span class="number">9</span>)<span class="keyword">find</span> / -size -<span class="number">1000</span><span class="keyword">k</span> 　　#查找出小于<span class="number">1000</span>KB的文件</span><br><span class="line"></span><br><span class="line">　　　　<span class="number">3</span>.使用混合查找方式查找文件</span><br><span class="line"></span><br><span class="line">　　　　参数有： ！，-<span class="built_in">and</span>(-<span class="keyword">a</span>)，-<span class="built_in">or</span>(-<span class="keyword">o</span>)。</span><br><span class="line"></span><br><span class="line">　　　　(<span class="number">1</span>)<span class="keyword">find</span> /tmp -size +<span class="number">10000</span><span class="keyword">c</span> -<span class="built_in">and</span> -mtime +<span class="number">2</span> 　　#在/tmp目录下查找大于<span class="number">10000</span>字节并在最后<span class="number">2</span>分钟内修改的文件</span><br><span class="line">   　　    (<span class="number">2</span>)<span class="keyword">find</span> / -user fred -<span class="built_in">or</span> -user george 　　#在/目录下查找用户是fred或者george的文件文件</span><br><span class="line">   　　    (<span class="number">3</span>)<span class="keyword">find</span> /tmp ! -user panda　　#在/tmp目录中查找所有不属于panda用户的文件</span><br><span class="line">    　　  </span><br><span class="line"></span><br><span class="line">　　二、<span class="keyword">grep</span>命令</span><br><span class="line"></span><br><span class="line">　　　  基本格式：<span class="keyword">find</span>  expression</span><br><span class="line"></span><br><span class="line"> 　　　 <span class="number">1</span>.主要参数</span><br><span class="line"></span><br><span class="line">　　　　[<span class="keyword">options</span>]主要参数：</span><br><span class="line">　　　　－<span class="keyword">c</span>：只输出匹配行的计数。</span><br><span class="line">　　　　－i：不区分大小写</span><br><span class="line">　　　　－h：查询多文件时不显示文件名。</span><br><span class="line">　　　　－<span class="keyword">l</span>：查询多文件时只输出包含匹配字符的文件名。</span><br><span class="line">　　　　－n：显示匹配行及行号。</span><br><span class="line">　　　　－s：不显示不存在或无匹配文本的错误信息。</span><br><span class="line">　　　　－v：显示不包含匹配文本的所有行。</span><br><span class="line"></span><br><span class="line">　　　　pattern正则表达式主要参数：</span><br><span class="line">　　　　\： 忽略正则表达式中特殊字符的原有含义。</span><br><span class="line">　　　　^：匹配正则表达式的开始行。</span><br><span class="line">　　　　$: 匹配正则表达式的结束行。</span><br><span class="line">　　　　\&lt;：从匹配正则表达 式的行开始。</span><br><span class="line">　　　　\&gt;：到匹配正则表达式的行结束。</span><br><span class="line">　　　　[ ]：单个字符，如[A]即A符合要求 。</span><br><span class="line">　　　　[ - ]：范围，如[A-Z]，即A、B、C一直到Z都符合要求 。</span><br><span class="line">　　　　.：所有的单个字符。</span><br><span class="line"></span><br><span class="line">   * ：有字符，长度可以为<span class="number">0</span>。</span><br><span class="line"></span><br><span class="line">　　　　<span class="number">2</span>.实例　 </span><br><span class="line"></span><br><span class="line">　　(<span class="number">1</span>)<span class="keyword">grep</span> <span class="string">'test'</span> d*　　#显示所有以d开头的文件中包含 test的行</span><br><span class="line">　　(<span class="number">2</span>)<span class="keyword">grep</span> ‘test’ aa bb <span class="keyword">cc</span> 　　 #显示在aa，bb，<span class="keyword">cc</span>文件中包含test的行</span><br><span class="line">　　(<span class="number">3</span>)<span class="keyword">grep</span> ‘[<span class="keyword">a</span>-<span class="keyword">z</span>]\&#123;<span class="number">5</span>\&#125;’ aa 　　#显示所有包含每行字符串至少有<span class="number">5</span>个连续小写字符的字符串的行</span><br><span class="line">　　(<span class="number">4</span>)<span class="keyword">grep</span> magic /usr/src　　#显示/usr/src目录下的文件(不含子目录)包含magic的行</span><br><span class="line">　　(<span class="number">5</span>)<span class="keyword">grep</span> -r magic /usr/src　　#显示/usr/src目录下的文件(包含子目录)包含magic的行</span><br><span class="line"></span><br><span class="line">　　(<span class="number">6</span>)<span class="keyword">grep</span> -<span class="keyword">w</span> pattern <span class="keyword">files</span> ：只匹配整个单词，而不是字符串的一部分(如匹配’magic’，而不是’magical’)，</span><br><span class="line"></span><br><span class="line">如果你想在当前目录下 查找<span class="string">"hello,world!"</span>字符串,可以这样:</span><br><span class="line"></span><br><span class="line"><span class="keyword">grep</span> -rn <span class="string">"hello,world!"</span> *</span><br><span class="line"></span><br><span class="line">* : 表示当前目录所有文件，也可以是某个文件名</span><br><span class="line"></span><br><span class="line">-r 是递归查找（如果不加-r表示只查找当前目录，不会递归的查找子目录）</span><br><span class="line"></span><br><span class="line">-n 是显示行号</span><br><span class="line"></span><br><span class="line">-R 查找所有文件包含子目录</span><br><span class="line"></span><br><span class="line">-i 忽略大小写</span><br><span class="line"></span><br><span class="line">下面是一些有意思的命令行参数：</span><br><span class="line"></span><br><span class="line"><span class="keyword">grep</span> -i pattern <span class="keyword">files</span> ：不区分大小写地搜索。默认情况区分大小写， </span><br><span class="line"></span><br><span class="line"><span class="keyword">grep</span> -<span class="keyword">l</span> pattern <span class="keyword">files</span> ：只列出匹配的文件名， </span><br><span class="line"></span><br><span class="line"><span class="keyword">grep</span> -L pattern <span class="keyword">files</span> ：列出不匹配的文件名， </span><br><span class="line"></span><br><span class="line"><span class="keyword">grep</span> -<span class="keyword">w</span> pattern <span class="keyword">files</span> ：只匹配整个单词，而不是字符串的一部分（如匹配‘magic’，而不是‘magical’）， </span><br><span class="line"></span><br><span class="line"><span class="keyword">grep</span> -C <span class="keyword">number</span> pattern <span class="keyword">files</span> ：匹配的上下文分别显示[<span class="keyword">number</span>]行， </span><br><span class="line"></span><br><span class="line"><span class="keyword">grep</span> pattern1 | pattern2 <span class="keyword">files</span> ：显示匹配 pattern1 或 pattern2 的行， </span><br><span class="line"></span><br><span class="line"><span class="keyword">grep</span> pattern1 <span class="keyword">files</span> | <span class="keyword">grep</span> pattern2 ：显示既匹配 pattern1 又匹配 pattern2 的行。</span><br></pre></td></tr></table></figure>

<h4 id="查看应用所占内存"><a href="#查看应用所占内存" class="headerlink" title="查看应用所占内存"></a>查看应用所占内存</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ps -u postgres o pid,rss:<span class="number">8</span>,cmd | awk <span class="string">'NR&gt;1 &#123;A+=$2&#125; &#123;print&#125; END&#123;print "Total RSS: " A&#125;'</span></span><br><span class="line">  PID      RSS CMD</span><br><span class="line"> <span class="number">3314</span>    <span class="number">47100</span> /usr/pgsql-<span class="number">12</span>/bin/postmaster -D /home/pgsql12/data/</span><br><span class="line"> <span class="number">3318</span>      <span class="number">544</span> postgres: logger   </span><br><span class="line"> <span class="number">3320</span>    <span class="number">76952</span> postgres: checkpointer   </span><br><span class="line"> <span class="number">3321</span>    <span class="number">57716</span> postgres: background writer   </span><br><span class="line"> <span class="number">3322</span>    <span class="number">16980</span> postgres: walwriter   </span><br><span class="line"> <span class="number">3323</span>     <span class="number">1664</span> postgres: autovacuum launcher   </span><br><span class="line"> <span class="number">3324</span>     <span class="number">1248</span> postgres: stats collector   </span><br><span class="line"> <span class="number">3325</span>      <span class="number">920</span> postgres: logical replication launcher   </span><br><span class="line"><span class="number">34905</span>    <span class="number">23572</span> postgres: dbuser qiyewechat <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">59622</span>) idle</span><br><span class="line"><span class="number">39446</span>     <span class="number">9936</span> postgres: dbuser qiyewechat <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">49408</span>) idle</span><br><span class="line"><span class="number">39449</span>    <span class="number">16132</span> postgres: dbuser qiyewechat <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">49412</span>) idle</span><br><span class="line"><span class="number">42193</span>    <span class="number">32336</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">52546</span>) idle</span><br><span class="line"><span class="number">42194</span>    <span class="number">15376</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">52547</span>) idle</span><br><span class="line"><span class="number">42996</span>     <span class="number">4492</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">54459</span>) idle</span><br><span class="line"><span class="number">43002</span>     <span class="number">8260</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">54498</span>) idle</span><br><span class="line"><span class="number">43489</span>     <span class="number">6604</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">55454</span>) idle</span><br><span class="line"><span class="number">43490</span>     <span class="number">6612</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">55461</span>) idle</span><br><span class="line"><span class="number">43885</span>     <span class="number">4496</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">56158</span>) idle</span><br><span class="line"><span class="number">43886</span>     <span class="number">4496</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">56160</span>) idle</span><br><span class="line"><span class="number">43887</span>    <span class="number">18624</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">56163</span>) idle</span><br><span class="line"><span class="number">43888</span>    <span class="number">25448</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">56165</span>) idle</span><br><span class="line"><span class="number">43889</span>    <span class="number">26704</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">56167</span>) idle</span><br><span class="line"><span class="number">44302</span>    <span class="number">10696</span> postgres: dbuser qiyewechat <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">57075</span>) idle</span><br><span class="line"><span class="number">44369</span>    <span class="number">14456</span> postgres: dbuser qiyewechat <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">57083</span>) idle</span><br><span class="line"><span class="number">44370</span>     <span class="number">6028</span> postgres: dbuser qiyewechat <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">57084</span>) idle</span><br><span class="line"><span class="number">44478</span>     <span class="number">4496</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">57323</span>) idle</span><br><span class="line"><span class="number">45814</span>     <span class="number">8460</span> postgres: dbuser qiyewechat <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">59407</span>) idle</span><br><span class="line"><span class="number">45900</span>    <span class="number">13064</span> postgres: dbuser qiyewechat <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">59474</span>) idle</span><br><span class="line"><span class="number">45907</span>     <span class="number">5776</span> postgres: dbuser qiyewechat <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">59514</span>) idle</span><br><span class="line"><span class="number">45992</span>     <span class="number">6344</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">59703</span>) idle</span><br><span class="line"><span class="number">46565</span>    <span class="number">17660</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">60717</span>) idle</span><br><span class="line"><span class="number">46573</span>    <span class="number">14536</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">60758</span>) idle</span><br><span class="line"><span class="number">46574</span>     <span class="number">6048</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">60759</span>) idle</span><br><span class="line"><span class="number">47215</span>     <span class="number">4504</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">61764</span>) idle</span><br><span class="line"><span class="number">47879</span>     <span class="number">9428</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">63113</span>) idle</span><br><span class="line"><span class="number">47880</span>    <span class="number">15380</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">63114</span>) idle</span><br><span class="line"><span class="number">48631</span>     <span class="number">4496</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">64278</span>) idle</span><br><span class="line"><span class="number">49247</span>     <span class="number">6076</span> postgres: dbuser postgres <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">65312</span>) idle</span><br><span class="line"><span class="number">49890</span>    <span class="number">18168</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">50169</span>) idle</span><br><span class="line"><span class="number">49893</span>    <span class="number">14576</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">50175</span>) idle</span><br><span class="line"><span class="number">49894</span>     <span class="number">5816</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">50176</span>) idle</span><br><span class="line"><span class="number">50162</span>     <span class="number">4492</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">50486</span>) idle</span><br><span class="line"><span class="number">50710</span>    <span class="number">10560</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">51809</span>) idle</span><br><span class="line"><span class="number">50711</span>    <span class="number">14512</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">51810</span>) idle</span><br><span class="line"><span class="number">50717</span>    <span class="number">14816</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">51826</span>) idle</span><br><span class="line"><span class="number">50718</span>     <span class="number">7660</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">51827</span>) idle</span><br><span class="line"><span class="number">50719</span>     <span class="number">5824</span> postgres: dbuser postgres <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">51828</span>) idle</span><br><span class="line"><span class="number">50723</span>     <span class="number">6064</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">51833</span>) idle</span><br><span class="line"><span class="number">51657</span>     <span class="number">4500</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">53646</span>) idle</span><br><span class="line"><span class="number">53083</span>     <span class="number">4504</span> postgres: dbuser ymall_test <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">56425</span>) idle</span><br><span class="line"><span class="number">53091</span>     <span class="number">8468</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">56449</span>) idle</span><br><span class="line"><span class="number">53092</span>    <span class="number">14500</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">56450</span>) idle</span><br><span class="line"><span class="number">53093</span>     <span class="number">6048</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">56451</span>) idle</span><br><span class="line"><span class="number">62156</span>     <span class="number">4228</span> postgres: dbuser ymall <span class="number">192.168</span><span class="meta">.138</span><span class="meta">.1</span>(<span class="number">57632</span>) idle</span><br><span class="line">Total RSS: <span class="number">698396</span></span><br></pre></td></tr></table></figure>

<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@prod-ghospital ~]#  ps -<span class="keyword">u</span> mysql o pid,rss:8,cmd | awk 'NR&gt;1 &#123;A+=<span class="variable">$2&#125;</span> &#123;<span class="keyword">print</span>&#125; END&#123;<span class="keyword">print</span> <span class="string">"Total RSS: "</span> A&#125;'</span><br><span class="line">  PID      RSS CMD</span><br><span class="line"> 3057  1496720 /usr/sbin/mysqld --daemonize --pid-<span class="keyword">file</span>=/<span class="keyword">var</span>/<span class="keyword">run</span>/mysqld/mysqld.pid</span><br><span class="line"><span class="keyword">Total</span> RSS: 1496720</span><br></pre></td></tr></table></figure>

<h4 id="检测页面的状态码查看项目存活"><a href="#检测页面的状态码查看项目存活" class="headerlink" title="检测页面的状态码查看项目存活"></a>检测页面的状态码查看项目存活</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@lepeng ~]<span class="comment"># cat url.txt </span></span><br><span class="line">http://localhost:9980/front/<span class="built_in">test</span>/aaaa2</span><br><span class="line"></span><br><span class="line">[root@lepeng ~]<span class="comment"># cat checkurl.sh </span></span><br><span class="line">fileurl=<span class="string">'/root/url.txt'</span></span><br><span class="line"><span class="keyword">for</span> chkurl <span class="keyword">in</span> $(cat <span class="variable">$&#123;fileurl&#125;</span>)  <span class="comment"># $&#123;&#125;忽略空格</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="comment"># -o 输出内容到/dev/null; -s 静默方式 ；-w 定义显示输出格式；"%&#123;http_code&#125;" 在最后被检索的 HTTP(S) 页中被找到的数字的代码</span></span><br><span class="line">    HTTP_CODE=`curl -o /dev/null -s --head -w <span class="string">"%&#123;http_code&#125;"</span> <span class="string">"<span class="variable">$&#123;chkurl&#125;</span>"</span>`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;HTTP_CODE&#125;</span> -ne 200 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        port=9980</span><br><span class="line">        <span class="built_in">echo</span> `date <span class="string">"+%Y-%m-%d %H:%M:%S"</span>` 项目正在重启.....  &gt;&gt;check-result.txt</span><br><span class="line">        <span class="comment">#根据端口号查询对应的pid</span></span><br><span class="line">        pid=$(netstat -nlp | grep :<span class="variable">$port</span> | awk <span class="string">'&#123;print $7&#125;'</span> | awk -F<span class="string">"/"</span> <span class="string">'&#123; print $1 &#125;'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">#杀掉对应的进程，如果pid不存在，则不执行</span></span><br><span class="line">        <span class="keyword">if</span> [  -n  <span class="string">"<span class="variable">$pid</span>"</span>  ];  <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">kill</span>  -9  <span class="variable">$pid</span>;</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="built_in">cd</span> /home/tomcat/lepeng_tomcat/tomcat-8.0.46-9980/bin/</span><br><span class="line">        ./startup.sh</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e  `date <span class="string">"+%Y-%m-%d %H:%M:%S"</span>` 当前状态码为<span class="variable">$&#123;HTTP_CODE&#125;</span>: <span class="variable">$chkurl</span>  &gt;&gt;check-result.txt</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>加入定时任务</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="emphasis">*/5 *</span> <span class="bullet">* *</span> * sh /root/checkurl.sh</span><br><span class="line"><span class="section">#每5分钟执行一次检测脚本</span></span><br><span class="line"><span class="section">#例如项目要3分钟,定时任务要大于3分钟,否则会一直重启</span></span><br></pre></td></tr></table></figure>

<h4 id="服务一直kill不掉"><a href="#服务一直kill不掉" class="headerlink" title="服务一直kill不掉"></a>服务一直kill不掉</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@prodl bin]</span># <span class="selector-tag">ps</span> <span class="selector-tag">-ef</span>|<span class="selector-tag">grep</span> <span class="selector-tag">runsv</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7808</span>     <span class="selector-tag">1</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsvdir</span> <span class="selector-tag">-P</span> /<span class="selector-tag">opt</span>/<span class="selector-tag">gitlab</span>/<span class="selector-tag">service</span> <span class="selector-tag">log</span>: <span class="selector-tag">vlogd</span>: <span class="selector-tag">warning</span>: <span class="selector-tag">unable</span> <span class="selector-tag">to</span> <span class="selector-tag">lock</span> <span class="selector-tag">directory</span>: /<span class="selector-tag">var</span>/<span class="selector-tag">log</span>/<span class="selector-tag">gitlab</span>/<span class="selector-tag">grafana</span>: <span class="selector-tag">temporary</span> <span class="selector-tag">failure</span> <span class="selector-tag">svlogd</span>: <span class="selector-tag">fatal</span>: <span class="selector-tag">no</span> <span class="selector-tag">functional</span> <span class="selector-tag">log</span> <span class="selector-tag">directories</span>. <span class="selector-tag">svlogd</span>: <span class="selector-tag">warning</span>: <span class="selector-tag">unable</span> <span class="selector-tag">to</span> <span class="selector-tag">lock</span> <span class="selector-tag">directory</span>: /<span class="selector-tag">var</span>/<span class="selector-tag">log</span>/<span class="selector-tag">gitlab</span>/<span class="selector-tag">grafana</span>: <span class="selector-tag">temporary</span> <span class="selector-tag">failure</span> <span class="selector-tag">svlogd</span>: <span class="selector-tag">fatal</span>: <span class="selector-tag">no</span> <span class="selector-tag">functional</span> <span class="selector-tag">log</span> <span class="selector-tag">directories</span>. <span class="selector-tag">svlogd</span>: <span class="selector-tag">warning</span>: <span class="selector-tag">unable</span> <span class="selector-tag">to</span> <span class="selector-tag">lock</span> <span class="selector-tag">directory</span>: /<span class="selector-tag">var</span>/<span class="selector-tag">log</span>/<span class="selector-tag">gitlab</span>/<span class="selector-tag">grafana</span>: <span class="selector-tag">temporary</span> <span class="selector-tag">failure</span> <span class="selector-tag">svlogd</span>: <span class="selector-tag">fatal</span>: <span class="selector-tag">no</span> <span class="selector-tag">functional</span> <span class="selector-tag">log</span> <span class="selector-tag">directories</span>. </span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7811</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">gitaly</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7812</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">alertmanager</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7813</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">sidekiq</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7814</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">postgresql</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7815</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">unicorn</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7816</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">prometheus</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7818</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">postgres-exporter</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7819</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">logrotate</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7820</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">node-exporter</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7821</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">gitlab-exporter</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">7822</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:11</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">gitlab-workhorse</span></span><br><span class="line"><span class="selector-tag">root</span>      <span class="selector-tag">8329</span>  <span class="selector-tag">7808</span>  <span class="selector-tag">0</span> <span class="selector-tag">21</span><span class="selector-pseudo">:23</span> ?        <span class="selector-tag">00</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> <span class="selector-tag">runsv</span> <span class="selector-tag">grafana</span></span><br></pre></td></tr></table></figure>

<p>runsvdir -P /opt/gitlab/service log为主进程</p>
<p>这是一个runit service，kill -9 无法杀死。【runsvdir 进程杀死后又重新创建（杀不死）】</p>
<p>后来查看了官方文档中的说明后， 使用如下命令：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@prod-ghospital bin]<span class="comment"># systemctl stop gitlab-runsvdir</span></span><br><span class="line">[root@prod-ghospital bin]<span class="comment"># ps -ef|grep runsv</span></span><br><span class="line">root    <span class="number"> 12453 </span><span class="number"> 6424 </span><span class="number"> 0 </span>21:36 pts/0    00:00:00 grep --color=auto runsv</span><br><span class="line">[root@prod-ghospital bin]<span class="comment"># netstat -lntp</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>127.0.0.1:25            0.0.0.0:*               LISTEN      4904/sendmail: acce </span><br><span class="line">tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:443             0.0.0.0:*               LISTEN      2081/nginx: master  </span><br><span class="line">tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>127.0.0.1:20037         0.0.0.0:*               LISTEN      2534/java           </span><br><span class="line">tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:6379            0.0.0.0:*               LISTEN      1350/redis-server * </span><br><span class="line">tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:80              0.0.0.0:*               LISTEN      2081/nginx: master  </span><br><span class="line">tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:8081            0.0.0.0:*               LISTEN      2534/java           </span><br><span class="line">tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:81              0.0.0.0:*               LISTEN      2081/nginx: master  </span><br><span class="line">tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:22              0.0.0.0:*               LISTEN      2978/sshd           </span><br><span class="line">tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>127.0.0.1:9600          :::*                    LISTEN      18615/java          </span><br><span class="line">tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::9000                 :::*                    LISTEN      19159/java          </span><br><span class="line">tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::3306                 :::*                    LISTEN      2970/mysqld         </span><br><span class="line">tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::6379                 :::*                    LISTEN      1350/redis-server * </span><br><span class="line">tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::9200                 :::*                    LISTEN      20071/java          </span><br><span class="line">tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::80                   :::*                    LISTEN      2081/nginx: master  </span><br><span class="line">tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::9300                 :::*                    LISTEN      19159/java          </span><br><span class="line">tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::9302                 :::*                    LISTEN      20071/java</span><br></pre></td></tr></table></figure>

<p>系统负载大于等于4并且cpu&gt;200% 重启程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取5分钟系统负载</span></span><br><span class="line">sys_load=`/bin/cat /proc/loadavg | awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"><span class="comment">#获取pot进程pid</span></span><br><span class="line">pot=$(netstat -nlp | grep 10010 | awk <span class="string">'&#123;print $7&#125;'</span> | awk -F<span class="string">"/"</span> <span class="string">'&#123; print $1 &#125;'</span>);</span><br><span class="line"><span class="comment">#获取shop进程pid</span></span><br><span class="line">shop=$(netstat -nlp | grep 9980 | awk <span class="string">'&#123;print $7&#125;'</span> | awk -F<span class="string">"/"</span> <span class="string">'&#123; print $1 &#125;'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果系统负载大于等于4并且cpu&gt;200%杀掉该进程</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$sys_load</span>"</span> &gt; <span class="string">"4"</span> ] || [ <span class="string">"<span class="variable">$sys_load</span>"</span> = <span class="string">"4"</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">ps axf -o <span class="string">"pid %cpu"</span> | awk <span class="string">'&#123;if($2&gt;=200.0) print $1&#125;'</span> | <span class="keyword">while</span> <span class="built_in">read</span> procid</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">kill</span> -9 <span class="variable">$procid</span></span><br><span class="line"><span class="built_in">echo</span> 系统负载+<span class="variable">$sys_load</span> &gt;&gt; /home/output.txt</span><br><span class="line"><span class="built_in">echo</span> cpu高的进程+ <span class="variable">$procid</span> &gt;&gt; /home/output.txt</span><br><span class="line"><span class="built_in">echo</span> `date`+<span class="string">"杀掉cpu高的进程"</span> &gt;&gt; /home/output.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果pot进程不在 重启pot</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$pot</span>"</span> = <span class="string">""</span>  ];  <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> pot进程+<span class="variable">$pot</span> &gt;&gt; /home/output.txt</span><br><span class="line"><span class="built_in">cd</span> /home/tomcat/lepeng_tomcat/tomcat-8.0.46-10010/bin/</span><br><span class="line">./startup.sh</span><br><span class="line"><span class="built_in">echo</span> `date`+<span class="string">"pot重启"</span> &gt;&gt; /home/output.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果shop进程不在 重启shop</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$shop</span>"</span> = <span class="string">""</span>  ];  <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> shop进程+<span class="variable">$shop</span> &gt;&gt; /home/output.txt</span><br><span class="line"><span class="built_in">cd</span> /home/tomcat/lepeng_tomcat/tomcat-8.0.46-9980/bin/</span><br><span class="line">./startup.sh</span><br><span class="line"><span class="built_in">echo</span> `date`+<span class="string">"shop重启"</span> &gt;&gt; /home/output.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h4 id="ssh登陆即进行告警通知"><a href="#ssh登陆即进行告警通知" class="headerlink" title="ssh登陆即进行告警通知"></a>ssh登陆即进行告警通知</h4><p>编写相关脚本内容如下:</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="meta">#msg=<span class="string">'监控服务器登录用户:\n主机名: '</span>`hostname`<span class="string">'\n监控主机IP: '</span>`ifconfig eth0|awk -F <span class="string">'[ :]+'</span> <span class="string">'NR==2 &#123;print $3&#125;'</span>`<span class="string">'\n监控登录用户: '</span>`whoami`<span class="string">'\n监控登录IP: '</span>`who am i |awk -F <span class="string">'[()]'</span> <span class="string">'&#123;print $2&#125;'</span>`<span class="string">'\n监控登录时间: '</span>`date <span class="string">'+%Y-%m-%d-%H:%M:%S'</span>`<span class="string">''</span></span></span><br><span class="line"><span class="meta">#获取相关登陆信息</span></span><br><span class="line">name=`hostname`</span><br><span class="line">ip=`ifconfig eth0|awk -F <span class="string">'[ :]+'</span> <span class="string">'NR==2 &#123;print $3&#125;'</span>`</span><br><span class="line">user=`whoami`</span><br><span class="line">_ip=`who am i |awk -F <span class="string">'[()]'</span> <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line">_time=`date <span class="string">'+%Y-%m-%d-%H:%M:%S'</span>`</span><br><span class="line"><span class="meta">#查询登陆地址并返回相应信息</span></span><br><span class="line">addr=`curl -q -s http://freeapi.ipip.net/$_ip | awk -F <span class="string">'"'</span> <span class="string">'&#123;print $2"-"$4"-"$6&#125;'</span>`</span><br><span class="line"><span class="meta">#自定义接入钉钉函数</span></span><br><span class="line">function SendMessageToDingding()&#123;</span><br><span class="line">    <span class="meta">#钉钉地址</span></span><br><span class="line">        url=<span class="string">"https://oapi.dingtalk.com/robot/send?access_token=11030e780f87aee0e5849dc488072940405c03aefa66341cde7e3a3d09916583"</span></span><br><span class="line">    <span class="meta">#推送到钉钉</span></span><br><span class="line">        res=`curl -XPOST -s -L -H <span class="string">"Content-Type:application/json"</span> -H <span class="string">"charset:utf-8"</span> $url -d <span class="string">"</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">        \"</span>msgtype\<span class="string">": \"</span>text\<span class="string">", </span></span><br><span class="line"><span class="string">        \"</span>text\<span class="string">": &#123;</span></span><br><span class="line"><span class="string">                 \"</span>content\<span class="string">": \"</span>监控主机名：$1\n主机IP: $2\n 登陆用户：$3\n 登陆IP: $4\nIP归属：$5\n登陆时间：$6\<span class="string">"</span></span><br><span class="line"><span class="string">                 &#125;</span></span><br><span class="line"><span class="string">    &#125;"</span>`</span><br><span class="line">        echo $res</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#subject=`echo -e $msg`</span></span><br><span class="line">body=<span class="string">"ECS监控ssh登陆"</span></span><br><span class="line"><span class="meta">#SendMessageToDingding $subject $body</span></span><br><span class="line"><span class="meta">#调用函数</span></span><br><span class="line">SendMessageToDingding $name $ip $user $_ip $addr $_time $body</span><br></pre></td></tr></table></figure>

<p>将脚本文件放置在 /etc/profile.d/ 文件目录下，即可实现登陆时，发送相关告警至钉钉</p>
<p>效果如下：<br><img src="\image\image-20210325100413140.png"></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>nmk</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://nmk0718.github.io/2020/10/16/Process/">http://nmk0718.github.io/2020/10/16/Process/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2020 <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/Process/"># Process</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/10/17/Kunbernetes自动化部署/">Kunbernetes自动化部署</a>
            
            
            <a class="next" rel="next" href="/2020/10/16/Loki/">Loki</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© nmk | Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span>
	</div>
</footer>

    </div>
</body>
</html>

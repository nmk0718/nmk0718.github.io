<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>helm | K&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">nimingkun&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/app">App</a>
                
                    <a class="menu-item" href="/game">Game</a>
                
                    <a class="menu-item" href="/media">Media</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">nimingkun&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/app">App</a>
                
                    <a class="menu-item" href="/game">Game</a>
                
                    <a class="menu-item" href="/media">Media</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">helm</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">nmk</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">2024-8-23&nbsp;&nbsp;16:29:00</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h3 id="安装helm"><a href="#安装helm" class="headerlink" title="安装helm"></a>安装helm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># mac下载</span><br><span class="line">wget https://get.helm.sh/helm-v3.14.3-darwin-amd64.tar.gz</span><br><span class="line"># linux下载</span><br><span class="line">wget https://get.helm.sh/helm-v3.14.3-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf helm-v3.14.3-darwin-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">sudo mv darwin-amd64/helm /usr/local/bin/helm</span><br><span class="line"></span><br><span class="line">helm version</span><br><span class="line">version.BuildInfo&#123;Version:&quot;v3.14.3&quot;, GitCommit:&quot;f03cc04caaa8f6d7c3e67cf918929150cf6f3f12&quot;, GitTreeState:&quot;clean&quot;,GoVersion:&quot;go1.21.7&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>mac需要去 <code>系统设置&gt;隐私与安全性&gt;安全性</code> 允许helm运行</p>
<h3 id="helm命令"><a href="#helm命令" class="headerlink" title="helm命令"></a>helm命令</h3><h4 id="helm-create"><a href="#helm-create" class="headerlink" title="helm create"></a>helm create</h4><p>该命令用于初始化一个新的 Helm Chart。Helm Chart 是 Kubernetes 应用的包，包含了运行应用所需的所有资源定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">helm create nmk-app</span><br><span class="line">➜ ~ tree nmk-app</span><br><span class="line">nmk-app</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── charts</span><br><span class="line">├── templates</span><br><span class="line">│   ├── NOTES.txt</span><br><span class="line">│   ├── _helpers.tpl</span><br><span class="line">│   ├── deployment.yaml</span><br><span class="line">│   ├── hpa.yaml</span><br><span class="line">│   ├── ingress.yaml</span><br><span class="line">│   ├── service.yaml</span><br><span class="line">│   ├── serviceaccount.yaml</span><br><span class="line">│   └── tests</span><br><span class="line">│       └── test-connection.yaml</span><br><span class="line">└── values.yaml</span><br></pre></td></tr></table></figure>

<h4 id="helm-install"><a href="#helm-install" class="headerlink" title="helm install"></a>helm install</h4><p>用于将 Helm Chart 安装到 Kubernetes 集群中。它会创建所有定义在 Chart 中的资源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜ ~ helm install nmk-app nmk-app</span><br><span class="line">NAME: nmk-app</span><br><span class="line">LAST DEPLOYED: Mon Aug 23 16:06:14 2024</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br></pre></td></tr></table></figure>

<h4 id="helm-upgrade"><a href="#helm-upgrade" class="headerlink" title="helm upgrade"></a>helm upgrade</h4><p>用于升级已安装的 Helm Chart 到新版本。可以修改 Chart 的配置和资源。</p>
<p>将已有的 release 升级到一个新版本的 chart</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜ ~ helm upgrade nmk-app nmk-app</span><br><span class="line">Release &quot;nmk-app&quot; has been upgraded. Happy Helming!</span><br><span class="line">NAME: nmk-app</span><br><span class="line">LAST DEPLOYED: Mon Aug 26 16:07:57 2024</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 2</span><br><span class="line">TEST SUITE: None</span><br></pre></td></tr></table></figure>

<h4 id="helm-rollback"><a href="#helm-rollback" class="headerlink" title="helm rollback"></a>helm rollback</h4><p>当 Helm Chart 升级后出现问题时，可以使用该命令回滚到之前的版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜ ~ helm rollback nmk-app 1</span><br><span class="line">Rollback was a success! Happy Helming!</span><br><span class="line">➜ ~ kubectl get pod  -n tke-docker-test -l app=nmk-app</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE</span><br><span class="line">nmk-app   1/1     Running   0          8m49s</span><br></pre></td></tr></table></figure>

<h4 id="helm-lint"><a href="#helm-lint" class="headerlink" title="helm lint"></a>helm lint</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜ ~ helm lint nmk-app</span><br><span class="line">==&gt; Linting nmk-app</span><br><span class="line">[INFO] Chart.yaml: icon is recommended</span><br><span class="line"></span><br><span class="line">1 chart(s) linted, 0 chart(s) failed</span><br><span class="line">#对1个chart进行了linting（代码审查），并且在审查过程中没有发现任何失败的问题</span><br></pre></td></tr></table></figure>

<h4 id="helm-show"><a href="#helm-show" class="headerlink" title="helm show"></a>helm show</h4><p>用于查看 Helm Chart 的内容，包括模板、配置文件和其他资源的定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">显示Chart的信息和元数据</span><br><span class="line"></span><br><span class="line">➜ ~ helm show chart nmk-app</span><br><span class="line">apiVersion: v2</span><br><span class="line">appVersion: 1.16.0</span><br><span class="line">description: A Helm chart for Kubernetes</span><br><span class="line">name: nmk-app</span><br><span class="line">type: application</span><br><span class="line">version: 0.1.0</span><br></pre></td></tr></table></figure>

<h4 id="helm-uninstall"><a href="#helm-uninstall" class="headerlink" title="helm uninstall"></a>helm uninstall</h4><p>移除已安装的 Helm Chart。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜ ~ helm uninstall nmk-app</span><br><span class="line">release &quot;nmk-app&quot; uninstalled</span><br></pre></td></tr></table></figure>

<h4 id="helm-pull"><a href="#helm-pull" class="headerlink" title="helm pull"></a>helm pull</h4><p>从远程仓库下载或拉取一个 Helm Chart 到本地。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜ ~ helm repo add stable https://charts.helm.sh/stable</span><br><span class="line">➜ ~ helm pull stable/mysql --version 1.6.9</span><br><span class="line">常用参数：</span><br><span class="line"></span><br><span class="line">--version：允许指定一个版本约束，用于下载特定版本的 Helm 图表。默认使用latest版本；</span><br><span class="line">--untar：下载Chart后是否自动解压缩。如果设置为true，则Helm会在下载后自动解压缩</span><br><span class="line">--untardir：指定图表提取到的目录；</span><br><span class="line">--repo：指定从中下载图表的存储库的 URL；</span><br><span class="line">--username和--password：提供访问私人存储库的凭证；</span><br><span class="line">--verify：可以在使用图表之前对其进行验证，确保图表的完整性和安全性。</span><br></pre></td></tr></table></figure>

<h3 id="制作helm-chart"><a href="#制作helm-chart" class="headerlink" title="制作helm chart"></a>制作helm chart</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">helm create nmk-app</span><br><span class="line">➜  Downloads tree nmk-app</span><br><span class="line">nmk-test</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── charts</span><br><span class="line">├── templates</span><br><span class="line">│   ├── NOTES.txt</span><br><span class="line">│   ├── _helpers.tpl</span><br><span class="line">│   ├── deployment.yaml</span><br><span class="line">│   ├── hpa.yaml</span><br><span class="line">│   ├── ingress.yaml</span><br><span class="line">│   ├── service.yaml</span><br><span class="line">│   ├── serviceaccount.yaml</span><br><span class="line">│   └── tests</span><br><span class="line">│       └── test-connection.yaml</span><br><span class="line">└── values.yaml</span><br></pre></td></tr></table></figure>

<p>删除没用的配置文件，只保留以下文件</p>
<h4 id="deployment-yaml"><a href="#deployment-yaml" class="headerlink" title="deployment.yaml"></a>deployment.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: &#123;&#123; .Values.appname &#125;&#125;</span><br><span class="line">  namespace: &#123;&#123; .Values.namespace &#125;&#125;</span><br><span class="line">  labels:</span><br><span class="line">    app: &#123;&#123; .Values.appname &#125;&#125;</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: &#123;&#123; .Values.appname &#125;&#125;</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 25%</span><br><span class="line">      maxUnavailable: 25%</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: &#123;&#123; .Values.appname &#125;&#125;</span><br><span class="line">    spec:</span><br><span class="line">      imagePullSecrets: </span><br><span class="line">        - name: &#123;&#123; .Values.imagepullsecrets &#125;&#125;</span><br><span class="line">      containers:</span><br><span class="line">        - name: &#123;&#123; .Values.appname &#125;&#125;</span><br><span class="line">          env:</span><br><span class="line">            - name: JAVA_OPTS</span><br><span class="line">              value: &#123;&#123; .Values.env.javaoptions &#125;&#125;</span><br><span class="line">          image: &quot;&#123;&#123; .Values.image.repository &#125;&#125;&#123;&#123; .Values.appname &#125;&#125;:&#123;&#123; .Values.image.tag &#125;&#125;&quot;</span><br><span class="line">          imagePullPolicy: &#123;&#123; .Values.image.pullPolicy &#125;&#125;</span><br><span class="line">          lifecycle:</span><br><span class="line">            preStop:</span><br><span class="line">              exec:</span><br><span class="line">                command:</span><br><span class="line">                - sleep</span><br><span class="line">                - 20s</span><br><span class="line">          readinessProbe:</span><br><span class="line">            failureThreshold: 10</span><br><span class="line">            httpGet:</span><br><span class="line">              path: /actuator/</span><br><span class="line">              port: &#123;&#123; .Values.service.port &#125;&#125;</span><br><span class="line">              scheme: HTTP</span><br><span class="line">            initialDelaySeconds: 10</span><br><span class="line">            periodSeconds: 15</span><br><span class="line">            successThreshold: 1</span><br><span class="line">            timeoutSeconds: 5</span><br><span class="line">          startupProbe:</span><br><span class="line">            failureThreshold: 10</span><br><span class="line">            httpGet:</span><br><span class="line">              path: /actuator/</span><br><span class="line">              port: &#123;&#123; .Values.service.port &#125;&#125;</span><br><span class="line">              scheme: HTTP</span><br><span class="line">            initialDelaySeconds: 10</span><br><span class="line">            periodSeconds: 10</span><br><span class="line">            successThreshold: 1</span><br><span class="line">            timeoutSeconds: 5</span><br><span class="line">          resources:</span><br><span class="line">            limits:</span><br><span class="line">              cpu: &#123;&#123; .Values.resource.limitCpu &#125;&#125;</span><br><span class="line">              memory: &#123;&#123; .Values.resource.limitMemory &#125;&#125;</span><br><span class="line">            requests:</span><br><span class="line">              cpu: &#123;&#123; .Values.resource.requestCpu &#125;&#125;</span><br><span class="line">              memory: &#123;&#123; .Values.resource.requestMemory &#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="service-yaml"><a href="#service-yaml" class="headerlink" title="service.yaml"></a>service.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: &#123;&#123; .Values.appname &#125;&#125;</span><br><span class="line">  namespace: &#123;&#123; .Values.namespace &#125;&#125;</span><br><span class="line">spec:</span><br><span class="line">  type: &#123;&#123; .Values.service.type &#125;&#125;</span><br><span class="line">  ports:</span><br><span class="line">    - port: &#123;&#123; .Values.service.port &#125;&#125;</span><br><span class="line">      targetPort: &#123;&#123; .Values.service.port &#125;&#125;</span><br><span class="line">      protocol: TCP</span><br><span class="line">      name: &#123;&#123; .Values.appname &#125;&#125;</span><br><span class="line">  selector:</span><br><span class="line">    app: &#123;&#123; .Values.appname &#125;&#125;</span><br><span class="line">  sessionAffinity: None</span><br></pre></td></tr></table></figure>

<h4 id="ingress-yaml"><a href="#ingress-yaml" class="headerlink" title="ingress.yaml"></a>ingress.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;- if .Values.ingress.enabled -&#125;&#125;</span><br><span class="line">&#123;&#123;- $fullName := .Values.appName -&#125;&#125;</span><br><span class="line">&#123;&#123;- $svcPort := .Values.service.port -&#125;&#125;</span><br><span class="line">&#123;&#123;- if and .Values.ingress.className (not (semverCompare &quot;&gt;=1.18-0&quot; .Capabilities.KubeVersion.GitVersion)) &#125;&#125;</span><br><span class="line">  &#123;&#123;- if not (hasKey .Values.ingress.annotations &quot;kubernetes.io/ingress.class&quot;) &#125;&#125;</span><br><span class="line">  &#123;&#123;- $_ := set .Values.ingress.annotations &quot;kubernetes.io/ingress.class&quot; .Values.ingress.className&#125;&#125;</span><br><span class="line">  &#123;&#123;- end &#125;&#125;</span><br><span class="line">&#123;&#123;- end &#125;&#125;</span><br><span class="line">&#123;&#123;- if semverCompare &quot;&gt;=1.19-0&quot; .Capabilities.KubeVersion.GitVersion -&#125;&#125;</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">&#123;&#123;- else if semverCompare &quot;&gt;=1.14-0&quot; .Capabilities.KubeVersion.GitVersion -&#125;&#125;</span><br><span class="line">apiVersion: networking.k8s.io/v1beta1</span><br><span class="line">&#123;&#123;- else -&#125;&#125;</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">&#123;&#123;- end &#125;&#125;</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: &#123;&#123; $fullName &#125;&#125;</span><br><span class="line">  namespace: &#123;&#123; .Values.namespace &#125;&#125;</span><br><span class="line">spec:</span><br><span class="line">  &#123;&#123;- if and .Values.ingress.className (semverCompare &quot;&gt;=1.18-0&quot; .Capabilities.KubeVersion.GitVersion) &#125;&#125;</span><br><span class="line">  ingressClassName: &#123;&#123; .Values.ingress.className &#125;&#125;</span><br><span class="line">  &#123;&#123;- end &#125;&#125;</span><br><span class="line">  &#123;&#123;- if .Values.ingress.tls &#125;&#125;</span><br><span class="line">  tls:</span><br><span class="line">    &#123;&#123;- range .Values.ingress.tls &#125;&#125;</span><br><span class="line">    - hosts:</span><br><span class="line">        &#123;&#123;- range .hosts &#125;&#125;</span><br><span class="line">        - &#123;&#123; . | quote &#125;&#125;</span><br><span class="line">        &#123;&#123;- end &#125;&#125;</span><br><span class="line">      secretName: &#123;&#123; .secretName &#125;&#125;</span><br><span class="line">    &#123;&#123;- end &#125;&#125;</span><br><span class="line">  &#123;&#123;- end &#125;&#125;</span><br><span class="line">  rules:</span><br><span class="line">    &#123;&#123;- range .Values.ingress.hosts &#125;&#125;</span><br><span class="line">    - host: &#123;&#123; .host | quote &#125;&#125;</span><br><span class="line">      http:</span><br><span class="line">        paths:</span><br><span class="line">          &#123;&#123;- range .paths &#125;&#125;</span><br><span class="line">          - path: &#123;&#123; .path &#125;&#125;</span><br><span class="line">            &#123;&#123;- if and .pathType (semverCompare &quot;&gt;=1.18-0&quot; $.Capabilities.KubeVersion.GitVersion) &#125;&#125;</span><br><span class="line">            pathType: &#123;&#123; .pathType &#125;&#125;</span><br><span class="line">            &#123;&#123;- end &#125;&#125;</span><br><span class="line">            backend:</span><br><span class="line">              &#123;&#123;- if semverCompare &quot;&gt;=1.19-0&quot; $.Capabilities.KubeVersion.GitVersion &#125;&#125;</span><br><span class="line">              service:</span><br><span class="line">                name: &#123;&#123; $fullName &#125;&#125;</span><br><span class="line">                port:</span><br><span class="line">                  number: &#123;&#123; $svcPort &#125;&#125;</span><br><span class="line">              &#123;&#123;- else &#125;&#125;</span><br><span class="line">              serviceName: &#123;&#123; $fullName &#125;&#125;</span><br><span class="line">              servicePort: &#123;&#123; $svcPort &#125;&#125;</span><br><span class="line">              &#123;&#123;- end &#125;&#125;</span><br><span class="line">          &#123;&#123;- end &#125;&#125;</span><br><span class="line">    &#123;&#123;- end &#125;&#125;</span><br><span class="line">&#123;&#123;- end &#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="values-yaml"><a href="#values-yaml" class="headerlink" title="values.yaml"></a>values.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">appname: nmk-app</span><br><span class="line"></span><br><span class="line">namespace: tke-docker-test</span><br><span class="line"></span><br><span class="line">replicaCount: 1</span><br><span class="line"></span><br><span class="line">image:</span><br><span class="line">  repository: helm-hub.com/nmk/</span><br><span class="line">  pullPolicy: IfNotPresent</span><br><span class="line">  tag: app-20240806110148</span><br><span class="line"></span><br><span class="line">imagepullsecrets: qcloudregistrykey</span><br><span class="line"></span><br><span class="line">env:</span><br><span class="line">  javaoptions: -Xms2g -Xmx2g -XX:MetaspaceSize=512M -XX:MaxMetaspaceSize=512M -Dspring.profiles.active=test -Dspring.cloud.consul.enabled=false -Dtsf.discovery.ribbon.enabled=false</span><br><span class="line"></span><br><span class="line">service:</span><br><span class="line">  type: ClusterIP</span><br><span class="line">  port: 8080</span><br><span class="line">  </span><br><span class="line">resource:</span><br><span class="line">  limitCpu: &apos;2&apos;</span><br><span class="line">  limitMemory: 2Gi</span><br><span class="line">  requestCpu: &apos;1&apos;</span><br><span class="line">  requestMemory: 1Gi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ingress:</span><br><span class="line">  enabled: true</span><br><span class="line">  className: &quot;nginx&quot;</span><br><span class="line">  annotations: &#123;&#125;</span><br><span class="line">    #kubernetes.io/ingress.class: nginx</span><br><span class="line">  hosts:</span><br><span class="line">    - host: nmk.com</span><br><span class="line">      paths:</span><br><span class="line">        - path: /</span><br><span class="line">          pathType: ImplementationSpecific</span><br><span class="line">  tls: </span><br><span class="line">    - secretName: ssl-2024</span><br><span class="line">      hosts:</span><br><span class="line">        - nmk.com</span><br></pre></td></tr></table></figure>

<h4 id="Chart-yaml"><a href="#Chart-yaml" class="headerlink" title="Chart.yaml"></a>Chart.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v2</span><br><span class="line">name: nmk-app</span><br><span class="line">description: A Helm chart for Kubernetes</span><br><span class="line">type: application</span><br><span class="line">version: 0.1.0</span><br><span class="line">appVersion: &quot;1.16.0&quot;</span><br></pre></td></tr></table></figure>

<h4 id="安装后查看"><a href="#安装后查看" class="headerlink" title="安装后查看"></a>安装后查看</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜ ~ Downloads helm list</span><br><span class="line">nmk-app        	default  	1       	2024-08-26 16:06:14.735267 +0800 CST   	deployed	nmk-app-0.1.0 	1.16.0</span><br><span class="line"></span><br><span class="line">➜ ~ Downloads kubectl get pods -n tke-docker-test</span><br><span class="line">nmk-app-6fdc57bd55-gx6mn                                    1/1     Running            0          117s</span><br><span class="line"></span><br><span class="line">➜ ~ Downloads kubectl get service -n tke-docker-test</span><br><span class="line">nmk-app                                    ClusterIP      172.31.159.244   &lt;none&gt;         8080/TCP                        4m14s</span><br><span class="line"></span><br><span class="line">➜ ~ Downloads kubectl get ingress -n tke-docker-test</span><br><span class="line">nmk-app                                 nginx    nmk.com                          10.30.150.3   80, 443   4m24s</span><br></pre></td></tr></table></figure>

<p>可使用以下参数指定变量进行多应用部署使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--set appName=demo --set version=v1.1</span><br></pre></td></tr></table></figure>

<p>参考文献：<br><a href="https://blog.csdn.net/dhf880913/article/details/138125561" target="_blank" rel="noopener">https://blog.csdn.net/dhf880913/article/details/138125561</a><br><a href="https://blog.csdn.net/zhuganlai168/article/details/131483308" target="_blank" rel="noopener">https://blog.csdn.net/zhuganlai168/article/details/131483308</a></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>nmk</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://nmk0718.github.io/2024/08/23/helm/">http://nmk0718.github.io/2024/08/23/helm/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2020 <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/helm/"># helm</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2024/08/27/hexo更换字体/">hexo更换字体</a>
            
            
            <a class="next" rel="next" href="/2024/07/22/容器内安装基础工具/">容器内安装基础工具</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© nmk | Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span>
	</div>
</footer>

    </div>
</body>
</html>
